<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-149147406-2"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-149147406-2');</script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script><script src="tooltips.js"></script><script src="reach-pre.js"></script><link rel="stylesheet" href="tooltips.css"><link rel="stylesheet" href="reach.css"><link rel="stylesheet" href="minted.css"><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>2.3&nbsp;Rock, Paper, and Scissors</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Reach:<span class="mywbr"> &nbsp;</span> The Safest and Easiest DApp Programming Language</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="overview.html" class="tocviewlink" data-pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="tut.html" class="tocviewselflink" data-pltdoc="x">Tutorial</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="guide.html" class="tocviewlink" data-pltdoc="x">Guide</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="workshop.html" class="tocviewlink" data-pltdoc="x">Workshop</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="ref.html" class="tocviewlink" data-pltdoc="x">Reference</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>2&nbsp;</td><td><a href="tut.html" class="tocviewlink" data-pltdoc="x">Tutorial</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="tut-0.html" class="tocviewlink" data-pltdoc="x">Install and Initialize</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="tut-1.html" class="tocviewlink" data-pltdoc="x">Scaffolding and Setup</a></td></tr><tr><td align="right">2.3&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Rock, Paper, and Scissors</a></td></tr><tr><td align="right">2.4&nbsp;</td><td><a href="tut-3.html" class="tocviewlink" data-pltdoc="x">Bets and Wagers</a></td></tr><tr><td align="right">2.5&nbsp;</td><td><a href="tut-4.html" class="tocviewlink" data-pltdoc="x">Trust and Commitments</a></td></tr><tr><td align="right">2.6&nbsp;</td><td><a href="tut-5.html" class="tocviewlink" data-pltdoc="x">Timeouts and Participation</a></td></tr><tr><td align="right">2.7&nbsp;</td><td><a href="tut-6.html" class="tocviewlink" data-pltdoc="x">Play and Play Again</a></td></tr><tr><td align="right">2.8&nbsp;</td><td><a href="tut-7.html" class="tocviewlink" data-pltdoc="x">Interaction and Independence</a></td></tr><tr><td align="right">2.9&nbsp;</td><td><a href="tut-8.html" class="tocviewlink" data-pltdoc="x">Interaction via web app</a></td></tr><tr><td align="right">2.10&nbsp;</td><td><a href="tut-9.html" class="tocviewlink" data-pltdoc="x">Onward and Further</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="tut-1.html" title="backward to &quot;2.2 Scaffolding and Setup&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="tut.html" title="up to &quot;2 Tutorial&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tut-3.html" title="forward to &quot;2.4 Bets and Wagers&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>2.3<tt>&nbsp;</tt><a name="(part._tut-2)"></a>Rock, Paper, and Scissors</h4><p>In this section, we&rsquo;ll have Alice and Bob actually execute the game of <span class="emph">Rock, Paper, Scissors!</span>.</p><p>We have to decide how to represent the hands of the game.
A simple way is to represent them as the numbers <code class="highlight"><span class="mi">0</span></code>, <code class="highlight"><span class="mi">1</span></code>, and <code class="highlight"><span class="mi">2</span></code>, standing for <span class="RktInBG"><span class="hspace"></span><span class="RktIn">Rock</span><span class="hspace"></span></span>, <span class="RktInBG"><span class="hspace"></span><span class="RktIn">Paper</span><span class="hspace"></span></span>, and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">Scissors</span><span class="hspace"></span></span>.
However, Reach does not support unsigned integers of exactly two bits, so it is better to represent them as the equivalence class of integers modulo three, so we won&rsquo;t distinguish between <code class="highlight"><span class="mi">0</span></code> and <code class="highlight"><span class="mi">3</span></code> as <span class="RktInBG"><span class="hspace"></span><span class="RktIn">Rock</span><span class="hspace"></span></span>.</p><p>We&rsquo;ll use a similar strategy for representing the three outcomes of the game: <span class="RktInBG"><span class="hspace"></span><span class="RktIn">B wins</span><span class="hspace"></span></span>, <span class="RktInBG"><span class="hspace"></span><span class="RktIn">Draw</span><span class="hspace"></span></span>, and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">A wins</span><span class="hspace"></span></span>.</p><p>The first step is to change the Reach program to specify that Alice and Bob&rsquo;s frontends can be interacted with to get the move that they will play, and later informed of the outcome of the game.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-2/index.rsh"><span class="stt">tut-2/index.rsh</span></a><button class="btn" data-clipboard-text="'reach 0.1';

const Player =
      { getHand: Fun([], UInt),
        seeOutcome: Fun([UInt], Null) };

export const main =
  Reach.App(
    {},
    [['Alice', Player], ['Bob', Player]],
    (A, B) =&gt; {
      // ...
      exit(); });"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span> <span class="mi">1</span>    <span class="s1">&#39;reach 0.1&#39;</span><span class="p">;</span>
 <span class="mi">2</span>    
 <span class="mi">3</span>    <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">Player</span></font> <font class="badlink"><span class="o">=</span></font>
 <span class="mi">4</span>          <span class="p">{</span> <font class="badlink"><span class="nx">getHand</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Fun%29%29%29" class="nb" data-pltdoc="x">Fun</a><span class="p">([],</span> <a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">),</span>
 <span class="mi">5</span>            <font class="badlink"><span class="nx">seeOutcome</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Fun%29%29%29" class="nb" data-pltdoc="x">Fun</a><span class="p">([</span><a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">],</span> <a href="ref-programs-compute.html#%28reach._%28%28.Null%29%29%29" class="nb" data-pltdoc="x">Null</a><span class="p">)</span> <span class="p">};</span>
 <span class="mi">6</span>    
 <span class="mi">7</span>    <a href="ref-programs-module.html#%28reach._%28%28export%29%29%29" class="kd" data-pltdoc="x">export</a> <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">main</span></font> <font class="badlink"><span class="o">=</span></font>
 <span class="mi">8</span>      <a href="ref-programs-module.html#%28reach._%28%28.Reach%29%29%29" class="nb" data-pltdoc="x">Reach</a><span class="p">.</span><a href="ref-programs-module.html#%28reach._%28%28.App%29%29%29" class="nb" data-pltdoc="x">App</a><span class="p">(</span>
 <span class="mi">9</span>        <span class="p">{},</span>
<span class="mi">10</span>        <span class="p">[[</span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <font class="badlink"><span class="nx">Player</span></font><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <font class="badlink"><span class="nx">Player</span></font><span class="p">]],</span>
<span class="mi">11</span>        <span class="p">(</span><font class="badlink"><span class="nx">A</span></font><span class="p">,</span> <font class="badlink"><span class="nx">B</span></font><span class="p">)</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="p">..</span>          <span class="c1">// ...</span>
<span class="mi">26</span>          <a href="ref-programs-step.html#%28reach._%28%28exit%29%29%29" class="k" data-pltdoc="x">exit</a><span class="p">();</span> <span class="p">});</span>
</pre></div></div></p><ul><li><p>Lines 3 through 5 defines a <a href="ref-programs-module.html#%28tech._participant._interact._interface%29" class="techoutside" data-pltdoc="x"><span class="techinside">participant interact interface</span></a> that will be shared between the two players.
In this case, it provides two methods: <code class="highlight"><font class="badlink"><span class="nx">getHand</span></font></code>, which returns a number; and <code class="highlight"><font class="badlink"><span class="nx">seeOutcome</span></font></code>, which receives a number.</p></li><li><p>Line 10 uses this interface for both participants.
Because of this line, <code class="highlight"><a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a></code> in the rest of the program will be bound to an object with methods corresponding to the these actions, which will connect to the <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a> of the corresponding participant.</p></li></ul><p>Before continuing with the Reach application, let&rsquo;s move over to the JavaScript interface and implement these methods in our <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a>.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-2/index.mjs#L14-L36"><span class="stt">tut-2/index.mjs</span></a><button class="btn" data-clipboard-text="  const HAND = ['Rock', 'Paper', 'Scissors'];
  const OUTCOME = ['Bob wins', 'Draw', 'Alice wins'];
  const Player = (Who) =&gt; ({
    getHand: () =&gt; {
      const hand = Math.floor(Math.random() * 3);
      console.log(`${Who} played ${HAND[hand]}`);
      return hand;
    },
    seeOutcome: (outcome) =&gt; {
      console.log(`${Who} saw outcome ${OUTCOME[outcome]}`);
    },
  });

  await Promise.all([
    backend.Alice(
      stdlib, ctcAlice,
      Player('Alice'),
    ),
    backend.Bob(
      stdlib, ctcBob,
      Player('Bob'),
    ),
  ]);"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mf">14</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">HAND</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">[</span><span class="s1">&#39;Rock&#39;</span><span class="p">,</span> <span class="s1">&#39;Paper&#39;</span><span class="p">,</span> <span class="s1">&#39;Scissors&#39;</span><span class="p">];</span>
<span class="mf">15</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">OUTCOME</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">[</span><span class="s1">&#39;Bob wins&#39;</span><span class="p">,</span> <span class="s1">&#39;Draw&#39;</span><span class="p">,</span> <span class="s1">&#39;Alice wins&#39;</span><span class="p">];</span>
<span class="mf">16</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">Player</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">Who</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">({</span>
<span class="mf">17</span>      <font class="badlink"><span class="nx">getHand</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mf">18</span>        <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">hand</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nb">Math</span></font><span class="p">.</span><font class="badlink"><span class="nx">floor</span></font><span class="p">(</span><font class="badlink"><span class="nb">Math</span></font><span class="p">.</span><font class="badlink"><span class="nx">random</span></font><span class="p">()</span> <font class="badlink"><span class="o">*</span></font> <span class="mf">3</span><span class="p">);</span>
<span class="mf">19</span>        <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">Who</span></font><span class="si">}</span><span class="sb"> played </span><span class="si">${</span><font class="badlink"><span class="nx">HAND</span></font><span class="p">[</span><font class="badlink"><span class="nx">hand</span></font><span class="p">]</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mf">20</span>        <font class="badlink"><span class="k">return</span></font> <font class="badlink"><span class="nx">hand</span></font><span class="p">;</span>
<span class="mf">21</span>      <span class="p">},</span>
<span class="mf">22</span>      <font class="badlink"><span class="nx">seeOutcome</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">(</span><font class="badlink"><span class="nx">outcome</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mf">23</span>        <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">Who</span></font><span class="si">}</span><span class="sb"> saw outcome </span><span class="si">${</span><font class="badlink"><span class="nx">OUTCOME</span></font><span class="p">[</span><font class="badlink"><span class="nx">outcome</span></font><span class="p">]</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mf">24</span>      <span class="p">},</span>
<span class="mf">25</span>    <span class="p">});</span>
<span class="mf">26</span>    
<span class="mf">27</span>    <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nb">Promise</span></font><span class="p">.</span><font class="badlink"><span class="nx">all</span></font><span class="p">([</span>
<span class="mf">28</span>      <a href="ref-backend-js.html#%28javascript._%28%28backend%29%29%29" class="nx" data-pltdoc="x">backend</a><span class="p">.</span><font class="badlink"><span class="nx">Alice</span></font><span class="p">(</span>
<span class="mf">29</span>        <a href="ref-backend-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">,</span> <font class="badlink"><span class="nx">ctcAlice</span></font><span class="p">,</span>
<span class="mf">30</span>        <font class="badlink"><span class="nx">Player</span></font><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">),</span>
<span class="mf">31</span>      <span class="p">),</span>
<span class="mf">32</span>      <a href="ref-backend-js.html#%28javascript._%28%28backend%29%29%29" class="nx" data-pltdoc="x">backend</a><span class="p">.</span><font class="badlink"><span class="nx">Bob</span></font><span class="p">(</span>
<span class="mf">33</span>        <a href="ref-backend-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">,</span> <font class="badlink"><span class="nx">ctcBob</span></font><span class="p">,</span>
<span class="mf">34</span>        <font class="badlink"><span class="nx">Player</span></font><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">),</span>
<span class="mf">35</span>      <span class="p">),</span>
<span class="mf">36</span>    <span class="p">]);</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Lines 14 and 15 define arrays to hold the meaning of the hands and outcomes.</p></li><li><p>Line 16 defines a constructor for the <code class="highlight"><font class="badlink"><span class="nx">Player</span></font></code> implementation.</p></li><li><p>Lines 17 through 21 define the <code class="highlight"><font class="badlink"><span class="nx">getHand</span></font></code> method.</p></li><li><p>Lines 22 through 24 define the <code class="highlight"><font class="badlink"><span class="nx">seeOutcome</span></font></code> method.</p></li><li><p>Finally, lines 30 and 34 instantiate the implementation once for Alice and once for Bob.
These are the actual objects that will be bound to <code class="highlight"><a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a></code> in the Reach program.</p></li></ul><p>There should be nothing interesting or controversial about these implementations; that&rsquo;s the point of Reach: we get to just write normal business logic without worrying about the details of the <a href="ref-model.html#%28tech._consensus._network%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus network</span></a> and decentralized application.</p><p>Let&rsquo;s return to the Reach program and look inside of the body of the program for what actions Alice and Bob take.</p><p>In a real-life game of <span class="emph">Rock, Paper, Scissors!</span>, Alice and Bob simultaneously decide what hand they will play and reveal it at the same time.
"Simultaneity" is a complex concept that is hard to realize in practice.
For example, if you&rsquo;ve ever player against a little kid, you may notice them trying to see what you&rsquo;re going to choose and delaying until the last minute to show their hand so they will win.
In a decentralized application, it is not possible to have simultaneity.
Instead, we have to select a particular participant who will "go first".
In this case, we&rsquo;ll choose Alice.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Does Alice go first, or do we call the player that goes first "Alice"?
This might seem like an unnecessary distinction to make, but it is a very subtle point about the way that Reach works.
In our <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a>, we explicitly ran <code class="highlight"><font class="badlink"><span class="nx">backend</span></font><span class="p">.</span><font class="badlink"><span class="nx">Alice</span></font></code> and <code class="highlight"><font class="badlink"><span class="nx">backend</span></font><span class="p">.</span><font class="badlink"><span class="nx">Bob</span></font></code>.
When we did that, we were committing that particular JavaScript thread to be either Alice or Bob.
In our game, whoever chose to run the Alice backend is the one that will go first.
In other words, <span style="font-weight: bold">Alice goes first</span>.
This will be more obvious at <a href="tut-7.html" data-pltdoc="x">the end of the tutorial</a> when we&rsquo;ll make the choice interactively about which role to play.</p></blockquote></blockquote></blockquote><p>The game proceeds in three steps.</p><p>First, Alice&rsquo;s backend interacts with her frontend, gets her hand, and publishes it.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-2/index.rsh#L12-L15"><span class="stt">tut-2/index.rsh</span></a><button class="btn" data-clipboard-text="      A.only(() =&gt; {
        const handA = declassify(interact.getHand()); });
      A.publish(handA);
      commit();"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">12</span>    <font class="badlink"><span class="nx">A</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28only%29%29%29" class="k" data-pltdoc="x">only</a><span class="p">(()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">13</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">handA</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28declassify%29%29%29" class="k" data-pltdoc="x">declassify</a><span class="p">(</span><a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">getHand</span></font><span class="p">());</span> <span class="p">});</span>
<span class="mi">14</span>    <font class="badlink"><span class="nx">A</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">(</span><font class="badlink"><span class="nx">handA</span></font><span class="p">);</span>
<span class="mi">15</span>    <a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 12 states that this block of code is something that <span class="emph">only</span> <code class="highlight"><font class="badlink"><span class="nx">A</span></font></code> (i.e., Alice) performs.</p></li><li><p>That means that the variable, <code class="highlight"><font class="badlink"><span class="nx">handA</span></font></code>, bound on line 13 is known only to Alice.</p></li><li><p>Line 13 binds that value to the result of interacting with Alice through the <code class="highlight"><font class="badlink"><span class="nx">getHand</span></font></code> method, which we wrote in JavaScript.</p></li><li><p>Line 13 also <a href="ref-programs-local.html#%28tech._declassify%29" class="techoutside" data-pltdoc="x"><span class="techinside">declassifies</span></a> the value, because in Reach, all information from <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontends</span></a> is <a href="ref-programs-valid.html#%28tech._secret%29" class="techoutside" data-pltdoc="x"><span class="techinside">secret</span></a> until it is explicitly made public.</p></li><li><p>Line 14 has Alice <a href="ref-model.html#%28tech._join%29" class="techoutside" data-pltdoc="x"><span class="techinside">join</span></a> the application by publishing the value to the <a href="ref-model.html#%28tech._consensus._network%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus network</span></a>, so it can be used to evaluate the outcome of the game.
Once this happens, the code is in a "<a href="ref-model.html#%28tech._consensus._step%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus step</span></a>" where all participants act together.</p></li><li><p>Line 15 commits the state of the <a href="ref-model.html#%28tech._consensus._network%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus network</span></a> and returns to "<a href="ref-model.html#%28tech._local._step%29" class="techoutside" data-pltdoc="x"><span class="techinside">local step</span></a>" where individual participants can act alone.</p></li></ul><p>The next step is similar, in that Bob publishes his hand; however, we don&rsquo;t immediately commit the state, instead we compute the outcome of the game.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-2/index.rsh#L17-L22"><span class="stt">tut-2/index.rsh</span></a><button class="btn" data-clipboard-text="      B.only(() =&gt; {
        const handB = declassify(interact.getHand()); });
      B.publish(handB);

      const outcome = (handA + (4 - handB)) % 3;
      commit();"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">17</span>    <font class="badlink"><span class="nx">B</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28only%29%29%29" class="k" data-pltdoc="x">only</a><span class="p">(()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">18</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">handB</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28declassify%29%29%29" class="k" data-pltdoc="x">declassify</a><span class="p">(</span><a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">getHand</span></font><span class="p">());</span> <span class="p">});</span>
<span class="mi">19</span>    <font class="badlink"><span class="nx">B</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">(</span><font class="badlink"><span class="nx">handB</span></font><span class="p">);</span>
<span class="mi">20</span>    
<span class="mi">21</span>    <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">outcome</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">handA</span></font> <a href="ref-programs-compute.html#%28reach._%28%28%2B%29%29%29" class="o" data-pltdoc="x">+</a> <span class="p">(</span><span class="mi">4</span> <a href="ref-programs-compute.html#%28reach._%28%28-%29%29%29" class="o" data-pltdoc="x">-</a> <font class="badlink"><span class="nx">handB</span></font><span class="p">))</span> <a href="ref-programs-compute.html#%28reach._%28%28~25%29%29%29" class="o" data-pltdoc="x">%</a> <span class="mi">3</span><span class="p">;</span>
<span class="mi">22</span>    <a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Lines 17 through 19 match Alice&rsquo;s similar <a href="ref-model.html#%28tech._local._step%29" class="techoutside" data-pltdoc="x"><span class="techinside">local step</span></a> and <a href="ref-model.html#%28tech._join%29" class="techoutside" data-pltdoc="x"><span class="techinside">join</span></a>ing of the application through a <a href="ref-model.html#%28tech._consensus._transfer%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus transfer</span></a> <a href="ref-model.html#%28tech._publication%29" class="techoutside" data-pltdoc="x"><span class="techinside">publication</span></a>.</p></li><li><p>But, line 21 computes the outcome of the game before committing.
(<code class="highlight"><span class="p">(</span><font class="badlink"><span class="nx">handA</span></font> <a href="ref-programs-compute.html#%28reach._%28%28%2B%29%29%29" class="o" data-pltdoc="x">+</a> <span class="p">(</span><span class="mi">4</span> <a href="ref-programs-compute.html#%28reach._%28%28-%29%29%29" class="o" data-pltdoc="x">-</a> <font class="badlink"><span class="nx">handB</span></font><span class="p">))</span> <a href="ref-programs-compute.html#%28reach._%28%28~25%29%29%29" class="o" data-pltdoc="x">%</a> <span class="mi">3</span></code> is a clever equation to compute the winner of a game of <span class="emph">Rock, Paper, Scissors!</span> using modular arithmetic.
Consider when <code class="highlight"><font class="badlink"><span class="nx">handA</span></font></code> is <code class="highlight"><span class="mi">0</span></code> (i.e., <span class="RktInBG"><span class="hspace"></span><span class="RktIn">Rock</span><span class="hspace"></span></span>) and <code class="highlight"><font class="badlink"><span class="nx">handB</span></font></code> is <code class="highlight"><span class="mi">2</span></code> (i.e., <span class="RktInBG"><span class="hspace"></span><span class="RktIn">Scissors</span><span class="hspace"></span></span>), then this equation is <code class="highlight"><span class="p">((</span><font class="badlink"><span class="nx">handA</span></font> <a href="ref-programs-compute.html#%28reach._%28%28%2B%29%29%29" class="o" data-pltdoc="x">+</a> <span class="p">(</span><span class="mi">4</span> <a href="ref-programs-compute.html#%28reach._%28%28-%29%29%29" class="o" data-pltdoc="x">-</a> <font class="badlink"><span class="nx">handB</span></font><span class="p">))</span> <a href="ref-programs-compute.html#%28reach._%28%28~25%29%29%29" class="o" data-pltdoc="x">%</a> <span class="mi">3</span><span class="p">)</span> <font class="badlink"><span class="o">=</span></font> <span class="p">((</span><span class="mi">0</span> <a href="ref-programs-compute.html#%28reach._%28%28%2B%29%29%29" class="o" data-pltdoc="x">+</a> <span class="p">(</span><span class="mi">4</span> <a href="ref-programs-compute.html#%28reach._%28%28-%29%29%29" class="o" data-pltdoc="x">-</a> <span class="mi">2</span><span class="p">))</span> <a href="ref-programs-compute.html#%28reach._%28%28~25%29%29%29" class="o" data-pltdoc="x">%</a> <span class="mi">3</span><span class="p">)</span> <font class="badlink"><span class="o">=</span></font> <span class="p">((</span><span class="mi">0</span> <a href="ref-programs-compute.html#%28reach._%28%28%2B%29%29%29" class="o" data-pltdoc="x">+</a> <span class="mi">2</span><span class="p">)</span> <a href="ref-programs-compute.html#%28reach._%28%28~25%29%29%29" class="o" data-pltdoc="x">%</a> <span class="mi">3</span><span class="p">)</span> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><span class="mi">2</span> <a href="ref-programs-compute.html#%28reach._%28%28~25%29%29%29" class="o" data-pltdoc="x">%</a> <span class="mi">3</span><span class="p">)</span> <font class="badlink"><span class="o">=</span></font> <span class="mi">2</span></code>, which is the last outcome, that is <span class="RktInBG"><span class="hspace"></span><span class="RktIn">A wins</span><span class="hspace"></span></span>, as we expect it to be.)</p></li></ul><p>Finally, we use the <a href="ref-programs-step.html#%28tech._each%29" class="techoutside" data-pltdoc="x"><span class="techinside">each</span></a> form to have each of the participants send the final outcome to their frontends.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-2/index.rsh#L24-L25"><span class="stt">tut-2/index.rsh</span></a><button class="btn" data-clipboard-text="      each([A, B], () =&gt; {
        interact.seeOutcome(outcome); });"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">24</span>    <a href="ref-programs-step.html#%28reach._%28%28each%29%29%29" class="k" data-pltdoc="x">each</a><span class="p">([</span><font class="badlink"><span class="nx">A</span></font><span class="p">,</span> <font class="badlink"><span class="nx">B</span></font><span class="p">],</span> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">25</span>      <a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">seeOutcome</span></font><span class="p">(</span><font class="badlink"><span class="nx">outcome</span></font><span class="p">);</span> <span class="p">});</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 24 states that this is a <a href="ref-model.html#%28tech._local._step%29" class="techoutside" data-pltdoc="x"><span class="techinside">local step</span></a> that <a href="ref-programs-step.html#%28tech._each%29" class="techoutside" data-pltdoc="x"><span class="techinside">each</span></a> of the participants performs.</p></li></ul><p>At this point, we can run the program and see its output by running</p><p><span class="hspace">&nbsp;&nbsp;</span><span style="font-weight: bold"><span class="stt">$</span></span><span class="stt"> </span><span class="stt">./reach run</span></p><p>Since the players act randomly, the results will be different every time.
When I ran the program three times, this is the output I got:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">$ ./reach run</span></p></td></tr><tr><td><p><span class="stt">Alice played Scissors</span></p></td></tr><tr><td><p><span class="stt">Bob played Paper</span></p></td></tr><tr><td><p><span class="stt">Alice saw outcome Alice wins</span></p></td></tr><tr><td><p><span class="stt">Bob saw outcome Alice wins</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">$ ./reach run</span></p></td></tr><tr><td><p><span class="stt">Alice played Scissors</span></p></td></tr><tr><td><p><span class="stt">Bob played Paper</span></p></td></tr><tr><td><p><span class="stt">Alice saw outcome Alice wins</span></p></td></tr><tr><td><p><span class="stt">Bob saw outcome Alice wins</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">$ ./reach run</span></p></td></tr><tr><td><p><span class="stt">Alice played Paper</span></p></td></tr><tr><td><p><span class="stt">Bob played Rock</span></p></td></tr><tr><td><p><span class="stt">Alice saw outcome Alice wins</span></p></td></tr><tr><td><p><span class="stt">Bob saw outcome Alice wins</span></p></td></tr></table></p><p>Alice is pretty good at <span class="emph">Rock, Paper, Scissors!</span>!</p><p><a href="ref-model.html#%28tech._consensus._network%29" class="techoutside" data-pltdoc="x"><span class="techinside">Consensus networks</span></a> in general, and Reach specifically, guarantee that all participants agree on the outcome of their decentralized computation.
Indeed, this is where the name <a href="ref-model.html#%28tech._consensus._network%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus network</span></a> comes from, as they enable these distributed, and untrusted, parties to come to a consensus, or agreement, about the intermediate states of a computation; and if they agree on the intermediate states, they will also agree on the output.
That&rsquo;s why every time you run <span class="stt">./reach run</span>, both Alice and Bob will see the same outcome!</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>If your version isn&rsquo;t working, look at the complete versions of <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-2/index.rsh"><span class="stt">tut-2/index.rsh</span></a> and <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-2/index.mjs"><span class="stt">tut-2/index.mjs</span></a> to make sure you copied everything down correctly!</p></blockquote></blockquote></blockquote><p>In <a href="tut-3.html" data-pltdoc="x">the next step</a>, we&rsquo;ll add some stakes to the game, because Alice needs to take her skills to the bank!</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="tut-1.html" title="backward to &quot;2.2 Scaffolding and Setup&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="tut.html" title="up to &quot;2 Tutorial&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tut-3.html" title="forward to &quot;2.4 Bets and Wagers&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div><script src="reach-post.js"></script></body></html>