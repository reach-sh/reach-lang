<p><i id="p_0" class="pid"></i>The Reach RPC Protocol (hereafter, "the protocol" or "it") is an instance of <a href="https://en.wikipedia.org/wiki/JSON">JSON</a>-based RPC protocol.<a href="#p_0" class="pid">0</a></p>
<p><i id="p_1" class="pid"></i>It should be transported over <a href="https://en.wikipedia.org/wiki/HTTPS">HTTPS</a> (i.e. HTTP over TLS).<a href="#p_1" class="pid">1</a></p>
<p>
  <i id="p_2" class="pid"></i>Requests must include an <code>X-API-Key</code> header whose value is a shared secret between a server instance and an RPC client, referred to as the <span class="term" id="term_API%20key">API key</span>.
  Typically this value comes from the environment variable <code>REACH_RPC_KEY</code> and is the <a href="https://en.wikipedia.org/wiki/Base64">Base64</a> encoding of 24 random bytes.<a href="#p_2" class="pid">2</a>
</p>
<p><i id="p_3" class="pid"></i>Requests must use the <code>POST</code> HTTP method.<a href="#p_3" class="pid">3</a></p>
<p><i id="p_4" class="pid"></i>Requests specify the RPC method to be invoked via the HTTP request target.<a href="#p_4" class="pid">4</a></p>
<p>
  <i id="p_5" class="pid"></i>Requests must include a <a href="https://en.wikipedia.org/wiki/JSON">JSON</a>-encoded array in their body.
  Requests should indicate this by setting the <code>Content-Type</code> header to <code>application/json; charset=utf-8</code>.
  This array is interpreted as the arguments to the RPC method.<a href="#p_5" class="pid">5</a>
</p>
<p>
  <i id="p_6" class="pid"></i>Responses must include a <a href="https://en.wikipedia.org/wiki/JSON">JSON</a>-encoded value in their body.
  Responses should indicate this by setting the <code>Content-Type</code> header to <code>application/json; charset=utf-8</code>.<a href="#p_6" class="pid">6</a>
</p>
<p><i id="p_7" class="pid"></i>Responses may include <span class="term" id="term_RPC%20handles">RPC handles</span>, which are strings that represent intermediate resources held on the RPC server that cannot be serialized to JSON.<a href="#p_7" class="pid">7</a></p>
<p><i id="p_8" class="pid"></i>RPC methods are either synchronous value RPC methods or interactive RPC methods.<a href="#p_8" class="pid">8</a></p>
<hr>
<p>
  <i id="p_9" class="pid"></i><span class="term" id="term_Synchronous%20value%20RPC%20methods">Synchronous value RPC methods</span> consume arguments and produce a single result without further interaction with the client.
  The result is the body of the response.<a href="#p_9" class="pid">9</a>
</p>
<p>
  <i id="p_10" class="pid"></i>For example, <span class="snip"><span style="color: #24292F">formatCurrency</span></span> is a synchronous value RPC method.
  A call to <span class="snip"><span style="color: #8250DF">formatCurrency</span><span style="color: #24292F">(</span><span style="color: #0A3069">"19283.1035819471"</span><span style="color: #24292F">, </span><span style="color: #0550AE">4</span><span style="color: #24292F">)</span></span> would be represented by the following HTTP session, with request lines indicated by <code>+</code> and response lines indicated by <code>-</code>:<a href="#p_10" class="pid">10</a>
</p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="+ POST /stdlib/formatCurrency HTTP/1.1
+ X-API-Key: OpenSesame
+ Content-Type: application/json; charset=utf-8
+
+ [ &quot;19283.1035819471&quot;, 4 ]

- HTTP/1.1 200 OK
- Content-Type: application/json; charset=utf-8
-
- &quot;19283.1035&quot;" href="#"></a></div><ol class="snippet"><li value="1">+ POST /stdlib/formatCurrency HTTP/1.1</li><li value="2">+ X-API-Key: OpenSesame</li><li value="3">+ Content-Type: application/json; charset=utf-8</li><li value="4">+</li><li value="5">+ [ "19283.1035819471", 4 ]</li><li value="6"></li><li value="7">- HTTP/1.1 200 OK</li><li value="8">- Content-Type: application/json; charset=utf-8</li><li value="9">-</li><li value="10">- "19283.1035"</li></ol></pre>
<hr>
<p><i id="p_11" class="pid"></i><span class="term" id="term_Interactive%20RPC%20methods">Interactive RPC methods</span> consume arguments, including a specification of interactive RPC callbacks, and produce an interactive RPC continuation.<a href="#p_11" class="pid">11</a></p>
<p><i id="p_12" class="pid"></i>An <span class="term" id="term_interactive%20RPC%20callback">interactive RPC callback</span> is a key of a JSON object, bound to <span class="snip"><span style="color: #0550AE">true</span></span>, that indicates that the initiator of an interactive RPC method responds to requests for further data during the execution of this call.<a href="#p_12" class="pid">12</a></p>
<p><i id="p_13" class="pid"></i>An <span class="term" id="term_interactive%20RPC%20continuation">interactive RPC continuation</span> is a JSON object that matches either:<a href="#p_13" class="pid">13</a></p>
<ul>
  <li><i id="p_14" class="pid"></i><span class="snip"><span style="color: #24292F">{</span><span style="color: #953800">t</span><span style="color: #24292F">: </span><span style="color: #0A3069">"Done"</span><span style="color: #24292F">, ans}</span></span>, where <span class="snip"><span style="color: #24292F">ans</span></span> is the final result of the original interactive RPC method.<a href="#p_14" class="pid">14</a></li>
  <li><i id="p_15" class="pid"></i><span class="snip"><span style="color: #24292F">{</span><span style="color: #953800">t</span><span style="color: #24292F">: </span><span style="color: #0A3069">"Kont"</span><span style="color: #24292F">, kid, m, args}</span></span>, where <span class="snip"><span style="color: #24292F">kid</span></span> is an RPC handle, <span class="snip"><span style="color: #24292F">m</span></span> is a string naming one of the interactive RPC callback methods, and <span class="snip"><span style="color: #24292F">args</span></span> is an array of the arguments to that method.<a href="#p_15" class="pid">15</a></li>
</ul>
<p>
  <i id="p_16" class="pid"></i>When a <span class="snip"><span style="color: #CF222E">!</span><span style="color: #24292F">js}</span></span>Kont`` value is produced, then the interactive RPC method is suspended until the <code>/kont</code> RPC method is invoked with the continuation RPC handle and the return value of the interactive RPC callback.
  The result of the <code>/kont</code> RPC method is another interactive RPC continuation.<a href="#p_16" class="pid">16</a>
</p>
<p><i id="p_17" class="pid"></i>Clients may perform any RPC methods while an interactive RPC method is suspended.<a href="#p_17" class="pid">17</a></p>
<p><i id="p_18" class="pid"></i>The server may re-use the same interactive RPC continuation handle many times.<a href="#p_18" class="pid">18</a></p>
<p>
  <i id="p_19" class="pid"></i>For example, the execution of a backend is an interactive RPC method.
  An example interaction might be represented by the following HTTP session, with request lines indicated by <code>+</code> and response lines indicated by <code>-</code>:<a href="#p_19" class="pid">19</a>
</p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="+ POST /backend/Alice HTTP/1.1
+ X-API-Key: OpenSesame
+ Content-Type: application/json; charset=utf-8
+
+ [ &quot;Contract-42&quot;, { &quot;price&quot;: 10 }, { &quot;showX&quot;: true } ]

- HTTP/1.1 200 OK
- Content-Type: application/json; charset=utf-8
-
- { t: &quot;Kont&quot;, kid: &quot;Kont-A&quot;, m: &quot;showX&quot;, args: [ &quot;19283.1035819471&quot; ] }

+ POST /stdlib/formatCurrency HTTP/1.1
+ X-API-Key: OpenSesame
+ Content-Type: application/json; charset=utf-8
+
+ [ &quot;19283.1035819471&quot;, 4 ]

- HTTP/1.1 200 OK
- Content-Type: application/json; charset=utf-8
-
- &quot;19283.1035&quot;

+ POST /kont HTTP/1.1
+ X-API-Key: OpenSesame
+ Content-Type: application/json; charset=utf-8
+
+ [ &quot;Kont-A&quot;, null ]

- HTTP/1.1 200 OK
- Content-Type: application/json; charset=utf-8
-
- { t: &quot;Done&quot;, ans: null }" href="#"></a></div><ol class="snippet"><li value="1">+ POST /backend/Alice HTTP/1.1</li><li value="2">+ X-API-Key: OpenSesame</li><li value="3">+ Content-Type: application/json; charset=utf-8</li><li value="4">+</li><li value="5">+ [ "Contract-42", { "price": 10 }, { "showX": true } ]</li><li value="6"></li><li value="7">- HTTP/1.1 200 OK</li><li value="8">- Content-Type: application/json; charset=utf-8</li><li value="9">-</li><li value="10">- { t: "Kont", kid: "Kont-A", m: "showX", args: [ "19283.1035819471" ] }</li><li value="11"></li><li value="12">+ POST /stdlib/formatCurrency HTTP/1.1</li><li value="13">+ X-API-Key: OpenSesame</li><li value="14">+ Content-Type: application/json; charset=utf-8</li><li value="15">+</li><li value="16">+ [ "19283.1035819471", 4 ]</li><li value="17"></li><li value="18">- HTTP/1.1 200 OK</li><li value="19">- Content-Type: application/json; charset=utf-8</li><li value="20">-</li><li value="21">- "19283.1035"</li><li value="22"></li><li value="23">+ POST /kont HTTP/1.1</li><li value="24">+ X-API-Key: OpenSesame</li><li value="25">+ Content-Type: application/json; charset=utf-8</li><li value="26">+</li><li value="27">+ [ "Kont-A", null ]</li><li value="28"></li><li value="29">- HTTP/1.1 200 OK</li><li value="30">- Content-Type: application/json; charset=utf-8</li><li value="31">-</li><li value="32">- { t: "Done", ans: null }</li></ol></pre>