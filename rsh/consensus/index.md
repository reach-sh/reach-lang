[{"bookPath":"","title":"Consensus Steps","titleId":"ref-programs-consensus","hasOtp":true,"hasPageHeader":true},"<p>\n  <i id=\"p_0\" class=\"pid\"></i>A Reach consensus step occurs in the continuation of a consensus transfer statement.\n  It represents the actions taken by the consensus network contract of an application.<a href=\"#p_0\" class=\"pid\">0</a>\n</p>\n<h2 id=\"ref-programs-consensus-stmts\" class=\"refHeader\">Statements<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ref-programs-consensus-stmts\"><span class=\"icon icon-link\"></span></a></h2>\n<p>\n  <i id=\"p_1\" class=\"pid\"></i>Any statements valid for a <a href=\"/rsh/compute/#ref-programs-compute-stmts\">computation</a> are valid for a consensus step.\n  However, some additional statements are allowed.<a href=\"#p_1\" class=\"pid\">1</a>\n</p>\n<h3 id=\"commit\" class=\"refHeader\"><code>commit</code><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#commit\"><span class=\"icon icon-link\"></span></a></h3>\n<p><span class=\"ref\" id=\"rsh_commit\" data-scope=\"rsh\" data-symbol=\"commit\"></span></p>\n<pre class=\"snippet unnumbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"commit();\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li></ol></pre>\n<p><i id=\"p_2\" class=\"pid\"></i>A <span class=\"term\" id=\"term_commit%20statement\">commit statement</span>, written <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></span>, commits to statement's continuation as the next step of the DApp computation. In other words, it ends the current consensus step and allows more local steps.<a href=\"#p_2\" class=\"pid\">2</a></p>\n<p><i id=\"p_3\" class=\"pid\"></i>For example, in the code below, the <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></span> on line 79 allows <code>Alice</code> to perform a local step after a consensus step:<a href=\"#p_3\" class=\"pid\">3</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-loops/index.rsh\">/examples/rps-7-loops/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    Bob.publish(handBob)\n      .timeout(relativeTime(deadline), () => closeTo(Alice, informTimeout));\n    commit();\n\n    Alice.only(() => {\n      const saltAlice = declassify(_saltAlice);\n      const handAlice = declassify(_handAlice);\n    });\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"77\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">Bob</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">(handBob)</span></li><li value=\"78\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/step/#rsh_timeout\" title=\"rsh: timeout\"><span style=\"color: var(--shiki-token-function)\">.timeout</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_relativeTime\" title=\"rsh: relativeTime\"><span style=\"color: var(--shiki-token-function)\">relativeTime</span></a><span style=\"color: var(--shiki-color-text)\">(deadline)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/step/#rsh_closeTo\" title=\"rsh: closeTo\"><span style=\"color: var(--shiki-token-function)\">closeTo</span></a><span style=\"color: var(--shiki-color-text)\">(Alice</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> informTimeout));</span></li><li value=\"79\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"80\"></li><li value=\"81\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">Alice</span><a href=\"/rsh/step/#rsh_only\" title=\"rsh: only\"><span style=\"color: var(--shiki-token-function)\">.only</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"82\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">saltAlice</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: var(--shiki-token-function)\">declassify</span></a><span style=\"color: var(--shiki-color-text)\">(_saltAlice);</span></li><li value=\"83\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">handAlice</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: var(--shiki-token-function)\">declassify</span></a><span style=\"color: var(--shiki-color-text)\">(_handAlice);</span></li><li value=\"84\"><span style=\"color: var(--shiki-color-text)\">    });</span></li></ol></pre>\n<h3 id=\"ref-programs-only-consensus\" class=\"refHeader\"><code>only</code> and <code>each</code><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ref-programs-only-consensus\"><span class=\"icon icon-link\"></span></a></h3>\n<p><i id=\"p_4\" class=\"pid\"></i><a href=\"/rsh/step/#ref-programs-only-step\">only and each</a> are allowed in consensus steps and are executed by backends once they observe the completion of the consensus step (i.e., after the associated commit statement.)<a href=\"#p_4\" class=\"pid\">4</a></p>\n<h3 id=\"ref-programs-consensus-view\" class=\"refHeader\">View Objects<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ref-programs-consensus-view\"><span class=\"icon icon-link\"></span></a></h3>\n<div class=\"note\">\n  <p>\n    <i id=\"p_5\" class=\"pid\"></i>Views are <a href=\"/rsh/appinit/#ref-programs-appinit-view\">defined in application initialization</a> in Reach.\n    They are <a href=\"/frontend/#ref-frontends-js-ctc\">accessed by frontends</a> by using the Reach standard library of the frontend language, such as JavaScript.\n    This section is about defining the value of a view in your Reach program.<a href=\"#p_5\" class=\"pid\">5</a>\n  </p>\n</div>\n<pre class=\"snippet unnumbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"vNFT.owner.set(creator);\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: var(--shiki-token-constant)\">vNFT</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">owner</span><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(creator);</span></li></ol></pre>\n<p>\n  <i id=\"p_6\" class=\"pid\"></i>If <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">VIEW</span></span> is a <span class=\"term\" id=\"term_view%20object\">view object</span>, then its fields are the elements of the associated view.\n  Each of these fields are bound to an object with a <code>set</code> method that accepts the function or value to be bound to that view at the current step, and all steps dominated by the current step (unless otherwise overridden).\n  If this function is not provided with an argument, then the corresponding view is unset.<a href=\"#p_6\" class=\"pid\">6</a>\n</p>\n<p><i id=\"p_7\" class=\"pid\"></i>For example, consider the following program:<a href=\"#p_7\" class=\"pid\">7</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/view-steps/index.rsh\">/examples/view-steps/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"'reach 0.1';\n\nconst Tlast = Maybe(Address);\nconst Ti = Maybe(UInt);\nconst T = Tuple(Tlast, Ti);\nconst Common = { checkView: Fun([T], Null) };\n\nexport const main = Reach.App(() => {\n  const A = Participant('Alice', Common);\n  const B = Participant('Bob', Common);\n  const vMain = View('Main', { last: Address, i: UInt });\n  init();\n\n  A.publish(); commit();\n\n  // The contract doesn't exist yet, so no view\n  A.interact.checkView([Tlast.None(), Ti.None()]);\n\n  A.publish();\n  vMain.i.set(1);\n  vMain.last.set(A);\n  // These views are now visible\n  A.interact.checkView([Tlast.Some(A), Ti.Some(1)]);\n  commit();\n\n  // Block race of Alice and Bob for Alice to observe the state\n  A.publish();\n  commit();\n\n  B.publish();\n  vMain.i.set(2);\n  vMain.last.set(B);\n  if ( A != B ) {\n    // The views above are visible\n    A.interact.checkView([Tlast.Some(B), Ti.Some(2)]);\n    commit();\n  } else {\n    // Or, we overwrite them\n    vMain.i.set(3);\n    vMain.last.set();\n    A.interact.checkView([Tlast.None(), Ti.Some(3)]);\n    commit();\n  }\n\n  A.publish();\n  commit();\n  // The contract doesn't exist anymore, so no view\n  B.interact.checkView([Tlast.None(), Ti.None()]);\n\n  exit();\n});\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: var(--shiki-token-string-expression)\">'reach 0.1'</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"2\"></li><li value=\"3\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Tlast</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Maybe\" title=\"rsh: Maybe\"><span style=\"color: var(--shiki-token-function)\">Maybe</span></a><span style=\"color: var(--shiki-color-text)\">(Address);</span></li><li value=\"4\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Ti</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Maybe\" title=\"rsh: Maybe\"><span style=\"color: var(--shiki-token-function)\">Maybe</span></a><span style=\"color: var(--shiki-color-text)\">(UInt);</span></li><li value=\"5\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">T</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Tuple\" title=\"rsh: Tuple\"><span style=\"color: var(--shiki-token-function)\">Tuple</span></a><span style=\"color: var(--shiki-color-text)\">(Tlast</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Ti);</span></li><li value=\"6\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Common</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> { checkView</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([</span><span style=\"color: var(--shiki-token-constant)\">T</span><span style=\"color: var(--shiki-color-text)\">]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Null) };</span></li><li value=\"7\"></li><li value=\"8\"><a href=\"/rsh/module/#rsh_export\" title=\"rsh: export\"><span style=\"color: var(--shiki-token-keyword)\">export</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">main</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/module/#rsh_Reach\" title=\"rsh: Reach\"><span style=\"color: var(--shiki-token-constant)\">Reach</span></a><a href=\"/rsh/module/#rsh_Reach.App\" title=\"rsh: Reach.App\"><span style=\"color: var(--shiki-token-function)\">.App</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"9\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">A</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_Participant\" title=\"rsh: Participant\"><span style=\"color: var(--shiki-token-function)\">Participant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Alice'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Common);</span></li><li value=\"10\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">B</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_Participant\" title=\"rsh: Participant\"><span style=\"color: var(--shiki-token-function)\">Participant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Bob'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Common);</span></li><li value=\"11\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">vMain</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-token-function)\">View</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Main'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> { last</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> i</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> UInt });</span></li><li value=\"12\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/appinit/#rsh_init\" title=\"rsh: init\"><span style=\"color: var(--shiki-token-function)\">init</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"13\"></li><li value=\"14\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">A</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">(); </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"15\"></li><li value=\"16\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-comment)\">// The contract doesn't exist yet, so no view</span></li><li value=\"17\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">A</span><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.checkView</span><span style=\"color: var(--shiki-color-text)\">([</span><span style=\"color: var(--shiki-token-constant)\">Tlast</span><a href=\"/rsh/compute/#rsh_Maybe.None\" title=\"rsh: Maybe.None\"><span style=\"color: var(--shiki-token-function)\">.None</span></a><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Ti</span><a href=\"/rsh/compute/#rsh_Maybe.None\" title=\"rsh: Maybe.None\"><span style=\"color: var(--shiki-token-function)\">.None</span></a><span style=\"color: var(--shiki-color-text)\">()]);</span></li><li value=\"18\"></li><li value=\"19\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">A</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"20\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">vMain</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">i</span><a href=\"/rsh/compute/#rsh_Tuple.set\" title=\"rsh: Tuple.set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"21\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">vMain</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">last</span><a href=\"/rsh/compute/#rsh_Tuple.set\" title=\"rsh: Tuple.set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">A</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"22\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-comment)\">// These views are now visible</span></li><li value=\"23\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">A</span><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.checkView</span><span style=\"color: var(--shiki-color-text)\">([</span><span style=\"color: var(--shiki-token-constant)\">Tlast</span><a href=\"/rsh/compute/#rsh_Maybe.Some\" title=\"rsh: Maybe.Some\"><span style=\"color: var(--shiki-token-function)\">.Some</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">A</span><span style=\"color: var(--shiki-color-text)\">)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Ti</span><a href=\"/rsh/compute/#rsh_Maybe.Some\" title=\"rsh: Maybe.Some\"><span style=\"color: var(--shiki-token-function)\">.Some</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">)]);</span></li><li value=\"24\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"25\"></li><li value=\"26\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-comment)\">// Block race of Alice and Bob for Alice to observe the state</span></li><li value=\"27\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">A</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"28\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"29\"></li><li value=\"30\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">B</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"31\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">vMain</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">i</span><a href=\"/rsh/compute/#rsh_Tuple.set\" title=\"rsh: Tuple.set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">2</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"32\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">vMain</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">last</span><a href=\"/rsh/compute/#rsh_Tuple.set\" title=\"rsh: Tuple.set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">B</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"33\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_if\" title=\"rsh: if\"><span style=\"color: var(--shiki-token-keyword)\">if</span></a><span style=\"color: var(--shiki-color-text)\"> ( </span><span style=\"color: var(--shiki-token-constant)\">A</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_!=\" title=\"rsh: !=\"><span style=\"color: var(--shiki-token-keyword)\">!=</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">B</span><span style=\"color: var(--shiki-color-text)\"> ) {</span></li><li value=\"34\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-comment)\">// The views above are visible</span></li><li value=\"35\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">A</span><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.checkView</span><span style=\"color: var(--shiki-color-text)\">([</span><span style=\"color: var(--shiki-token-constant)\">Tlast</span><a href=\"/rsh/compute/#rsh_Maybe.Some\" title=\"rsh: Maybe.Some\"><span style=\"color: var(--shiki-token-function)\">.Some</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">B</span><span style=\"color: var(--shiki-color-text)\">)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Ti</span><a href=\"/rsh/compute/#rsh_Maybe.Some\" title=\"rsh: Maybe.Some\"><span style=\"color: var(--shiki-token-function)\">.Some</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">2</span><span style=\"color: var(--shiki-color-text)\">)]);</span></li><li value=\"36\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"37\"><span style=\"color: var(--shiki-color-text)\">  } </span><a href=\"/rsh/compute/#rsh_else\" title=\"rsh: else\"><span style=\"color: var(--shiki-token-keyword)\">else</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"38\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-comment)\">// Or, we overwrite them</span></li><li value=\"39\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">vMain</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">i</span><a href=\"/rsh/compute/#rsh_Tuple.set\" title=\"rsh: Tuple.set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">3</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"40\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">vMain</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">last</span><a href=\"/rsh/compute/#rsh_Tuple.set\" title=\"rsh: Tuple.set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"41\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">A</span><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.checkView</span><span style=\"color: var(--shiki-color-text)\">([</span><span style=\"color: var(--shiki-token-constant)\">Tlast</span><a href=\"/rsh/compute/#rsh_Maybe.None\" title=\"rsh: Maybe.None\"><span style=\"color: var(--shiki-token-function)\">.None</span></a><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Ti</span><a href=\"/rsh/compute/#rsh_Maybe.Some\" title=\"rsh: Maybe.Some\"><span style=\"color: var(--shiki-token-function)\">.Some</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">3</span><span style=\"color: var(--shiki-color-text)\">)]);</span></li><li value=\"42\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"43\"><span style=\"color: var(--shiki-color-text)\">  }</span></li><li value=\"44\"></li><li value=\"45\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">A</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"46\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"47\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-comment)\">// The contract doesn't exist anymore, so no view</span></li><li value=\"48\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">B</span><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.checkView</span><span style=\"color: var(--shiki-color-text)\">([</span><span style=\"color: var(--shiki-token-constant)\">Tlast</span><a href=\"/rsh/compute/#rsh_Maybe.None\" title=\"rsh: Maybe.None\"><span style=\"color: var(--shiki-token-function)\">.None</span></a><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Ti</span><a href=\"/rsh/compute/#rsh_Maybe.None\" title=\"rsh: Maybe.None\"><span style=\"color: var(--shiki-token-function)\">.None</span></a><span style=\"color: var(--shiki-color-text)\">()]);</span></li><li value=\"49\"></li><li value=\"50\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/step/#rsh_exit\" title=\"rsh: exit\"><span style=\"color: var(--shiki-token-function)\">exit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"51\"><span style=\"color: var(--shiki-color-text)\">});</span></li></ol></pre>\n<p>\n  <i id=\"p_8\" class=\"pid\"></i>In this program, the Reach backend calls the frontend <span class=\"snip\"><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-color-text)\">interact</span></a></span> function, <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">checkView</span></span> with the expected value of the views at each point in the program.\n  The frontend compares that value with what is returned by<a href=\"#p_8\" class=\"pid\">8</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"[ await ctc.getViews().Main.last(),\n  await ctc.getViews().Main.i() ]\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: var(--shiki-color-text)\">[ </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_ctc\" title=\"js: ctc\"><span style=\"color: var(--shiki-token-constant)\">ctc</span></a><a href=\"/frontend/#js_ctc.getViews\" title=\"js: ctc.getViews\"><span style=\"color: var(--shiki-token-function)\">.getViews</span></a><span style=\"color: var(--shiki-color-text)\">().</span><span style=\"color: var(--shiki-token-constant)\">Main</span><span style=\"color: var(--shiki-token-function)\">.last</span><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"2\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_ctc\" title=\"js: ctc\"><span style=\"color: var(--shiki-token-constant)\">ctc</span></a><a href=\"/frontend/#js_ctc.getViews\" title=\"js: ctc.getViews\"><span style=\"color: var(--shiki-token-function)\">.getViews</span></a><span style=\"color: var(--shiki-color-text)\">().</span><span style=\"color: var(--shiki-token-constant)\">Main</span><span style=\"color: var(--shiki-token-function)\">.i</span><span style=\"color: var(--shiki-color-text)\">() ]</span></li></ol></pre>\n<p><i id=\"p_9\" class=\"pid\"></i>When a view is bound to a function, it may inspect any values in its scope, including linear state.<a href=\"#p_9\" class=\"pid\">9</a></p>\n<h3 id=\"ref-programs-consensus-events\" class=\"refHeader\">Event Objects<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ref-programs-consensus-events\"><span class=\"icon icon-link\"></span></a></h3>\n<pre class=\"snippet unnumbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"Logger.log(4, x);\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: var(--shiki-token-constant)\">Logger</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">4</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> x);</span></li></ol></pre>\n<p>\n  <i id=\"p_10\" class=\"pid\"></i>If <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">EVENT</span></span> is an <span class=\"term\" id=\"term_event%20object\">event object</span>, then its fields are the elements of the associated event.\n  Each of these fields are a function, whose domain is specified by the <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_Events\" title=\"rsh: Events\"><span style=\"color: var(--shiki-color-text)\">Events</span></a></span> interface.<a href=\"#p_10\" class=\"pid\">10</a>\n</p>\n<p><i id=\"p_11\" class=\"pid\"></i>For example, consider the following program:<a href=\"#p_11\" class=\"pid\">11</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"'reach 0.1';\n\nexport const main = Reach.App(() => {\n  const A = Participant('A', {\n    getCtc: Fun([], Contract)\n  });\n  const E = Events('Announcer', {\n    announce: [UInt, Contract],\n  });\n  init();\n\n  A.publish();\n\n  var [ i ] = [ 0 ];\n  invariant(balance() == 0);\n  while (true) {\n    commit();\n    A.only(() => {\n      const ctc = declassify(interact.getCtc());\n    });\n    A.publish(ctc);\n\n    E.announce(i, ctc);\n\n    [ i ] = [ i + 1];\n    continue;\n  }\n\n  commit();\n\n});\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: var(--shiki-token-string-expression)\">'reach 0.1'</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"2\"></li><li value=\"3\"><a href=\"/rsh/module/#rsh_export\" title=\"rsh: export\"><span style=\"color: var(--shiki-token-keyword)\">export</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">main</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/module/#rsh_Reach\" title=\"rsh: Reach\"><span style=\"color: var(--shiki-token-constant)\">Reach</span></a><a href=\"/rsh/module/#rsh_Reach.App\" title=\"rsh: Reach.App\"><span style=\"color: var(--shiki-token-function)\">.App</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"4\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">A</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_Participant\" title=\"rsh: Participant\"><span style=\"color: var(--shiki-token-function)\">Participant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'A'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"5\"><span style=\"color: var(--shiki-color-text)\">    getCtc</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Contract)</span></li><li value=\"6\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"7\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">E</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_Events\" title=\"rsh: Events\"><span style=\"color: var(--shiki-token-function)\">Events</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Announcer'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"8\"><span style=\"color: var(--shiki-color-text)\">    announce</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> [UInt</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Contract]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"9\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"10\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/appinit/#rsh_init\" title=\"rsh: init\"><span style=\"color: var(--shiki-token-function)\">init</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"11\"></li><li value=\"12\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">A</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"13\"></li><li value=\"14\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_var\" title=\"rsh: var\"><span style=\"color: var(--shiki-token-keyword)\">var</span></a><span style=\"color: var(--shiki-color-text)\"> [ i ] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> [ </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\"> ];</span></li><li value=\"15\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_invariant\" title=\"rsh: invariant\"><span style=\"color: var(--shiki-token-function)\">invariant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_balance\" title=\"rsh: balance\"><span style=\"color: var(--shiki-token-function)\">balance</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"16\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-keyword)\">while</span></a><span style=\"color: var(--shiki-color-text)\"> (</span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a><span style=\"color: var(--shiki-color-text)\">) {</span></li><li value=\"17\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"18\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">A</span><a href=\"/rsh/step/#rsh_only\" title=\"rsh: only\"><span style=\"color: var(--shiki-token-function)\">.only</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"19\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctc</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: var(--shiki-token-function)\">declassify</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.getCtc</span><span style=\"color: var(--shiki-color-text)\">());</span></li><li value=\"20\"><span style=\"color: var(--shiki-color-text)\">    });</span></li><li value=\"21\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">A</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">(ctc);</span></li><li value=\"22\"></li><li value=\"23\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">E</span><span style=\"color: var(--shiki-token-function)\">.announce</span><span style=\"color: var(--shiki-color-text)\">(i</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> ctc);</span></li><li value=\"24\"></li><li value=\"25\"><span style=\"color: var(--shiki-color-text)\">    [ i ] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> [ i </span><a href=\"/rsh/compute/#rsh_+\" title=\"rsh: +\"><span style=\"color: var(--shiki-token-keyword)\">+</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">];</span></li><li value=\"26\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_continue\" title=\"rsh: continue\"><span style=\"color: var(--shiki-token-keyword)\">continue</span></a><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"27\"><span style=\"color: var(--shiki-color-text)\">  }</span></li><li value=\"28\"></li><li value=\"29\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"30\"></li><li value=\"31\"><span style=\"color: var(--shiki-color-text)\">});</span></li></ol></pre>\n<p>\n  <i id=\"p_12\" class=\"pid\"></i>In this program, there is an announcement made every loop; an event is emitted with the published\n  <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">ctc</span></span> and its corresponding index <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">i</span></span>.\n  A frontend may observe the values of these events with <span class=\"snip\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_ctc\" title=\"js: ctc\"><span style=\"color: var(--shiki-token-constant)\">ctc</span></a><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/frontend/#js_ctc.e\" title=\"js: ctc.e\"><span style=\"color: var(--shiki-token-constant)\">e</span></a><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">Announcer</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">announce</span><span style=\"color: var(--shiki-token-function)\">.next</span><span style=\"color: var(--shiki-color-text)\">()</span></span> or\n  <span class=\"snip\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_ctc\" title=\"js: ctc\"><span style=\"color: var(--shiki-token-constant)\">ctc</span></a><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/frontend/#js_ctc.e\" title=\"js: ctc.e\"><span style=\"color: var(--shiki-token-constant)\">e</span></a><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">Announcer</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">announce</span><span style=\"color: var(--shiki-token-function)\">.monitor</span><span style=\"color: var(--shiki-color-text)\">(announceHandler)</span></span> where <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">announceHandler</span></span> is a function.<a href=\"#p_12\" class=\"pid\">12</a>\n</p>\n<h3 id=\"participantset--and--set\" class=\"refHeader\"><code>Participant.set</code> and <code>.set</code><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#participantset--and--set\"><span class=\"icon icon-link\"></span></a></h3>\n<p><span class=\"ref\" id=\"rsh_Participant.set\" data-scope=\"rsh\" data-symbol=\"Participant.set\"></span></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"Participant.set(PART, ADDR);\nPART.set(ADDR);\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/appinit/#rsh_Participant\" title=\"rsh: Participant\"><span style=\"color: var(--shiki-token-constant)\">Participant</span></a><a href=\"/rsh/consensus/#rsh_Participant.set\" title=\"rsh: Participant.set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">PART</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ADDR</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"2\"><span style=\"color: var(--shiki-token-constant)\">PART</span><a href=\"/rsh/consensus/#rsh_Participant.set\" title=\"rsh: Participant.set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">ADDR</span><span style=\"color: var(--shiki-color-text)\">);</span></li></ol></pre>\n<p>\n  <i id=\"p_13\" class=\"pid\"></i>After execution, the given participant is fixed to the given address.\n  It is invalid to attempt to <span class=\"snip\"><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-color-text)\">.set</span></a></span> a participant class.\n  If a backend is running for this participant and its address does not match the given address, then it will abort.\n  This may only occur within a consensus step.<a href=\"#p_13\" class=\"pid\">13</a>\n</p>\n<div class=\"note\">\n  <p><i id=\"p_14\" class=\"pid\"></i><a href=\"/workshop/relay/#workshop-relay\">Relay Account</a> is a good introductory project that demonstrates how to use this feature of Reach.<a href=\"#p_14\" class=\"pid\">14</a></p>\n</div>\n<p><i id=\"p_15\" class=\"pid\"></i>Example:<a href=\"#p_15\" class=\"pid\">15</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/workshop-relay/index.rsh\">/examples/workshop-relay/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    Alice.publish(amt, relay)\n      .pay(amt);\n    Relay.set(relay);\n    commit();\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"14\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">Alice</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">(amt</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> relay)</span></li><li value=\"15\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/step/#rsh_pay\" title=\"rsh: pay\"><span style=\"color: var(--shiki-token-function)\">.pay</span></a><span style=\"color: var(--shiki-color-text)\">(amt);</span></li><li value=\"16\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">Relay</span><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(relay);</span></li><li value=\"17\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li></ol></pre>\n<p>\n  <i id=\"p_16\" class=\"pid\"></i>Alice first publishes the amount and the participant, <code>relay</code>, that will receive the amount, and then completes a <span class=\"snip\"><a href=\"/rsh/step/#rsh_pay\" title=\"rsh: pay\"><span style=\"color: var(--shiki-color-text)\">pay</span></a></span> action.\n  Then, the address of <code>Relay</code> is <span class=\"snip\"><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-color-text)\">set</span></a></span> in the consensus step, to make sure it is remembered by the consensus.\n  This code is also an assert that <code>relay</code> is the address of the participant <code>Relay</code>.<a href=\"#p_16\" class=\"pid\">16</a>\n</p>\n<h3 id=\"while\" class=\"refHeader\"><code>while</code><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#while\"><span class=\"icon icon-link\"></span></a></h3>\n<p><span class=\"ref\" id=\"rsh_while\" data-scope=\"rsh\" data-symbol=\"while\"></span><span class=\"ref\" id=\"rsh_var\" data-scope=\"rsh\" data-symbol=\"var\"></span><span class=\"ref\" id=\"rsh_invariant\" data-scope=\"rsh\" data-symbol=\"invariant\"></span></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"var [ heap1, heap2 ] = [ 21, 21 ];\n{ const sum = () => heap1 + heap2; }\ninvariant(balance() == 2 * wagerAmount);\nwhile ( sum() > 0 ) {\n  ....\n  [ heap1, heap2 ] = [ heap1 - 1, heap2 ];\n  continue; }\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/consensus/#rsh_var\" title=\"rsh: var\"><span style=\"color: var(--shiki-token-keyword)\">var</span></a><span style=\"color: var(--shiki-color-text)\"> [ heap1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> heap2 ] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> [ </span><span style=\"color: var(--shiki-token-constant)\">21</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">21</span><span style=\"color: var(--shiki-color-text)\"> ];</span></li><li value=\"2\"><span style=\"color: var(--shiki-color-text)\">{ </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_sum\" title=\"rsh: sum\"><span style=\"color: var(--shiki-token-function)\">sum</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> heap1 </span><a href=\"/rsh/compute/#rsh_+\" title=\"rsh: +\"><span style=\"color: var(--shiki-token-keyword)\">+</span></a><span style=\"color: var(--shiki-color-text)\"> heap2; }</span></li><li value=\"3\"><a href=\"/rsh/consensus/#rsh_invariant\" title=\"rsh: invariant\"><span style=\"color: var(--shiki-token-function)\">invariant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_balance\" title=\"rsh: balance\"><span style=\"color: var(--shiki-token-function)\">balance</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">2</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_*\" title=\"rsh: *\"><span style=\"color: var(--shiki-token-keyword)\">*</span></a><span style=\"color: var(--shiki-color-text)\"> wagerAmount);</span></li><li value=\"4\"><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-keyword)\">while</span></a><span style=\"color: var(--shiki-color-text)\"> ( </span><a href=\"/rsh/compute/#rsh_sum\" title=\"rsh: sum\"><span style=\"color: var(--shiki-token-function)\">sum</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_%3E\" title=\"rsh: >\"><span style=\"color: var(--shiki-token-keyword)\">&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\"> ) {</span></li><li value=\"5\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-keyword)\">...</span><span style=\"color: var(--shiki-color-text)\">.</span></li><li value=\"6\"><span style=\"color: var(--shiki-color-text)\">  [ heap1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> heap2 ] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> [ heap1 </span><a href=\"/rsh/compute/#rsh_-\" title=\"rsh: -\"><span style=\"color: var(--shiki-token-keyword)\">-</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> heap2 ];</span></li><li value=\"7\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_continue\" title=\"rsh: continue\"><span style=\"color: var(--shiki-token-keyword)\">continue</span></a><span style=\"color: var(--shiki-color-text)\">; }</span></li></ol></pre>\n<p><i id=\"p_17\" class=\"pid\"></i>A <span class=\"term\" id=\"term_while%20statement\">while statement</span> may occur within a consensus step and is written:<a href=\"#p_17\" class=\"pid\">17</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"var LHS = INIT_EXPR;\nDEFINE_BLOCK; // optional\ninvariant(INVARIANT_EXPR, ?INVARIANT_MSG);\nwhile( COND_EXPR ) BLOCK\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/consensus/#rsh_var\" title=\"rsh: var\"><span style=\"color: var(--shiki-token-keyword)\">var</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">LHS</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">INIT_EXPR</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"2\"><span style=\"color: var(--shiki-token-constant)\">DEFINE_BLOCK</span><span style=\"color: var(--shiki-color-text)\">; </span><span style=\"color: var(--shiki-token-comment)\">// optional</span></li><li value=\"3\"><a href=\"/rsh/consensus/#rsh_invariant\" title=\"rsh: invariant\"><span style=\"color: var(--shiki-token-function)\">invariant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">INVARIANT_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_?\" title=\"rsh: ?\"><span style=\"color: var(--shiki-token-keyword)\">?</span></a><span style=\"color: var(--shiki-token-constant)\">INVARIANT_MSG</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"4\"><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-function)\">while</span></a><span style=\"color: var(--shiki-color-text)\">( </span><span style=\"color: var(--shiki-token-constant)\">COND_EXPR</span><span style=\"color: var(--shiki-color-text)\"> ) </span><span style=\"color: var(--shiki-token-constant)\">BLOCK</span></li></ol></pre>\n<p>\n  <i id=\"p_18\" class=\"pid\"></i>where <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">LHS</span></span> is a valid left-hand side of an identifier definition where the expression <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">INIT_EXPR</span></span> is the right-hand side, and\n  <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">DEFINE_BLOCK</span></span> is an optional block that may define bindings that use the <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">LHS</span></span> values which are bound inside the rest of the <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-keyword)\">while</span></a></span> and its tail, and\n  <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">INVARIANT_EXPR</span></span> is an expression, called the <span class=\"term\" id=\"term_loop%20invariant\">loop invariant</span>, that must be true before and after every execution of the block <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">BLOCK</span></span>it may be specified multiple times,\n  <code>INVARIANT_MSG</code> is an optional bytes argument, which is included in any reported violation, and\n  if <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">COND_EXPR</span></span> is true, then the block executes,\n  and if not, then the loop terminates and control transfers to the continuation of the while statement.\n  The identifiers bound by <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">LHS</span></span> are bound within <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">DEFINE_BLOCK</span></span>, <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">INVARIANT_EXPR</span></span>, <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">COND_EXPR</span></span>, <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">BLOCK</span></span>, and the tail of the while statement.<a href=\"#p_18\" class=\"pid\">18</a>\n</p>\n<div class=\"note\">\n  <p><i id=\"p_19\" class=\"pid\"></i>Read about finding <a href=\"/guide/loop-invs/#guide-loop-invs\">loop invariants</a> in the Reach guide.<a href=\"#p_19\" class=\"pid\">19</a></p>\n</div>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/chicken-race/index.rsh\">/examples/chicken-race/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"      while ( keepGoing ) {\n        commit();\n\n        each([Alice, Bob], () => {\n          const go = declassify(interact.keepGoing()); });\n        Alice.only(() => {\n          const isAlice = true; });\n        Bob.only(() => {\n          const isAlice = false; });\n\n        race(Alice, Bob).publish(isAlice).when(go)\n          .timeout(relativeTime(deadline), () => {\n            showOutcome(TIMEOUT)();\n            race(Alice, Bob).publish();\n            keepGoing = false;\n            continue; });\n        const [ da, db ] = isAlice ? [ 1, 0 ] : [ 0, 1 ];\n        each([Alice, Bob], () => {\n          interact.roundWinnerWas(isAlice); });\n        [ keepGoing, as, bs ] = [ true, as + da, bs + db ];\n        continue;\n      }\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"43\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-keyword)\">while</span></a><span style=\"color: var(--shiki-color-text)\"> ( keepGoing ) {</span></li><li value=\"44\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"45\"></li><li value=\"46\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/step/#rsh_each\" title=\"rsh: each\"><span style=\"color: var(--shiki-token-function)\">each</span></a><span style=\"color: var(--shiki-color-text)\">([Alice</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bob]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"47\"><span style=\"color: var(--shiki-color-text)\">          </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">go</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: var(--shiki-token-function)\">declassify</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.keepGoing</span><span style=\"color: var(--shiki-color-text)\">()); });</span></li><li value=\"48\"><span style=\"color: var(--shiki-color-text)\">        </span><span style=\"color: var(--shiki-token-constant)\">Alice</span><a href=\"/rsh/step/#rsh_only\" title=\"rsh: only\"><span style=\"color: var(--shiki-token-function)\">.only</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"49\"><span style=\"color: var(--shiki-color-text)\">          </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">isAlice</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a><span style=\"color: var(--shiki-color-text)\">; });</span></li><li value=\"50\"><span style=\"color: var(--shiki-color-text)\">        </span><span style=\"color: var(--shiki-token-constant)\">Bob</span><a href=\"/rsh/step/#rsh_only\" title=\"rsh: only\"><span style=\"color: var(--shiki-token-function)\">.only</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"51\"><span style=\"color: var(--shiki-color-text)\">          </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">isAlice</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_false\" title=\"rsh: false\"><span style=\"color: var(--shiki-token-constant)\">false</span></a><span style=\"color: var(--shiki-color-text)\">; });</span></li><li value=\"52\"></li><li value=\"53\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/step/#rsh_race\" title=\"rsh: race\"><span style=\"color: var(--shiki-token-function)\">race</span></a><span style=\"color: var(--shiki-color-text)\">(Alice</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bob)</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">(isAlice)</span><a href=\"/rsh/step/#rsh_when\" title=\"rsh: when\"><span style=\"color: var(--shiki-token-function)\">.when</span></a><span style=\"color: var(--shiki-color-text)\">(go)</span></li><li value=\"54\"><span style=\"color: var(--shiki-color-text)\">          </span><a href=\"/rsh/step/#rsh_timeout\" title=\"rsh: timeout\"><span style=\"color: var(--shiki-token-function)\">.timeout</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_relativeTime\" title=\"rsh: relativeTime\"><span style=\"color: var(--shiki-token-function)\">relativeTime</span></a><span style=\"color: var(--shiki-color-text)\">(deadline)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"55\"><span style=\"color: var(--shiki-color-text)\">            </span><span style=\"color: var(--shiki-token-function)\">showOutcome</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">TIMEOUT</span><span style=\"color: var(--shiki-color-text)\">)();</span></li><li value=\"56\"><span style=\"color: var(--shiki-color-text)\">            </span><a href=\"/rsh/step/#rsh_race\" title=\"rsh: race\"><span style=\"color: var(--shiki-token-function)\">race</span></a><span style=\"color: var(--shiki-color-text)\">(Alice</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bob)</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"57\"><span style=\"color: var(--shiki-color-text)\">            keepGoing </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_false\" title=\"rsh: false\"><span style=\"color: var(--shiki-token-constant)\">false</span></a><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"58\"><span style=\"color: var(--shiki-color-text)\">            </span><a href=\"/rsh/consensus/#rsh_continue\" title=\"rsh: continue\"><span style=\"color: var(--shiki-token-keyword)\">continue</span></a><span style=\"color: var(--shiki-color-text)\">; });</span></li><li value=\"59\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><span style=\"color: var(--shiki-token-constant)\">da</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">db</span><span style=\"color: var(--shiki-color-text)\"> ] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> isAlice </span><a href=\"/rsh/compute/#rsh_?\" title=\"rsh: ?\"><span style=\"color: var(--shiki-token-keyword)\">?</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\"> ] </span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> [ </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\"> ];</span></li><li value=\"60\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/step/#rsh_each\" title=\"rsh: each\"><span style=\"color: var(--shiki-token-function)\">each</span></a><span style=\"color: var(--shiki-color-text)\">([Alice</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bob]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"61\"><span style=\"color: var(--shiki-color-text)\">          </span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.roundWinnerWas</span><span style=\"color: var(--shiki-color-text)\">(isAlice); });</span></li><li value=\"62\"><span style=\"color: var(--shiki-color-text)\">        [ keepGoing</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> as</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> bs ] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> [ </span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">as</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_+\" title=\"rsh: +\"><span style=\"color: var(--shiki-token-keyword)\">+</span></a><span style=\"color: var(--shiki-color-text)\"> da</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> bs </span><a href=\"/rsh/compute/#rsh_+\" title=\"rsh: +\"><span style=\"color: var(--shiki-token-keyword)\">+</span></a><span style=\"color: var(--shiki-color-text)\"> db ];</span></li><li value=\"63\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/consensus/#rsh_continue\" title=\"rsh: continue\"><span style=\"color: var(--shiki-token-keyword)\">continue</span></a><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"64\"><span style=\"color: var(--shiki-color-text)\">      }</span></li></ol></pre>\n<h3 id=\"continue\" class=\"refHeader\"><code>continue</code><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#continue\"><span class=\"icon icon-link\"></span></a></h3>\n<p><span class=\"ref\" id=\"rsh_continue\" data-scope=\"rsh\" data-symbol=\"continue\"></span></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"[ heap1, heap2 ] = [ heap1 - 1, heap2 ];\ncontinue;\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: var(--shiki-color-text)\">[ heap1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> heap2 ] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> [ heap1 </span><a href=\"/rsh/compute/#rsh_-\" title=\"rsh: -\"><span style=\"color: var(--shiki-token-keyword)\">-</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> heap2 ];</span></li><li value=\"2\"><a href=\"/rsh/consensus/#rsh_continue\" title=\"rsh: continue\"><span style=\"color: var(--shiki-token-keyword)\">continue</span></a><span style=\"color: var(--shiki-color-text)\">;</span></li></ol></pre>\n<p><i id=\"p_20\" class=\"pid\"></i>A <span class=\"term\" id=\"term_continue%20statement\">continue statement</span> may occur within a while statement's block and is written:<a href=\"#p_20\" class=\"pid\">20</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"LHS = UPDATE_EXPR;\ncontinue;\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: var(--shiki-token-constant)\">LHS</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">UPDATE_EXPR</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"2\"><a href=\"/rsh/consensus/#rsh_continue\" title=\"rsh: continue\"><span style=\"color: var(--shiki-token-keyword)\">continue</span></a><span style=\"color: var(--shiki-color-text)\">;</span></li></ol></pre>\n<p><i id=\"p_21\" class=\"pid\"></i>where the identifiers bound by <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">LHS</span></span> are a subset of the variables bound by the nearest enclosing while statement and <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">UPDATE_EXPR</span></span> is an expression which may be bound by <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">LHS</span></span>.<a href=\"#p_21\" class=\"pid\">21</a></p>\n<p><i id=\"p_22\" class=\"pid\"></i>A continue statement is a terminator statement, so it must have an empty tail.<a href=\"#p_22\" class=\"pid\">22</a></p>\n<p><i id=\"p_23\" class=\"pid\"></i>A continue statement may be written without the preceding identifier update, which is equivalent to writing<a href=\"#p_23\" class=\"pid\">23</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"[] = [];\ncontinue;\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: var(--shiki-color-text)\">[] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> [];</span></li><li value=\"2\"><a href=\"/rsh/consensus/#rsh_continue\" title=\"rsh: continue\"><span style=\"color: var(--shiki-token-keyword)\">continue</span></a><span style=\"color: var(--shiki-color-text)\">;</span></li></ol></pre>\n<p>\n  <i id=\"p_24\" class=\"pid\"></i>A continue statement must be dominated by a consensus transfer, which means that the body of a while statement must always <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></span> before calling <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_continue\" title=\"rsh: continue\"><span style=\"color: var(--shiki-token-keyword)\">continue</span></a><span style=\"color: var(--shiki-color-text)\">;</span></span>.\n  This restriction may be lifted in future versions of Reach, which will perform termination checking.<a href=\"#p_24\" class=\"pid\">24</a>\n</p>\n<hr>\n<p>\n  <i id=\"p_25\" class=\"pid\"></i>As a special case, a continue statement may occur in a step, if the <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">UPDATE_EXPR</span></span> transitions to a consensus step.\n  In other words, this is a valid program:<a href=\"#p_25\" class=\"pid\">25</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const f = () => {\n commit();\n A.publish();\n return 1;\n};\n\nvar x = 0;\ninvariant(balance() == 0);\nwhile ( x == 0 ) {\n x = f();\n continue;\n}\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">f</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"2\"><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"3\"><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">A</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"4\"><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"5\"><span style=\"color: var(--shiki-color-text)\">};</span></li><li value=\"6\"></li><li value=\"7\"><a href=\"/rsh/consensus/#rsh_var\" title=\"rsh: var\"><span style=\"color: var(--shiki-token-keyword)\">var</span></a><span style=\"color: var(--shiki-color-text)\"> x </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"8\"><a href=\"/rsh/consensus/#rsh_invariant\" title=\"rsh: invariant\"><span style=\"color: var(--shiki-token-function)\">invariant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_balance\" title=\"rsh: balance\"><span style=\"color: var(--shiki-token-function)\">balance</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"9\"><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-keyword)\">while</span></a><span style=\"color: var(--shiki-color-text)\"> ( x </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\"> ) {</span></li><li value=\"10\"><span style=\"color: var(--shiki-color-text)\"> x </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">f</span><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"11\"><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/consensus/#rsh_continue\" title=\"rsh: continue\"><span style=\"color: var(--shiki-token-keyword)\">continue</span></a><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"12\"><span style=\"color: var(--shiki-color-text)\">}</span></li></ol></pre>\n<p>\n  <i id=\"p_26\" class=\"pid\"></i>The following example displays how a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_continue\" title=\"rsh: continue\"><span style=\"color: var(--shiki-token-keyword)\">continue</span></a></span> is used inside of a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-keyword)\">while</span></a></span> loop that started in line 43.\n  Bob and Alice race to be the first to <span class=\"snip\"><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-color-text)\">publish</span></a></span> and therefore be the round winner.\n  When one of them publishes, the <code>keepGoing</code> function returns false, and the program hits <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_continue\" title=\"rsh: continue\"><span style=\"color: var(--shiki-token-keyword)\">continue</span></a></span> where it exits the <span class=\"snip\"><a href=\"/rsh/step/#rsh_race\" title=\"rsh: race\"><span style=\"color: var(--shiki-color-text)\">race</span></a></span> and moves on with the rest of the program.<a href=\"#p_26\" class=\"pid\">26</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/chicken-race/index.rsh\">/examples/chicken-race/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"        race(Alice, Bob).publish(isAlice).when(go)\n          .timeout(relativeTime(deadline), () => {\n            showOutcome(TIMEOUT)();\n            race(Alice, Bob).publish();\n            keepGoing = false;\n            continue; });\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"53\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/step/#rsh_race\" title=\"rsh: race\"><span style=\"color: var(--shiki-token-function)\">race</span></a><span style=\"color: var(--shiki-color-text)\">(Alice</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bob)</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">(isAlice)</span><a href=\"/rsh/step/#rsh_when\" title=\"rsh: when\"><span style=\"color: var(--shiki-token-function)\">.when</span></a><span style=\"color: var(--shiki-color-text)\">(go)</span></li><li value=\"54\"><span style=\"color: var(--shiki-color-text)\">          </span><a href=\"/rsh/step/#rsh_timeout\" title=\"rsh: timeout\"><span style=\"color: var(--shiki-token-function)\">.timeout</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_relativeTime\" title=\"rsh: relativeTime\"><span style=\"color: var(--shiki-token-function)\">relativeTime</span></a><span style=\"color: var(--shiki-color-text)\">(deadline)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"55\"><span style=\"color: var(--shiki-color-text)\">            </span><span style=\"color: var(--shiki-token-function)\">showOutcome</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">TIMEOUT</span><span style=\"color: var(--shiki-color-text)\">)();</span></li><li value=\"56\"><span style=\"color: var(--shiki-color-text)\">            </span><a href=\"/rsh/step/#rsh_race\" title=\"rsh: race\"><span style=\"color: var(--shiki-token-function)\">race</span></a><span style=\"color: var(--shiki-color-text)\">(Alice</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bob)</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"57\"><span style=\"color: var(--shiki-color-text)\">            keepGoing </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_false\" title=\"rsh: false\"><span style=\"color: var(--shiki-token-constant)\">false</span></a><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"58\"><span style=\"color: var(--shiki-color-text)\">            </span><a href=\"/rsh/consensus/#rsh_continue\" title=\"rsh: continue\"><span style=\"color: var(--shiki-token-keyword)\">continue</span></a><span style=\"color: var(--shiki-color-text)\">; });</span></li></ol></pre>\n<h3 id=\"parallelreduce\" class=\"refHeader\"><code>parallelReduce</code><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#parallelreduce\"><span class=\"icon icon-link\"></span></a></h3>\n<p><span class=\"ref\" id=\"rsh_parallelReduce\" data-scope=\"rsh\" data-symbol=\"parallelReduce\"></span></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const [ keepGoing, as, bs ] =\n  parallelReduce([ true, 0, 0 ])\n  .invariant(balance() == 2 * wager)\n  .while(keepGoing)\n  .case(Alice, (() => ({\n    when: declassify(interact.keepGoing()) })),\n    (_) => {\n      each([Alice, Bob], () => {\n        interact.roundWinnerWas(true); });\n      return [ true, 1 + as, bs ]; })\n  .case(Bob, (() => ({\n    when: declassify(interact.keepGoing()) })),\n    (_) => {\n      each([Alice, Bob], () => {\n        interact.roundWinnerWas(false); });\n      return [ true, as, 1 + bs ]; })\n  .timeout(deadline, () => {\n    showOutcome(TIMEOUT)();\n    race(Alice, Bob).publish();\n    return [ false, as, bs ]; });\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><span style=\"color: var(--shiki-token-constant)\">keepGoing</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">as</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">bs</span><span style=\"color: var(--shiki-color-text)\"> ] </span><span style=\"color: var(--shiki-token-keyword)\">=</span></li><li value=\"2\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-token-function)\">parallelReduce</span></a><span style=\"color: var(--shiki-color-text)\">([ </span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\"> ])</span></li><li value=\"3\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_parallelReduce.invariant\" title=\"rsh: parallelReduce.invariant\"><span style=\"color: var(--shiki-token-function)\">.invariant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_balance\" title=\"rsh: balance\"><span style=\"color: var(--shiki-token-function)\">balance</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">2</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_*\" title=\"rsh: *\"><span style=\"color: var(--shiki-token-keyword)\">*</span></a><span style=\"color: var(--shiki-color-text)\"> wager)</span></li><li value=\"4\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_parallelReduce.while\" title=\"rsh: parallelReduce.while\"><span style=\"color: var(--shiki-token-function)\">.while</span></a><span style=\"color: var(--shiki-color-text)\">(keepGoing)</span></li><li value=\"5\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_parallelReduce.case\" title=\"rsh: parallelReduce.case\"><span style=\"color: var(--shiki-token-function)\">.case</span></a><span style=\"color: var(--shiki-color-text)\">(Alice</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> ({</span></li><li value=\"6\"><span style=\"color: var(--shiki-color-text)\">    when</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: var(--shiki-token-function)\">declassify</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.keepGoing</span><span style=\"color: var(--shiki-color-text)\">()) }))</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"7\"><span style=\"color: var(--shiki-color-text)\">    (_) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"8\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/step/#rsh_each\" title=\"rsh: each\"><span style=\"color: var(--shiki-token-function)\">each</span></a><span style=\"color: var(--shiki-color-text)\">([Alice</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bob]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"9\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.roundWinnerWas</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a><span style=\"color: var(--shiki-color-text)\">); });</span></li><li value=\"10\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_+\" title=\"rsh: +\"><span style=\"color: var(--shiki-token-keyword)\">+</span></a><span style=\"color: var(--shiki-color-text)\"> as</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> bs ]; })</span></li><li value=\"11\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_parallelReduce.case\" title=\"rsh: parallelReduce.case\"><span style=\"color: var(--shiki-token-function)\">.case</span></a><span style=\"color: var(--shiki-color-text)\">(Bob</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> ({</span></li><li value=\"12\"><span style=\"color: var(--shiki-color-text)\">    when</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: var(--shiki-token-function)\">declassify</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.keepGoing</span><span style=\"color: var(--shiki-color-text)\">()) }))</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"13\"><span style=\"color: var(--shiki-color-text)\">    (_) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"14\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/step/#rsh_each\" title=\"rsh: each\"><span style=\"color: var(--shiki-token-function)\">each</span></a><span style=\"color: var(--shiki-color-text)\">([Alice</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bob]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"15\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.roundWinnerWas</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_false\" title=\"rsh: false\"><span style=\"color: var(--shiki-token-constant)\">false</span></a><span style=\"color: var(--shiki-color-text)\">); });</span></li><li value=\"16\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> as</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_+\" title=\"rsh: +\"><span style=\"color: var(--shiki-token-keyword)\">+</span></a><span style=\"color: var(--shiki-color-text)\"> bs ]; })</span></li><li value=\"17\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_parallelReduce.timeout\" title=\"rsh: parallelReduce.timeout\"><span style=\"color: var(--shiki-token-function)\">.timeout</span></a><span style=\"color: var(--shiki-color-text)\">(deadline</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"18\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-function)\">showOutcome</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">TIMEOUT</span><span style=\"color: var(--shiki-color-text)\">)();</span></li><li value=\"19\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/step/#rsh_race\" title=\"rsh: race\"><span style=\"color: var(--shiki-token-function)\">race</span></a><span style=\"color: var(--shiki-color-text)\">(Alice</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bob)</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"20\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><a href=\"/rsh/compute/#rsh_false\" title=\"rsh: false\"><span style=\"color: var(--shiki-token-constant)\">false</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> as</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> bs ]; });</span></li></ol></pre>\n<div class=\"note\">\n  <p><i id=\"p_27\" class=\"pid\"></i>If you're unsure of what kind of consensus transfer to use, you may want to read the <a href=\"/guide/ctransfers/#guide-ctransfers\">explanation of the differences</a> in the Guide.<a href=\"#p_27\" class=\"pid\">27</a></p>\n</div>\n<p><i id=\"p_28\" class=\"pid\"></i>A <span class=\"term\" id=\"term_parallel%20reduce%20statement\">parallel reduce statement</span> is written:<a href=\"#p_28\" class=\"pid\">28</a></p>\n<p><span class=\"ref\" id=\"rsh_parallelReduce.define\" data-scope=\"rsh\" data-symbol=\"parallelReduce.define\"></span><span class=\"ref\" id=\"rsh_parallelReduce.invariant\" data-scope=\"rsh\" data-symbol=\"parallelReduce.invariant\"></span><span class=\"ref\" id=\"rsh_parallelReduce.while\" data-scope=\"rsh\" data-symbol=\"parallelReduce.while\"></span><span class=\"ref\" id=\"rsh_parallelReduce.paySpec\" data-scope=\"rsh\" data-symbol=\"parallelReduce.paySpec\"></span><span class=\"ref\" id=\"rsh_parallelReduce.case\" data-scope=\"rsh\" data-symbol=\"parallelReduce.case\"></span><span class=\"ref\" id=\"rsh_parallelReduce.api\" data-scope=\"rsh\" data-symbol=\"parallelReduce.api\"></span><span class=\"ref\" id=\"rsh_parallelReduce.api_\" data-scope=\"rsh\" data-symbol=\"parallelReduce.api_\"></span><span class=\"ref\" id=\"rsh_parallelReduce.timeout\" data-scope=\"rsh\" data-symbol=\"parallelReduce.timeout\"></span></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const LHS =\n  parallelReduce(INIT_EXPR)\n  .define(() => DEFINE_BLOCK)\n  .invariant(INVARIANT_EXPR, ?INVARIANT_MSG)\n  .while(COND_EXPR)\n  .paySpec(TOKENS_EXPR)\n  .case(PART_EXPR,\n    CHECK_EXPR,\n    PUBLISH_EXPR,\n    PAY_EXPR,\n    CONSENSUS_EXPR)\n  .api(API_EXPR,\n    ASSUME_EXPR,\n    PAY_EXPR,\n    CONSENSUS_EXPR)\n  .api_(API_EXPR,\n    CHECKED_CONSENSUS_EXPR)\n  .timeout(DELAY_EXPR, () =>\n    TIMEOUT_BLOCK);\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">LHS</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span></li><li value=\"2\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-token-function)\">parallelReduce</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">INIT_EXPR</span><span style=\"color: var(--shiki-color-text)\">)</span></li><li value=\"3\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_parallelReduce.define\" title=\"rsh: parallelReduce.define\"><span style=\"color: var(--shiki-token-function)\">.define</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">DEFINE_BLOCK</span><span style=\"color: var(--shiki-color-text)\">)</span></li><li value=\"4\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_parallelReduce.invariant\" title=\"rsh: parallelReduce.invariant\"><span style=\"color: var(--shiki-token-function)\">.invariant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">INVARIANT_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_?\" title=\"rsh: ?\"><span style=\"color: var(--shiki-token-keyword)\">?</span></a><span style=\"color: var(--shiki-token-constant)\">INVARIANT_MSG</span><span style=\"color: var(--shiki-color-text)\">)</span></li><li value=\"5\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_parallelReduce.while\" title=\"rsh: parallelReduce.while\"><span style=\"color: var(--shiki-token-function)\">.while</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">COND_EXPR</span><span style=\"color: var(--shiki-color-text)\">)</span></li><li value=\"6\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_parallelReduce.paySpec\" title=\"rsh: parallelReduce.paySpec\"><span style=\"color: var(--shiki-token-function)\">.paySpec</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">TOKENS_EXPR</span><span style=\"color: var(--shiki-color-text)\">)</span></li><li value=\"7\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_parallelReduce.case\" title=\"rsh: parallelReduce.case\"><span style=\"color: var(--shiki-token-function)\">.case</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">PART_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"8\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">CHECK_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"9\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">PUBLISH_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"10\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">PAY_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"11\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">CONSENSUS_EXPR</span><span style=\"color: var(--shiki-color-text)\">)</span></li><li value=\"12\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_parallelReduce.api\" title=\"rsh: parallelReduce.api\"><span style=\"color: var(--shiki-token-function)\">.api</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">API_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"13\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">ASSUME_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"14\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">PAY_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"15\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">CONSENSUS_EXPR</span><span style=\"color: var(--shiki-color-text)\">)</span></li><li value=\"16\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_parallelReduce.api_\" title=\"rsh: parallelReduce.api_\"><span style=\"color: var(--shiki-token-function)\">.api_</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">API_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"17\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">CHECKED_CONSENSUS_EXPR</span><span style=\"color: var(--shiki-color-text)\">)</span></li><li value=\"18\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_parallelReduce.timeout\" title=\"rsh: parallelReduce.timeout\"><span style=\"color: var(--shiki-token-function)\">.timeout</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">DELAY_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a></li><li value=\"19\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">TIMEOUT_BLOCK</span><span style=\"color: var(--shiki-color-text)\">);</span></li></ol></pre>\n<p>\n  <i id=\"p_29\" class=\"pid\"></i>The <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">LHS</span></span> and <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">INIT_EXPR</span></span> are like the initialization component of a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-keyword)\">while</span></a></span> loop; and,\n  the <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_invariant\" title=\"rsh: invariant\"><span style=\"color: var(--shiki-color-text)\">.invariant</span></a></span> and <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-color-text)\">.while</span></a></span> components are like the invariant and condition of a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-keyword)\">while</span></a></span> loop;\n  multiple <code>.invariant</code>s may be specified;\n  the <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">DEFINE_BLOCK</span></span> is like the <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">DEFINE_BLOCK</span></span> of a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-keyword)\">while</span></a></span> loop. It may be specified multiple times;\n  while the <span class=\"snip\"><a href=\"/rsh/compute/#rsh_case\" title=\"rsh: case\"><span style=\"color: var(--shiki-color-text)\">.case</span></a></span>, <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">.api</span></span>, <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">.api_</span></span>, <span class=\"snip\"><a href=\"/rsh/step/#rsh_timeout\" title=\"rsh: timeout\"><span style=\"color: var(--shiki-color-text)\">.timeout</span></a></span>, and <span class=\"snip\"><a href=\"/rsh/step/#rsh_paySpec\" title=\"rsh: paySpec\"><span style=\"color: var(--shiki-color-text)\">.paySpec</span></a></span> components are like the corresponding components of a <span class=\"snip\"><a href=\"/rsh/step/#rsh_fork\" title=\"rsh: fork\"><span style=\"color: var(--shiki-color-text)\">fork</span></a></span> statement.<a href=\"#p_29\" class=\"pid\">29</a>\n</p>\n<p><i id=\"p_30\" class=\"pid\"></i>The <span class=\"snip\"><a href=\"/rsh/compute/#rsh_case\" title=\"rsh: case\"><span style=\"color: var(--shiki-color-text)\">.case</span></a></span> component may be repeated many times, just like in a <span class=\"snip\"><a href=\"/rsh/step/#rsh_fork\" title=\"rsh: fork\"><span style=\"color: var(--shiki-color-text)\">fork</span></a></span> statement.<a href=\"#p_30\" class=\"pid\">30</a></p>\n<p>\n  <i id=\"p_31\" class=\"pid\"></i>The <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">.define</span></span> component may define bindings that reference the <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">LHS</span></span> values. These bindings are accessible\n  from every component of the <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-color-text)\">parallelReduce</span></a></span> statement, except for the <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">INIT_EXPR</span></span>.<a href=\"#p_31\" class=\"pid\">31</a>\n</p>\n<h4 id=\"timeremaining\" class=\"refHeader\"><code>.timeRemaining</code><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#timeremaining\"><span class=\"icon icon-link\"></span></a></h4>\n<p>\n  <i id=\"p_32\" class=\"pid\"></i>When dealing with absolute deadlines in <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-color-text)\">parallelReduce</span></a></span>, there is a common pattern in the\n  <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">TIMEOUT_BLOCK</span></span> to have participants <span class=\"snip\"><a href=\"/rsh/step/#rsh_race\" title=\"rsh: race\"><span style=\"color: var(--shiki-color-text)\">race</span></a></span> to <span class=\"snip\"><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-color-text)\">publish</span></a></span> and return the accumulator.\n  There is a shorthand, <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">.timeRemaining</span></span>, available for this situation:<a href=\"#p_32\" class=\"pid\">32</a>\n</p>\n<p><span class=\"ref\" id=\"rsh_parallelReduce.timeRemaining\" data-scope=\"rsh\" data-symbol=\"parallelReduce.timeRemaining\"></span></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const [ timeRemaining, keepGoing ] = makeDeadline(deadline);\nconst [ x, y, z ] =\n  parallelReduce([ 1, 2, 3 ])\n    .while(keepGoing())\n    ...\n    .timeRemaining(timeRemaining())\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><span style=\"color: var(--shiki-token-constant)\">timeRemaining</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">keepGoing</span><span style=\"color: var(--shiki-color-text)\"> ] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_makeDeadline\" title=\"rsh: makeDeadline\"><span style=\"color: var(--shiki-token-function)\">makeDeadline</span></a><span style=\"color: var(--shiki-color-text)\">(deadline);</span></li><li value=\"2\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><span style=\"color: var(--shiki-token-constant)\">x</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">y</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">z</span><span style=\"color: var(--shiki-color-text)\"> ] </span><span style=\"color: var(--shiki-token-keyword)\">=</span></li><li value=\"3\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-token-function)\">parallelReduce</span></a><span style=\"color: var(--shiki-color-text)\">([ </span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">2</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">3</span><span style=\"color: var(--shiki-color-text)\"> ])</span></li><li value=\"4\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_parallelReduce.while\" title=\"rsh: parallelReduce.while\"><span style=\"color: var(--shiki-token-function)\">.while</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-function)\">keepGoing</span><span style=\"color: var(--shiki-color-text)\">())</span></li><li value=\"5\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-keyword)\">...</span></li><li value=\"6\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_parallelReduce.timeRemaining\" title=\"rsh: parallelReduce.timeRemaining\"><span style=\"color: var(--shiki-token-function)\">.timeRemaining</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/consensus/#rsh_parallelReduce.timeRemaining\" title=\"rsh: parallelReduce.timeRemaining\"><span style=\"color: var(--shiki-token-function)\">timeRemaining</span></a><span style=\"color: var(--shiki-color-text)\">())</span></li></ol></pre>\n<p><i id=\"p_33\" class=\"pid\"></i>which will expand to:<a href=\"#p_33\" class=\"pid\">33</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\".timeout(timeRemaining(), () => {\n  race(...Participants).publish();\n  return [ x, y, z ]; })\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/step/#rsh_timeout\" title=\"rsh: timeout\"><span style=\"color: var(--shiki-token-function)\">.timeout</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-function)\">timeRemaining</span><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"2\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/step/#rsh_race\" title=\"rsh: race\"><span style=\"color: var(--shiki-token-function)\">race</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-keyword)\">...</span><span style=\"color: var(--shiki-color-text)\">Participants)</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"3\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [ x</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> y</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> z ]; })</span></li></ol></pre>\n<h4 id=\"throwtimeout\" class=\"refHeader\"><code>.throwTimeout</code><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#throwtimeout\"><span class=\"icon icon-link\"></span></a></h4>\n<p>\n  <i id=\"p_34\" class=\"pid\"></i><span class=\"snip\"><a href=\"/rsh/step/#rsh_throwTimeout\" title=\"rsh: throwTimeout\"><span style=\"color: var(--shiki-color-text)\">.throwTimeout</span></a></span> is a shorthand that will throw the accumulator as an exception when a timeout occurs.\n  Therefore, a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-color-text)\">parallelReduce</span></a></span> that uses this branch must be inside of a try statement. For example,<a href=\"#p_34\" class=\"pid\">34</a>\n</p>\n<p><span class=\"ref\" id=\"rsh_parallelReduce.throwTimeout\" data-scope=\"rsh\" data-symbol=\"parallelReduce.throwTimeout\"></span></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"try {\n  const [ x, y, z ] =\n    parallelReduce([ 1, 2, 3 ])\n    ...\n    .throwTimeout(deadline)\n} catch (e) { ... }\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/errors/#rsh_try\" title=\"rsh: try\"><span style=\"color: var(--shiki-token-keyword)\">try</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"2\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><span style=\"color: var(--shiki-token-constant)\">x</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">y</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">z</span><span style=\"color: var(--shiki-color-text)\"> ] </span><span style=\"color: var(--shiki-token-keyword)\">=</span></li><li value=\"3\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-token-function)\">parallelReduce</span></a><span style=\"color: var(--shiki-color-text)\">([ </span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">2</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">3</span><span style=\"color: var(--shiki-color-text)\"> ])</span></li><li value=\"4\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-keyword)\">...</span></li><li value=\"5\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_parallelReduce.throwTimeout\" title=\"rsh: parallelReduce.throwTimeout\"><span style=\"color: var(--shiki-token-function)\">.throwTimeout</span></a><span style=\"color: var(--shiki-color-text)\">(deadline)</span></li><li value=\"6\"><span style=\"color: var(--shiki-color-text)\">} </span><a href=\"/rsh/errors/#rsh_catch\" title=\"rsh: catch\"><span style=\"color: var(--shiki-token-keyword)\">catch</span></a><span style=\"color: var(--shiki-color-text)\"> (e) { </span><span style=\"color: var(--shiki-token-keyword)\">...</span><span style=\"color: var(--shiki-color-text)\"> }</span></li></ol></pre>\n<p><i id=\"p_35\" class=\"pid\"></i>will expand <span class=\"snip\"><a href=\"/rsh/step/#rsh_throwTimeout\" title=\"rsh: throwTimeout\"><span style=\"color: var(--shiki-color-text)\">throwTimeout</span></a></span> to:<a href=\"#p_35\" class=\"pid\">35</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\".timeout(deadline, () => {\n  throw [ x, y, z ]; })\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/step/#rsh_timeout\" title=\"rsh: timeout\"><span style=\"color: var(--shiki-token-function)\">.timeout</span></a><span style=\"color: var(--shiki-color-text)\">(deadline</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"2\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/errors/#rsh_throw\" title=\"rsh: throw\"><span style=\"color: var(--shiki-token-keyword)\">throw</span></a><span style=\"color: var(--shiki-color-text)\"> [ x</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> y</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> z ]; })</span></li></ol></pre>\n<h4 id=\"parallelreduce--intuition\" class=\"refHeader\"><code>parallelReduce</code> intuition<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#parallelreduce--intuition\"><span class=\"icon icon-link\"></span></a></h4>\n<p>\n  <i id=\"p_36\" class=\"pid\"></i>A parallel reduce statement is essentially an abbreviation of pattern of a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-keyword)\">while</span></a></span> loop combined with a <span class=\"snip\"><a href=\"/rsh/step/#rsh_fork\" title=\"rsh: fork\"><span style=\"color: var(--shiki-color-text)\">fork</span></a></span> statement that you could write yourself.\n  This is an extremely common pattern in decentralized applications.<a href=\"#p_36\" class=\"pid\">36</a>\n</p>\n<p><i id=\"p_37\" class=\"pid\"></i>The idea is that there are some values (the <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">LHS</span></span>) which after intialization will be repeatedly updated uniquely by each of the racing participants until the condition does not hold.<a href=\"#p_37\" class=\"pid\">37</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"var LHS = INIT_EXPR;\nDEFINE_BLOCK;\ninvariant(INVARIANT_EXPR);\nwhile(COND_EXPR) {\n  fork()\n  .case(PART_EXPR,\n    CHECK_EXPR,\n    PUBLISH_EXPR,\n    PAY_EXPR,\n    (m) => {\n      LHS = CONSENSUS_EXPR(m);\n      continue; })\n  .timeout(DELAY_EXPR, () =>\n    TIMEOUT_BLOCK);\n}\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/consensus/#rsh_var\" title=\"rsh: var\"><span style=\"color: var(--shiki-token-keyword)\">var</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">LHS</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">INIT_EXPR</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"2\"><span style=\"color: var(--shiki-token-constant)\">DEFINE_BLOCK</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"3\"><a href=\"/rsh/consensus/#rsh_invariant\" title=\"rsh: invariant\"><span style=\"color: var(--shiki-token-function)\">invariant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">INVARIANT_EXPR</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"4\"><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-keyword)\">while</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">COND_EXPR</span><span style=\"color: var(--shiki-color-text)\">) {</span></li><li value=\"5\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/step/#rsh_fork\" title=\"rsh: fork\"><span style=\"color: var(--shiki-token-function)\">fork</span></a><span style=\"color: var(--shiki-color-text)\">()</span></li><li value=\"6\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/step/#rsh_fork.case\" title=\"rsh: fork.case\"><span style=\"color: var(--shiki-token-function)\">.case</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">PART_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"7\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">CHECK_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"8\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">PUBLISH_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"9\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">PAY_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"10\"><span style=\"color: var(--shiki-color-text)\">    (m) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"11\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-constant)\">LHS</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">CONSENSUS_EXPR</span><span style=\"color: var(--shiki-color-text)\">(m);</span></li><li value=\"12\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/consensus/#rsh_continue\" title=\"rsh: continue\"><span style=\"color: var(--shiki-token-keyword)\">continue</span></a><span style=\"color: var(--shiki-color-text)\">; })</span></li><li value=\"13\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/step/#rsh_fork.timeout\" title=\"rsh: fork.timeout\"><span style=\"color: var(--shiki-token-function)\">.timeout</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">DELAY_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a></li><li value=\"14\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">TIMEOUT_BLOCK</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"15\"><span style=\"color: var(--shiki-color-text)\">}</span></li></ol></pre>\n<h2 id=\"ref-programs-consensus-exprs\" class=\"refHeader\">Expressions<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ref-programs-consensus-exprs\"><span class=\"icon icon-link\"></span></a></h2>\n<p>\n  <i id=\"p_38\" class=\"pid\"></i>Any expressions valid for a <a href=\"/rsh/compute/#ref-programs-compute-exprs\">computation</a> are valid for a consensus step.\n  However, some additional expressions are allowed.<a href=\"#p_38\" class=\"pid\">38</a>\n</p>\n<h3 id=\"ref-programs-consensus-this\" class=\"refHeader\"><code>this</code><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ref-programs-consensus-this\"><span class=\"icon icon-link\"></span></a></h3>\n<p>\n  <i id=\"p_39\" class=\"pid\"></i>Inside of a consensus step, <span class=\"snip\"><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a></span> refers to the address of the participant that performed the consensus transfer.\n  This is useful when the consensus transfer was initiated by a <span class=\"snip\"><a href=\"/rsh/step/#rsh_race\" title=\"rsh: race\"><span style=\"color: var(--shiki-color-text)\">race</span></a></span> expression.<a href=\"#p_39\" class=\"pid\">39</a>\n</p>\n<h3 id=\"transfer\" class=\"refHeader\"><code>transfer</code><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#transfer\"><span class=\"icon icon-link\"></span></a></h3>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"transfer(10).to(Alice);\ntransfer(2, gil).to(Alice);\ntransfer([1, [2, gil]]).to(Alice);\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/consensus/#rsh_transfer\" title=\"rsh: transfer\"><span style=\"color: var(--shiki-token-function)\">transfer</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-color-text)\">)</span><a href=\"/rsh/consensus/#rsh_transfer.to\" title=\"rsh: transfer.to\"><span style=\"color: var(--shiki-token-function)\">.to</span></a><span style=\"color: var(--shiki-color-text)\">(Alice);</span></li><li value=\"2\"><a href=\"/rsh/consensus/#rsh_transfer\" title=\"rsh: transfer\"><span style=\"color: var(--shiki-token-function)\">transfer</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">2</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> gil)</span><a href=\"/rsh/consensus/#rsh_transfer.to\" title=\"rsh: transfer.to\"><span style=\"color: var(--shiki-token-function)\">.to</span></a><span style=\"color: var(--shiki-color-text)\">(Alice);</span></li><li value=\"3\"><a href=\"/rsh/consensus/#rsh_transfer\" title=\"rsh: transfer\"><span style=\"color: var(--shiki-token-function)\">transfer</span></a><span style=\"color: var(--shiki-color-text)\">([</span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> [</span><span style=\"color: var(--shiki-token-constant)\">2</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> gil]])</span><a href=\"/rsh/consensus/#rsh_transfer.to\" title=\"rsh: transfer.to\"><span style=\"color: var(--shiki-token-function)\">.to</span></a><span style=\"color: var(--shiki-color-text)\">(Alice);</span></li></ol></pre>\n<p>\n  <i id=\"p_40\" class=\"pid\"></i><span class=\"ref\" id=\"rsh_transfer\" data-scope=\"rsh\" data-symbol=\"transfer\"></span><span class=\"ref\" id=\"rsh_transfer.to\" data-scope=\"rsh\" data-symbol=\"transfer.to\"></span>A <span class=\"term\" id=\"term_transfer%20expression\">transfer expression</span>,\n  written <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_transfer\" title=\"rsh: transfer\"><span style=\"color: var(--shiki-token-function)\">transfer</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">PAY_AMOUNT_EXPR</span><span style=\"color: var(--shiki-color-text)\">)</span><a href=\"/rsh/consensus/#rsh_transfer.to\" title=\"rsh: transfer.to\"><span style=\"color: var(--shiki-token-function)\">.to</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">ADDR_EXPR</span><span style=\"color: var(--shiki-color-text)\">)</span></span>,\n  where <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">PAY_AMOUNT_EXPR</span></span> is an expression that evaluates to a <a href=\"/rsh/step/#payAmt\">pay amount</a>, and\n  <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">ADDR_EXPR</span></span> evaluates to an address,\n  performs a transfer of network tokens or non-network tokens from the contract to the named participant.\n  The amount transfered must evaluate to less than or equal to the balance of the network and non-network tokens in the contract account.<a href=\"#p_40\" class=\"pid\">40</a>\n</p>\n<p><i id=\"p_41\" class=\"pid\"></i>A transfer expression may only occur within a consensus step.<a href=\"#p_41\" class=\"pid\">41</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/simple-nft-auction/index.rsh\">/examples/simple-nft-auction/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"      });\n  transfer(lastPrice).to(Creator);\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"59\"><span style=\"color: var(--shiki-color-text)\">      });</span></li><li value=\"60\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_transfer\" title=\"rsh: transfer\"><span style=\"color: var(--shiki-token-function)\">transfer</span></a><span style=\"color: var(--shiki-color-text)\">(lastPrice)</span><a href=\"/rsh/consensus/#rsh_transfer.to\" title=\"rsh: transfer.to\"><span style=\"color: var(--shiki-token-function)\">.to</span></a><span style=\"color: var(--shiki-color-text)\">(Creator);</span></li></ol></pre>\n<p>\n  <i id=\"p_42\" class=\"pid\"></i>The first <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_transfer\" title=\"rsh: transfer\"><span style=\"color: var(--shiki-color-text)\">transfer</span></a></span> example from the Simple NFT Auction pays the <code>lastPrice</code> to the NFT <code>Creator</code>.\n  The second <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_transfer\" title=\"rsh: transfer\"><span style=\"color: var(--shiki-color-text)\">transfer</span></a></span> example gives the sale quantity of the NFT to the <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_Participant\" title=\"rsh: Participant\"><span style=\"color: var(--shiki-color-text)\">Participant</span></a></span> that bid the highest price.<a href=\"#p_42\" class=\"pid\">42</a>\n</p>\n<h3 id=\"require\" class=\"refHeader\"><code>require</code><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#require\"><span class=\"icon icon-link\"></span></a></h3>\n<p><span class=\"ref\" id=\"rsh_require\" data-scope=\"rsh\" data-symbol=\"require\"></span></p>\n<pre class=\"snippet unnumbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"require( claim, [msg] )\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/consensus/#rsh_require\" title=\"rsh: require\"><span style=\"color: var(--shiki-token-function)\">require</span></a><span style=\"color: var(--shiki-color-text)\">( claim</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> [msg] )</span></li></ol></pre>\n<p>\n  <i id=\"p_43\" class=\"pid\"></i>A requirement where <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">claim</span></span> evaluates to <span class=\"snip\"><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a></span> with honest participants.\n  This may only appear in a consensus step.\n  It accepts an optional bytes argument, which is included in any reported violation.<a href=\"#p_43\" class=\"pid\">43</a>\n</p>\n<p><i id=\"p_44\" class=\"pid\"></i>If a publication would violate the requirement, the consensus network rejects the transaction.<a href=\"#p_44\" class=\"pid\">44</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/abstract-tok/index.rsh\">/examples/abstract-tok/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  A.publish(token1, token2, amt);\n  require(token1 != token2);\n  commit();\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"20\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">A</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">(token1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> token2</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amt);</span></li><li value=\"21\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_require\" title=\"rsh: require\"><span style=\"color: var(--shiki-token-function)\">require</span></a><span style=\"color: var(--shiki-color-text)\">(token1 </span><a href=\"/rsh/compute/#rsh_!=\" title=\"rsh: !=\"><span style=\"color: var(--shiki-token-keyword)\">!=</span></a><span style=\"color: var(--shiki-color-text)\"> token2);</span></li><li value=\"22\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li></ol></pre>\n<p>\n  <i id=\"p_45\" class=\"pid\"></i>The example above has Alice publish two tokens named <code>token1</code> and <code>token2</code> and the <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_require\" title=\"rsh: require\"><span style=\"color: var(--shiki-color-text)\">require</span></a></span> statement checks if they are different tokens.\n  If they are not different tokens, then the transaction is rejected.<a href=\"#p_45\" class=\"pid\">45</a>\n</p>\n<h3 id=\"checkcommitment\" class=\"refHeader\"><code>checkCommitment</code><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#checkcommitment\"><span class=\"icon icon-link\"></span></a></h3>\n<p><span class=\"ref\" id=\"rsh_checkCommitment\" data-scope=\"rsh\" data-symbol=\"checkCommitment\"></span></p>\n<pre class=\"snippet unnumbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"checkCommitment( commitment, salt, x )\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/consensus/#rsh_checkCommitment\" title=\"rsh: checkCommitment\"><span style=\"color: var(--shiki-token-function)\">checkCommitment</span></a><span style=\"color: var(--shiki-color-text)\">( commitment</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> salt</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> x )</span></li></ol></pre>\n<p>\n  <i id=\"p_46\" class=\"pid\"></i>Makes a requirement that <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">commitment</span></span> is the digest of <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">salt</span></span> and <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">x</span></span>.\n  This is used in a consensus step after <span class=\"snip\"><a href=\"/rsh/local/#rsh_makeCommitment\" title=\"rsh: makeCommitment\"><span style=\"color: var(--shiki-color-text)\">makeCommitment</span></a></span> was used in a local step.<a href=\"#p_46\" class=\"pid\">46</a>\n</p>\n<p><i id=\"p_47\" class=\"pid\"></i>The example below shows <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_checkCommitment\" title=\"rsh: checkCommitment\"><span style=\"color: var(--shiki-color-text)\">checkCommitment</span></a></span> being used in a consensus step on line 87 after <span class=\"snip\"><a href=\"/rsh/local/#rsh_makeCommitment\" title=\"rsh: makeCommitment\"><span style=\"color: var(--shiki-color-text)\">makeCommitment</span></a></span> was used in a local step on line 66:<a href=\"#p_47\" class=\"pid\">47</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-loops/index.rsh\">/examples/rps-7-loops/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    Alice.only(() => {\n      const _handAlice = interact.getHand();\n      const [_commitAlice, _saltAlice] = makeCommitment(interact, _handAlice);\n      const commitAlice = declassify(_commitAlice);\n    });\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"64\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">Alice</span><a href=\"/rsh/step/#rsh_only\" title=\"rsh: only\"><span style=\"color: var(--shiki-token-function)\">.only</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"65\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">_handAlice</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.getHand</span><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"66\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> [</span><span style=\"color: var(--shiki-token-constant)\">_commitAlice</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">_saltAlice</span><span style=\"color: var(--shiki-color-text)\">] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_makeCommitment\" title=\"rsh: makeCommitment\"><span style=\"color: var(--shiki-token-function)\">makeCommitment</span></a><span style=\"color: var(--shiki-color-text)\">(interact</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> _handAlice);</span></li><li value=\"67\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">commitAlice</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: var(--shiki-token-function)\">declassify</span></a><span style=\"color: var(--shiki-color-text)\">(_commitAlice);</span></li><li value=\"68\"><span style=\"color: var(--shiki-color-text)\">    });</span></li></ol></pre>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-loops/index.rsh\">/examples/rps-7-loops/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    Alice.publish(saltAlice, handAlice)\n      .timeout(relativeTime(deadline), () => closeTo(Bob, informTimeout));\n    checkCommitment(commitAlice, saltAlice, handAlice);\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"85\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">Alice</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">(saltAlice</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> handAlice)</span></li><li value=\"86\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/step/#rsh_timeout\" title=\"rsh: timeout\"><span style=\"color: var(--shiki-token-function)\">.timeout</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_relativeTime\" title=\"rsh: relativeTime\"><span style=\"color: var(--shiki-token-function)\">relativeTime</span></a><span style=\"color: var(--shiki-color-text)\">(deadline)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/step/#rsh_closeTo\" title=\"rsh: closeTo\"><span style=\"color: var(--shiki-token-function)\">closeTo</span></a><span style=\"color: var(--shiki-color-text)\">(Bob</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> informTimeout));</span></li><li value=\"87\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_checkCommitment\" title=\"rsh: checkCommitment\"><span style=\"color: var(--shiki-token-function)\">checkCommitment</span></a><span style=\"color: var(--shiki-color-text)\">(commitAlice</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> saltAlice</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> handAlice);</span></li></ol></pre>\n<h3 id=\"ref-programs-consensus-token-minting\" class=\"refHeader\">Token minting<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ref-programs-consensus-token-minting\"><span class=\"icon icon-link\"></span></a></h3>\n<p><span class=\"ref\" id=\"rsh_burn\" data-scope=\"rsh\" data-symbol=\"burn\"></span><span class=\"ref\" id=\"rsh_Token.burn\" data-scope=\"rsh\" data-symbol=\"Token.burn\"></span><span class=\"ref\" id=\"rsh_destroy\" data-scope=\"rsh\" data-symbol=\"destroy\"></span><span class=\"ref\" id=\"rsh_Token.destroy\" data-scope=\"rsh\" data-symbol=\"Token.destroy\"></span><span class=\"ref\" id=\"rsh_supply\" data-scope=\"rsh\" data-symbol=\"supply\"></span><span class=\"ref\" id=\"rsh_Token.supply\" data-scope=\"rsh\" data-symbol=\"Token.supply\"></span><span class=\"ref\" id=\"rsh_destroyed\" data-scope=\"rsh\" data-symbol=\"destroyed\"></span><span class=\"ref\" id=\"rsh_Token.destroyed\" data-scope=\"rsh\" data-symbol=\"Token.destroyed\"></span></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"require(supply >= 2 * amt);\nconst tok = new Token({ name, symbol, url, metadata, supply, decimals });\ntransfer(amt, tok).to(who);\ntok.burn(amt);\nassert(tok.supply() == supply - amt);\ntok.burn();\nassert(tok.destroyed() == false);\ntok.destroy();\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/consensus/#rsh_require\" title=\"rsh: require\"><span style=\"color: var(--shiki-token-function)\">require</span></a><span style=\"color: var(--shiki-color-text)\">(supply </span><a href=\"/rsh/compute/#rsh_%3E=\" title=\"rsh: >=\"><span style=\"color: var(--shiki-token-keyword)\">&gt;=</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">2</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_*\" title=\"rsh: *\"><span style=\"color: var(--shiki-token-keyword)\">*</span></a><span style=\"color: var(--shiki-color-text)\"> amt);</span></li><li value=\"2\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">tok</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_new\" title=\"rsh: new\"><span style=\"color: var(--shiki-token-keyword)\">new</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Token\" title=\"rsh: Token\"><span style=\"color: var(--shiki-token-function)\">Token</span></a><span style=\"color: var(--shiki-color-text)\">({ name</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> symbol</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> url</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> metadata</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> supply</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> decimals });</span></li><li value=\"3\"><a href=\"/rsh/consensus/#rsh_transfer\" title=\"rsh: transfer\"><span style=\"color: var(--shiki-token-function)\">transfer</span></a><span style=\"color: var(--shiki-color-text)\">(amt</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> tok)</span><a href=\"/rsh/consensus/#rsh_transfer.to\" title=\"rsh: transfer.to\"><span style=\"color: var(--shiki-token-function)\">.to</span></a><span style=\"color: var(--shiki-color-text)\">(who);</span></li><li value=\"4\"><span style=\"color: var(--shiki-token-constant)\">tok</span><a href=\"/rsh/consensus/#rsh_Token.burn\" title=\"rsh: Token.burn\"><span style=\"color: var(--shiki-token-function)\">.burn</span></a><span style=\"color: var(--shiki-color-text)\">(amt);</span></li><li value=\"5\"><a href=\"/rsh/compute/#rsh_assert\" title=\"rsh: assert\"><span style=\"color: var(--shiki-token-function)\">assert</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">tok</span><a href=\"/rsh/consensus/#rsh_Token.supply\" title=\"rsh: Token.supply\"><span style=\"color: var(--shiki-token-function)\">.supply</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> supply </span><a href=\"/rsh/compute/#rsh_-\" title=\"rsh: -\"><span style=\"color: var(--shiki-token-keyword)\">-</span></a><span style=\"color: var(--shiki-color-text)\"> amt);</span></li><li value=\"6\"><span style=\"color: var(--shiki-token-constant)\">tok</span><a href=\"/rsh/consensus/#rsh_Token.burn\" title=\"rsh: Token.burn\"><span style=\"color: var(--shiki-token-function)\">.burn</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"7\"><a href=\"/rsh/compute/#rsh_assert\" title=\"rsh: assert\"><span style=\"color: var(--shiki-token-function)\">assert</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">tok</span><a href=\"/rsh/consensus/#rsh_Token.destroyed\" title=\"rsh: Token.destroyed\"><span style=\"color: var(--shiki-token-function)\">.destroyed</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_false\" title=\"rsh: false\"><span style=\"color: var(--shiki-token-constant)\">false</span></a><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"8\"><span style=\"color: var(--shiki-token-constant)\">tok</span><a href=\"/rsh/consensus/#rsh_Token.destroy\" title=\"rsh: Token.destroy\"><span style=\"color: var(--shiki-token-function)\">.destroy</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li></ol></pre>\n<div class=\"note\">\n  <p><i id=\"p_48\" class=\"pid\"></i><a href=\"/networks/#ref-networks\">Networks</a> discusses how Reach supports token minting on specific consensus networks.<a href=\"#p_48\" class=\"pid\">48</a></p>\n</div>\n<p>\n  <i id=\"p_49\" class=\"pid\"></i>We refer to creation of a new non-network token as <span class=\"term\" id=\"term_token%20minting\">token minting</span>.\n  It is written with the expression <span class=\"snip\"><a href=\"/rsh/compute/#rsh_new\" title=\"rsh: new\"><span style=\"color: var(--shiki-token-keyword)\">new</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Token\" title=\"rsh: Token\"><span style=\"color: var(--shiki-token-function)\">Token</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">PARAMS</span><span style=\"color: var(--shiki-color-text)\">)</span></span>, where <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">PARAMS</span></span> is an object with the following keys:<a href=\"#p_49\" class=\"pid\">49</a>\n</p>\n<ul>\n  <li><i id=\"p_50\" class=\"pid\"></i><code>name</code>: A value of type <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Bytes\" title=\"rsh: Bytes\"><span style=\"color: var(--shiki-token-function)\">Bytes</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">32</span><span style=\"color: var(--shiki-color-text)\">)</span></span>; defaults to empty.<a href=\"#p_50\" class=\"pid\">50</a></li>\n  <li><i id=\"p_51\" class=\"pid\"></i><code>symbol</code>: A value of type <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Bytes\" title=\"rsh: Bytes\"><span style=\"color: var(--shiki-token-function)\">Bytes</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">8</span><span style=\"color: var(--shiki-color-text)\">)</span></span>; defaults to empty.<a href=\"#p_51\" class=\"pid\">51</a></li>\n  <li><i id=\"p_52\" class=\"pid\"></i><code>url</code>: A value of type <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Bytes\" title=\"rsh: Bytes\"><span style=\"color: var(--shiki-token-function)\">Bytes</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">96</span><span style=\"color: var(--shiki-color-text)\">)</span></span>; defaults to empty.<a href=\"#p_52\" class=\"pid\">52</a></li>\n  <li>\n    <i id=\"p_53\" class=\"pid\"></i><code>metadata</code>: A value of type <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Bytes\" title=\"rsh: Bytes\"><span style=\"color: var(--shiki-token-function)\">Bytes</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">32</span><span style=\"color: var(--shiki-color-text)\">)</span></span>; defaults to empty.\n    This value is intended to be a digest of a larger metadata document.<a href=\"#p_53\" class=\"pid\">53</a>\n  </li>\n  <li><i id=\"p_54\" class=\"pid\"></i><code>supply</code>: A value of type <span class=\"snip\"><a href=\"/rsh/compute/#rsh_UInt\" title=\"rsh: UInt\"><span style=\"color: var(--shiki-color-text)\">UInt</span></a></span>; defaults to <span class=\"snip\"><a href=\"/rsh/compute/#rsh_UInt\" title=\"rsh: UInt\"><span style=\"color: var(--shiki-token-constant)\">UInt</span></a><a href=\"/rsh/compute/#rsh_UInt.max\" title=\"rsh: UInt.max\"><span style=\"color: var(--shiki-color-text)\">.max</span></a></span>.<a href=\"#p_54\" class=\"pid\">54</a></li>\n  <li><i id=\"p_55\" class=\"pid\"></i><code>decimals</code>: A value of type <span class=\"snip\"><a href=\"/rsh/compute/#rsh_UInt\" title=\"rsh: UInt\"><span style=\"color: var(--shiki-color-text)\">UInt</span></a></span>; defaults to <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">6</span></span> on Algorand, and <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">18</span></span> on Ethereum and Conflux.<a href=\"#p_55\" class=\"pid\">55</a></li>\n</ul>\n<p><i id=\"p_56\" class=\"pid\"></i>The following examples demonstrate how the details above may be used:<a href=\"#p_56\" class=\"pid\">56</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/masterexamples/token-decimals/index.rsh\">examples/token-decimals/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  A.publish(decimals);\n\n  const supply = UInt.max;\n  const t = new Token({ supply, decimals });\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"14\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">A</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">(decimals);</span></li><li value=\"15\"></li><li value=\"16\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/consensus/#rsh_supply\" title=\"rsh: supply\"><span style=\"color: var(--shiki-token-constant)\">supply</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_UInt\" title=\"rsh: UInt\"><span style=\"color: var(--shiki-token-constant)\">UInt</span></a><span style=\"color: var(--shiki-color-text)\">.max;</span></li><li value=\"17\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">t</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_new\" title=\"rsh: new\"><span style=\"color: var(--shiki-token-keyword)\">new</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Token\" title=\"rsh: Token\"><span style=\"color: var(--shiki-token-function)\">Token</span></a><span style=\"color: var(--shiki-color-text)\">({ supply</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> decimals });</span></li></ol></pre>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/masterexamples/mint-basic/index.rsh\">examples/mint-basic/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  A.publish(name, symbol, url, metadata, supply, amt);\n  require(4 * amt <= supply);\n  require(4 * amt <= UInt.max);\n\n  const md1 = {name, symbol, url, metadata, supply};\n  const tok1 = new Token(md1);\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"28\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">A</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">(name</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> symbol</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> url</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> metadata</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> supply</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amt);</span></li><li value=\"29\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_require\" title=\"rsh: require\"><span style=\"color: var(--shiki-token-function)\">require</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">4</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_*\" title=\"rsh: *\"><span style=\"color: var(--shiki-token-keyword)\">*</span></a><span style=\"color: var(--shiki-color-text)\"> amt </span><a href=\"/rsh/compute/#rsh_%3C=\" title=\"rsh: <=\"><span style=\"color: var(--shiki-token-keyword)\">&lt;=</span></a><span style=\"color: var(--shiki-color-text)\"> supply);</span></li><li value=\"30\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_require\" title=\"rsh: require\"><span style=\"color: var(--shiki-token-function)\">require</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">4</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_*\" title=\"rsh: *\"><span style=\"color: var(--shiki-token-keyword)\">*</span></a><span style=\"color: var(--shiki-color-text)\"> amt </span><a href=\"/rsh/compute/#rsh_%3C=\" title=\"rsh: <=\"><span style=\"color: var(--shiki-token-keyword)\">&lt;=</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_UInt\" title=\"rsh: UInt\"><span style=\"color: var(--shiki-token-constant)\">UInt</span></a><span style=\"color: var(--shiki-color-text)\">.max);</span></li><li value=\"31\"></li><li value=\"32\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">md1</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> {name</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> symbol</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> url</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> metadata</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> supply};</span></li><li value=\"33\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">tok1</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_new\" title=\"rsh: new\"><span style=\"color: var(--shiki-token-keyword)\">new</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Token\" title=\"rsh: Token\"><span style=\"color: var(--shiki-token-function)\">Token</span></a><span style=\"color: var(--shiki-color-text)\">(md1);</span></li></ol></pre>\n<p>\n  <i id=\"p_57\" class=\"pid\"></i>This returns a <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Token\" title=\"rsh: Token\"><span style=\"color: var(--shiki-color-text)\">Token</span></a></span> value and deposits a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_supply\" title=\"rsh: supply\"><span style=\"color: var(--shiki-color-text)\">supply</span></a></span> amount of the new non-network tokens into the contract account associated with the DApp.\n  These tokens must be destroyed by the end of the DApp.<a href=\"#p_57\" class=\"pid\">57</a>\n</p>\n<div class=\"note\">\n  <p><i id=\"p_58\" class=\"pid\"></i>Reach assumes that network tokens and non-network tokens behave identically, but often they do not; <a href=\"/guide/nntoks/#guide-nntoks\">this article</a> discusses the causes and consequences of this.<a href=\"#p_58\" class=\"pid\">58</a></p>\n</div>\n<hr>\n<p><i id=\"p_59\" class=\"pid\"></i><span class=\"snip\"><a href=\"/rsh/compute/#rsh_Token\" title=\"rsh: Token\"><span style=\"color: var(--shiki-token-constant)\">Token</span></a><a href=\"/rsh/consensus/#rsh_Token.burn\" title=\"rsh: Token.burn\"><span style=\"color: var(--shiki-token-function)\">.burn</span></a><span style=\"color: var(--shiki-color-text)\">(tok</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amt)</span></span>, or <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">tok</span><a href=\"/rsh/consensus/#rsh_burn\" title=\"rsh: burn\"><span style=\"color: var(--shiki-token-function)\">.burn</span></a><span style=\"color: var(--shiki-color-text)\">(amt)</span></span>, where <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">tok</span></span> is a <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Token\" title=\"rsh: Token\"><span style=\"color: var(--shiki-color-text)\">Token</span></a></span> value and <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">amt</span></span> is a <span class=\"snip\"><a href=\"/rsh/compute/#rsh_UInt\" title=\"rsh: UInt\"><span style=\"color: var(--shiki-color-text)\">UInt</span></a></span> value, may be used to <span class=\"term\" id=\"term_burn\">burn</span> tokens in the contract account, meaning that they are utterly destroyed and can never be recovered.<a href=\"#p_59\" class=\"pid\">59</a></p>\n<hr>\n<p>\n  <i id=\"p_60\" class=\"pid\"></i><span class=\"snip\"><a href=\"/rsh/compute/#rsh_Token\" title=\"rsh: Token\"><span style=\"color: var(--shiki-token-constant)\">Token</span></a><a href=\"/rsh/consensus/#rsh_Token.destroy\" title=\"rsh: Token.destroy\"><span style=\"color: var(--shiki-token-function)\">.destroy</span></a><span style=\"color: var(--shiki-color-text)\">(tok)</span></span>, or <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">tok</span><a href=\"/rsh/consensus/#rsh_destroy\" title=\"rsh: destroy\"><span style=\"color: var(--shiki-token-function)\">.destroy</span></a><span style=\"color: var(--shiki-color-text)\">()</span></span>, where <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">tok</span></span> is a <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Token\" title=\"rsh: Token\"><span style=\"color: var(--shiki-color-text)\">Token</span></a></span> value, may be used to destroy the token so that it may never be used again by any users on the consensus network.\n  This must be called before the application exits.<a href=\"#p_60\" class=\"pid\">60</a>\n</p>\n<hr>\n<p>\n  <i id=\"p_61\" class=\"pid\"></i><span class=\"snip\"><a href=\"/rsh/compute/#rsh_Token\" title=\"rsh: Token\"><span style=\"color: var(--shiki-token-constant)\">Token</span></a><a href=\"/rsh/consensus/#rsh_Token.destroyed\" title=\"rsh: Token.destroyed\"><span style=\"color: var(--shiki-token-function)\">.destroyed</span></a><span style=\"color: var(--shiki-color-text)\">(tok)</span></span>, or <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">tok</span><a href=\"/rsh/consensus/#rsh_destroyed\" title=\"rsh: destroyed\"><span style=\"color: var(--shiki-token-function)\">.destroyed</span></a><span style=\"color: var(--shiki-color-text)\">()</span></span>, where <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">tok</span></span> is a <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Token\" title=\"rsh: Token\"><span style=\"color: var(--shiki-color-text)\">Token</span></a></span> value, returns whether <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_destroy\" title=\"rsh: destroy\"><span style=\"color: var(--shiki-color-text)\">destroy</span></a></span>\n  has been called on <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">tok</span></span> yet.<a href=\"#p_61\" class=\"pid\">61</a>\n</p>\n<hr>\n<p><i id=\"p_62\" class=\"pid\"></i><span class=\"snip\"><a href=\"/rsh/compute/#rsh_Token\" title=\"rsh: Token\"><span style=\"color: var(--shiki-token-constant)\">Token</span></a><a href=\"/rsh/consensus/#rsh_Token.supply\" title=\"rsh: Token.supply\"><span style=\"color: var(--shiki-token-function)\">.supply</span></a><span style=\"color: var(--shiki-color-text)\">(tok)</span></span>, or <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">tok</span><a href=\"/rsh/consensus/#rsh_supply\" title=\"rsh: supply\"><span style=\"color: var(--shiki-token-function)\">.supply</span></a><span style=\"color: var(--shiki-color-text)\">()</span></span>, where <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">tok</span></span> is a <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Token\" title=\"rsh: Token\"><span style=\"color: var(--shiki-color-text)\">Token</span></a></span> value, may be used to query the current supply of tokens, i.e. the number of tokens which have not been burnt.<a href=\"#p_62\" class=\"pid\">62</a></p>\n<h3 id=\"remote-objects\" class=\"refHeader\">Remote objects<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#remote-objects\"><span class=\"icon icon-link\"></span></a></h3>\n<p><span class=\"ref\" id=\"rsh_remote\" data-scope=\"rsh\" data-symbol=\"remote\"></span></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const randomOracle =\n  remote( randomOracleCtcInfo, {\n    getRandom: Fun([], UInt),\n  });\nconst randomVal = randomOracle.getRandom.pay(randomFee)();\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">randomOracle</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span></li><li value=\"2\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_remote\" title=\"rsh: remote\"><span style=\"color: var(--shiki-token-function)\">remote</span></a><span style=\"color: var(--shiki-color-text)\">( randomOracleCtcInfo</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"3\"><span style=\"color: var(--shiki-color-text)\">    getRandom</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"4\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"5\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">randomVal</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">randomOracle</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">getRandom</span><a href=\"/rsh/step/#rsh_pay\" title=\"rsh: pay\"><span style=\"color: var(--shiki-token-function)\">.pay</span></a><span style=\"color: var(--shiki-color-text)\">(randomFee)();</span></li></ol></pre>\n<div class=\"note\">\n  <p><i id=\"p_63\" class=\"pid\"></i><a href=\"/networks/#ref-networks\">Networks</a> discusses how Reach supports remote objects on specific consensus networks.<a href=\"#p_63\" class=\"pid\">63</a></p>\n</div>\n<p>\n  <i id=\"p_64\" class=\"pid\"></i>A <span class=\"term\" id=\"term_remote%20object\">remote object</span> represents a foreign contract in a Reach application.\n  During a consensus step, a Reach computation may consensually communicate with such an object via a prescribed interface.<a href=\"#p_64\" class=\"pid\">64</a>\n</p>\n<p>\n  <i id=\"p_65\" class=\"pid\"></i>A remote object is constructed by calling the <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_remote\" title=\"rsh: remote\"><span style=\"color: var(--shiki-color-text)\">remote</span></a></span> function with a <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Contract\" title=\"rsh: Contract\"><span style=\"color: var(--shiki-color-text)\">Contract</span></a></span>, an interface---an object where each key is bound to a function type, and an optional object of aliases.\n  The alias object maps function names from the interface to function names on the remote contract.\n  It allows users to bind specific instances of an overloaded remote function.\n  For example:<a href=\"#p_65\" class=\"pid\">65</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const randomOracle =\n  remote( randomOracleCtcInfo, {\n    getRandom: Fun([], UInt),\n    getRandom1: Fun([UInt], UInt),\n  }, {\n    getRandom: &quot;random&quot;,\n    getRandom1: &quot;random&quot;,\n  });\nconst token =\n  remote( tokenCtcInfo, {\n    balanceOf: Fun([Address], UInt),\n    transferTo: Fun([UInt, Address], Null),\n  });\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">randomOracle</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span></li><li value=\"2\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_remote\" title=\"rsh: remote\"><span style=\"color: var(--shiki-token-function)\">remote</span></a><span style=\"color: var(--shiki-color-text)\">( randomOracleCtcInfo</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"3\"><span style=\"color: var(--shiki-color-text)\">    getRandom</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"4\"><span style=\"color: var(--shiki-color-text)\">    getRandom1</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([UInt]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"5\"><span style=\"color: var(--shiki-color-text)\">  }</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"6\"><span style=\"color: var(--shiki-color-text)\">    getRandom</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"random\"</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"7\"><span style=\"color: var(--shiki-color-text)\">    getRandom1</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"random\"</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"8\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"9\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">token</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span></li><li value=\"10\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_remote\" title=\"rsh: remote\"><span style=\"color: var(--shiki-token-function)\">remote</span></a><span style=\"color: var(--shiki-color-text)\">( tokenCtcInfo</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"11\"><span style=\"color: var(--shiki-color-text)\">    balanceOf</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Address]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"12\"><span style=\"color: var(--shiki-color-text)\">    transferTo</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([UInt</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Address]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Null)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"13\"><span style=\"color: var(--shiki-color-text)\">  });</span></li></ol></pre>\n<p>\n  <i id=\"p_66\" class=\"pid\"></i>In this example, the random oracle contract has an overloaded method, <code>random</code>.\n  This <code>random</code> method accepts 0 or 1 parameters.\n  We explicitly specify that <code>getRandom</code> refers to calling the <code>random</code> function with no arguments, and <code>getRandom1</code> refers to calling the <code>random</code> function with 1 argument.<a href=\"#p_66\" class=\"pid\">66</a>\n</p>\n<p>\n  <i id=\"p_67\" class=\"pid\"></i><span class=\"ref\" id=\"rsh_REMOTE_FUN\" data-scope=\"rsh\" data-symbol=\"REMOTE_FUN\"></span>Once constructed, the fields of a remote object represent those remote contract interactions, referred to as <span class=\"term\" id=\"term_remote%20functions\">remote functions</span>.\n  For example, <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">randomOracle</span><span style=\"color: var(--shiki-color-text)\">.getRandom</span></span>, <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">token</span><span style=\"color: var(--shiki-color-text)\">.balanceOf</span></span>, and <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">token</span><span style=\"color: var(--shiki-color-text)\">.transferTo</span></span> are remote functions in the example.<a href=\"#p_67\" class=\"pid\">67</a>\n</p>\n<p>\n  <i id=\"p_68\" class=\"pid\"></i>A remote function may be invoked by calling it with the appropriate arguments, whereupon it returns the specified output.\n  In addition, a remote function may be augmented with one of the following operations:<a href=\"#p_68\" class=\"pid\">68</a>\n</p>\n<ul>\n  <li>\n    <i id=\"p_69\" class=\"pid\"></i><span class=\"snip\"><a href=\"/rsh/consensus/#rsh_REMOTE_FUN\" title=\"rsh: REMOTE_FUN\"><span style=\"color: var(--shiki-token-constant)\">REMOTE_FUN</span></a><a href=\"/rsh/step/#rsh_pay\" title=\"rsh: pay\"><span style=\"color: var(--shiki-token-function)\">.pay</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">AMT</span><span style=\"color: var(--shiki-color-text)\">)</span></span> ---\n    Returns a remote function that receives a pay amount, <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">AMT</span></span>, <em>from</em> the caller when it is called.<a href=\"#p_69\" class=\"pid\">69</a>\n  </li>\n  <li>\n    <i id=\"p_70\" class=\"pid\"></i><span class=\"ref\" id=\"rsh_bill\" data-scope=\"rsh\" data-symbol=\"bill\"></span><span class=\"snip\"><a href=\"/rsh/consensus/#rsh_REMOTE_FUN\" title=\"rsh: REMOTE_FUN\"><span style=\"color: var(--shiki-token-constant)\">REMOTE_FUN</span></a><a href=\"/rsh/consensus/#rsh_bill\" title=\"rsh: bill\"><span style=\"color: var(--shiki-token-function)\">.bill</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">AMT</span><span style=\"color: var(--shiki-color-text)\">)</span></span> ---\n    Returns a remote function that provides a pay amount, <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">AMT</span></span>, <em>to</em> the caller when it returns.<a href=\"#p_70\" class=\"pid\">70</a>\n  </li>\n  <li>\n    <i id=\"p_71\" class=\"pid\"></i><span class=\"ref\" id=\"rsh_withBill\" data-scope=\"rsh\" data-symbol=\"withBill\"></span><span class=\"snip\"><a href=\"/rsh/consensus/#rsh_REMOTE_FUN\" title=\"rsh: REMOTE_FUN\"><span style=\"color: var(--shiki-token-constant)\">REMOTE_FUN</span></a><a href=\"/rsh/consensus/#rsh_withBill\" title=\"rsh: withBill\"><span style=\"color: var(--shiki-token-function)\">.withBill</span></a><span style=\"color: var(--shiki-color-text)\">()</span></span> ---\n    Returns a remote function that provides some number of network tokens and, possibly, non-network tokens <em>to</em> the caller when it returns.\n    The exact amount is returned from the invocation by wrapping the original result in a tuple.<a href=\"#p_71\" class=\"pid\">71</a>\n  </li>\n  <li>\n    <i id=\"p_72\" class=\"pid\"></i><span class=\"ref\" id=\"rsh_remote.ALGO\" data-scope=\"rsh\" data-symbol=\"remote.ALGO\"></span><span class=\"snip\"><a href=\"/rsh/consensus/#rsh_REMOTE_FUN\" title=\"rsh: REMOTE_FUN\"><span style=\"color: var(--shiki-token-constant)\">REMOTE_FUN</span></a><a href=\"/rsh/appinit/#rsh_ALGO\" title=\"rsh: ALGO\"><span style=\"color: var(--shiki-token-function)\">.ALGO</span></a><span style=\"color: var(--shiki-color-text)\">(opts)</span></span> ---\n    Returns a remote function that records the need for additional resources on Algorand.<a href=\"#p_72\" class=\"pid\">72</a>\n    <ul>\n      <li>\n        <i id=\"p_73\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">opts</span><span style=\"color: var(--shiki-color-text)\">.fees</span></span> records extra fees.\n        If this is needed, and not included, then the consensus transfer to the current consensus step will fail with an insufficient fee error.<a href=\"#p_73\" class=\"pid\">73</a>\n      </li>\n      <li>\n        <i id=\"p_74\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">opts</span><span style=\"color: var(--shiki-color-text)\">.assets</span></span> records extra assets.\n        If this is needed, and not included, then the consensus transfer to the current consensus step will fail with an invalid asset reference.<a href=\"#p_74\" class=\"pid\">74</a>\n      </li>\n      <li>\n        <i id=\"p_75\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">opts</span><span style=\"color: var(--shiki-color-text)\">.apps</span></span> records extra applications.\n        If this is needed, and not included, then the consensus transfer to the current consensus step will fail with an invalid application reference.<a href=\"#p_75\" class=\"pid\">75</a>\n      </li>\n      <li>\n        <i id=\"p_76\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">opts</span><span style=\"color: var(--shiki-color-text)\">.addressToAccount</span></span> changes <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Address\" title=\"rsh: Address\"><span style=\"color: var(--shiki-color-text)\">Address</span></a></span> arguments to <code>Account</code> array references.\n        If this is needed, and not included, then the consensus transfer to the current consensus step will fail because an incorrectly typed argument was provided to the remote object.<a href=\"#p_76\" class=\"pid\">76</a>\n      </li>\n      <li>\n        <i id=\"p_77\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">opts</span><span style=\"color: var(--shiki-color-text)\">.onCompletion</span></span> sets the <code>OnCompletion</code> field of the transaction.\n        The value is a string for the field value; e.g., <span class=\"snip\"><span style=\"color: var(--shiki-token-string-expression)\">'DeleteApplication'</span></span>.\n        It is dangerous to call this with <code>OptIn</code>, because the minimum balance of the calling contract will increase and Reach cannot track that, because it is not statically available.\n        The minimum balance will decrease on a <code>CloseOut</code> or <code>ClearState</code> transaction.<a href=\"#p_77\" class=\"pid\">77</a>\n      </li>\n    </ul>\n  </li>\n</ul>\n<p><i id=\"p_78\" class=\"pid\"></i>If the remote contract is not expected to return non-network tokens then a pair is returned, where the amount of network tokens received is the first element, and the original result is the second element.<a href=\"#p_78\" class=\"pid\">78</a></p>\n<p>\n  <i id=\"p_79\" class=\"pid\"></i>If the remote contract is expected to return non-network tokens then a triple is returned, where the amount of network tokens received\n  is the first element, a tuple of the non-network tokens received is the second element, and the original result is the third element.\n  If the caller expects to receive non-network tokens, they must provide a tuple of tokens as an argument to <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_withBill\" title=\"rsh: withBill\"><span style=\"color: var(--shiki-color-text)\">withBill</span></a></span>.\n  The ordering of tokens in the argument is preserved when returning the amounts received.\n  For example,<a href=\"#p_79\" class=\"pid\">79</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const [ netRecv, [gilRecv, zmdRecv], randomValue ] =\n  randomOracle.getRandom.pay(stipend).withBill([gil, zmd])();\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><span style=\"color: var(--shiki-token-constant)\">netRecv</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> [</span><span style=\"color: var(--shiki-token-constant)\">gilRecv</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">zmdRecv</span><span style=\"color: var(--shiki-color-text)\">]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">randomValue</span><span style=\"color: var(--shiki-color-text)\"> ] </span><span style=\"color: var(--shiki-token-keyword)\">=</span></li><li value=\"2\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">randomOracle</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">getRandom</span><a href=\"/rsh/step/#rsh_pay\" title=\"rsh: pay\"><span style=\"color: var(--shiki-token-function)\">.pay</span></a><span style=\"color: var(--shiki-color-text)\">(stipend)</span><a href=\"/rsh/consensus/#rsh_withBill\" title=\"rsh: withBill\"><span style=\"color: var(--shiki-token-function)\">.withBill</span></a><span style=\"color: var(--shiki-color-text)\">([gil</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> zmd])();</span></li></ol></pre>\n<p>\n  <i id=\"p_80\" class=\"pid\"></i>might be the way to communicate with a random oracle that receives a conservative approximation of its actual cost and returns what it does not use, along with some amount of network tokens, <code>GIL</code>, and <code>ZMD</code>.\n  This operation may not be used with <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_REMOTE_FUN\" title=\"rsh: REMOTE_FUN\"><span style=\"color: var(--shiki-token-constant)\">REMOTE_FUN</span></a><a href=\"/rsh/consensus/#rsh_bill\" title=\"rsh: bill\"><span style=\"color: var(--shiki-color-text)\">.bill</span></a></span>.<a href=\"#p_80\" class=\"pid\">80</a>\n</p>\n<h3 id=\"mappings-creation-and-modification\" class=\"refHeader\">Mappings: creation and modification<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#mappings-creation-and-modification\"><span class=\"icon icon-link\"></span></a></h3>\n<p><span class=\"ref\" id=\"rsh_Map\" data-scope=\"rsh\" data-symbol=\"Map\"></span></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const bidsM = new Map(Address, UInt);\n       // or `new Map(UInt);`\nbidsM[this] = 17;\ndelete bidsM[this];\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">bidsM</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_new\" title=\"rsh: new\"><span style=\"color: var(--shiki-token-keyword)\">new</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a><span style=\"color: var(--shiki-color-text)\">(Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt);</span></li><li value=\"2\"><span style=\"color: var(--shiki-color-text)\">       </span><span style=\"color: var(--shiki-token-comment)\">// or `new Map(UInt);`</span></li><li value=\"3\"><span style=\"color: var(--shiki-color-text)\">bidsM[</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-color-text)\">] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">17</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"4\"><a href=\"/rsh/errors/#rsh_delete\" title=\"rsh: delete\"><span style=\"color: var(--shiki-token-keyword)\">delete</span></a><span style=\"color: var(--shiki-color-text)\"> bidsM[</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-color-text)\">];</span></li></ol></pre>\n<p>\n  <i id=\"p_81\" class=\"pid\"></i>A new mapping of linear state may be constructed in a consensus step by writing <span class=\"snip\"><a href=\"/rsh/compute/#rsh_new\" title=\"rsh: new\"><span style=\"color: var(--shiki-token-keyword)\">new</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">VAL_TYPE_EXPR</span><span style=\"color: var(--shiki-color-text)\">)</span></span> or <span class=\"snip\"><a href=\"/rsh/compute/#rsh_new\" title=\"rsh: new\"><span style=\"color: var(--shiki-token-keyword)\">new</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">KEY_TYPE_EXPR</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">VAL_TYPE_EXPR</span><span style=\"color: var(--shiki-color-text)\">)</span></span>, where <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">KEY_TYPE_EXPR</span></span> and <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">VAL_TYPE_EXPR</span></span> are types.\n  If <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">KEY_TYPE_EXPR</span></span> is not specified, it will default to <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Address\" title=\"rsh: Address\"><span style=\"color: var(--shiki-color-text)\">Address</span></a></span>.<a href=\"#p_81\" class=\"pid\">81</a>\n</p>\n<p><i id=\"p_82\" class=\"pid\"></i>For example the code below contains only the <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">VAL_TYPE_EXPR</span></span>:<a href=\"#p_82\" class=\"pid\">82</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/splice1/index.rsh\">/examples/splice1/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const M1 = new Map(Bytes(128));\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"7\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">M1</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_new\" title=\"rsh: new\"><span style=\"color: var(--shiki-token-keyword)\">new</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_Bytes\" title=\"rsh: Bytes\"><span style=\"color: var(--shiki-token-function)\">Bytes</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">128</span><span style=\"color: var(--shiki-color-text)\">));</span></li></ol></pre>\n<p><i id=\"p_83\" class=\"pid\"></i>While the following code contains both the <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">KEY_TYPE_EXPR</span></span> and <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">VAL_TYPE_EXPR</span></span>:<a href=\"#p_83\" class=\"pid\">83</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/map-arbitrary-key/index.rsh\">/examples/map-arbitrary-key/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const m1 = new Map(UInt, UInt);\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"24\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">m1</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_new\" title=\"rsh: new\"><span style=\"color: var(--shiki-token-keyword)\">new</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a><span style=\"color: var(--shiki-color-text)\">(UInt</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt);</span></li></ol></pre>\n<p>\n  <i id=\"p_84\" class=\"pid\"></i>These examples return a value which may be used to dereference particular mappings via <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">map[</span><span style=\"color: var(--shiki-token-constant)\">EXPR</span><span style=\"color: var(--shiki-color-text)\">]</span></span>.\n  Such dereferences return a value of type <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Maybe\" title=\"rsh: Maybe\"><span style=\"color: var(--shiki-token-function)\">Maybe</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">VAL_TYPE_EXPR</span><span style=\"color: var(--shiki-color-text)\">)</span></span>, because the mapping may not contain a value for <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">EXPR</span></span>.<a href=\"#p_84\" class=\"pid\">84</a>\n</p>\n<p>\n  <i id=\"p_85\" class=\"pid\"></i>A mapping may be modified by writing <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">map[</span><span style=\"color: var(--shiki-token-constant)\">EXPR</span><span style=\"color: var(--shiki-color-text)\">] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">VALUE_EXPR</span></span> to install <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">VALUE_EXPR</span></span> (of type <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">VAL_TYPE_EXPR</span></span>) at <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">EXPR</span></span>, or by writing <span class=\"snip\"><a href=\"/rsh/errors/#rsh_delete\" title=\"rsh: delete\"><span style=\"color: var(--shiki-token-keyword)\">delete</span></a><span style=\"color: var(--shiki-color-text)\"> map[</span><span style=\"color: var(--shiki-token-constant)\">EXPR</span><span style=\"color: var(--shiki-color-text)\">]</span></span> to remove the mapping entry.\n  Such modifications may only occur in a consensus step.<a href=\"#p_85\" class=\"pid\">85</a>\n</p>\n<p>\n  <i id=\"p_86\" class=\"pid\"></i>N+2 relations can be created by using a <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Tuple\" title=\"rsh: Tuple\"><span style=\"color: var(--shiki-color-text)\">Tuple</span></a></span> as the Map key.\n  For example, a nested mapping: <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a><span style=\"color: var(--shiki-color-text)\">(Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a><span style=\"color: var(--shiki-color-text)\">(Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt))</span></span>, can be simulated by coalescing the Map keys into a <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Tuple\" title=\"rsh: Tuple\"><span style=\"color: var(--shiki-color-text)\">Tuple</span></a></span>: <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_Tuple\" title=\"rsh: Tuple\"><span style=\"color: var(--shiki-token-function)\">Tuple</span></a><span style=\"color: var(--shiki-color-text)\">(Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Address)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt)</span></span>.<a href=\"#p_86\" class=\"pid\">86</a>\n</p>\n<h3 id=\"sets-creation-and-modification\" class=\"refHeader\">Sets: creation and modification<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#sets-creation-and-modification\"><span class=\"icon icon-link\"></span></a></h3>\n<p><span class=\"ref\" id=\"rsh_Set\" data-scope=\"rsh\" data-symbol=\"Set\"></span><span class=\"ref\" id=\"rsh_Set.insert\" data-scope=\"rsh\" data-symbol=\"Set.insert\"></span><span class=\"ref\" id=\"rsh_Set.remove\" data-scope=\"rsh\" data-symbol=\"Set.remove\"></span><span class=\"ref\" id=\"rsh_Set.member\" data-scope=\"rsh\" data-symbol=\"Set.member\"></span><span class=\"ref\" id=\"rsh_Set.Map\" data-scope=\"rsh\" data-symbol=\"Set.Map\"></span></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const bidders = new Set();\nbidders.insert(Alice);\nbidders.Map.size(); // 1\nbidders.remove(Alice);\nbidders.member(Alice); // false\nbidders.Map.size(); // 0\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">bidders</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_new\" title=\"rsh: new\"><span style=\"color: var(--shiki-token-keyword)\">new</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/consensus/#rsh_Set\" title=\"rsh: Set\"><span style=\"color: var(--shiki-token-constant)\">Set</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"2\"><span style=\"color: var(--shiki-token-constant)\">bidders</span><a href=\"/rsh/consensus/#rsh_Set.insert\" title=\"rsh: Set.insert\"><span style=\"color: var(--shiki-token-function)\">.insert</span></a><span style=\"color: var(--shiki-color-text)\">(Alice);</span></li><li value=\"3\"><span style=\"color: var(--shiki-token-constant)\">bidders</span><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/rsh/consensus/#rsh_Set.Map\" title=\"rsh: Set.Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a><a href=\"/rsh/compute/#rsh_Map.size\" title=\"rsh: Map.size\"><span style=\"color: var(--shiki-token-function)\">.size</span></a><span style=\"color: var(--shiki-color-text)\">(); </span><span style=\"color: var(--shiki-token-comment)\">// 1</span></li><li value=\"4\"><span style=\"color: var(--shiki-token-constant)\">bidders</span><a href=\"/rsh/consensus/#rsh_Set.remove\" title=\"rsh: Set.remove\"><span style=\"color: var(--shiki-token-function)\">.remove</span></a><span style=\"color: var(--shiki-color-text)\">(Alice);</span></li><li value=\"5\"><span style=\"color: var(--shiki-token-constant)\">bidders</span><a href=\"/rsh/consensus/#rsh_Set.member\" title=\"rsh: Set.member\"><span style=\"color: var(--shiki-token-function)\">.member</span></a><span style=\"color: var(--shiki-color-text)\">(Alice); </span><span style=\"color: var(--shiki-token-comment)\">// false</span></li><li value=\"6\"><span style=\"color: var(--shiki-token-constant)\">bidders</span><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/rsh/consensus/#rsh_Set.Map\" title=\"rsh: Set.Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a><a href=\"/rsh/compute/#rsh_Map.size\" title=\"rsh: Map.size\"><span style=\"color: var(--shiki-token-function)\">.size</span></a><span style=\"color: var(--shiki-color-text)\">(); </span><span style=\"color: var(--shiki-token-comment)\">// 0</span></li></ol></pre>\n<p>\n  <i id=\"p_87\" class=\"pid\"></i>A <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_Set\" title=\"rsh: Set\"><span style=\"color: var(--shiki-token-constant)\">Set</span></a></span> is another container for linear state. It is simply a type alias of <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a><span style=\"color: var(--shiki-color-text)\">(Null)</span></span>;\n  it is only useful for tracking <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Address\" title=\"rsh: Address\"><span style=\"color: var(--shiki-color-text)\">Address</span></a></span>es. Because a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_Set\" title=\"rsh: Set\"><span style=\"color: var(--shiki-token-constant)\">Set</span></a></span> is internally a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a></span>, it may\n  only be constructed in a consensus step.<a href=\"#p_87\" class=\"pid\">87</a>\n</p>\n<p>\n  <i id=\"p_88\" class=\"pid\"></i>A <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_Set\" title=\"rsh: Set\"><span style=\"color: var(--shiki-token-constant)\">Set</span></a></span> may be modified by writing <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">s</span><span style=\"color: var(--shiki-token-function)\">.insert</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">ADDRESS</span><span style=\"color: var(--shiki-color-text)\">)</span></span> to install <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">ADDRESS</span></span> in the\n  set, <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">s</span></span>, or <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">s</span><span style=\"color: var(--shiki-token-function)\">.remove</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">ADDRESS</span><span style=\"color: var(--shiki-color-text)\">)</span></span> to remove the <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">ADDRESS</span></span> from the set.\n  Such modifications may only occur in a consensus step.<a href=\"#p_88\" class=\"pid\">88</a>\n</p>\n<p><i id=\"p_89\" class=\"pid\"></i>The following example shows the usage of <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">s</span><span style=\"color: var(--shiki-token-function)\">.insert</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">ADDRESS</span><span style=\"color: var(--shiki-color-text)\">)</span></span>:<a href=\"#p_89\" class=\"pid\">89</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/hs/t/y/merit-badge.rsh\">/hs/t/y/merit-badge.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    if ( okay ) {\n      holdersM.insert(requester);\n    }\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"46\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_if\" title=\"rsh: if\"><span style=\"color: var(--shiki-token-keyword)\">if</span></a><span style=\"color: var(--shiki-color-text)\"> ( okay ) {</span></li><li value=\"47\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-constant)\">holdersM</span><span style=\"color: var(--shiki-token-function)\">.insert</span><span style=\"color: var(--shiki-color-text)\">(requester);</span></li><li value=\"48\"><span style=\"color: var(--shiki-color-text)\">    }</span></li></ol></pre>\n<p><i id=\"p_90\" class=\"pid\"></i>While the example below shows the usage of <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">s</span><span style=\"color: var(--shiki-token-function)\">.remove</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">ADDRESS</span><span style=\"color: var(--shiki-color-text)\">)</span></span><a href=\"#p_90\" class=\"pid\">90</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/dominant-assurance/index.rsh\">/examples/dominant-assurance/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"      .timeout(failPayTimeout, () => {\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"143\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/step/#rsh_timeout\" title=\"rsh: timeout\"><span style=\"color: var(--shiki-token-function)\">.timeout</span></a><span style=\"color: var(--shiki-color-text)\">(failPayTimeout</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li></ol></pre>\n<p><i id=\"p_91\" class=\"pid\"></i>To check whether an address is in the set, <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">s</span><span style=\"color: var(--shiki-token-function)\">.member</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">ADDRESS</span><span style=\"color: var(--shiki-color-text)\">)</span></span> is used.<a href=\"#p_91\" class=\"pid\">91</a></p>\n<p><i id=\"p_92\" class=\"pid\"></i>The following example shows the usage of <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">s</span><span style=\"color: var(--shiki-token-function)\">.member</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">ADDRESS</span><span style=\"color: var(--shiki-color-text)\">)</span></span><a href=\"#p_92\" class=\"pid\">92</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/dominant-assurance/index.rsh\">/examples/dominant-assurance/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"        investors.insert(this);\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"99\"><span style=\"color: var(--shiki-color-text)\">        </span><span style=\"color: var(--shiki-token-constant)\">investors</span><span style=\"color: var(--shiki-token-function)\">.insert</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-color-text)\">);</span></li></ol></pre>\n<p>\n  <i id=\"p_93\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">s</span><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-color-text)\">.Map</span></a></span> will return the underlying <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a></span>, so you can use foldable\n  instance methods.<a href=\"#p_93\" class=\"pid\">93</a>\n</p>\n<h3 id=\"ref-programs-consensus-new-contract\" class=\"refHeader\">Contract creation<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ref-programs-consensus-new-contract\"><span class=\"icon icon-link\"></span></a></h3>\n<p>\n  <i id=\"p_94\" class=\"pid\"></i><span class=\"ref\" id=\"rsh_new%20Contract\" data-scope=\"rsh\" data-symbol=\"new Contract\"></span><span class=\"ref\" id=\"rsh_Contract.new\" data-scope=\"rsh\" data-symbol=\"Contract.new\"></span>Reach programs can create new child contracts based on predetermined, static code during compile time.\n  This code is specified with <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_ContractCode\" title=\"rsh: ContractCode\"><span style=\"color: var(--shiki-color-text)\">ContractCode</span></a></span>, which you can read about in <a href=\"/rsh/appinit/#ref-programs-appinit-contractcode\">Contract code definition</a>.<a href=\"#p_94\" class=\"pid\">94</a>\n</p>\n<p><i id=\"p_95\" class=\"pid\"></i>Given some child contract code, indicated by the variable <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">cc</span></span>, you can create a constructor function with:<a href=\"#p_95\" class=\"pid\">95</a></p>\n<pre class=\"snippet unnumbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const ctor = new Contract(cc, opts?)\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctor</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_new\" title=\"rsh: new\"><span style=\"color: var(--shiki-token-keyword)\">new</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Contract\" title=\"rsh: Contract\"><span style=\"color: var(--shiki-token-function)\">Contract</span></a><span style=\"color: var(--shiki-color-text)\">(cc</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> opts</span><a href=\"/rsh/compute/#rsh_?\" title=\"rsh: ?\"><span style=\"color: var(--shiki-token-keyword)\">?</span></a><span style=\"color: var(--shiki-color-text)\">)</span></li></ol></pre>\n<p>\n  <i id=\"p_96\" class=\"pid\"></i>where <code>opts</code> is an optional object.\n  Each enabled connector accepts its own options in a field with the name of the connector.<a href=\"#p_96\" class=\"pid\">96</a>\n</p>\n<p><i id=\"p_97\" class=\"pid\"></i>The <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_ETH\" title=\"rsh: ETH\"><span style=\"color: var(--shiki-token-constant)\">ETH</span></a></span> connector accepts no options.<a href=\"#p_97\" class=\"pid\">97</a></p>\n<p><i id=\"p_98\" class=\"pid\"></i>The <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_ALGO\" title=\"rsh: ALGO\"><span style=\"color: var(--shiki-token-constant)\">ALGO</span></a></span> connector accepts the keys:<a href=\"#p_98\" class=\"pid\">98</a></p>\n<ul>\n  <li><i id=\"p_99\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">opts</span><span style=\"color: var(--shiki-color-text)\">.globalUints</span></span> --- The number of unsigned integers in the global storage of the contract.<a href=\"#p_99\" class=\"pid\">99</a></li>\n  <li><i id=\"p_100\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">opts</span><span style=\"color: var(--shiki-color-text)\">.globalBytes</span></span> --- The number of byte strings in the global storage of the contract.<a href=\"#p_100\" class=\"pid\">100</a></li>\n  <li><i id=\"p_101\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">opts</span><span style=\"color: var(--shiki-color-text)\">.localUints</span></span> --- The number of unsigned integers in the local storage of the contract.<a href=\"#p_101\" class=\"pid\">101</a></li>\n  <li><i id=\"p_102\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">opts</span><span style=\"color: var(--shiki-color-text)\">.localBytes</span></span> --- The number of byte strings in the local storage of the contract.<a href=\"#p_102\" class=\"pid\">102</a></li>\n</ul>\n<p><i id=\"p_103\" class=\"pid\"></i>If these options are required, but not present, then the contract will behave incorrectly.<a href=\"#p_103\" class=\"pid\">103</a></p>\n<p>\n  <i id=\"p_104\" class=\"pid\"></i>The constructor function must be called to actually create the contract.\n  It is like a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_REMOTE_FUN\" title=\"rsh: REMOTE_FUN\"><span style=\"color: var(--shiki-token-constant)\">REMOTE_FUN</span></a><span style=\"color: var(--shiki-color-text)\">}</span></span>, but it cannot be augmented, nor can it receive payment.\n  It returns a <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Contract\" title=\"rsh: Contract\"><span style=\"color: var(--shiki-color-text)\">Contract</span></a></span> value for the newly created contract.<a href=\"#p_104\" class=\"pid\">104</a>\n</p>\n<div class=\"note\">\n  <p><i id=\"p_105\" class=\"pid\"></i>Why can't you augment constructor calls?<a href=\"#p_105\" class=\"pid\">105</a></p>\n  <p>\n    <i id=\"p_106\" class=\"pid\"></i>Some constructor augmentations, like those specific for a particular network, could work, but are not supported by Reach presently.\n    Others, such as token payments, cannot work at all, because given that the contract doesn't exist yet, there's no way to know where to send the tokens to.<a href=\"#p_106\" class=\"pid\">106</a>\n  </p>\n</div>\n<p>\n  <i id=\"p_107\" class=\"pid\"></i>On some connectors, like <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_ALGO\" title=\"rsh: ALGO\"><span style=\"color: var(--shiki-token-constant)\">ALGO</span></a></span>, it is necessary to delete child contracts before the parent exits.\n  Reach does not yet enforce this property during verification, so if you fail to obey it, then your program will not be able to finish.<a href=\"#p_107\" class=\"pid\">107</a>\n</p>","<ul><li class=\"dynamic\">\n    <a href=\"#ref-programs-consensus\">Consensus Steps</a>\n    <ul class=\"dynamic\">\n      <li class=\"dynamic\">\n        <a href=\"#ref-programs-consensus-stmts\">Statements</a>\n        <ul class=\"dynamic\">\n          <li class=\"dynamic\">\n            <a href=\"#commit\"><code>commit</code></a>\n          </li>\n          <li class=\"dynamic\">\n            <a href=\"#ref-programs-only-consensus\"><code>only</code> and <code>each</code></a>\n          </li>\n          <li class=\"dynamic\">\n            <a href=\"#ref-programs-consensus-view\">View Objects</a>\n          </li>\n          <li class=\"dynamic\">\n            <a href=\"#ref-programs-consensus-events\">Event Objects</a>\n          </li>\n          <li class=\"dynamic\">\n            <a href=\"#participantset--and--set\"><code>Participant.set</code> and <code>.set</code></a>\n          </li>\n          <li class=\"dynamic\">\n            <a href=\"#while\"><code>while</code></a>\n          </li>\n          <li class=\"dynamic\">\n            <a href=\"#continue\"><code>continue</code></a>\n          </li>\n          <li class=\"dynamic\">\n            <a href=\"#parallelreduce\"><code>parallelReduce</code></a>\n            <ul class=\"dynamic\">\n              <li class=\"dynamic\"><a href=\"#timeremaining\"><code>.timeRemaining</code></a></li>\n              <li class=\"dynamic\"><a href=\"#throwtimeout\"><code>.throwTimeout</code></a></li>\n              <li class=\"dynamic\"><a href=\"#parallelreduce--intuition\"><code>parallelReduce</code> intuition</a></li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n      <li class=\"dynamic\">\n        <a href=\"#ref-programs-consensus-exprs\">Expressions</a>\n        <ul class=\"dynamic\">\n          <li class=\"dynamic\"><a href=\"#ref-programs-consensus-this\"><code>this</code></a></li>\n          <li class=\"dynamic\"><a href=\"#transfer\"><code>transfer</code></a></li>\n          <li class=\"dynamic\"><a href=\"#require\"><code>require</code></a></li>\n          <li class=\"dynamic\"><a href=\"#checkcommitment\"><code>checkCommitment</code></a></li>\n          <li class=\"dynamic\"><a href=\"#ref-programs-consensus-token-minting\">Token minting</a></li>\n          <li class=\"dynamic\"><a href=\"#remote-objects\">Remote objects</a></li>\n          <li class=\"dynamic\"><a href=\"#mappings-creation-and-modification\">Mappings: creation and modification</a></li>\n          <li class=\"dynamic\"><a href=\"#sets-creation-and-modification\">Sets: creation and modification</a></li>\n          <li class=\"dynamic\"><a href=\"#ref-programs-consensus-new-contract\">Contract creation</a></li>\n        </ul>\n      </li>\n    </ul>\n  </li></ul>"]