<p>This tutorial shows you how to build <a href="https://github.com/hagenhaus/wisdom-for-sale">Wisdom for Sale</a>, a command-line and web-based application that enables two participants, a seller and a buyer, to trade wisdom for tokens via a smart contract running on a private Algorand, Ethereum, or Conflux consensus network residing in a Docker container on your computer. Your DApp creates and funds two accounts (one for each participant), enables the seller and buyer to make a transaction, and exits.</p>
<h1 id="learning-objectives">Learning Objectives</h1>
<p>The following learning objectives describe what you will be able to do as a result of completing this tutorial.</p>
<ol>
  <li>Define essential Reach terms.</li>
  <li>Build a simple Reach command-line DApp.</li>
  <li>Convert the command-line DApp into a vanilla Webapp.</li>
</ol>
<h1 id="examine-the-transaction">Examine the transaction</h1>
<p>The following diagram represents the wisdom-for-sale transaction:</p>
<div>
  <img src="/en/books/essentials/getting-started/wisdom-for-sale/seller-buyer.png" class="img-fluid my-4 d-block" width="800" height="314" loading="lazy">
</div>
<p>This particular transaction took place on an Algorand devnet. The Algorand cryptocurrency standard token unit is the <em>ALGO</em>. As indicated by the final balances in the diagram, the seller received 0.006 ALGO less than the agreed upon price, and the buyer paid 0.003 ALGO more. These expenses represent <em>gas</em>, the cost of doing business on a consensus network. The seller paid a little more gas than the buyer because the seller deployed the contract.</p>
<h1 id="clone-the-repository">Clone the repository</h1>
<p>This section shows you how to clone the tutorial repository.</p>
<ol>
  <li>
    <p>Clone the <a href="https://github.com/hagenhaus/wisdom-for-sale">wisdom-for-sale</a> repository:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ cd ~/reach</li><li value="2">$ git clone https://github.com/hagenhaus/wisdom-for-sale.git</li></ol></pre>
  </li>
  <li>
    <p>Open the repository in vscode, and change directory to <em>current</em>.</p>
    <p>
      <img src="/en/books/essentials/getting-started/wisdom-for-sale/vscode-initial.png" class="img-fluid" width="700" loading="lazy">
    </p>
  </li>
  <li>
    <p>Copy <em>index.mjs</em> and <em>index.rsh</em> from the <em>starter</em> folder to the <em>current</em> folder, and open both new files.</p>
    <p>
      <img src="/en/books/essentials/getting-started/wisdom-for-sale/vscode-open.png" class="img-fluid" width="700" loading="lazy">
    </p>
  </li>
</ol>
<h2 id="review-frontend-starter">Review frontend starter</h2>
<p>The frontend source file is <a href="https://github.com/hagenhaus/wisdom-for-sale/blob/master/starter/index.mjs">index.mjs</a>:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">import</span><span style="color: #24292E"> { loadStdlib } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'@reach-sh/stdlib'</span><span style="color: #24292E">;</span></li><li value="2"><span style="color: #D73A49">import</span><span style="color: #24292E"> </span><span style="color: #005CC5">*</span><span style="color: #24292E"> </span><span style="color: #D73A49">as</span><span style="color: #24292E"> backend </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'./build/index.main.mjs'</span><span style="color: #24292E">;</span></li><li value="3"></li><li value="4"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">role</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">'seller'</span><span style="color: #24292E">;</span></li><li value="5"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Your role is ${</span><span style="color: #24292E">role</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="6"></li><li value="7"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">stdlib</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">loadStdlib</span><span style="color: #24292E">(process.env);</span></li><li value="8"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`The consensus network is ${</span><span style="color: #24292E">stdlib</span><span style="color: #032F62">.</span><span style="color: #24292E">connector</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="9"></li><li value="10"><span style="color: #24292E">(</span><span style="color: #D73A49">async</span><span style="color: #24292E"> () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="11"></li><li value="12"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">commonInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {};</span></li><li value="13"></li><li value="14"><span style="color: #24292E">  </span><span style="color: #6A737D">// SELLER</span></li><li value="15"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (role </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">'seller'</span><span style="color: #24292E">) {</span></li><li value="16"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> { </span><span style="color: #D73A49">...</span><span style="color: #24292E">commonInteract };</span></li><li value="17"></li><li value="18"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">acc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(stdlib.</span><span style="color: #6F42C1">parseCurrency</span><span style="color: #24292E">(</span><span style="color: #005CC5">1000</span><span style="color: #24292E">));</span></li><li value="19"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> acc.</span><span style="color: #6F42C1">contract</span><span style="color: #24292E">(backend);</span></li><li value="20"><span style="color: #24292E">    </span><span style="color: #D73A49">await</span><span style="color: #24292E"> backend.</span><span style="color: #6F42C1">Seller</span><span style="color: #24292E">(ctc, sellerInteract);</span></li><li value="21"><span style="color: #24292E">  }</span></li><li value="22"></li><li value="23"><span style="color: #24292E">  </span><span style="color: #6A737D">// BUYER</span></li><li value="24"><span style="color: #24292E">  </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></li><li value="25"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">buyerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> { </span><span style="color: #D73A49">...</span><span style="color: #24292E">commonInteract };</span></li><li value="26"><span style="color: #24292E">  }</span></li><li value="27"></li><li value="28"><span style="color: #24292E">})();</span></li></ol></pre>
<p>Below is a line-by-line description of this JavaScript code:</p>
<ul>
  <li>Line 1: Import the Reach JS Standard Library loader.</li>
  <li>Line 2: Import the JS backend compiled from index.rsh.</li>
  <li>Line 4: Hard-code the role. You will change this later.</li>
  <li>Line 5: Display the role.</li>
  <li>Line 7: Load the Reach JS Stdlib for the consensus network specified by <code>REACH_CONNECTOR_MODE</code> env var.</li>
  <li>Line 8: Display the consensus network type.</li>
  <li>Line 10: Enable enclosed code to await the fulfillment of promises.</li>
  <li>Line 12: Define empty (for now) object.</li>
  <li>Line 15: Code for when you run this app as the seller.</li>
  <li>Line 16: Define empty (for now) object.</li>
  <li>Line 18: Create an account for the seller. <em>parseCurrency</em> transforms units from standard to atomic.</li>
  <li>Line 19: Get a reference to the contract.</li>
  <li>Line 20: Initiate interaction with contract for seller.</li>
  <li>Line 24: Code for when you run this app as the buyer.</li>
  <li>Line 25: Define empty (for now) object.</li>
</ul>
<h2 id="review-backend-starter">Review backend starter</h2>
<p>The backend source file is <a href="https://github.com/hagenhaus/wisdom-for-sale/blob/master/starter/index.rsh">index.rsh</a>.</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #032F62">'reach 0.1'</span><span style="color: #24292E">;</span></li><li value="2"></li><li value="3"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">commonInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {};</span></li><li value="4"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> { </span><span style="color: #D73A49">...</span><span style="color: #24292E">commonInteract };</span></li><li value="5"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">buyerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> { </span><span style="color: #D73A49">...</span><span style="color: #24292E">commonInteract };</span></li><li value="6"></li><li value="7"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">main</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Reach.</span><span style="color: #6F42C1">App</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="8"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Seller'</span><span style="color: #24292E">, sellerInteract);</span></li><li value="9"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">B</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Buyer'</span><span style="color: #24292E">, buyerInteract);</span></li><li value="10"><span style="color: #24292E">  </span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">();</span></li><li value="11"></li><li value="12"><span style="color: #24292E">  </span><span style="color: #6F42C1">exit</span><span style="color: #24292E">();</span></li><li value="13"><span style="color: #24292E">});</span></li></ol></pre>
<p>Below is a line-by-line description of this Reach code:</p>
<ul>
  <li>Line 1: Instruction to the compiler.</li>
  <li>Lines 3-5: Define empty (for now) objects.</li>
  <li>Line 7: Reach standard application initialization.</li>
  <li>Line 8: Define a constant to represent the seller.</li>
  <li>Line 9: Define a constant to represent the buyer.</li>
  <li>Line 10: Finalize participant and other options, and proceed to a Reach step.</li>
  <li>Line 12: Terminate computation.</li>
</ul>
<h1 id="run-the-dapp">Run the DApp</h1>
<p>This section shows you how to run your DApp. Reach can compile your DApp to run on any of the following consensus network types:</p>
<ul>
  <li><code>ALGO-devnet</code></li>
  <li><code>CFX-devnet</code></li>
  <li><code>ETH-devnet</code></li>
</ul>
<p>You tell the Reach compiler which type by setting the <code>REACH_CONNECTOR_MODE</code> environment variable. One way is to set the variable and execute <code>reach run</code> on the same line:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ REACH_CONNECTOR_MODE=ALGO-devnet reach run</li></ol></pre>
<p>Another is to export the variable and then execute <code>reach run</code>:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ export REACH_CONNECTOR_MODE=ALGO-devnet</li><li value="2">$ reach run</li></ol></pre>
<p>Follow these steps to run the DApp:</p>
<ol>
  <li>
    <p>In the vscode terminal, set <code>REACH_CONNECTOR_MODE=ALGO-devnet</code> and run the app on the same line:</p>
    <p>
      <img src="/en/books/essentials/getting-started/wisdom-for-sale/vscode-run.png" class="img-fluid" width="700" loading="lazy">
    </p>
  </li>
  <li>
    <p>This time, first <code>export REACH_CONNECTOR_MODE=ALGO-devnet</code>, and then run the app:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ export REACH_CONNECTOR_MODE=ALGO-devnet</li><li value="2">$ reach run</li></ol></pre>
  </li>
  <li>
    <p>Repeat the first two steps for <code>CFX</code> and <code>ETH</code>.</p>
  </li>
</ol>
<blockquote>
  <p>For consistency, output in this tutorial reflects <code>REACH_CONNECTOR_MODE=ALGO-devnet</code>.</p>
</blockquote>
<p>Where does your DApp run? In your current environment, the Reach Compiler, the consensus network devnets, your application, and the smart contract run on your computer in Docker containers instantiated from Reach Docker images.</p><button class="btn btn-success btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#ebp" aria-expanded="false"><i class="fas fa-info-circle me-2"></i><span>Explore Build Output</span></button><span class="collapse" id="ebp"><p>Here is sample output:</p><pre class="snippet numbered"><ol class="snippet"><li value="1">current % REACH_CONNECTOR_MODE=ALGO-devnet reach run</li><li value="2">Verifying knowledge assertions</li><li value="3">Verifying for generic connector</li><li value="4">  Verifying when ALL participants are honest</li><li value="5">  Verifying when NO participants are honest</li><li value="6">  Verifying when ONLY "Buyer" is honest</li><li value="7">  Verifying when ONLY "Seller" is honest</li><li value="8">Checked 4 theorems; No failures!</li><li value="9">[+] Building 0.2s (7/7) FINISHED</li><li value="10"> =&gt; [internal] load build definition from Dockerfile                                         0.0s</li><li value="11"> =&gt; =&gt; transferring dockerfile: 234B                                                         0.0s</li><li value="12"> =&gt; [internal] load .dockerignore                                                            0.0s</li><li value="13"> =&gt; =&gt; transferring context: 75B                                                             0.0s</li><li value="14"> =&gt; [internal] load metadata for docker.io/reachsh/runner:0.1.5                              0.0s</li><li value="15"> =&gt; [internal] load build context                                                            0.0s</li><li value="16"> =&gt; =&gt; transferring context: 4.60kB                                                          0.0s</li><li value="17"> =&gt; CACHED [1/2] FROM docker.io/reachsh/runner:0.1.5                                         0.0s</li><li value="18"> =&gt; [2/2] COPY . /app                                                                        0.0s</li><li value="19"> =&gt; exporting to image                                                                       0.0s</li><li value="20"> =&gt; =&gt; exporting layers                                                                      0.0s</li><li value="21"> =&gt; =&gt; writing image sha256:13e69eb72504bbc85074476e5d1183b6ad2734a5eabc9e56c2138023d64a507a 0.0s</li><li value="22"> =&gt; =&gt; naming to docker.io/reachsh/reach-app-current:latest                                  0.0s</li><li value="23"></li><li value="24">Use 'docker scan' to run Snyk tests against images to find vulnerabilities and learn how to fix them</li><li value="25">Creating reach2021-10-13t14-26-55z-vcv1_reach-app-current_run ... done</li><li value="26"></li><li value="27">&gt; @reach-sh/current@ index /app</li><li value="28">&gt; node --experimental-modules --unhandled-rejections=strict index.mjs</li><li value="29"></li><li value="30">The consensus network is ALGO.</li><li value="31">Your role is seller.</li></ol></pre><p>Below is a line-by-line description:</p><ul>
    <li>
      <p>Line 1: The Reach Compiler inputs <em>reach.rsh</em>.</p>
      <p>
        <img src="/en/books/essentials/getting-started/wisdom-for-sale/reach-run-2.png" class="img-fluid" width="420" loading="lazy">
      </p>
      <p>And, it outputs <em>index.main.mjs</em> consisting of the compiled backend (blue) and the smart contract (dark orange):</p>
      <p>
        <img src="/en/books/essentials/getting-started/wisdom-for-sale/reach-run-3.png" class="img-fluid" width="420" loading="lazy">
      </p>
    </li>
    <li>
      <p>Line 2: The Reach Verification Engine validates the smart contract:</p>
      <p>
        <img src="/en/books/essentials/getting-started/wisdom-for-sale/reach-run-4.png" class="img-fluid" width="420" loading="lazy">
      </p>
    </li>
    <li>
      <p>Lines 10-22: The process builds a Docker image for your application.</p>
      <p>
        <img src="/en/books/essentials/getting-started/wisdom-for-sale/reach-run-5.png" class="img-fluid" width="420" loading="lazy">
      </p>
      <p>Note the mention of <em>Dockerfile</em> and <em>.dockerignore</em>. The <code>reach run</code> command creates the following set of files, deleting all but <em>index.main.mjs</em> on completion:</p>
      <pre class="snippet unnumbered"><ol class="snippet"><li value="1">build/index.main.mjs</li><li value="2">.dockerignore</li><li value="3">.gitignore</li><li value="4">Dockerfile</li><li value="5">package.json</li></ol></pre>
      <p>For some of your Reach projects, you may find it useful to retain and edit these files, especially <em>package.json</em>. To create and retain these files, run <code>reach scaffold</code> before running <code>reach run</code>.</p>
    </li>
    <li>
      <p>Line 24: The process checks the new image for vulnerabilities.</p>
      <p>
        <img src="/en/books/essentials/getting-started/wisdom-for-sale/reach-run-6.png" class="img-fluid" width="420" loading="lazy">
      </p>
    </li>
    <li>
      <p>Line 27: The process runs your app in a container built from the image.</p>
      <p>
        <img src="/en/books/essentials/getting-started/wisdom-for-sale/reach-run-7.png" class="img-fluid" width="420" loading="lazy">
      </p>
    </li>
    <li>
      <p>Line 30-31: Your application outputs these messages.</p>
    </li>
  </ul><hr style="background-color:#198754;opacity:1;height:6px;"></span>
<h1 id="pass-an-argument">Pass an argument</h1>
<p>This section shows you how to tell your DApp whether to run as the seller or the buyer. You do this by passing <em>role</em> as a command-line argument (e.g. <code>reach run index seller</code>). You cannot do this by passing <em>role</em> as a custom environment variable (e.g. <code>ROLE=seller reach run</code>) because the <a href="https://github.com/reach-sh/reach-lang/blob/master/reach">reach</a> script exports only a pre-determined list of environment variables (including <code>REACH_CONNECTOR_MODE</code>) within the Docker container where it runs your DApp. Follow these directions to pass <em>role</em> as a command-line argument:</p>
<ol>
  <li>
    <p>In <em>index.mjs</em>, find the following line:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">role</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">'seller'</span><span style="color: #24292E">;</span></li></ol></pre>
  </li>
  <li>
    <p>Replace it with the following, and save the file:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">if</span><span style="color: #24292E"> (process.argv.</span><span style="color: #005CC5">length</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E"> </span><span style="color: #D73A49">||</span><span style="color: #24292E"> [</span><span style="color: #032F62">'seller'</span><span style="color: #24292E">, </span><span style="color: #032F62">'buyer'</span><span style="color: #24292E">].</span><span style="color: #6F42C1">includes</span><span style="color: #24292E">(process.argv[</span><span style="color: #005CC5">2</span><span style="color: #24292E">]) </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">) {</span></li><li value="2"><span style="color: #24292E">  console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">'Usage: reach run index [seller|buyer]'</span><span style="color: #24292E">);</span></li><li value="3"><span style="color: #24292E">  process.</span><span style="color: #6F42C1">exit</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></li><li value="4"><span style="color: #24292E">}</span></li><li value="5"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">role</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> process.argv[</span><span style="color: #005CC5">2</span><span style="color: #24292E">];</span></li></ol></pre>
  </li>
  <li>
    <p>Open two terminals (i.e. shells):</p>
    <p>
      <img src="/en/books/essentials/getting-started/wisdom-for-sale/terminals-empty.png" class="img-fluid" width="700" loading="lazy">
    </p>
  </li>
  <li>
    <p>Change directory in both terminals:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ ~/reach/wisdom-for-sale/current</li></ol></pre>
  </li>
  <li>
    <p>Run the following command in both terminals:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ export REACH_CONNECTOR_MODE=ALGO-devnet</li></ol></pre>
  </li>
  <li>
    <p>In the Seller Terminal, run your DApp as the seller:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ reach run index seller</li></ol></pre>
    <p>When you pass arguments to <code>reach run</code>, the first one must be the name of the <code>index.rsh</code> file without the extension (i.e. <code>index</code>) as seen above.</p>
    <p>Application output should resemble the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">The consensus network is ALGO.</li><li value="2">Your role is seller.</li></ol></pre>
  </li>
  <li>
    <p>In the Buyer Terminal, run your DApp as the buyer:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ reach run index buyer</li></ol></pre>
    <p>Output should resemble the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">The consensus network is ALGO.</li><li value="2">Your role is buyer.</li></ol></pre>
  </li>
</ol>
<h1 id="add-a-nodejs-package">Add a Node.js package</h1>
<p>This section shows you how to leverage the <a href="https://www.npmjs.com/package/yargs">yargs</a> Node.js package to manage command-line arguments as an alternative to using the simple technique described above.</p>
<p>This section is <strong>optional</strong>. If you do <strong>not</strong> want to add a Node.js package to your DApp at this time, you can skip to the next section, continuing to use the following commands throughout the remainder of this tutorial:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ reach run index seller</li><li value="2">$ reach run index buyer</li></ol></pre>
<p>If you <strong>do</strong> complete this section, you will need to use the following commands instead:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ reach run index -r seller</li><li value="2">$ reach run index -r buyer</li></ol></pre>
<p>Adding a Node.js package to your Reach DApp is easy:</p>
<ol>
  <li>
    <p>In any terminal, change directory:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ cd ~/reach/wisdom-for-sale/current</li></ol></pre>
  </li>
  <li>
    <p>Create non-temporary Reach scaffolding files:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ reach scaffold</li></ol></pre>
  </li>
  <li>
    <p>Install the Node.js package:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ npm i yargs</li></ol></pre>
  </li>
  <li>
    <p>Open <em>Dockerfile</em>, and uncomment</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">COPY package.json /app/package.json</li><li value="2">RUN npm install</li><li value="3">RUN npm link @reach-sh/stdlib</li></ol></pre>
    <p><code>COPY</code> and <code>RUN</code> are commands understood by Docker.</p>
  </li>
  <li>
    <p>Open <em>index.mjs</em>, and add the following import near the top of the file:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">import yargs from 'yargs';</li></ol></pre>
  </li>
  <li>
    <p>In <em>index.mjs</em>, find the following code:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">if</span><span style="color: #24292E"> (process.argv.</span><span style="color: #005CC5">length</span><span style="color: #24292E"> </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E"> </span><span style="color: #D73A49">||</span><span style="color: #24292E"> [</span><span style="color: #032F62">'seller'</span><span style="color: #24292E">, </span><span style="color: #032F62">'buyer'</span><span style="color: #24292E">].</span><span style="color: #6F42C1">includes</span><span style="color: #24292E">(process.argv[</span><span style="color: #005CC5">2</span><span style="color: #24292E">]) </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">) {</span></li><li value="2"><span style="color: #24292E">  console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">'Usage: reach run index [seller|buyer]'</span><span style="color: #24292E">);</span></li><li value="3"><span style="color: #24292E">  process.</span><span style="color: #6F42C1">exit</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></li><li value="4"><span style="color: #24292E">}</span></li><li value="5"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">role</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> process.argv[</span><span style="color: #005CC5">2</span><span style="color: #24292E">];</span></li></ol></pre>
  </li>
  <li>
    <p>Replace it with the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">argv</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">yargs</span><span style="color: #24292E">(process.argv.</span><span style="color: #6F42C1">slice</span><span style="color: #24292E">(</span><span style="color: #005CC5">2</span><span style="color: #24292E">))</span></li><li value="2"><span style="color: #24292E">  .</span><span style="color: #6F42C1">option</span><span style="color: #24292E">(</span><span style="color: #032F62">'help'</span><span style="color: #24292E">, {</span></li><li value="3"><span style="color: #24292E">    alias: </span><span style="color: #032F62">'h'</span><span style="color: #24292E">,</span></li><li value="4"><span style="color: #24292E">    describe: </span><span style="color: #032F62">'Show help.'</span><span style="color: #24292E">,</span></li><li value="5"><span style="color: #24292E">    type: </span><span style="color: #032F62">'boolean'</span></li><li value="6"><span style="color: #24292E">  })</span></li><li value="7"><span style="color: #24292E">  .</span><span style="color: #6F42C1">option</span><span style="color: #24292E">(</span><span style="color: #032F62">'role'</span><span style="color: #24292E">, {</span></li><li value="8"><span style="color: #24292E">    alias: </span><span style="color: #032F62">'r'</span><span style="color: #24292E">,</span></li><li value="9"><span style="color: #24292E">    describe: </span><span style="color: #032F62">'Specify role.'</span><span style="color: #24292E">,</span></li><li value="10"><span style="color: #24292E">    type: </span><span style="color: #032F62">'string'</span><span style="color: #24292E">,</span></li><li value="11"><span style="color: #24292E">    choices: [</span><span style="color: #032F62">'seller'</span><span style="color: #24292E">, </span><span style="color: #032F62">'buyer'</span><span style="color: #24292E">],</span></li><li value="12"><span style="color: #24292E">    default: </span><span style="color: #032F62">'seller'</span></li><li value="13"><span style="color: #24292E">  })</span></li><li value="14"><span style="color: #24292E">  .argv</span></li><li value="15"></li><li value="16"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">role</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> argv.r;</span></li></ol></pre>
  </li>
  <li>
    <p>Tell your DApp to display help information:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ reach run index -h</li></ol></pre>
    <p>Output should resemble the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Options:</li><li value="2">  -h, --help     Show help.          [boolean]</li><li value="3">      --version  Show version number [boolean]</li><li value="4">  -r, --role     Specify role.       [string] [choices: "seller", "buyer"] [default: "seller"]</li></ol></pre>
  </li>
  <li>
    <p>In the Seller Terminal, run your DApp as the seller:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ reach run index -r seller</li></ol></pre>
    <p>Output should resemble the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">The consensus network is ALGO.</li><li value="2">Your role is seller.</li></ol></pre>
  </li>
  <li>
    <p>In the Buyer Terminal, run your DApp as the buyer:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ reach run index -r buyer</li></ol></pre>
    <p>Output should resemble the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">The consensus network is ALGO.</li><li value="2">Your role is buyer.</li></ol></pre>
  </li>
</ol>
<p>For the remainder of the tutorial, remember to use the <code>-r</code> flag.</p>
<h1 id="explore-units-and-balances">Explore units and balances</h1>
<p>This section helps you explore standard and atomic units using the <a href="/en/books/essentials/support-for-js-frontends/">JavaScript Standard Library</a>. Regarding tokens, each consensus network has a (divisible) standard unit and an (indivisible) atomic unit. Users usually want to see standard units. A smart contract, on the other hand, <em>always</em> deals with atomic units. So, your DApp needs to convert between the two frequently. <code>parseCurrency</code> converts from standard to atomic. <code>formatCurrency</code> converts from atomic to standard.</p>
<ol>
  <li>
    <p>In <em>index.mjs</em>, find the following line:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`The consensus network is ${</span><span style="color: #24292E">stdlib</span><span style="color: #032F62">.</span><span style="color: #24292E">connector</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li></ol></pre>
  </li>
  <li>
    <p>Add the following below it, and run your DApp as the seller to view the standard and atomic units for your network:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`The standard unit is ${</span><span style="color: #24292E">stdlib</span><span style="color: #032F62">.</span><span style="color: #24292E">standardUnit</span><span style="color: #032F62">}`</span><span style="color: #24292E">);</span></li><li value="2"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`The atomic unit is ${</span><span style="color: #24292E">stdlib</span><span style="color: #032F62">.</span><span style="color: #24292E">atomicUnit</span><span style="color: #032F62">}`</span><span style="color: #24292E">);</span></li></ol></pre>
    <p>Output should resemble the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">The consensus network is ALGO.</li><li value="2">The standard unit is ALGO</li><li value="3">The atomic unit is μALGO</li></ol></pre>
  </li>
  <li>
    <p>Replace your two <code>console.log</code> additions with the following, and run again:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">suStr</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> stdlib.standardUnit;</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">auStr</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> stdlib.atomicUnit;</span></li><li value="3"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`The standard unit is ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">}`</span><span style="color: #24292E">);</span></li><li value="4"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`The atomic unit is ${</span><span style="color: #24292E">auStr</span><span style="color: #032F62">}`</span><span style="color: #24292E">);</span></li></ol></pre>
    <p>Output should be the same.</p>
  </li>
  <li>
    <p>Replace your additions with the following, and run again:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">suStr</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> stdlib.standardUnit;</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">auStr</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> stdlib.atomicUnit;</span></li><li value="3"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">su</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">parseCurrency</span><span style="color: #24292E">(su);</span></li><li value="4"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toSU</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">au</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">formatCurrency</span><span style="color: #24292E">(au, </span><span style="color: #005CC5">4</span><span style="color: #24292E">);</span></li><li value="5"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">suBal</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">1000</span><span style="color: #24292E">;</span></li><li value="6"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Balance is ${</span><span style="color: #24292E">suBal</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">}`</span><span style="color: #24292E">);</span></li><li value="7"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">auBal</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(suBal);</span></li><li value="8"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Balance is ${</span><span style="color: #24292E">auBal</span><span style="color: #032F62">} ${</span><span style="color: #24292E">auStr</span><span style="color: #032F62">}`</span><span style="color: #24292E">);</span></li><li value="9"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Balance is ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">auBal</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">}`</span><span style="color: #24292E">);</span></li></ol></pre>
    <p>Output should resemble the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">The consensus network is ALGO.</li><li value="2">Balance is 1000 ALGO</li><li value="3">Balance is 1000000000 μALGO</li><li value="4">Balance is 1000 ALGO</li></ol></pre>
  </li>
  <li>
    <p>Replace your additions with the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">suStr</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> stdlib.standardUnit;</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">su</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">parseCurrency</span><span style="color: #24292E">(su);</span></li><li value="3"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toSU</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">au</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">formatCurrency</span><span style="color: #24292E">(au, </span><span style="color: #005CC5">4</span><span style="color: #24292E">);</span></li><li value="4"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">iBalance</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">1000</span><span style="color: #24292E">);</span></li><li value="5"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">async</span><span style="color: #24292E"> (</span><span style="color: #E36209">acc</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Your balance is ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #D73A49">await</span><span style="color: #032F62"> </span><span style="color: #24292E">stdlib</span><span style="color: #032F62">.</span><span style="color: #6F42C1">balanceOf</span><span style="color: #032F62">(</span><span style="color: #24292E">acc</span><span style="color: #032F62">))</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li></ol></pre>
    <p>You use <code>iBalance</code> and <code>showBalance</code> in the next steps.</p>
  </li>
  <li>
    <p>In <em>index.mjs</em>, find and replace Line 1 (below) with Line 2 to utilize <code>iBalance</code>:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">acc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(stdlib.</span><span style="color: #6F42C1">parseCurrency</span><span style="color: #24292E">(</span><span style="color: #005CC5">1000</span><span style="color: #24292E">));</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">acc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(iBalance);</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.mjs</em>, insert <code>showBalance</code> in two places (Lines 2 and 5) to show the account balance before and after contract deployment:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">acc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(iBalance);</span></li><li value="2"><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E">(acc);</span></li><li value="3"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> acc.</span><span style="color: #6F42C1">contract</span><span style="color: #24292E">(backend);</span></li><li value="4"><span style="color: #D73A49">await</span><span style="color: #24292E"> backend.</span><span style="color: #6F42C1">Seller</span><span style="color: #24292E">(ctc, sellerInteract);</span></li><li value="5"><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E">(acc);</span></li></ol></pre>
  </li>
  <li>
    <p>Run your DApp again. Output should resemble the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is seller.</li><li value="2">The consensus network is ALGO.</li><li value="3">Your balance is 1000 ALGO.</li><li value="4">Your balance is 1000 ALGO.</li></ol></pre>
    <p>The second balance is now poised to reflect the results of the transactions you will implement below.</p>
  </li>
</ol>
<h1 id="deploy-the-contract-seller">Deploy the contract (seller)</h1>
<p>This section shows you how to have the seller (1) deploy the contract and (2) return the contract information to be used later by the buyer to attach to the contract. The format of contract information varies depending on the consensus network. Here are examples:</p>
<table>
  <thead>
    <tr>
      <th>Conensus Network</th>
      <th>Contract Information Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Algorand</td>
      <td><code>49</code></td>
    </tr>
    <tr>
      <td>Conflux</td>
      <td><code>"NET999:TYPE.CONTRACT:ACDWGDGH6DKDAJ528Y5CCWMX8NBVPHXU72S3FPF8CY"</code></td>
    </tr>
    <tr>
      <td>Ethereum</td>
      <td><code>"0x403372276F841d7451E6417Cc7B17fDD159FE34C"</code></td>
    </tr>
  </tbody>
</table>
<p>In this tutorial, the seller outputs the contract information to the Seller Terminal, and the buyer copies &amp; pastes the contract information from the Seller Terminal to the Buyer Terminal (including the quotation marks if persent). In real life, the seller would need to search for a contract name and its associated contract information in some repository.</p><button class="btn btn-success btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#fsci" aria-expanded="false"><i class="fas fa-info-circle me-2"></i><span>Storing and Finding Contract Information</span></button><span class="collapse" id="fsci"><p>Not done yet.</p><hr style="background-color:#198754;opacity:1;height:6px;"></span>
<p>Follow these directions to have the seller deploy the contract and return the contract information:</p>
<ol>
  <li>
    <p>In <em>index.mjs</em>, find the following line:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> { </span><span style="color: #D73A49">...</span><span style="color: #24292E">commonInteract };</span></li></ol></pre>
  </li>
  <li>
    <p>Replace it with the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> { </span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span><span style="color: #24292E">commonInteract,</span></li><li value="3"><span style="color: #24292E">  price: </span><span style="color: #6F42C1">toAU</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">),</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #6F42C1">reportReady</span><span style="color: #24292E">: </span><span style="color: #D73A49">async</span><span style="color: #24292E"> (</span><span style="color: #E36209">price</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="5"><span style="color: #24292E">    console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Your wisdom is for sale at ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">price</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="6"><span style="color: #24292E">    console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Contract info: ${</span><span style="color: #005CC5">JSON</span><span style="color: #032F62">.</span><span style="color: #005CC5">stringify</span><span style="color: #032F62">(</span><span style="color: #D73A49">await</span><span style="color: #032F62"> </span><span style="color: #24292E">ctc</span><span style="color: #032F62">.</span><span style="color: #6F42C1">getInfo</span><span style="color: #032F62">())</span><span style="color: #032F62">}`</span><span style="color: #24292E">);</span></li><li value="7"><span style="color: #24292E">  }</span></li><li value="8"><span style="color: #24292E">};</span></li></ol></pre>
    <p>You will add a <code>wisdom</code> property to the <code>sellerInteract</code> later in the tutorial.</p>
  </li>
  <li>
    <p>In <em>index.rsh</em>, find the following line:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> { </span><span style="color: #D73A49">...</span><span style="color: #24292E">commonInteract };</span></li></ol></pre>
  </li>
  <li>
    <p>Replace it with the following Reach code:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span><span style="color: #24292E">commonInteract,</span></li><li value="3"><span style="color: #24292E">  price: UInt,</span></li><li value="4"><span style="color: #24292E">  reportReady: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([UInt], Null),</span></li><li value="5"><span style="color: #24292E">};</span></li></ol></pre>
    <ul>
      <li>Line 1: <code>sellerInteract</code> is a user-defined Reach object.</li>
      <li>Line 2: The spread syntax <code>...</code> adds all <code>commonInteract</code> properties (none yet) to the object.</li>
      <li>Line 3: <code>price </code>is a <code>UInt</code>, a Reach-defined unsigned integer.</li>
      <li>Line 4: <code>reportReady</code> is a function that takes a <code>UInt</code> as an argument and returns nothing.</li>
    </ul>
  </li>
  <li>
    <p>In <em>index.rsh</em>, add Lines 3-6 between <code>deploy</code> and <code>exit</code>:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #6F42C1">deploy</span><span style="color: #24292E">();</span></li><li value="2"></li><li value="3"><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">price</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.price); });</span></li><li value="4"><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">(price);</span></li><li value="5"><span style="color: #005CC5">S</span><span style="color: #24292E">.interact.</span><span style="color: #6F42C1">reportReady</span><span style="color: #24292E">(price);</span></li><li value="6"><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="7"></li><li value="8"><span style="color: #6F42C1">exit</span><span style="color: #24292E">();</span></li></ol></pre>
    <ul>
      <li>Line 1: <code>deploy</code> initializes the DApp, and transitions to a step.</li>
      <li>Line 3: <code>S.only()</code> transitions to a local step in which seller gets <code>price</code>.</li>
      <li>Line 4: <code>S.publish()</code> transitions to a consensus step.</li>
      <li>Line 5: <code>S.interact</code> transitions to a local step in which seller passes <code>price</code> to frontend.</li>
      <li>Line 6: <code>commit()</code> transitions to a step.</li>
      <li>Line 8: <code>exit()</code> halts the contract forever.</li>
    </ul>
    <p>The next section explains these functions in more detail. For now, know that Reach programs (the <em>index.rsh</em> portion of your Reach DApp) are organized into four modes, and that <code>deploy</code>, <code>only</code>, <code>publish</code>, <code>commit</code>, and <code>exit</code> cause mode transitions.</p>
  </li>
  <li>
    <p>Run your DApp as the seller. Output should resemble the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is seller.</li><li value="2">The consensus network is ALGO.</li><li value="3">Your balance is 1000 ALGO.</li><li value="4">Your wisdom is for sale at 5 ALGO.</li><li value="5">Contract info: 3</li><li value="6">Your balance is 999.996 ALGO.</li></ol></pre>
    <p>The seller creates the contract, retrieves the contract information, and makes it available to the buyer who will (shortly) use the information to attach to the contract. Note that simply deploying the contract cost the seller gas.</p>
  </li>
</ol>
<p>The interact objects introduced in this section facilitate communication between the frontend (e.g. <code>index.mjs</code>) and backend (e.g. <code>index.main.mjs</code>) of Reach applications, (remembering that <code>index.rsh</code> is the pre-compiled version of <code>index.main.mjs</code>). The <a href="/en/books/essentials/tutorials/market-day/">Market Day</a> tutorial explores interact objects in more detail.</p>
<h1 id="attach-to-the-contract-buyer">Attach to the contract (buyer)</h1>
<p>This section shows you how to have the buyer attach to the contact. It also introduces <em>@reach-sh/stdlib/ask.mjs</em>, a minimal Reach Node.js package for command-line input.</p>
<ol>
  <li>
    <p>In <em>index.mjs</em>, add the following near the top of the file:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">import</span><span style="color: #24292E"> { ask, yesno, done } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'@reach-sh/stdlib/ask.mjs'</span><span style="color: #24292E">;</span></li></ol></pre>
  </li>
  <li>
    <p>And, add <code>done();</code> just before <code>})();</code> at the bottom of the file.</p>
  </li>
  <li>
    <p>In <em>index.mjs</em>, find the following line:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">buyerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> { </span><span style="color: #D73A49">...</span><span style="color: #24292E">commonInteract };</span></li></ol></pre>
  </li>
  <li>
    <p>Replace it with the following:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">buyerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span><span style="color: #24292E">commonInteract,</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #6F42C1">confirmPurchase</span><span style="color: #24292E">: </span><span style="color: #D73A49">async</span><span style="color: #24292E"> (</span><span style="color: #E36209">price</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(</span><span style="color: #032F62">`Do you want to purchase wisdom for ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">price</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">}?`</span><span style="color: #24292E">, yesno)</span></li><li value="4"><span style="color: #24292E">};</span></li><li value="5"></li><li value="6"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">acc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(iBalance);</span></li><li value="7"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">info</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(</span><span style="color: #032F62">'Paste contract info:'</span><span style="color: #24292E">, (</span><span style="color: #E36209">s</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">JSON</span><span style="color: #24292E">.</span><span style="color: #005CC5">parse</span><span style="color: #24292E">(s));</span></li><li value="8"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> acc.</span><span style="color: #6F42C1">contract</span><span style="color: #24292E">(backend, info);</span></li><li value="9"><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E">(acc);</span></li><li value="10"><span style="color: #D73A49">await</span><span style="color: #24292E"> ctc.p.</span><span style="color: #6F42C1">Buyer</span><span style="color: #24292E">(buyerInteract);</span></li><li value="11"><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E">(acc);</span></li></ol></pre>
    <ul>
      <li>Line 3: <code>ask</code> and <code>yesno</code> are functions in <code>@reach-sh/stdlib/ask.mjs</code>. <code>yesno</code> accepts only <code>y</code> or <code>n</code>.</li>
      <li>Line 7: You must parse contract information (so, it must be parsable).</li>
      <li>Line 10: You can substitute <em>participants</em> for <em>p</em>.</li>
    </ul>
  </li>
  <li>
    <p>In <em>index.rsh</em>, find the following line:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">buyerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> { </span><span style="color: #D73A49">...</span><span style="color: #24292E">commonInteract };</span></li></ol></pre>
  </li>
  <li>
    <p>Replace it with the following Reach code:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">buyerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span><span style="color: #24292E">commonInteract,</span></li><li value="3"><span style="color: #24292E">  confirmPurchase: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([UInt], Bool)</span></li><li value="4"><span style="color: #24292E">};</span></li></ol></pre>
    <ul>
      <li>Line 1: <code>buyerInteract</code> is a user-defined Reach object.</li>
      <li>Line 2: The spread syntax <code>...</code> adds all <code>commonInteract</code> properties (none yet) to the object.</li>
      <li>Line 3: <code>confirmPurchase</code> is a function that takes a <code>UInt</code> and returns a <code>Bool</code>.</li>
    </ul>
  </li>
  <li>
    <p>In <em>index.rsh</em>, add the following before <code>exit()</code>:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">willBuy</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.</span><span style="color: #6F42C1">confirmPurchase</span><span style="color: #24292E">(price)); });</span></li><li value="2"><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">(willBuy);</span></li><li value="3"><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">willBuy) {</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="5"><span style="color: #24292E">} </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></li><li value="6"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="7"><span style="color: #24292E">}</span></li></ol></pre>
    <ul>
      <li>Line 1: <code>confirmPurchase</code> passes <code>price</code> and returns <code>true</code> or <code>false</code> from frontend.</li>
      <li>Line 2: <code>B.publish()</code> transitions to a consensus step.</li>
      <li>Line 4: <code>commit()</code> transitions to a step.</li>
    </ul>
    <p>See <a href="#reach-mode-diagram">Reach Mode Diagram</a> and <a href="#reach-mode-definitions">Reach Mode Definitions</a> at the bottom of this section for an explanation about <em>index.rsh</em> code.</p>
  </li>
  <li>
    <p>Run your DApp as both the seller and the buyer. When prompted, copy &amp; paste the contract info from the Seller Terminal to the Buyer Terminal. Output should resemble the following:</p>
    <div class="row gx-3">
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is seller.</li><li value="2">The consensus network is ALGO.</li><li value="3">Your balance is 1000 ALGO.</li><li value="4">Your wisdom is for sale at 5 ALGO.</li><li value="5">Contract info: 23</li><li value="6">Your balance is 999.997 ALGO.</li></ol></pre>
      </div>
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is buyer.</li><li value="2">The consensus network is ALGO.</li><li value="3">Paste contract info:</li><li value="4">23</li><li value="5">Your balance is 1000 ALGO.</li><li value="6">Do you want to purchase wisdom for 5 ALGO?</li><li value="7">n</li><li value="8">Your balance is 999.998 ALGO.</li></ol></pre>
      </div>
    </div>
  </li>
</ol>
<h2 id="reach-mode-diagram">Reach Mode Diagram</h2>
<p>Reach programs (the <em>index.rsh</em> portion of your Reach DApp) are organized into four modes: <em>Init Mode</em>, <em>Step Mode</em>, <em>Local Step Mode</em>, and <em>Consensus Step Mode</em>. Consider this diagram:</p>
<div>
  <img src="/en/books/essentials/getting-started/wisdom-for-sale/modes.png" class="img-fluid my-4 d-block" width="700" loading="lazy">
</div>
<p>The dark blue boxes in the diagram represent modes. The light blue boxes represent actions (functions) permitted within the mode. The orange text represents functions that cause transitions between modes.</p>
<h2 id="reach-mode-definitions">Reach Mode Definitions</h2>
<h3 id="init-mode">Init Mode</h3>
<p>Application Initialization defines participants and views (see <a href="#view-the-contract">View the contract</a> later in the tutorial). It also, optionally, overrides default compile options. Lines 2 and 3 below occur in the <em>Init</em> mode:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">main</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Reach.</span><span style="color: #6F42C1">App</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Seller'</span><span style="color: #24292E">, sellerInteract);</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">B</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Buyer'</span><span style="color: #24292E">, buyerInteract);</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">();</span></li></ol></pre>
<p>You can also override compile options (Line 2 below) in the <em>Init</em> mode:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">main</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Reach.</span><span style="color: #6F42C1">App</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #6F42C1">setOptions</span><span style="color: #24292E">({ verifyArithmetic: </span><span style="color: #005CC5">true</span><span style="color: #24292E">, connectors: [</span><span style="color: #005CC5">ETH</span><span style="color: #24292E">, </span><span style="color: #005CC5">ALGO</span><span style="color: #24292E"> ] });</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Seller'</span><span style="color: #24292E">, sellerInteract);</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">B</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Buyer'</span><span style="color: #24292E">, buyerInteract);</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">();</span></li></ol></pre>
<p>The <code>deploy</code> function transitions from the <em>Init</em> mode to the <em>Step</em> mode.</p>
<h3 id="step-mode">Step Mode</h3>
<p>A Step specifies actions taken by each and every participant. <code>exit()</code>, for example, is a function that must occur within a step, and it means that each and every participant exits the contract after which that instance of the contract becomes forever unavailable.</p>
<h3 id="local-step-mode">Local Step Mode</h3>
<p>A Local Step specifies actions taken by a single participant. Local steps must occur within the body of <code>only</code> or <code>each</code> statements. Here is an example:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">price</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.price); });</span></li></ol></pre>
<p><code>only()</code> and <code>each()</code> transition to a local step and then back to the originating mode (step or consensus step).</p>
<h3 id="consensus-step-mode">Consensus Step Mode</h3>
<p>A Consensus Step specifies actions taken by the contract itself. Later in this tutorial, the contract calls <code>transfer</code> to transfer funds from the contract to the seller.</p>
<h1 id="cancel-a-transaction">Cancel a transaction</h1>
<p>This section shows you how to cancel a transaction.</p>
<ol>
  <li>
    <p>In <em>index.mjs</em>, find the following line:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">commonInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {};</span></li></ol></pre>
  </li>
  <li>
    <p>Replace it with the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">commonInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #6F42C1">reportCancellation</span><span style="color: #24292E">: () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`The buyer cancelled the order.`</span><span style="color: #24292E">); }</span></li><li value="3"><span style="color: #24292E">};</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.rsh</em>, find the following line:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">commonInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {};</span></li></ol></pre>
  </li>
  <li>
    <p>Replace it with the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">commonInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  reportCancellation: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([], Null)</span></li><li value="3"><span style="color: #24292E">};</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.rsh</em>, add Lines 3 and 4 to existing code:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">willBuy) {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #6F42C1">each</span><span style="color: #24292E">([</span><span style="color: #005CC5">S</span><span style="color: #24292E">, </span><span style="color: #005CC5">B</span><span style="color: #24292E">], () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> interact.</span><span style="color: #6F42C1">reportCancellation</span><span style="color: #24292E">());</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #6F42C1">exit</span><span style="color: #24292E">();</span></li><li value="5"><span style="color: #24292E">} </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></li><li value="6"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="7"><span style="color: #24292E">}</span></li></ol></pre>
  </li>
  <li>
    <p>Run your DApp as both the seller and the buyer. Answer <code>n</code> when asked to buy wisdom. Output should include the following:</p>
    <div class="row gx-3">
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is seller.</li><li value="2">The buyer cancelled the order.</li></ol></pre>
      </div>
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is buyer.</li><li value="2">The buyer cancelled the order.</li></ol></pre>
      </div>
    </div>
    <p>In the Buyer Terminal, it might be more consistent to output <em>You cancelled the order</em> instead of <em>The buyer cancelled the order</em>. The following steps implement this slight change.</p>
  </li>
  <li>
    <p>In <em>index.mjs</em>, modify <code>commonInteract</code>:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">commonInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">role</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> ({</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #6F42C1">reportCancellation</span><span style="color: #24292E">: () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`${</span><span style="color: #24292E">role</span><span style="color: #032F62"> </span><span style="color: #D73A49">==</span><span style="color: #032F62"> </span><span style="color: #032F62">'buyer'</span><span style="color: #032F62"> </span><span style="color: #D73A49">?</span><span style="color: #032F62"> </span><span style="color: #032F62">'You'</span><span style="color: #032F62"> </span><span style="color: #D73A49">:</span><span style="color: #032F62"> </span><span style="color: #032F62">'The buyer'} cancelled the order.`</span><span style="color: #24292E">); }</span></li><li value="3"><span style="color: #24292E">});</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.mjs</em>, modify <code>sellerInteract</code> and <code>buyerInteract</code> to pass <code>role</code> to <em>commonInteract</em>:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">sellerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span><span style="color: #6F42C1">commonInteract</span><span style="color: #24292E">(role),</span></li><li value="3"><span style="color: #24292E">}</span></li><li value="4"></li><li value="5"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">buyerInteract</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="6"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span><span style="color: #6F42C1">commonInteract</span><span style="color: #24292E">(role),</span></li><li value="7"><span style="color: #24292E">}</span></li></ol></pre>
  </li>
  <li>
    <p>Rerun your DApp as the seller and buyer. Answer <code>n</code> again. Now, buyer output should include <em>You cancelled the order</em>:</p>
    <div class="row gx-3">
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is seller.</li><li value="2">The buyer cancelled the order.</li></ol></pre>
      </div>
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is buyer.</li><li value="2">You cancelled the order.</li></ol></pre>
      </div>
    </div>
  </li>
</ol>
<h1 id="complete-a-transaction">Complete a transaction</h1>
<p>This section shows you how to get wisdom from the seller on the frontend, and swap it for tokens on the backend.</p>
<ol>
  <li>
    <p>In <em>index.mjs</em>, add a <code>wisdom</code> property to <code>sellerInteract</code> right after the <code>price</code> property:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">wisdom</span><span style="color: #24292E">: </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(</span><span style="color: #032F62">'Enter a wise phrase, or press Enter for default:'</span><span style="color: #24292E">, (</span><span style="color: #E36209">s</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #D73A49">let</span><span style="color: #24292E"> w </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">!</span><span style="color: #24292E">s </span><span style="color: #D73A49">?</span><span style="color: #24292E"> </span><span style="color: #032F62">'Build healthy communities.'</span><span style="color: #24292E"> </span><span style="color: #D73A49">:</span><span style="color: #24292E"> s;</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">s) { console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(w); }</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> w;</span></li><li value="5"><span style="color: #24292E">}),</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.rsh</em>, add a <code>wisdom</code> property to <code>sellerInteract</code> right after the <code>price</code> property:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">wisdom</span><span style="color: #24292E">: </span><span style="color: #6F42C1">Bytes</span><span style="color: #24292E">(</span><span style="color: #005CC5">128</span><span style="color: #24292E">),</span></li></ol></pre>
  </li>
  <li>
    <p>Run your DApp as the seller to test the new input mechanism. You can Ctrl-C twice to exit.</p>
  </li>
  <li>
    <p>In <em>index.mjs</em>, add <code>reportWisdom</code> to <code>buyerInteract</code>:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">reportWisdom</span><span style="color: #24292E">: (</span><span style="color: #E36209">wisdom</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Your new wisdom is "${</span><span style="color: #24292E">wisdom</span><span style="color: #032F62">}"`</span><span style="color: #24292E">)</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.rsh</em>, add <code>reportWisdom</code> to <code>buyerInteract</code>:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">reportWisdom</span><span style="color: #24292E">: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([</span><span style="color: #6F42C1">Bytes</span><span style="color: #24292E">(</span><span style="color: #005CC5">128</span><span style="color: #24292E">)], Null)</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.rsh</em>, add the following before <code>exit()</code>:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">pay</span><span style="color: #24292E">(price);</span></li><li value="2"><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="3"></li><li value="4"><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">wisdom</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.wisdom); });</span></li><li value="5"><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">(wisdom);</span></li><li value="6"><span style="color: #6F42C1">transfer</span><span style="color: #24292E">(price).</span><span style="color: #6F42C1">to</span><span style="color: #24292E">(</span><span style="color: #005CC5">S</span><span style="color: #24292E">);</span></li><li value="7"><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="8"></li><li value="9"><span style="color: #005CC5">B</span><span style="color: #24292E">.interact.</span><span style="color: #6F42C1">reportWisdom</span><span style="color: #24292E">(wisdom);</span></li></ol></pre>
    <ul>
      <li>Line 1: The buyer always pays the contract.</li>
      <li>Line 4: After the buyer commits to purchase, the seller declassifies the wisdom.</li>
      <li>Line 5: The seller makes the wisdom available to the buyer.</li>
      <li>Line 6: The contract transfers funds to the seller.</li>
      <li>Line 9: The buyer sends the new wisdom to the frontend for the user.</li>
    </ul>
  </li>
  <li>
    <p>Run your DApp as the seller and the buyer. Answer <code>y</code> when asked to buy wisdom. Output should resemble the following:</p>
    <div class="row gx-3">
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is seller.</li><li value="2">The consensus network is ALGO.</li><li value="3">Enter a wise phrase, or press Enter for default:</li><li value="4"></li><li value="5">Build healthy communities.</li><li value="6">Your balance is 1000 ALGO.</li><li value="7">Your wisdom is for sale at 5 ALGO.</li><li value="8">Contract info: 90</li><li value="9">Your balance is 1004.994 ALGO.</li></ol></pre>
      </div>
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is buyer.</li><li value="2">The consensus network is ALGO.</li><li value="3">Paste contract info:</li><li value="4">90</li><li value="5">Your balance is 1000 ALGO.</li><li value="6">Do you want to purchase wisdom for 5 ALGO?</li><li value="7">y</li><li value="8">Your new wisdom is "Build healthy communities."</li><li value="9">Your balance is 994.997 ALGO.</li></ol></pre>
        <p>It might be nice to inform the seller and the buyer when the <code>pay</code> and <code>transfer</code> actions take place. The next steps add these improvements.</p>
      </div>
    </div>
  </li>
  <li>
    <p>In <em>index.mjs</em>, add the following to <code>commonInteract</code>:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">reportPayment</span><span style="color: #24292E">: (</span><span style="color: #E36209">payment</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`${</span><span style="color: #24292E">role</span><span style="color: #032F62"> </span><span style="color: #D73A49">==</span><span style="color: #032F62"> </span><span style="color: #032F62">'buyer'</span><span style="color: #032F62"> </span><span style="color: #D73A49">?</span><span style="color: #032F62"> </span><span style="color: #032F62">'You'</span><span style="color: #032F62"> </span><span style="color: #D73A49">:</span><span style="color: #032F62"> </span><span style="color: #032F62">'The buyer'} paid ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">payment</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">} to the contract.`</span><span style="color: #24292E">),</span></li><li value="2"><span style="color: #E36209">reportTransfer</span><span style="color: #24292E">: (</span><span style="color: #E36209">payment</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`The contract paid ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">payment</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">} to ${</span><span style="color: #24292E">role</span><span style="color: #032F62"> </span><span style="color: #D73A49">==</span><span style="color: #032F62"> </span><span style="color: #032F62">'seller'</span><span style="color: #032F62"> </span><span style="color: #D73A49">?</span><span style="color: #032F62"> </span><span style="color: #032F62">'you'</span><span style="color: #032F62"> </span><span style="color: #D73A49">:</span><span style="color: #032F62"> </span><span style="color: #032F62">'the seller'}.`</span><span style="color: #24292E">),</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.rsh</em>, add the following to <code>commonInteract</code>:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">reportPayment</span><span style="color: #24292E">: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([UInt], Null),</span></li><li value="2"><span style="color: #E36209">reportTransfer</span><span style="color: #24292E">: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([UInt], Null),</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.rsh</em>, add Lines 2 and 10 to existing code:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #005CC5">B</span><span style="color: #24292E">.</span><span style="color: #6F42C1">pay</span><span style="color: #24292E">(price);</span></li><li value="2"><span style="color: #6F42C1">each</span><span style="color: #24292E">([</span><span style="color: #005CC5">S</span><span style="color: #24292E">, </span><span style="color: #005CC5">B</span><span style="color: #24292E">], () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> interact.</span><span style="color: #6F42C1">reportPayment</span><span style="color: #24292E">(price));</span></li><li value="3"><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="4"></li><li value="5"><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">wisdom</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.wisdom); });</span></li><li value="6"><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">(wisdom);</span></li><li value="7"><span style="color: #6F42C1">transfer</span><span style="color: #24292E">(price).</span><span style="color: #6F42C1">to</span><span style="color: #24292E">(</span><span style="color: #005CC5">S</span><span style="color: #24292E">);</span></li><li value="8"><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="9"></li><li value="10"><span style="color: #6F42C1">each</span><span style="color: #24292E">([</span><span style="color: #005CC5">S</span><span style="color: #24292E">, </span><span style="color: #005CC5">B</span><span style="color: #24292E">], () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> interact.</span><span style="color: #6F42C1">reportTransfer</span><span style="color: #24292E">(price));</span></li><li value="11"><span style="color: #005CC5">B</span><span style="color: #24292E">.interact.</span><span style="color: #6F42C1">reportWisdom</span><span style="color: #24292E">(wisdom);</span></li></ol></pre>
    <ul>
      <li>Line 2: <code>each</code> calls <code>interact.reportPayment</code> for each participant in the array.</li>
      <li>Line 10: <code>each</code> calls <code>interact.reportTransfer</code> for each participant in the array.</li>
    </ul>
  </li>
  <li>
    <p>Run your DApp as the seller and the buyer. Answer <code>y</code> when asked to buy wisdom. Output should resemble the following:</p>
    <div class="row gx-3">
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is seller.</li><li value="2">The consensus network is ALGO.</li><li value="3">Enter a wise phrase, or press Enter for default:</li><li value="4"></li><li value="5">Build healthy communities.</li><li value="6">Your balance is 1000 ALGO.</li><li value="7">Your wisdom is for sale at 5 ALGO.</li><li value="8">Contract info: 113</li><li value="9">The buyer paid 5 ALGO to the contract.</li><li value="10">The contract paid 5 ALGO to you.</li><li value="11">Your balance is 1004.994 ALGO.</li></ol></pre>
      </div>
      <div class="col-12 col-lg-auto">
        <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Your role is buyer.</li><li value="2">The consensus network is ALGO.</li><li value="3">Paste contract info:</li><li value="4">113</li><li value="5">Your balance is 1000 ALGO.</li><li value="6">Do you want to purchase wisdom for 5 ALGO?</li><li value="7">y</li><li value="8">You paid 5 ALGO to the contract.</li><li value="9">The contract paid 5 ALGO to the seller.</li><li value="10">Your new wisdom is "Build healthy communities."</li><li value="11">Your balance is 994.997 ALGO.</li></ol></pre>
      </div>
    </div>
  </li>
</ol>
<h1 id="view-the-contract">View the contract</h1>
<p>This section shows you how to have the buyer (before attaching) peek into the deployed contract to view the price, and explains why viewing contract data before attaching is sometimes advantageous.</p>
<p>Below is the <em>index.mjs</em> version of <code>confirmPurchase</code> from the <code>buyerInteract</code> object:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #E36209">confirmPurchase</span><span style="color: #24292E">: </span><span style="color: #D73A49">async</span><span style="color: #24292E"> (</span><span style="color: #E36209">price</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(</span><span style="color: #032F62">`Do you want to purchase wisdom for ${</span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">price</span><span style="color: #032F62">)</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">}?`</span><span style="color: #24292E">, yesno),</span></li></ol></pre>
<p>The backend calls the function (passing <code>price</code>), and the frontend displays <code>price</code> to the buyer, asks for a decision, waits for the answer, and returns <code>true</code> or <code>false</code> to the backend. Effective for a command-line app, this approach doesn't work as well for a webapp which might use a modal in place of <code>ask-yesno</code>:</p>
<div>
  <img src="/en/books/essentials/getting-started/wisdom-for-sale/modal.png" class="img-fluid my-4 d-block" width="400" loading="lazy">
</div>
<p>Using Bootstrap as a example, here is how to display a modal:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">modal</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> bootstrap.</span><span style="color: #6F42C1">Modal</span><span style="color: #24292E">(document.</span><span style="color: #6F42C1">getElementById</span><span style="color: #24292E">(</span><span style="color: #032F62">'confirm-modal'</span><span style="color: #24292E">), {})</span></li><li value="2"><span style="color: #24292E">modal.</span><span style="color: #6F42C1">show</span><span style="color: #24292E">();</span></li></ol></pre>
<p>Note that <code>modal.show()</code> does not display the modal and wait for an answer. Rather, it returns immediately to the caller (before the modal appears), and, to get the answer, the application listens (asynchronously) for <em>Yes</em> and <em>No</em> button events. So, the application cannot call <code>modal.show()</code> from within <code>confirmPurchase</code>, wait for an answer, and return <code>true</code> or <code>false</code> to the backend.</p>
<p>Instead, a webapp can do the following prior to attaching to the contract:</p>
<ol>
  <li>Get and display the price to the buyer.</li>
  <li>Get confirmation from the buyer.</li>
</ol>
<p>Once confirmed, the webapp can attach to the contract and complete the transaction (skipping the existing <code>confirmPurchase</code> by, for now, always returning <code>true</code>). The following directions show you how to obtain <code>price</code> from the contract before attaching:</p>
<ol>
  <li>
    <p>In <em>index.rsh</em>, add Lines 4 and 10:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">main</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Reach.</span><span style="color: #6F42C1">App</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="2"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">S</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Seller'</span><span style="color: #24292E">, sellerInteract);</span></li><li value="3"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">B</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Buyer'</span><span style="color: #24292E">, buyerInteract);</span></li><li value="4"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">V</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">View</span><span style="color: #24292E">(</span><span style="color: #032F62">'Main'</span><span style="color: #24292E">, { price: UInt });</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">();</span></li><li value="6"></li><li value="7"><span style="color: #24292E">  </span><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> { </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">price</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.price); });</span></li><li value="8"><span style="color: #24292E">  </span><span style="color: #005CC5">S</span><span style="color: #24292E">.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">(price);</span></li><li value="9"><span style="color: #24292E">  </span><span style="color: #005CC5">S</span><span style="color: #24292E">.interact.</span><span style="color: #6F42C1">reportReady</span><span style="color: #24292E">(price);</span></li><li value="10"><span style="color: #24292E">  </span><span style="color: #005CC5">V</span><span style="color: #24292E">.price.</span><span style="color: #6F42C1">set</span><span style="color: #24292E">(price);</span></li><li value="11"><span style="color: #24292E">  </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li></ol></pre>
  </li>
  <li>
    <p>In <em>index.mjs</em>, add Lines 4 and 5 (in the Buyer section):</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">acc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(iBalance);</span></li><li value="2"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">info</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ask</span><span style="color: #24292E">(</span><span style="color: #032F62">'Paste contract info:'</span><span style="color: #24292E">, (</span><span style="color: #E36209">s</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">JSON</span><span style="color: #24292E">.</span><span style="color: #005CC5">parse</span><span style="color: #24292E">(s));</span></li><li value="3"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctc</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> acc.</span><span style="color: #6F42C1">contract</span><span style="color: #24292E">(backend, info);</span></li><li value="4"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">price</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> ctc.views.Main.</span><span style="color: #6F42C1">price</span><span style="color: #24292E">();</span></li><li value="5"><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`The price of wisdom is ${</span><span style="color: #24292E">price</span><span style="color: #032F62">[</span><span style="color: #005CC5">0</span><span style="color: #032F62">] </span><span style="color: #D73A49">==</span><span style="color: #032F62"> </span><span style="color: #032F62">'None'</span><span style="color: #032F62"> </span><span style="color: #D73A49">?</span><span style="color: #032F62"> </span><span style="color: #032F62">'0'</span><span style="color: #032F62"> </span><span style="color: #D73A49">:</span><span style="color: #032F62"> </span><span style="color: #6F42C1">toSU</span><span style="color: #032F62">(</span><span style="color: #24292E">price</span><span style="color: #032F62">[</span><span style="color: #005CC5">1</span><span style="color: #032F62">])</span><span style="color: #032F62">} ${</span><span style="color: #24292E">suStr</span><span style="color: #032F62">}.`</span><span style="color: #24292E">);</span></li><li value="6"><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E">(acc);</span></li><li value="7"><span style="color: #D73A49">await</span><span style="color: #24292E"> ctc.p.</span><span style="color: #6F42C1">Buyer</span><span style="color: #24292E">(buyerInteract)</span></li><li value="8"><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showBalance</span><span style="color: #24292E">(acc);</span></li></ol></pre>
  </li>
  <li>
    <p>Run your DApp as the seller and the buyer. Buyer output should include the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">The price of wisdom is 5 ETH.</li></ol></pre>
  </li>
</ol>
<p>Using a view, the buyer is able to obtain <code>price</code> before attaching to the contract.</p><button class="btn btn-success btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#apav" aria-expanded="false"><i class="fas fa-info-circle me-2"></i><span>About Participants and Views</span></button><span class="collapse" id="apav"><p>Not done yet.</p><hr style="background-color:#198754;opacity:1;height:6px;"></span>
<h1 id="examine-the-webapp">Examine the webapp</h1>
<p>The <a href="https://github.com/hagenhaus/wisdom-for-sale">wisdom-for-sale</a> repository includes a <a href="https://getbootstrap.com/docs/5.1/getting-started/introduction/">Bootstrap</a>-based webapp implementation that you can inspect and modify:</p>
<p class="ratio ratio-16x9 my-4" style="max-width:500px;">
  <iframe src="https://www.youtube.com/embed/dOssmYL2ULA" frameborder="0" allowfullscreen=""></iframe>
</p>
<p>You need node.js and npm installed on your computer because you will need the <a href="https://www.npmjs.com/package/http-server">http-server</a> package (or similar) to run the webapp. Below are directions for running and inspecting the DApp:</p>
<ol>
  <li>
    <p>Copy <a href="https://github.com/hagenhaus/wisdom-for-sale/blob/master/solution/index.html">index.html</a> and <a href="https://github.com/hagenhaus/wisdom-for-sale/blob/master/solution/webapp.mjs">webapp.mjs</a> from the solution directory to your current directory.</p>
  </li>
  <li>
    <p>Stop and remove all your Reach containers:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ reach down</li></ol></pre>
  </li>
  <li>
    <p>Open four terminals (i.e. shells):</p>
    <p>
      <img src="/en/books/essentials/getting-started/wisdom-for-sale/webapp-windows.png" class="img-fluid" width="800" loading="lazy">
    </p>
  </li>
  <li>
    <p>Change directory in each terminal:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ ~/reach/wisdom-for-sale/current</li></ol></pre>
  </li>
  <li>
    <p>In the ALGO Terminal, run the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ export REACH_CONNECTOR_MODE=ALGO-devnet</li><li value="2">$ reach devnet</li></ol></pre>
  </li>
  <li>
    <p>In the CFX Terminal, run the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ export REACH_CONNECTOR_MODE=CFX-devnet</li><li value="2">$ reach devnet</li></ol></pre>
  </li>
  <li>
    <p>In the ETH Terminal, run the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ export REACH_CONNECTOR_MODE=ETH-devnet</li><li value="2">$ reach devnet</li></ol></pre>
  </li>
  <li>
    <p>In the Webapp Terminal, run the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">$ npm i --global http-server # Install the package globally if you haven't already.</li><li value="2">$ http-server -c-1 -p 8080   # Run the webapp.</li></ol></pre>
    <p>Output should look similar to the following:</p>
    <pre class="snippet unnumbered"><ol class="snippet"><li value="1">Starting up http-server, serving ./</li><li value="2"></li><li value="3">http-server settings: </li><li value="4">CORS: disabled</li><li value="5">Cache: -1 seconds</li><li value="6">Connection Timeout: 120 seconds</li><li value="7">Directory Listings: visible</li><li value="8">AutoIndex: visible</li><li value="9">Serve GZIP Files: false</li><li value="10">Serve Brotli Files: false</li><li value="11">Default File Extension: none</li><li value="12"></li><li value="13">Available on:</li><li value="14">  http://127.0.0.1:8080</li><li value="15">  http://192.168.1.4:8080</li><li value="16">Hit CTRL-C to stop the server</li></ol></pre>
  </li>
  <li>
    <p>Browse to one of the urls listed above. <code>http://localhost:8080</code> should probably work, too.</p>
  </li>
  <li>
    <p>Click <em>Choose a DevNet</em>, and select <em>Algorand</em>. The Deploy button should turn green.</p>
  </li>
  <li>
    <p>Click <em>Deploy</em>. The <em>Attach</em> button should turn green.</p>
  </li>
  <li>
    <p>Click <em>Attach</em>, and then click <em>Yes</em>. The <em>Reset</em> button should turn green.</p>
  </li>
  <li>
    <p>Click <em>Reset</em>, and try it again with a different <code>Price</code> and <code>Wisdom</code> string.</p>
  </li>
  <li>
    <p>Click <em>Choose a DevNet</em>, select <em>Ethereum</em>, and repeat the Deploy, Attach, Reset steps.</p>
  </li>
</ol>
<p>Note that the webapp doesn't run reliably on Conflux yet.</p>
<h1 id="self-assessment">Self Assessment</h1>
<p>Click on the question to view the answer.</p>
<ol>
  <li>
    <p class="q-and-a" data-bs-toggle="collapse" href="#standard-atomic" aria-expanded="false">Do smart contracts use standard or atomic units?</p>
    <div class="collapse mb-3" id="standard-atomic">
      <div class="card card-body">Smart contracts use atomic (indivisible) units. User interfaces, on the other hand, often use standard units to present cryptocurrency amounts to users. Therefore, Reach frontends frequently need to convert between the two. The Reach JS Stdlib function parseCurrency converts from standard to atomic, and the function formatCurrency converts from atomic to standard.</div>
    </div>
  </li>
  <li>
    <p class="q-and-a" data-bs-toggle="collapse" href="#participants" aria-expanded="false">Reach DApps create smart contracts that enable ____ to interact on consensus networks.</p>
    <div class="collapse mb-3" id="participants">
      <div class="card card-body">Participants. A Reach program describes participant interactions from which the Reach compiler derives a smart contract.</div>
    </div>
  </li>
  <li>
    <p class="q-and-a" data-bs-toggle="collapse" href="#interact" aria-expanded="false">Name the objects that comprise the interface between Reach frontend and backend participants.</p>
    <div class="collapse mb-3" id="interact">
      <div class="card card-body">Interact objects enable Reach frontend and backend participants to communicate.</div>
    </div>
  </li>
  <li>
    <p class="q-and-a" data-bs-toggle="collapse" href="#filenames" aria-expanded="false">Name the Reach default frontend and backend files.</p>
    <div class="collapse mb-3" id="filenames">
      <div class="card card-body">index.mjs and index.rsh are the default frontend and backend filenames respectively. The Reach compiler compiles index.rsh into index.main.mjs.</div>
    </div>
  </li>
  <li>
    <p class="q-and-a" data-bs-toggle="collapse" href="#bytecode" aria-expanded="false">In addition to participant backends, what does index.main.mjs contain?</p>
    <div class="collapse mb-3" id="bytecode">
      <div class="card card-body">It also contains the smart contract bytecode for each supported consensus network.</div>
    </div>
  </li>
  <li>
    <p class="q-and-a" data-bs-toggle="collapse" href="#verification-engine" aria-expanded="false">When does the Reach Verification Engine run?</p>
    <div class="collapse mb-3" id="verification-engine">
      <div class="card card-body">Compile time.</div>
    </div>
  </li>
  <li>
    <p class="q-and-a" data-bs-toggle="collapse" href="#js-stdlibs" aria-expanded="false">Can Reach DApps run on local Dockerized devnets?</p>
    <div class="collapse mb-3" id="js-stdlibs">
      <div class="card card-body">Yes. Running Reach DApps on local Dockerized devnets is a convenient way to develop and test.</div>
    </div>
  </li>
  <li>
    <p class="q-and-a" data-bs-toggle="collapse" href="#conn-mode" aria-expanded="false">Name the environment variable used by Reach to determine the target consensus network.</p>
    <div class="collapse mb-3" id="conn-mode">
      <div class="card card-body">REACH_CONNECTOR_MODE</div>
    </div>
  </li>
  <li>
    <p class="q-and-a" data-bs-toggle="collapse" href="#reach-down" aria-expanded="false">Name the reach command that stops and removes all Reach Docker containers.</p>
    <div class="collapse mb-3" id="reach-down">
      <div class="card card-body">reach down</div>
    </div>
  </li>
  <li>
    <p class="q-and-a" data-bs-toggle="collapse" href="#view" aria-expanded="false">Name the reach object that allows frontends to peak into a contract without attaching.</p>
    <div class="collapse mb-3" id="view">
      <div class="card card-body">View</div>
    </div>
  </li>
</ol>