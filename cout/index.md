[{"bookPath":"","title":"Compiled Output","titleId":"ref-backends","hasOtp":true,"hasPageHeader":true},"<p>\n  <i id=\"p_0\" class=\"pid\"></i>This section describes the compilation output of Reach version 0.1.11,\n  which are participant backends.<a href=\"#p_0\" class=\"pid\">0</a>\n</p>\n<p><i id=\"p_1\" class=\"pid\"></i>They are accessed via <a href=\"/cout/#ref-backends-js\">JavaScript</a> or via <a href=\"/rpc/#ref-backends-rpc\">the RPC server</a>.<a href=\"#p_1\" class=\"pid\">1</a></p>\n<h2 id=\"ref-backends-js\" class=\"refHeader\">JavaScript<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ref-backends-js\"><span class=\"icon icon-link\"></span></a></h2>\n<p>\n  <i id=\"p_2\" class=\"pid\"></i>The Reach JavaScript backend produces a compilation output named <code>input.APP.mjs</code>.\n  This will normally be imported by writing:<a href=\"#p_2\" class=\"pid\">2</a>\n</p>\n<p><span class=\"ref\" id=\"js_backend\" data-scope=\"js\" data-symbol=\"backend\"></span></p>\n<pre class=\"snippet unnumbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"import * as backend from './build/index.main.mjs';\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import\" title=\"js: import\"><span style=\"color: var(--shiki-token-keyword)\">import</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">*</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">as</span><span style=\"color: var(--shiki-color-text)\"> backend </span><span style=\"color: var(--shiki-token-keyword)\">from</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'./build/index.main.mjs'</span><span style=\"color: var(--shiki-color-text)\">;</span></li></ol></pre>\n<p>\n  <i id=\"p_3\" class=\"pid\"></i>This module exports an asynchronous function for each participant.\n  For example, if a Reach program contains a participant named <span class=\"snip\"><span style=\"color: var(--shiki-token-string-expression)\">'A'</span></span> in the <span class=\"snip\"><a href=\"/rsh/module/#rsh_Reach\" title=\"rsh: Reach\"><span style=\"color: var(--shiki-token-constant)\">Reach</span></a><a href=\"/rsh/module/#rsh_Reach.App\" title=\"rsh: Reach.App\"><span style=\"color: var(--shiki-color-text)\">.App</span></a></span>, then the JavaScript backend will include a function named <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">A</span></span> (i.e. <span class=\"snip\"><a href=\"/cout/#js_backend\" title=\"js: backend\"><span style=\"color: var(--shiki-token-constant)\">backend</span></a><span style=\"color: var(--shiki-color-text)\">.</span><span style=\"color: var(--shiki-token-constant)\">A</span></span>).\n  The <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">Promise</span></span> returned by these functions is resolved when the Reach program terminates (i.e. reaches <span class=\"snip\"><a href=\"/rsh/step/#rsh_exit\" title=\"rsh: exit\"><span style=\"color: var(--shiki-token-function)\">exit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></span>).<a href=\"#p_3\" class=\"pid\">3</a>\n</p>\n<p><i id=\"p_4\" class=\"pid\"></i>Each function accepts two arguments: <span class=\"snip\"><a href=\"/frontend/#js_ctc\" title=\"js: ctc\"><span style=\"color: var(--shiki-color-text)\">ctc</span></a></span> and <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">interact</span></span>. These functions should be called by the frontend.<a href=\"#p_4\" class=\"pid\">4</a></p>\n<p><i id=\"p_5\" class=\"pid\"></i>The <span class=\"snip\"><a href=\"/frontend/#js_ctc\" title=\"js: ctc\"><span style=\"color: var(--shiki-color-text)\">ctc</span></a></span> argument is the result of a call to the functions <span class=\"snip\"><a href=\"/frontend/#js_acc\" title=\"js: acc\"><span style=\"color: var(--shiki-token-constant)\">acc</span></a><a href=\"/frontend/#js_deploy\" title=\"js: deploy\"><span style=\"color: var(--shiki-color-text)\">.deploy</span></a></span> or <span class=\"snip\"><a href=\"/frontend/#js_acc\" title=\"js: acc\"><span style=\"color: var(--shiki-token-constant)\">acc</span></a><a href=\"/frontend/#js_attach\" title=\"js: attach\"><span style=\"color: var(--shiki-color-text)\">.attach</span></a></span> provided by the <a href=\"/frontend/#ref-frontends-js\">JavaScript frontend support library</a>.<a href=\"#p_5\" class=\"pid\">5</a></p>\n<p>\n  <i id=\"p_6\" class=\"pid\"></i>The <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">interact</span></span> argument is an object matching the participant interact interface for the corresponding participant.\n  The types of values this object contains must match those specified\n  <a href=\"/frontend/#ref-frontends-js-types\">on this list</a>.\n  Each function may return a <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">Promise</span></span>, which the backend will <span class=\"snip\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a></span>, if it needs to perform an asynchronous action.<a href=\"#p_6\" class=\"pid\">6</a>\n</p>\n<p>\n  <i id=\"p_7\" class=\"pid\"></i>The backend provides a value, <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">_version</span></span>, which is a string representation of the Reach version used to compile the program.\n  For example, the version of Reach used to produce this documentation would contain the string <span class=\"snip\"><span style=\"color: var(--shiki-token-string-expression)\">'reach-vers'</span></span>.<a href=\"#p_7\" class=\"pid\">7</a>\n</p>\n<p>\n  <i id=\"p_8\" class=\"pid\"></i>The backend provides a function, <span class=\"ref\" id=\"js_getExports\" data-scope=\"js\" data-symbol=\"getExports\"></span><span class=\"snip\"><a href=\"/cout/#js_getExports\" title=\"js: getExports\"><span style=\"color: var(--shiki-color-text)\">getExports</span></a></span>, which exposes the exports of a Reach program.\n  This function receives the standard library as an argument and returns an object with all the exports present in the module being compiled.<a href=\"#p_8\" class=\"pid\">8</a>\n</p>\n<div class=\"note\">\n  <p><i id=\"p_9\" class=\"pid\"></i>It's possible to expose bindings from other modules to <span class=\"snip\"><a href=\"/cout/#js_getExports\" title=\"js: getExports\"><span style=\"color: var(--shiki-color-text)\">getExports</span></a></span> by re-exporting them in your \"top-level\" module.<a href=\"#p_9\" class=\"pid\">9</a></p>\n</div>\n<p>\n  <i id=\"p_10\" class=\"pid\"></i>For example, if a Reach program\n  exported a variable <code>x</code>, i.e. <span class=\"snip\"><a href=\"/rsh/module/#rsh_export\" title=\"rsh: export\"><span style=\"color: var(--shiki-token-keyword)\">export</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">x</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">5</span></span>, the frontend could access the value in the following manner:<a href=\"#p_10\" class=\"pid\">10</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const stdlib = loadStdlib();\nbackend.getExports(stdlib).x; // 5\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_loadStdlib\" title=\"js: loadStdlib\"><span style=\"color: var(--shiki-token-function)\">loadStdlib</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"2\"><a href=\"/cout/#js_backend\" title=\"js: backend\"><span style=\"color: var(--shiki-token-constant)\">backend</span></a><a href=\"/cout/#js_getExports\" title=\"js: getExports\"><span style=\"color: var(--shiki-token-function)\">.getExports</span></a><span style=\"color: var(--shiki-color-text)\">(stdlib).x; </span><span style=\"color: var(--shiki-token-comment)\">// 5</span></li></ol></pre>\n<p><i id=\"p_11\" class=\"pid\"></i>Finally, the backend provides a value, <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">_Connectors</span></span>, which is an opaque object representing the connectors the app was compiled for.<a href=\"#p_11\" class=\"pid\">11</a></p>\n<h3 id=\"ref-backends-js-guarantees\" class=\"refHeader\">Guarantees<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ref-backends-js-guarantees\"><span class=\"icon icon-link\"></span></a></h3>\n<p>\n  <i id=\"p_12\" class=\"pid\"></i>This backend does not guarantee that values in a positive position in a participant interact interface, that are later passed to a negative position in a participant interact interface, will be identical, in the sense of JavaScript's <span class=\"snip\"><span style=\"color: var(--shiki-token-keyword)\">===</span></span> operator, to the original value.\n  In other words, this backend does not ensure that Reach programs are parametric over JavaScript values that they interact with.<a href=\"#p_12\" class=\"pid\">12</a>\n</p>\n<p>\n  <i id=\"p_13\" class=\"pid\"></i>Positive and negative are best understood by example with a function type: a positive position is supplied by the function, such as the result; while a negative position is supplied by the caller, such as the arguments.\n  These notions generalize, however, to higher (and lower) order contexts.\n  In the case of Reach, this means that non-function values in a participant interact interface are positive.<a href=\"#p_13\" class=\"pid\">13</a>\n</p>\n<p><i id=\"p_14\" class=\"pid\"></i>For example, if the Reach program,<a href=\"#p_14\" class=\"pid\">14</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"Reach.App( {},\n [ Participant(&quot;A&quot;, {\n     get: Bytes(32),\n     give: Fun([Bytes(32)], Bool) } ) ],\n (A) => {\n  A.only(() => {\n   const x = interact.give(interact.get); });\n  A.publish(x);\n  commit(); });\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/module/#rsh_Reach\" title=\"rsh: Reach\"><span style=\"color: var(--shiki-token-constant)\">Reach</span></a><a href=\"/rsh/module/#rsh_Reach.App\" title=\"rsh: Reach.App\"><span style=\"color: var(--shiki-token-function)\">.App</span></a><span style=\"color: var(--shiki-color-text)\">( {}</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"2\"><span style=\"color: var(--shiki-color-text)\"> [ </span><a href=\"/rsh/appinit/#rsh_Participant\" title=\"rsh: Participant\"><span style=\"color: var(--shiki-token-function)\">Participant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">\"A\"</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"3\"><span style=\"color: var(--shiki-color-text)\">     get</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Bytes\" title=\"rsh: Bytes\"><span style=\"color: var(--shiki-token-function)\">Bytes</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">32</span><span style=\"color: var(--shiki-color-text)\">)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"4\"><span style=\"color: var(--shiki-color-text)\">     give</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([</span><a href=\"/rsh/compute/#rsh_Bytes\" title=\"rsh: Bytes\"><span style=\"color: var(--shiki-token-function)\">Bytes</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">32</span><span style=\"color: var(--shiki-color-text)\">)]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bool) } ) ]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"5\"><span style=\"color: var(--shiki-color-text)\"> (A) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"6\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">A</span><a href=\"/rsh/step/#rsh_only\" title=\"rsh: only\"><span style=\"color: var(--shiki-token-function)\">.only</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"7\"><span style=\"color: var(--shiki-color-text)\">   </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">x</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.give</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-color-text)\">.get); });</span></li><li value=\"8\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">A</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">(x);</span></li><li value=\"9\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">(); });</span></li></ol></pre>\n<p><i id=\"p_15\" class=\"pid\"></i>is given the <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">interact</span></span> object,<a href=\"#p_15\" class=\"pid\">15</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const x = &quot;A string&quot;;\n{ get: x,\n  give: (str) => x === str }\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">x</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"A string\"</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"2\"><span style=\"color: var(--shiki-color-text)\">{ get</span><span style=\"color: var(--shiki-token-punctuation)\">:</span><span style=\"color: var(--shiki-color-text)\"> x</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"3\"><span style=\"color: var(--shiki-color-text)\">  give</span><span style=\"color: var(--shiki-token-punctuation)\">:</span><span style=\"color: var(--shiki-color-text)\"> (str) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> x </span><span style=\"color: var(--shiki-token-keyword)\">===</span><span style=\"color: var(--shiki-color-text)\"> str }</span></li></ol></pre>\n<p>\n  <i id=\"p_16\" class=\"pid\"></i>then it is not guaranteed that <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">A</span></span> will publish <span class=\"snip\"><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a></span>, because the <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">str</span></span> given to <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">give</span></span> may not be identical to <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">x</span></span>.\n  (However, they are <span class=\"snip\"><a href=\"/frontend/#js_bytesEq\" title=\"js: bytesEq\"><span style=\"color: var(--shiki-color-text)\">bytesEq</span></a></span>.)<a href=\"#p_16\" class=\"pid\">16</a>\n</p>","<ul><li class=\"dynamic\">\n    <a href=\"#ref-backends\">Compiled Output</a>\n    <ul class=\"dynamic\">\n      <li class=\"dynamic\">\n        <a href=\"#ref-backends-js\">JavaScript</a>\n        <ul class=\"dynamic\">\n          <li class=\"dynamic\"><a href=\"#ref-backends-js-guarantees\">Guarantees</a></li>\n        </ul>\n      </li>\n    </ul>\n  </li></ul>"]