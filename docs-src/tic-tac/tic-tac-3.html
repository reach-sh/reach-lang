<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>4&nbsp;Pay-to-Play</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Pay-<wbr></wbr>To-<wbr></wbr>Play Tic-<wbr></wbr>Tac-<wbr></wbr>Toe Tutorial</a></td></tr></table></div><div class="tocviewsublistonly" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="tic-tac-0.html" class="tocviewlink" data-pltdoc="x">Install and Initialize</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="tic-tac-1.html" class="tocviewlink" data-pltdoc="x">Scaffolding and Setup</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="tic-tac-2.html" class="tocviewlink" data-pltdoc="x">Tic-<wbr></wbr>Tac-<wbr></wbr>Toe</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Pay-<wbr></wbr>to-<wbr></wbr>Play</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="tic-tac-5.html" class="tocviewlink" data-pltdoc="x">Timeouts and Participation</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="tic-tac-6.html" class="tocviewlink" data-pltdoc="x">Interaction and Independence</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="tic-tac-7.html" class="tocviewlink" data-pltdoc="x">Web Interaction</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="algo.html" class="tocviewlink" data-pltdoc="x">Running on Algorand</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="trouble.html" class="tocviewlink" data-pltdoc="x">Troubleshooting</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="tic-tac-2.html" title="backward to &quot;3 Tic-Tac-Toe&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Pay-To-Play Tic-Tac-Toe Tutorial&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tic-tac-5.html" title="forward to &quot;5 Timeouts and Participation&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>4<tt>&nbsp;</tt><a name="(part._tic-tac-3)"></a>Pay-to-Play</h3><p>Before now, the whole idea of implementing Pay-To-Play on our Tic-Tac-Toe engine has been skipped over.</p><p>However, in this section, we will add Pay-To-Play to our game!</p><p>The first thing that we have to do is add the fee matrix and a few fee handlers to the Reach script so that it can access them for the fee calculations.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-3/index.rsh#L11-L18"><span class="stt">tic-tac-3/index.rsh</span></a><button class="btn" data-clipboard-text="
// Create the array for the fees, which is aligned with the state array.
const fee_matrix = array(UInt, [3, 2, 3, 2, 4, 2, 3, 2, 3]);

const fee_realized = (st, fee) =&gt; Array.iota(9).map((i) =&gt; st[i] ? fee[i]:0);

const sum_fee = (st, fee) =&gt; (fee_realized(st, fee)).sum();
"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">11</span>    
<span class="mi">12</span>    <span class="c1">// Create the array for the fees, which is aligned with the state array.</span>
<span class="mi">13</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">fee_matrix</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nb">array</span></font><span class="p">(</span><font class="badlink"><span class="nb">UInt</span></font><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
<span class="mi">14</span>    
<span class="mi">15</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">fee_realized</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">,</span> <font class="badlink"><span class="nx">fee</span></font><span class="p">)</span> <font class="badlink"><span class="o">=&gt;</span></font> <font class="badlink"><span class="nb">Array</span></font><span class="p">.</span><font class="badlink"><span class="nx">iota</span></font><span class="p">(</span><span class="mi">9</span><span class="p">).</span><font class="badlink"><span class="nx">map</span></font><span class="p">((</span><font class="badlink"><span class="nx">i</span></font><span class="p">)</span> <font class="badlink"><span class="o">=&gt;</span></font> <font class="badlink"><span class="nx">st</span></font><span class="p">[</span><font class="badlink"><span class="nx">i</span></font><span class="p">]</span> <font class="badlink"><span class="o">?</span></font> <font class="badlink"><span class="nx">fee</span></font><span class="p">[</span><font class="badlink"><span class="nx">i</span></font><span class="p">]</span><font class="badlink"><span class="o">:</span></font><span class="mi">0</span><span class="p">);</span>
<span class="mi">16</span>    
<span class="mi">17</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">sum_fee</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">,</span> <font class="badlink"><span class="nx">fee</span></font><span class="p">)</span> <font class="badlink"><span class="o">=&gt;</span></font> <span class="p">(</span><font class="badlink"><span class="nx">fee_realized</span></font><span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">,</span> <font class="badlink"><span class="nx">fee</span></font><span class="p">)).</span><font class="badlink"><span class="nx">sum</span></font><span class="p">();</span>
<span class="mi">18</span>    
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 12 defines the fee matrix, which contains the data that each side costs fee &rsquo;2&rsquo;, each corner costs fee &rsquo;3&rsquo;, and the center costs fee &rsquo;4&rsquo;.</p></li><li><p>Line 15 defines a function to multiply each item in the fee matrix by the corresponding item in the given board matrix.</p></li><li><p>Line 17 defines a small container function to take the cumulative sum of the matrix returned by the fee_realized function.</p></li></ul><p>Then, we pass the fee_mt variable to interact.getMove, so that the JS code can print the fee for the given move.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-3/index.rsh#L61-L61"><span class="stt">tic-tac-3/index.rsh</span></a><button class="btn" data-clipboard-text="  const _m = interact.getMove(st, fee_matrix);"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">61</span>      <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">_m</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="k">interact</span></font><span class="p">.</span><font class="badlink"><span class="nx">getMove</span></font><span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">,</span> <font class="badlink"><span class="nx">fee_matrix</span></font><span class="p">);</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>Once that is done, we then have to modify what we tell the Reach program we will be passing to the JS getMove function.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-3/index.rsh#L78-L78"><span class="stt">tic-tac-3/index.rsh</span></a><button class="btn" data-clipboard-text="        getMove: Fun([State, Board], UInt),"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">78</span>      <font class="badlink"><span class="nx">getMove</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nb">Fun</span></font><span class="p">([</span><font class="badlink"><span class="nx">State</span></font><span class="p">,</span> <font class="badlink"><span class="nx">Board</span></font><span class="p">],</span> <font class="badlink"><span class="nb">UInt</span></font><span class="p">),</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>and add in the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">Fees</span><span class="hspace"></span></span> type</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-3/index.rsh#L3-L3"><span class="stt">tic-tac-3/index.rsh</span></a><button class="btn" data-clipboard-text="const Fees = Array(UInt, 9)"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
 <span class="mi">3</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">Fees</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nb">Array</span></font><span class="p">(</span><font class="badlink"><span class="nb">UInt</span></font><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>Then, actually modify what the players pay.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-3/index.rsh#L136-L153"><span class="stt">tic-tac-3/index.rsh</span></a><button class="btn" data-clipboard-text="      const x_wager = (sum_fee(state.xs, fee_matrix))*wagerAmount/16
      const o_wager = (sum_fee(state.os, fee_matrix))*wagerAmount/16
      const x_unspent = wagerAmount - x_wager
      const o_unspent = wagerAmount - o_wager
      const pot = x_wager + o_wager
      // bool logical winner
      const x_win = winner_is_x(state) 
      const o_win = winner_is_o(state)
      const tie = !( x_win || o_win)        
      // At the end of the game, divy funds to the correct party
      const [toA, toB] = (
          x_win ? [pot+x_unspent, o_unspent]
          : o_win ? [x_unspent, pot+o_unspent]
          : [o_wager+x_unspent, x_wager+o_unspent]
      );
      transfer(toA).to(A);
      transfer(toB).to(B);
      commit();"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">136</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">x_wager</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">sum_fee</span></font><span class="p">(</span><font class="badlink"><span class="nx">state</span></font><span class="p">.</span><font class="badlink"><span class="nx">xs</span></font><span class="p">,</span> <font class="badlink"><span class="nx">fee_matrix</span></font><span class="p">))</span><font class="badlink"><span class="o">*</span></font><font class="badlink"><span class="nx">wagerAmount</span></font><font class="badlink"><span class="o">/</span></font><span class="mi">16</span>
<span class="mi">137</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">o_wager</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">sum_fee</span></font><span class="p">(</span><font class="badlink"><span class="nx">state</span></font><span class="p">.</span><font class="badlink"><span class="nx">os</span></font><span class="p">,</span> <font class="badlink"><span class="nx">fee_matrix</span></font><span class="p">))</span><font class="badlink"><span class="o">*</span></font><font class="badlink"><span class="nx">wagerAmount</span></font><font class="badlink"><span class="o">/</span></font><span class="mi">16</span>
<span class="mi">138</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">x_unspent</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">wagerAmount</span></font> <font class="badlink"><span class="o">-</span></font> <font class="badlink"><span class="nx">x_wager</span></font>
<span class="mi">139</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">o_unspent</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">wagerAmount</span></font> <font class="badlink"><span class="o">-</span></font> <font class="badlink"><span class="nx">o_wager</span></font>
<span class="mi">140</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">pot</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">x_wager</span></font> <font class="badlink"><span class="o">+</span></font> <font class="badlink"><span class="nx">o_wager</span></font>
<span class="mi">141</span>    <span class="c1">// bool logical winner</span>
<span class="mi">142</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">x_win</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">winner_is_x</span></font><span class="p">(</span><font class="badlink"><span class="nx">state</span></font><span class="p">)</span> 
<span class="mi">143</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">o_win</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">winner_is_o</span></font><span class="p">(</span><font class="badlink"><span class="nx">state</span></font><span class="p">)</span>
<span class="mi">144</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">tie</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="o">!</span></font><span class="p">(</span> <font class="badlink"><span class="nx">x_win</span></font> <font class="badlink"><span class="o">||</span></font> <font class="badlink"><span class="nx">o_win</span></font><span class="p">)</span>        
<span class="mi">145</span>    <span class="c1">// At the end of the game, divy funds to the correct party</span>
<span class="mi">146</span>    <font class="badlink"><span class="kd">const</span></font> <span class="p">[</span><font class="badlink"><span class="nx">toA</span></font><span class="p">,</span> <font class="badlink"><span class="nx">toB</span></font><span class="p">]</span> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span>
<span class="mi">147</span>        <font class="badlink"><span class="nx">x_win</span></font> <font class="badlink"><span class="o">?</span></font> <span class="p">[</span><font class="badlink"><span class="nx">pot</span></font><font class="badlink"><span class="o">+</span></font><font class="badlink"><span class="nx">x_unspent</span></font><span class="p">,</span> <font class="badlink"><span class="nx">o_unspent</span></font><span class="p">]</span>
<span class="mi">148</span>        <font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">o_win</span></font> <font class="badlink"><span class="o">?</span></font> <span class="p">[</span><font class="badlink"><span class="nx">x_unspent</span></font><span class="p">,</span> <font class="badlink"><span class="nx">pot</span></font><font class="badlink"><span class="o">+</span></font><font class="badlink"><span class="nx">o_unspent</span></font><span class="p">]</span>
<span class="mi">149</span>        <font class="badlink"><span class="o">:</span></font> <span class="p">[</span><font class="badlink"><span class="nx">o_wager</span></font><font class="badlink"><span class="o">+</span></font><font class="badlink"><span class="nx">x_unspent</span></font><span class="p">,</span> <font class="badlink"><span class="nx">x_wager</span></font><font class="badlink"><span class="o">+</span></font><font class="badlink"><span class="nx">o_unspent</span></font><span class="p">]</span>
<span class="mi">150</span>    <span class="p">);</span>
<span class="mi">151</span>    <font class="badlink"><span class="k">transfer</span></font><span class="p">(</span><font class="badlink"><span class="nx">toA</span></font><span class="p">).</span><font class="badlink"><span class="nx">to</span></font><span class="p">(</span><font class="badlink"><span class="nx">A</span></font><span class="p">);</span>
<span class="mi">152</span>    <font class="badlink"><span class="k">transfer</span></font><span class="p">(</span><font class="badlink"><span class="nx">toB</span></font><span class="p">).</span><font class="badlink"><span class="nx">to</span></font><span class="p">(</span><font class="badlink"><span class="nx">B</span></font><span class="p">);</span>
<span class="mi">153</span>    <font class="badlink"><span class="k">commit</span></font><span class="p">();</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>Now, the Reach file is fully set up for the Pay-To-Play function. Since this is done, we must now move on to editing the JS side of the DApp.</p><p>The only thing to change is the getMove function:</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-3/index.mjs#L50-L65"><span class="stt">tic-tac-3/index.mjs</span></a><button class="btn" data-clipboard-text="    getMove: (state, fee_mt) =&gt; {
      console.log(`${name} chooses a move from the state:${render(state)}`);
      const xs = state.xs;
      const os = state.os;
      let fee = 0;
      while ( xs &amp;&amp; os ) {
        const i = Math.floor( Math.random() * 9 );
        if ( ! ( xs[i] || os[i] ) ) {
          fee = (wagerAmount / 16) * fee_mt[i];
          console.log(`${name} chooses move ${i} from board Above.`);
          console.log(`fee: ${fee / 10 ** 18} * 10**18`);
          return i;
        }
      }
      throw Error(`impossible to make a move`);
    },"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">50</span>        <font class="badlink"><span class="nx">getMove</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">(</span><font class="badlink"><span class="nx">state</span></font><span class="p">,</span> <font class="badlink"><span class="nx">fee_mt</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mi">51</span>    <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">name</span></font><span class="si">}</span><span class="sb"> chooses a move from the state:</span><span class="si">${</span><font class="badlink"><span class="nx">render</span></font><span class="p">(</span><font class="badlink"><span class="nx">state</span></font><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mi">52</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">xs</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">state</span></font><span class="p">.</span><font class="badlink"><span class="nx">xs</span></font><span class="p">;</span>
<span class="mi">53</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">os</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">state</span></font><span class="p">.</span><font class="badlink"><span class="nx">os</span></font><span class="p">;</span>
<span class="mi">54</span>    <font class="badlink"><span class="kd">let</span></font> <font class="badlink"><span class="nx">fee</span></font> <font class="badlink"><span class="o">=</span></font> <span class="mi">0</span><span class="p">;</span>
<span class="mi">55</span>    <font class="badlink"><span class="k">while</span></font> <span class="p">(</span> <font class="badlink"><span class="nx">xs</span></font> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">os</span></font> <span class="p">)</span> <span class="p">{</span>
<span class="mi">56</span>      <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">i</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nb">Math</span></font><span class="p">.</span><font class="badlink"><span class="nx">floor</span></font><span class="p">(</span> <font class="badlink"><span class="nb">Math</span></font><span class="p">.</span><font class="badlink"><span class="nx">random</span></font><span class="p">()</span> <font class="badlink"><span class="o">*</span></font> <span class="mi">9</span> <span class="p">);</span>
<span class="mi">57</span>      <font class="badlink"><span class="k">if</span></font> <span class="p">(</span> <font class="badlink"><span class="o">!</span></font> <span class="p">(</span> <font class="badlink"><span class="nx">xs</span></font><span class="p">[</span><font class="badlink"><span class="nx">i</span></font><span class="p">]</span> <font class="badlink"><span class="o">||</span></font> <font class="badlink"><span class="nx">os</span></font><span class="p">[</span><font class="badlink"><span class="nx">i</span></font><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
<span class="mi">58</span>        <font class="badlink"><span class="nx">fee</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">wagerAmount</span></font> <font class="badlink"><span class="o">/</span></font> <span class="mi">16</span><span class="p">)</span> <font class="badlink"><span class="o">*</span></font> <font class="badlink"><span class="nx">fee_mt</span></font><span class="p">[</span><font class="badlink"><span class="nx">i</span></font><span class="p">];</span>
<span class="mi">59</span>        <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">name</span></font><span class="si">}</span><span class="sb"> chooses move </span><span class="si">${</span><font class="badlink"><span class="nx">i</span></font><span class="si">}</span><span class="sb"> from board Above.`</span><span class="p">);</span>
<span class="mi">60</span>        <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`fee: </span><span class="si">${</span><font class="badlink"><span class="nx">fee</span></font> <font class="badlink"><span class="o">/</span></font> <span class="mi">10</span> <font class="badlink"><span class="o">**</span></font> <span class="mi">18</span><span class="si">}</span><span class="sb"> * 10**18`</span><span class="p">);</span>
<span class="mi">61</span>        <font class="badlink"><span class="k">return</span></font> <font class="badlink"><span class="nx">i</span></font><span class="p">;</span>
<span class="mi">62</span>      <span class="p">}</span>
<span class="mi">63</span>    <span class="p">}</span>
<span class="mi">64</span>    <font class="badlink"><span class="k">throw</span></font> <font class="badlink"><span class="nb">Error</span></font><span class="p">(</span><span class="sb">`impossible to make a move`</span><span class="p">);</span>
<span class="mi">65</span>        <span class="p">},</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>Once that is complete, Pay-to-Play has successfully been implemented on your Tic-Tac-Toe DApp!
The only visible difference in the output of the game will be that the final balances will no longer be exactly 5 ETH (or ALGO, depending on which REACH_CONNECTOR_MODE you are running on) different from the starting balances.</p><p>Since the players act randomly, the results will be different every time.
When I ran the program, this is the output I got:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">Bob sees the final board:</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9556;&#9552;&#9552;&#9552;&#9574;&#9552;&#9552;&#9552;&#9574;&#9552;&#9552;&#9552;&#9559;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9553; X &#9553; O &#9553; O &#9553;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9568;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9571;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9553; O &#9553; X &#9553; X &#9553;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9568;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9571;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9553; X &#9553; O &#9553; X &#9553;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9562;&#9552;&#9552;&#9552;&#9577;&#9552;&#9552;&#9552;&#9577;&#9552;&#9552;&#9552;&#9565;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">Alice sees the final board:</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9556;&#9552;&#9552;&#9552;&#9574;&#9552;&#9552;&#9552;&#9574;&#9552;&#9552;&#9552;&#9559;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9553; X &#9553; O &#9553; O &#9553;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9568;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9571;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9553; O &#9553; X &#9553; X &#9553;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9568;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9571;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9553; X &#9553; O &#9553; X &#9553;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9562;&#9552;&#9552;&#9552;&#9577;&#9552;&#9552;&#9552;&#9577;&#9552;&#9552;&#9552;&#9565;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">Alice went from 1000 to 1002.8124.</span></p></td></tr><tr><td><p><span class="stt">Bob went from 1000 to 997.1874.</span></p></td></tr><tr><td><p><span class="stt">Done!</span></p></td></tr></table></p><p>Now that our game is fully implemented, however, it turns out there is a fatal flaw in it! Read the <a href="tic-tac-5.html" data-pltdoc="x">next section</a> to find out why.</p><p><a href="index.html" data-pltdoc="x">Main menu</a></p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="tic-tac-2.html" title="backward to &quot;3 Tic-Tac-Toe&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Pay-To-Play Tic-Tac-Toe Tutorial&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tic-tac-5.html" title="forward to &quot;5 Timeouts and Participation&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>