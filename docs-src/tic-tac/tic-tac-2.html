<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>3&nbsp;Tic-Tac-Toe</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Pay-<wbr></wbr>To-<wbr></wbr>Play Tic-<wbr></wbr>Tac-<wbr></wbr>Toe Tutorial</a></td></tr></table></div><div class="tocviewsublistonly" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="tic-tac-0.html" class="tocviewlink" data-pltdoc="x">Install and Initialize</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="tic-tac-1.html" class="tocviewlink" data-pltdoc="x">Scaffolding and Setup</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Tic-<wbr></wbr>Tac-<wbr></wbr>Toe</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="tic-tac-3.html" class="tocviewlink" data-pltdoc="x">Pay-<wbr></wbr>to-<wbr></wbr>Play</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="tic-tac-5.html" class="tocviewlink" data-pltdoc="x">Timeouts and Participation</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="tic-tac-6.html" class="tocviewlink" data-pltdoc="x">Interaction and Independence</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="tic-tac-7.html" class="tocviewlink" data-pltdoc="x">Web Interaction</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="algo.html" class="tocviewlink" data-pltdoc="x">Running on Algorand</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="trouble.html" class="tocviewlink" data-pltdoc="x">Troubleshooting</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="tic-tac-1.html" title="backward to &quot;2 Scaffolding and Setup&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Pay-To-Play Tic-Tac-Toe Tutorial&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tic-tac-3.html" title="forward to &quot;4 Pay-to-Play&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>3<tt>&nbsp;</tt><a name="(part._tic-tac-2)"></a>Tic-Tac-Toe</h3><p>In this section, we&rsquo;ll have Alice and Bob actually execute the game of Tic-Tac-Toe.</p><p>Alice will always be X and Bob will always be O.</p><p>We have to decide how to represent the hands of the game.</p><p>The first step is to add the global variables for the Tic-Tac-Toe implementation in the Reach program.
First, we&rsquo;ll add the board variables.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-2/index.rsh#L4-L15"><span class="stt">tic-tac-2/index.rsh</span></a><button class="btn" data-clipboard-text="const CELLS = 9;
const Board = Array(Bool, CELLS);
const State = Object({ xsTurn: Bool,
                       xs: Board,
                       os: Board });

const boardMt = Array.replicate(9, false);

const tttInitial = (XisFirst) =&gt;
      ({ xsTurn: XisFirst,
         xs: boardMt,
         os: boardMt });"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
 <span class="mi">4</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">CELLS</span></font> <font class="badlink"><span class="o">=</span></font> <span class="mi">9</span><span class="p">;</span>
 <span class="mi">5</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">Board</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nb">Array</span></font><span class="p">(</span><font class="badlink"><span class="nb">Bool</span></font><span class="p">,</span> <font class="badlink"><span class="nx">CELLS</span></font><span class="p">);</span>
 <span class="mi">6</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">State</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nb">Object</span></font><span class="p">({</span> <font class="badlink"><span class="nx">xsTurn</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nb">Bool</span></font><span class="p">,</span>
 <span class="mi">7</span>                         <font class="badlink"><span class="nx">xs</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">Board</span></font><span class="p">,</span>
 <span class="mi">8</span>                         <font class="badlink"><span class="nx">os</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">Board</span></font> <span class="p">});</span>
 <span class="mi">9</span>    
<span class="mi">10</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">boardMt</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nb">Array</span></font><span class="p">.</span><font class="badlink"><span class="nx">replicate</span></font><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <font class="badlink"><span class="kc">false</span></font><span class="p">);</span>
<span class="mi">11</span>    
<span class="mi">12</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">tttInitial</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">XisFirst</span></font><span class="p">)</span> <font class="badlink"><span class="o">=&gt;</span></font>
<span class="mi">13</span>        <span class="p">({</span> <font class="badlink"><span class="nx">xsTurn</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">XisFirst</span></font><span class="p">,</span>
<span class="mi">14</span>           <font class="badlink"><span class="nx">xs</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">boardMt</span></font><span class="p">,</span>
<span class="mi">15</span>           <font class="badlink"><span class="nx">os</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">boardMt</span></font> <span class="p">});</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 5 defines the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">Board</span><span class="hspace"></span></span> template.</p></li><li><p>Line 4 defines the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">State</span><span class="hspace"></span></span> template.</p></li><li><p>Line 10 actually makes the board <span class="RktInBG"><span class="hspace"></span><span class="RktIn">Array</span><span class="hspace"></span></span>, or matrix.</p></li><li><p>Line 12 returns the finite state machine of the game, including two boards and whose turn it is.</p></li></ul><p>Next, we&rsquo;ll add a few of the winning functions.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-2/index.rsh#L17-L48"><span class="stt">tic-tac-2/index.rsh</span></a><button class="btn" data-clipboard-text="const occupied_cell = (st, i) =&gt; (st.xs[i] || st.os[i]);

const occupied_matrix = (st) =&gt; Array.iota(9).map(i =&gt; occupied_cell(st, i));

const wins = (b) =&gt;
    (
    // horizontal
    ((b[0] &amp;&amp; b[1] &amp;&amp; b[2]) ? 1:0) 
    +((b[3] &amp;&amp; b[4] &amp;&amp; b[5]) ? 1:0)
    +((b[6] &amp;&amp; b[7] &amp;&amp; b[8]) ? 1:0)
    // vertical
    +((b[0] &amp;&amp; b[3] &amp;&amp; b[6]) ? 1:0)
    +((b[1] &amp;&amp; b[4] &amp;&amp; b[7]) ? 1:0)
    +((b[2] &amp;&amp; b[5] &amp;&amp; b[8]) ? 1:0)
    // diagonal
    +((b[0] &amp;&amp; b[4] &amp;&amp; b[8]) ? 1:0) 
    +((b[2] &amp;&amp; b[4] &amp;&amp; b[6]) ? 1:0)
    )

// true if there is a winner
const winner = (b) =&gt; wins(b) &gt; 0

const winner_is_x = ( st ) =&gt; winner(st.xs);
const winner_is_o = ( st ) =&gt; winner(st.os);

// Check if the game was a draw, aka the state is full
const draw = (board) =&gt; board.and();

const game_over = (st) =&gt;
      (winner(st.xs)
       || winner(st.os)
       || draw(occupied_matrix(st)));"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">17</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">occupied_cell</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">,</span> <font class="badlink"><span class="nx">i</span></font><span class="p">)</span> <font class="badlink"><span class="o">=&gt;</span></font> <span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">.</span><font class="badlink"><span class="nx">xs</span></font><span class="p">[</span><font class="badlink"><span class="nx">i</span></font><span class="p">]</span> <font class="badlink"><span class="o">||</span></font> <font class="badlink"><span class="nx">st</span></font><span class="p">.</span><font class="badlink"><span class="nx">os</span></font><span class="p">[</span><font class="badlink"><span class="nx">i</span></font><span class="p">]);</span>
<span class="mi">18</span>    
<span class="mi">19</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">occupied_matrix</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">)</span> <font class="badlink"><span class="o">=&gt;</span></font> <font class="badlink"><span class="nb">Array</span></font><span class="p">.</span><font class="badlink"><span class="nx">iota</span></font><span class="p">(</span><span class="mi">9</span><span class="p">).</span><font class="badlink"><span class="nx">map</span></font><span class="p">(</span><font class="badlink"><span class="nx">i</span></font> <font class="badlink"><span class="o">=&gt;</span></font> <font class="badlink"><span class="nx">occupied_cell</span></font><span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">,</span> <font class="badlink"><span class="nx">i</span></font><span class="p">));</span>
<span class="mi">20</span>    
<span class="mi">21</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">wins</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">b</span></font><span class="p">)</span> <font class="badlink"><span class="o">=&gt;</span></font>
<span class="mi">22</span>      <span class="p">(</span>
<span class="mi">23</span>      <span class="c1">// horizontal</span>
<span class="mi">24</span>      <span class="p">((</span><font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <font class="badlink"><span class="o">?</span></font> <span class="mi">1</span><font class="badlink"><span class="o">:</span></font><span class="mi">0</span><span class="p">)</span> 
<span class="mi">25</span>      <font class="badlink"><span class="o">+</span></font><span class="p">((</span><font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <font class="badlink"><span class="o">?</span></font> <span class="mi">1</span><font class="badlink"><span class="o">:</span></font><span class="mi">0</span><span class="p">)</span>
<span class="mi">26</span>      <font class="badlink"><span class="o">+</span></font><span class="p">((</span><font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">8</span><span class="p">])</span> <font class="badlink"><span class="o">?</span></font> <span class="mi">1</span><font class="badlink"><span class="o">:</span></font><span class="mi">0</span><span class="p">)</span>
<span class="mi">27</span>      <span class="c1">// vertical</span>
<span class="mi">28</span>      <font class="badlink"><span class="o">+</span></font><span class="p">((</span><font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <font class="badlink"><span class="o">?</span></font> <span class="mi">1</span><font class="badlink"><span class="o">:</span></font><span class="mi">0</span><span class="p">)</span>
<span class="mi">29</span>      <font class="badlink"><span class="o">+</span></font><span class="p">((</span><font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">7</span><span class="p">])</span> <font class="badlink"><span class="o">?</span></font> <span class="mi">1</span><font class="badlink"><span class="o">:</span></font><span class="mi">0</span><span class="p">)</span>
<span class="mi">30</span>      <font class="badlink"><span class="o">+</span></font><span class="p">((</span><font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">8</span><span class="p">])</span> <font class="badlink"><span class="o">?</span></font> <span class="mi">1</span><font class="badlink"><span class="o">:</span></font><span class="mi">0</span><span class="p">)</span>
<span class="mi">31</span>      <span class="c1">// diagonal</span>
<span class="mi">32</span>      <font class="badlink"><span class="o">+</span></font><span class="p">((</span><font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">8</span><span class="p">])</span> <font class="badlink"><span class="o">?</span></font> <span class="mi">1</span><font class="badlink"><span class="o">:</span></font><span class="mi">0</span><span class="p">)</span> 
<span class="mi">33</span>      <font class="badlink"><span class="o">+</span></font><span class="p">((</span><font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">b</span></font><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <font class="badlink"><span class="o">?</span></font> <span class="mi">1</span><font class="badlink"><span class="o">:</span></font><span class="mi">0</span><span class="p">)</span>
<span class="mi">34</span>      <span class="p">)</span>
<span class="mi">35</span>    
<span class="mi">36</span>    <span class="c1">// true if there is a winner</span>
<span class="mi">37</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">winner</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">b</span></font><span class="p">)</span> <font class="badlink"><span class="o">=&gt;</span></font> <font class="badlink"><span class="nx">wins</span></font><span class="p">(</span><font class="badlink"><span class="nx">b</span></font><span class="p">)</span> <font class="badlink"><span class="o">&gt;</span></font> <span class="mi">0</span>
<span class="mi">38</span>    
<span class="mi">39</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">winner_is_x</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span> <font class="badlink"><span class="nx">st</span></font> <span class="p">)</span> <font class="badlink"><span class="o">=&gt;</span></font> <font class="badlink"><span class="nx">winner</span></font><span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">.</span><font class="badlink"><span class="nx">xs</span></font><span class="p">);</span>
<span class="mi">40</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">winner_is_o</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span> <font class="badlink"><span class="nx">st</span></font> <span class="p">)</span> <font class="badlink"><span class="o">=&gt;</span></font> <font class="badlink"><span class="nx">winner</span></font><span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">.</span><font class="badlink"><span class="nx">os</span></font><span class="p">);</span>
<span class="mi">41</span>    
<span class="mi">42</span>    <span class="c1">// Check if the game was a draw, aka the state is full</span>
<span class="mi">43</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">draw</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">board</span></font><span class="p">)</span> <font class="badlink"><span class="o">=&gt;</span></font> <font class="badlink"><span class="nx">board</span></font><span class="p">.</span><font class="badlink"><span class="nb">and</span></font><span class="p">();</span>
<span class="mi">44</span>    
<span class="mi">45</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">game_over</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">)</span> <font class="badlink"><span class="o">=&gt;</span></font>
<span class="mi">46</span>        <span class="p">(</span><font class="badlink"><span class="nx">winner</span></font><span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">.</span><font class="badlink"><span class="nx">xs</span></font><span class="p">)</span>
<span class="mi">47</span>         <font class="badlink"><span class="o">||</span></font> <font class="badlink"><span class="nx">winner</span></font><span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">.</span><font class="badlink"><span class="nx">os</span></font><span class="p">)</span>
<span class="mi">48</span>         <font class="badlink"><span class="o">||</span></font> <font class="badlink"><span class="nx">draw</span></font><span class="p">(</span><font class="badlink"><span class="nx">occupied_matrix</span></font><span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">)));</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 17 defines the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">occupied_cell</span><span class="hspace"></span></span> function, which finds out if a given place on the board is occupied.</p></li><li><p>Line 19 defines the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">occupied_matrix</span><span class="hspace"></span></span> function, which returns a matrix of all of the occupied places.</p></li><li><p>Lines 21-34 check if there is a winner, or a three-in-a-row in any possible direction.</p></li><li><p>The function on line 37 returns true if there is a winner on the given board.</p></li><li><p>The function on line 39 returns true if X won.</p></li><li><p>The function on line 40 returns true if O won.</p></li><li><p>The function on line 43 returns true if the board is full.</p></li><li><p>The function on lines 45-48 returns true if the game is over because someone won or a draw occurred.</p></li></ul><p>Once that is done, we&rsquo;ll add the functions used for making moves.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-2/index.rsh#L50-L65"><span class="stt">tic-tac-2/index.rsh</span></a><button class="btn" data-clipboard-text="const is_legal = (m) =&gt; (0 &lt;= m &amp;&amp; m &lt; CELLS);
const is_valid = (st, m) =&gt; (! occupied_cell(st, m));

function getValidMove(interact, st) {
  const _m = interact.getMove(st);
  assume(is_legal(_m));
  assume(is_valid(st, _m));
  return declassify(_m); }

function applyMove(st, m) {
  require(is_legal(m));
  require(is_valid(st, m));
  const turn = st.xsTurn;
  return { xsTurn: ! turn,
           xs: (turn ? st.xs.set(m, true) : st.xs),
           os: (turn ? st.os : st.os.set(m, true)) }; }"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">50</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">is_legal</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">m</span></font><span class="p">)</span> <font class="badlink"><span class="o">=&gt;</span></font> <span class="p">(</span><span class="mi">0</span> <font class="badlink"><span class="o">&lt;=</span></font> <font class="badlink"><span class="nx">m</span></font> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">m</span></font> <font class="badlink"><span class="o">&lt;</span></font> <font class="badlink"><span class="nx">CELLS</span></font><span class="p">);</span>
<span class="mi">51</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">is_valid</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">,</span> <font class="badlink"><span class="nx">m</span></font><span class="p">)</span> <font class="badlink"><span class="o">=&gt;</span></font> <span class="p">(</span><font class="badlink"><span class="o">!</span></font> <font class="badlink"><span class="nx">occupied_cell</span></font><span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">,</span> <font class="badlink"><span class="nx">m</span></font><span class="p">));</span>
<span class="mi">52</span>    
<span class="mi">53</span>    <font class="badlink"><span class="kd">function</span></font> <font class="badlink"><span class="nx">getValidMove</span></font><span class="p">(</span><font class="badlink"><span class="k">interact</span></font><span class="p">,</span> <font class="badlink"><span class="nx">st</span></font><span class="p">)</span> <span class="p">{</span>
<span class="mi">54</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">_m</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="k">interact</span></font><span class="p">.</span><font class="badlink"><span class="nx">getMove</span></font><span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">);</span>
<span class="mi">55</span>    <font class="badlink"><span class="k">assume</span></font><span class="p">(</span><font class="badlink"><span class="nx">is_legal</span></font><span class="p">(</span><font class="badlink"><span class="nx">_m</span></font><span class="p">));</span>
<span class="mi">56</span>    <font class="badlink"><span class="k">assume</span></font><span class="p">(</span><font class="badlink"><span class="nx">is_valid</span></font><span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">,</span> <font class="badlink"><span class="nx">_m</span></font><span class="p">));</span>
<span class="mi">57</span>    <font class="badlink"><span class="k">return</span></font> <font class="badlink"><span class="k">declassify</span></font><span class="p">(</span><font class="badlink"><span class="nx">_m</span></font><span class="p">);</span> <span class="p">}</span>
<span class="mi">58</span>    
<span class="mi">59</span>    <font class="badlink"><span class="kd">function</span></font> <font class="badlink"><span class="nx">applyMove</span></font><span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">,</span> <font class="badlink"><span class="nx">m</span></font><span class="p">)</span> <span class="p">{</span>
<span class="mi">60</span>    <font class="badlink"><span class="k">require</span></font><span class="p">(</span><font class="badlink"><span class="nx">is_legal</span></font><span class="p">(</span><font class="badlink"><span class="nx">m</span></font><span class="p">));</span>
<span class="mi">61</span>    <font class="badlink"><span class="k">require</span></font><span class="p">(</span><font class="badlink"><span class="nx">is_valid</span></font><span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">,</span> <font class="badlink"><span class="nx">m</span></font><span class="p">));</span>
<span class="mi">62</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">turn</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">st</span></font><span class="p">.</span><font class="badlink"><span class="nx">xsTurn</span></font><span class="p">;</span>
<span class="mi">63</span>    <font class="badlink"><span class="k">return</span></font> <span class="p">{</span> <font class="badlink"><span class="nx">xsTurn</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="o">!</span></font> <font class="badlink"><span class="nx">turn</span></font><span class="p">,</span>
<span class="mi">64</span>             <font class="badlink"><span class="nx">xs</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">(</span><font class="badlink"><span class="nx">turn</span></font> <font class="badlink"><span class="o">?</span></font> <font class="badlink"><span class="nx">st</span></font><span class="p">.</span><font class="badlink"><span class="nx">xs</span></font><span class="p">.</span><font class="badlink"><span class="nx">set</span></font><span class="p">(</span><font class="badlink"><span class="nx">m</span></font><span class="p">,</span> <font class="badlink"><span class="kc">true</span></font><span class="p">)</span> <font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">st</span></font><span class="p">.</span><font class="badlink"><span class="nx">xs</span></font><span class="p">),</span>
<span class="mi">65</span>             <font class="badlink"><span class="nx">os</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">(</span><font class="badlink"><span class="nx">turn</span></font> <font class="badlink"><span class="o">?</span></font> <font class="badlink"><span class="nx">st</span></font><span class="p">.</span><font class="badlink"><span class="nx">os</span></font> <font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">st</span></font><span class="p">.</span><font class="badlink"><span class="nx">os</span></font><span class="p">.</span><font class="badlink"><span class="nx">set</span></font><span class="p">(</span><font class="badlink"><span class="nx">m</span></font><span class="p">,</span> <font class="badlink"><span class="kc">true</span></font><span class="p">))</span> <span class="p">};</span> <span class="p">}</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 50 defines the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">is_legal</span><span class="hspace"></span></span> function, which makes sure that a given place on the board is within the boundaries of the board.</p></li><li><p>Line 51 defines the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">is_valid</span><span class="hspace"></span></span> function, which returns true if the given move is not occupied.</p></li><li><p>Lines 53-57 get a move from the JS, check if it is valid and legal, and return it.</p></li><li><p>Lines 59-65 return an updated state if the given move was valid and legal.</p></li></ul><p>Now, we will change the Reach program to specify that Alice and Bob&rsquo;s frontends can be interacted with to get the move that they will play, and later informed of the outcome of the game.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-2/index.rsh#L68-L84"><span class="stt">tic-tac-2/index.rsh</span></a><button class="btn" data-clipboard-text="
const Player =
      { ...hasRandom,
        getMove: Fun([State], UInt),
        endsWith: Fun([State], Null) };
const Alice =
      { ...Player,
        getWager: Fun([], UInt) };
const Bob =
      { ...Player,
        acceptWager: Fun([UInt], Null) };

export const main =
  Reach.App(
    {},
    [Participant('A', Alice), Participant('B', Bob)],
    (A, B) =&gt; {"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">68</span>    
<span class="mi">69</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">Player</span></font> <font class="badlink"><span class="o">=</span></font>
<span class="mi">70</span>    <span class="p">{</span> <span class="p">...</span><font class="badlink"><span class="nb">hasRandom</span></font><span class="p">,</span>
<span class="mi">71</span>      <font class="badlink"><span class="nx">getMove</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nb">Fun</span></font><span class="p">([</span><font class="badlink"><span class="nx">State</span></font><span class="p">],</span> <font class="badlink"><span class="nb">UInt</span></font><span class="p">),</span>
<span class="mi">72</span>      <font class="badlink"><span class="nx">endsWith</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nb">Fun</span></font><span class="p">([</span><font class="badlink"><span class="nx">State</span></font><span class="p">],</span> <font class="badlink"><span class="nb">Null</span></font><span class="p">)</span> <span class="p">};</span>
<span class="mi">73</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">Alice</span></font> <font class="badlink"><span class="o">=</span></font>
<span class="mi">74</span>    <span class="p">{</span> <span class="p">...</span><font class="badlink"><span class="nx">Player</span></font><span class="p">,</span>
<span class="mi">75</span>      <font class="badlink"><span class="nx">getWager</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nb">Fun</span></font><span class="p">([],</span> <font class="badlink"><span class="nb">UInt</span></font><span class="p">)</span> <span class="p">};</span>
<span class="mi">76</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">Bob</span></font> <font class="badlink"><span class="o">=</span></font>
<span class="mi">77</span>    <span class="p">{</span> <span class="p">...</span><font class="badlink"><span class="nx">Player</span></font><span class="p">,</span>
<span class="mi">78</span>      <font class="badlink"><span class="nx">acceptWager</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nb">Fun</span></font><span class="p">([</span><font class="badlink"><span class="nb">UInt</span></font><span class="p">],</span> <font class="badlink"><span class="nb">Null</span></font><span class="p">)</span> <span class="p">};</span>
<span class="mi">79</span>    
<span class="mi">80</span>    <font class="badlink"><span class="kd">export</span></font> <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">main</span></font> <font class="badlink"><span class="o">=</span></font>
<span class="mi">81</span>      <font class="badlink"><span class="nb">Reach</span></font><span class="p">.</span><font class="badlink"><span class="nb">App</span></font><span class="p">(</span>
<span class="mi">82</span>        <span class="p">{},</span>
<span class="mi">83</span>        <span class="p">[</span><font class="badlink"><span class="nb">Participant</span></font><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <font class="badlink"><span class="nx">Alice</span></font><span class="p">),</span> <font class="badlink"><span class="nb">Participant</span></font><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <font class="badlink"><span class="nx">Bob</span></font><span class="p">)],</span>
<span class="mi">84</span>        <span class="p">(</span><font class="badlink"><span class="nx">A</span></font><span class="p">,</span> <font class="badlink"><span class="nx">B</span></font><span class="p">)</span> <font class="badlink"><span class="o">=&gt;</span></font> <span class="p">{</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Lines 69 through 78 define <font class="badlink"><span class="techoutside"><span class="techinside">participant interact interfaces</span></span></font> that the two players will use.</p></li><li><p>Line 83 uses this interface for both participants.</p></li></ul><p>Before continuing with the Reach application, let&rsquo;s move over to the JavaScript interface and add the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">render</span><span class="hspace"></span></span> function.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-2/index.mjs#L6-L23"><span class="stt">tic-tac-2/index.mjs</span></a><button class="btn" data-clipboard-text="function render(st) {

    let o = &quot;\n\t╔═══╦═══╦═══╗\n\t║&quot;;
    for (let i = 0; i &lt; 9; i++) {
        if (st.xs[i] == 1) {
            o += &quot; X &quot;;
        } else if (st.os[i] == 1) {
            o += &quot; O &quot;;
        } else {
            o += &quot;   &quot;;
        }
        if (i != 8) {
            o += i % 3 == 2 ? &quot;║\n\t╠═══╬═══╬═══╣\n\t║&quot; : &quot;║&quot;;
        }
    }
    o += &quot;║\n\t╚═══╩═══╩═══╝\n&quot;;
    return o;
}"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
 <span class="mi">6</span>    <font class="badlink"><span class="kd">function</span></font> <font class="badlink"><span class="nx">render</span></font><span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">)</span> <span class="p">{</span>
 <span class="mi">7</span>    
 <span class="mi">8</span>      <font class="badlink"><span class="kd">let</span></font> <font class="badlink"><span class="nx">o</span></font> <font class="badlink"><span class="o">=</span></font> <span class="s2">"\n\t&#9556;&#9552;&#9552;&#9552;&#9574;&#9552;&#9552;&#9552;&#9574;&#9552;&#9552;&#9552;&#9559;\n\t&#9553;"</span><span class="p">;</span>
 <span class="mi">9</span>      <font class="badlink"><span class="k">for</span></font> <span class="p">(</span><font class="badlink"><span class="kd">let</span></font> <font class="badlink"><span class="nx">i</span></font> <font class="badlink"><span class="o">=</span></font> <span class="mi">0</span><span class="p">;</span> <font class="badlink"><span class="nx">i</span></font> <font class="badlink"><span class="o">&lt;</span></font> <span class="mi">9</span><span class="p">;</span> <font class="badlink"><span class="nx">i</span></font><font class="badlink"><span class="o">++</span></font><span class="p">)</span> <span class="p">{</span>
<span class="mi">10</span>          <font class="badlink"><span class="k">if</span></font> <span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">.</span><font class="badlink"><span class="nx">xs</span></font><span class="p">[</span><font class="badlink"><span class="nx">i</span></font><span class="p">]</span> <font class="badlink"><span class="o">==</span></font> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
<span class="mi">11</span>              <font class="badlink"><span class="nx">o</span></font> <font class="badlink"><span class="o">+=</span></font> <span class="s2">" X "</span><span class="p">;</span>
<span class="mi">12</span>          <span class="p">}</span> <font class="badlink"><span class="k">else</span></font> <font class="badlink"><span class="k">if</span></font> <span class="p">(</span><font class="badlink"><span class="nx">st</span></font><span class="p">.</span><font class="badlink"><span class="nx">os</span></font><span class="p">[</span><font class="badlink"><span class="nx">i</span></font><span class="p">]</span> <font class="badlink"><span class="o">==</span></font> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
<span class="mi">13</span>              <font class="badlink"><span class="nx">o</span></font> <font class="badlink"><span class="o">+=</span></font> <span class="s2">" O "</span><span class="p">;</span>
<span class="mi">14</span>          <span class="p">}</span> <font class="badlink"><span class="k">else</span></font> <span class="p">{</span>
<span class="mi">15</span>              <font class="badlink"><span class="nx">o</span></font> <font class="badlink"><span class="o">+=</span></font> <span class="s2">"   "</span><span class="p">;</span>
<span class="mi">16</span>          <span class="p">}</span>
<span class="mi">17</span>          <font class="badlink"><span class="k">if</span></font> <span class="p">(</span><font class="badlink"><span class="nx">i</span></font> <font class="badlink"><span class="o">!=</span></font> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
<span class="mi">18</span>              <font class="badlink"><span class="nx">o</span></font> <font class="badlink"><span class="o">+=</span></font> <font class="badlink"><span class="nx">i</span></font> <font class="badlink"><span class="o">%</span></font> <span class="mi">3</span> <font class="badlink"><span class="o">==</span></font> <span class="mi">2</span> <font class="badlink"><span class="o">?</span></font> <span class="s2">"&#9553;\n\t&#9568;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9571;\n\t&#9553;"</span> <font class="badlink"><span class="o">:</span></font> <span class="s2">"&#9553;"</span><span class="p">;</span>
<span class="mi">19</span>          <span class="p">}</span>
<span class="mi">20</span>      <span class="p">}</span>
<span class="mi">21</span>      <font class="badlink"><span class="nx">o</span></font> <font class="badlink"><span class="o">+=</span></font> <span class="s2">"&#9553;\n\t&#9562;&#9552;&#9552;&#9552;&#9577;&#9552;&#9552;&#9552;&#9577;&#9552;&#9552;&#9552;&#9565;\n"</span><span class="p">;</span>
<span class="mi">22</span>      <font class="badlink"><span class="k">return</span></font> <font class="badlink"><span class="nx">o</span></font><span class="p">;</span>
<span class="mi">23</span>    <span class="p">}</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 8 adds the top of the board to the board text.</p></li><li><p><div class="SIntrapara">Line 9 sets up a 0-8 for loop. </div><div class="SIntrapara"><ul><li><p>If the current item is an x, line 10 adds an X to the board text.</p></li><li><p>If the current item is an o, line 12 adds an O to the board text.</p></li><li><p>Otherwise, line 15 adds whitespace to the board text.</p></li><li><p>If the row is complete, line 18 adds a divider to the board text.</p></li></ul></div></p></li><li><p>Line 21 adds the bottom of the board to the board text.</p></li><li><p>Line 22 returns the board text.</p></li></ul><p>Then, let&rsquo;s add some wagering related variables to our frontend.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-2/index.mjs#L35-L39"><span class="stt">tic-tac-2/index.mjs</span></a><button class="btn" data-clipboard-text="  const wagerAmount = stdlib.parseCurrency(5);
  const getBalance = async (who) =&gt; (await stdlib.balanceOf(who)) / 10 ** 18;
  const startAlice = await getBalance(alice);
  const startBob = await getBalance(bob);
  const dispAmt = (x) =&gt; `${stdlib.formatCurrency(x)} ${stdlib.standardUnit}`;"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">35</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">wagerAmount</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">stdlib</span></font><span class="p">.</span><font class="badlink"><span class="nx">parseCurrency</span></font><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="mi">36</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">getBalance</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">async</span></font> <span class="p">(</span><font class="badlink"><span class="nx">who</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">(</span><font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">stdlib</span></font><span class="p">.</span><font class="badlink"><span class="nx">balanceOf</span></font><span class="p">(</span><font class="badlink"><span class="nx">who</span></font><span class="p">))</span> <font class="badlink"><span class="o">/</span></font> <span class="mi">10</span> <font class="badlink"><span class="o">**</span></font> <span class="mi">18</span><span class="p">;</span>
<span class="mi">37</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">startAlice</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">getBalance</span></font><span class="p">(</span><font class="badlink"><span class="nx">alice</span></font><span class="p">);</span>
<span class="mi">38</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">startBob</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">getBalance</span></font><span class="p">(</span><font class="badlink"><span class="nx">bob</span></font><span class="p">);</span>
<span class="mi">39</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">dispAmt</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">x</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">stdlib</span></font><span class="p">.</span><font class="badlink"><span class="nx">formatCurrency</span></font><span class="p">(</span><font class="badlink"><span class="nx">x</span></font><span class="p">)</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><font class="badlink"><span class="nx">stdlib</span></font><span class="p">.</span><font class="badlink"><span class="nx">standardUnit</span></font><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 35 creates the wager amount variable.</p></li><li><p>Line 36 defines a function to get the balance of a player.</p></li><li><p>Line 37-38 find the balance of both players.</p></li><li><p>Line 12 defines a function to pretty-print balances.</p></li></ul><p>Next, let&rsquo;s implement the methods described in our backend in the <font class="badlink"><span class="techoutside"><span class="techinside">frontend</span></span></font>.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-2/index.mjs#L41-L65"><span class="stt">tic-tac-2/index.mjs</span></a><button class="btn" data-clipboard-text="  const interactWith = (name) =&gt; ({
    ...stdlib.hasRandom,
    getWager: () =&gt; {
      console.log(`${name} publishes parameters of game: wager of ${dispAmt(wagerAmount)}`);
      return wagerAmount;
    },
    acceptWager: (givenWagerAmount) =&gt; {
      console.log(`${name} accepts parameters of game: wager of ${dispAmt(givenWagerAmount)}`);
    },
    getMove: (state) =&gt; {
      console.log(`${name} chooses a move from the state:${render(state)}`);
      const xs = state.xs;
      const os = state.os;
      while ( xs &amp;&amp; os ) {
        const i = Math.floor( Math.random() * 9 );
        if ( ! ( xs[i] || os[i] ) ) {
          return i;
        }
      }
      throw Error(`impossible to make a move`);
    },
    endsWith: (state) =&gt; {
      console.log(`${name} sees the final state: ${render(state)}`);
    },
  });"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">41</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">interactWith</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">name</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">({</span>
<span class="mi">42</span>      <span class="p">...</span><font class="badlink"><span class="nx">stdlib</span></font><span class="p">.</span><font class="badlink"><span class="nx">hasRandom</span></font><span class="p">,</span>
<span class="mi">43</span>      <font class="badlink"><span class="nx">getWager</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mi">44</span>        <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">name</span></font><span class="si">}</span><span class="sb"> publishes parameters of game: wager of </span><span class="si">${</span><font class="badlink"><span class="nx">dispAmt</span></font><span class="p">(</span><font class="badlink"><span class="nx">wagerAmount</span></font><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mi">45</span>        <font class="badlink"><span class="k">return</span></font> <font class="badlink"><span class="nx">wagerAmount</span></font><span class="p">;</span>
<span class="mi">46</span>      <span class="p">},</span>
<span class="mi">47</span>      <font class="badlink"><span class="nx">acceptWager</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">(</span><font class="badlink"><span class="nx">givenWagerAmount</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mi">48</span>        <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">name</span></font><span class="si">}</span><span class="sb"> accepts parameters of game: wager of </span><span class="si">${</span><font class="badlink"><span class="nx">dispAmt</span></font><span class="p">(</span><font class="badlink"><span class="nx">givenWagerAmount</span></font><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mi">49</span>      <span class="p">},</span>
<span class="mi">50</span>      <font class="badlink"><span class="nx">getMove</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">(</span><font class="badlink"><span class="nx">state</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mi">51</span>        <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">name</span></font><span class="si">}</span><span class="sb"> chooses a move from the state:</span><span class="si">${</span><font class="badlink"><span class="nx">render</span></font><span class="p">(</span><font class="badlink"><span class="nx">state</span></font><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mi">52</span>        <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">xs</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">state</span></font><span class="p">.</span><font class="badlink"><span class="nx">xs</span></font><span class="p">;</span>
<span class="mi">53</span>        <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">os</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">state</span></font><span class="p">.</span><font class="badlink"><span class="nx">os</span></font><span class="p">;</span>
<span class="mi">54</span>        <font class="badlink"><span class="k">while</span></font> <span class="p">(</span> <font class="badlink"><span class="nx">xs</span></font> <font class="badlink"><span class="o">&amp;&amp;</span></font> <font class="badlink"><span class="nx">os</span></font> <span class="p">)</span> <span class="p">{</span>
<span class="mi">55</span>          <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">i</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nb">Math</span></font><span class="p">.</span><font class="badlink"><span class="nx">floor</span></font><span class="p">(</span> <font class="badlink"><span class="nb">Math</span></font><span class="p">.</span><font class="badlink"><span class="nx">random</span></font><span class="p">()</span> <font class="badlink"><span class="o">*</span></font> <span class="mi">9</span> <span class="p">);</span>
<span class="mi">56</span>          <font class="badlink"><span class="k">if</span></font> <span class="p">(</span> <font class="badlink"><span class="o">!</span></font> <span class="p">(</span> <font class="badlink"><span class="nx">xs</span></font><span class="p">[</span><font class="badlink"><span class="nx">i</span></font><span class="p">]</span> <font class="badlink"><span class="o">||</span></font> <font class="badlink"><span class="nx">os</span></font><span class="p">[</span><font class="badlink"><span class="nx">i</span></font><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
<span class="mi">57</span>            <font class="badlink"><span class="k">return</span></font> <font class="badlink"><span class="nx">i</span></font><span class="p">;</span>
<span class="mi">58</span>          <span class="p">}</span>
<span class="mi">59</span>        <span class="p">}</span>
<span class="mi">60</span>        <font class="badlink"><span class="k">throw</span></font> <font class="badlink"><span class="nb">Error</span></font><span class="p">(</span><span class="sb">`impossible to make a move`</span><span class="p">);</span>
<span class="mi">61</span>      <span class="p">},</span>
<span class="mi">62</span>      <font class="badlink"><span class="nx">endsWith</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">(</span><font class="badlink"><span class="nx">state</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mi">63</span>        <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">name</span></font><span class="si">}</span><span class="sb"> sees the final state: </span><span class="si">${</span><font class="badlink"><span class="nx">render</span></font><span class="p">(</span><font class="badlink"><span class="nx">state</span></font><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mi">64</span>      <span class="p">},</span>
<span class="mi">65</span>    <span class="p">});</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 47 defines the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">interactWith</span><span class="hspace"></span></span> function.</p></li><li><p>Line 48 allows the reach program to use random.</p></li><li><p>Lines 49-52 define the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">getWager</span><span class="hspace"></span></span> function that returns the wager to the reach program.</p></li><li><p>Lines 53-55 define a function to allow Bob to accecept the wager.</p></li><li><p>Lines 56-70 define the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">getMove</span><span class="hspace"></span></span> function:</p><ul><li><p>Line 57 prints a message that the player has chosen a move.</p></li><li><p>Lines 58 and 59 localize the state.xs and state.os variables.</p></li><li><p>Line 60 sets up a while loop.</p></li><li><p>Line 61 gets a random move from 0-8 and stores it to <span class="RktInBG"><span class="hspace"></span><span class="RktIn">i</span><span class="hspace"></span></span>.</p></li><li><p>Lines 62-63 check if the move is valid (not occupied).</p></li><li><p>If the move is valid, line 63 returns the move.</p></li></ul></li><li><p>Line 68 defines the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">endsWith</span><span class="hspace"></span></span> function.</p></li><li><p>Line 69 prints the end state.</p></li></ul><p>After that, modify the interaction promises from line 66-75 to include <span class="RktInBG"><span class="hspace"></span><span class="RktIn">interactWith</span><span class="hspace"></span></span>.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-2/index.mjs#L67-L70"><span class="stt">tic-tac-2/index.mjs</span></a><button class="btn" data-clipboard-text="  await Promise.all([
    backend.A(ctcAlice, interactWith('Alice')),
    backend.B(ctcBob, interactWith('Bob')),
  ]);"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">67</span>    <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nb">Promise</span></font><span class="p">.</span><font class="badlink"><span class="nx">all</span></font><span class="p">([</span>
<span class="mi">68</span>      <font class="badlink"><span class="nx">backend</span></font><span class="p">.</span><font class="badlink"><span class="nx">A</span></font><span class="p">(</span><font class="badlink"><span class="nx">ctcAlice</span></font><span class="p">,</span> <font class="badlink"><span class="nx">interactWith</span></font><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">)),</span>
<span class="mi">69</span>      <font class="badlink"><span class="nx">backend</span></font><span class="p">.</span><font class="badlink"><span class="nx">B</span></font><span class="p">(</span><font class="badlink"><span class="nx">ctcBob</span></font><span class="p">,</span> <font class="badlink"><span class="nx">interactWith</span></font><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">)),</span>
<span class="mi">70</span>    <span class="p">]);</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>To finish off the JavaScript frontend, we will add a few <span class="RktInBG"><span class="hspace"></span><span class="RktIn">console.log()</span><span class="hspace"></span></span> statements to the end of the program.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-2/index.mjs#L72-L75"><span class="stt">tic-tac-2/index.mjs</span></a><button class="btn" data-clipboard-text="  console.log(`Alice went from ${startAlice} to ${await getBalance(accAlice)}`)
  console.log(`Bob went from ${startBob} to ${await getBalance(accBob)}`)
  console.log(`Done!`);
  process.exit(0);"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">72</span>    <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`Alice went from </span><span class="si">${</span><font class="badlink"><span class="nx">startAlice</span></font><span class="si">}</span><span class="sb"> to </span><span class="si">${</span><font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">getBalance</span></font><span class="p">(</span><font class="badlink"><span class="nx">accAlice</span></font><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="mi">73</span>    <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`Bob went from </span><span class="si">${</span><font class="badlink"><span class="nx">startBob</span></font><span class="si">}</span><span class="sb"> to </span><span class="si">${</span><font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">getBalance</span></font><span class="p">(</span><font class="badlink"><span class="nx">accBob</span></font><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="mi">74</span>    <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`Done!`</span><span class="p">);</span>
<span class="mi">75</span>    <font class="badlink"><span class="nx">process</span></font><span class="p">.</span><font class="badlink"><span class="nx">exit</span></font><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>There should be nothing interesting or controversial about these implementations; that&rsquo;s the point of Reach: we get to just write normal business logic without worrying about the details of the <font class="badlink"><span class="techoutside"><span class="techinside">consensus network</span></span></font> and decentralized application.</p><p>Now, let&rsquo;s go back to the Reach program and look inside of the body of the program for what actions Alice and Bob take.</p><p>First, both parties get a random number from 0-1 from the JavaScript:</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-2/index.rsh#L85-L104"><span class="stt">tic-tac-2/index.rsh</span></a><button class="btn" data-clipboard-text="      A.only(() =&gt; {
        const wagerAmount = declassify(interact.getWager());
        const _coinFlipA = interact.random();
        const commitA = declassify(digest(_coinFlipA)); });
      A.publish(wagerAmount, commitA)
        .pay(wagerAmount);
      commit();

      B.only(() =&gt; {
        interact.acceptWager(wagerAmount);
        const coinFlipB = declassify(interact.random()); });
      B.publish(coinFlipB)
        .pay(wagerAmount);
      commit();

      A.only(() =&gt; {
        const coinFlipA = declassify(_coinFlipA); });
      A.publish(coinFlipA);

      require(commitA == digest(coinFlipA));"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">85</span>    <font class="badlink"><span class="nx">A</span></font><span class="p">.</span><font class="badlink"><span class="k">only</span></font><span class="p">(()</span> <font class="badlink"><span class="o">=&gt;</span></font> <span class="p">{</span>
<span class="mi">86</span>      <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">wagerAmount</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="k">declassify</span></font><span class="p">(</span><font class="badlink"><span class="k">interact</span></font><span class="p">.</span><font class="badlink"><span class="nx">getWager</span></font><span class="p">());</span>
<span class="mi">87</span>      <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">_coinFlipA</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="k">interact</span></font><span class="p">.</span><font class="badlink"><span class="nx">random</span></font><span class="p">();</span>
<span class="mi">88</span>      <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">commitA</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="k">declassify</span></font><span class="p">(</span><font class="badlink"><span class="nb">digest</span></font><span class="p">(</span><font class="badlink"><span class="nx">_coinFlipA</span></font><span class="p">));</span> <span class="p">});</span>
<span class="mi">89</span>    <font class="badlink"><span class="nx">A</span></font><span class="p">.</span><font class="badlink"><span class="k">publish</span></font><span class="p">(</span><font class="badlink"><span class="nx">wagerAmount</span></font><span class="p">,</span> <font class="badlink"><span class="nx">commitA</span></font><span class="p">)</span>
<span class="mi">90</span>      <span class="p">.</span><font class="badlink"><span class="k">pay</span></font><span class="p">(</span><font class="badlink"><span class="nx">wagerAmount</span></font><span class="p">);</span>
<span class="mi">91</span>    <font class="badlink"><span class="k">commit</span></font><span class="p">();</span>
<span class="mi">92</span>    
<span class="mi">93</span>    <font class="badlink"><span class="nx">B</span></font><span class="p">.</span><font class="badlink"><span class="k">only</span></font><span class="p">(()</span> <font class="badlink"><span class="o">=&gt;</span></font> <span class="p">{</span>
<span class="mi">94</span>      <font class="badlink"><span class="k">interact</span></font><span class="p">.</span><font class="badlink"><span class="nx">acceptWager</span></font><span class="p">(</span><font class="badlink"><span class="nx">wagerAmount</span></font><span class="p">);</span>
<span class="mi">95</span>      <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">coinFlipB</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="k">declassify</span></font><span class="p">(</span><font class="badlink"><span class="k">interact</span></font><span class="p">.</span><font class="badlink"><span class="nx">random</span></font><span class="p">());</span> <span class="p">});</span>
<span class="mi">96</span>    <font class="badlink"><span class="nx">B</span></font><span class="p">.</span><font class="badlink"><span class="k">publish</span></font><span class="p">(</span><font class="badlink"><span class="nx">coinFlipB</span></font><span class="p">)</span>
<span class="mi">97</span>      <span class="p">.</span><font class="badlink"><span class="k">pay</span></font><span class="p">(</span><font class="badlink"><span class="nx">wagerAmount</span></font><span class="p">);</span>
<span class="mi">98</span>    <font class="badlink"><span class="k">commit</span></font><span class="p">();</span>
<span class="mi">99</span>    
<span class="mi">100</span>    <font class="badlink"><span class="nx">A</span></font><span class="p">.</span><font class="badlink"><span class="k">only</span></font><span class="p">(()</span> <font class="badlink"><span class="o">=&gt;</span></font> <span class="p">{</span>
<span class="mi">101</span>      <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">coinFlipA</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="k">declassify</span></font><span class="p">(</span><font class="badlink"><span class="nx">_coinFlipA</span></font><span class="p">);</span> <span class="p">});</span>
<span class="mi">102</span>    <font class="badlink"><span class="nx">A</span></font><span class="p">.</span><font class="badlink"><span class="k">publish</span></font><span class="p">(</span><font class="badlink"><span class="nx">coinFlipA</span></font><span class="p">);</span>
<span class="mi">103</span>    
<span class="mi">104</span>    <font class="badlink"><span class="k">require</span></font><span class="p">(</span><font class="badlink"><span class="nx">commitA</span></font> <font class="badlink"><span class="o">==</span></font> <font class="badlink"><span class="nb">digest</span></font><span class="p">(</span><font class="badlink"><span class="nx">coinFlipA</span></font><span class="p">));</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>Then, the reach script calculates the player to go first:</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-2/index.rsh#L105-L105"><span class="stt">tic-tac-2/index.rsh</span></a><button class="btn" data-clipboard-text="      const XisFirst = (((coinFlipA % 2) + (coinFlipB % 2)) % 2) == 0;"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">105</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">XisFirst</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(((</span><font class="badlink"><span class="nx">coinFlipA</span></font> <font class="badlink"><span class="o">%</span></font> <span class="mi">2</span><span class="p">)</span> <font class="badlink"><span class="o">+</span></font> <span class="p">(</span><font class="badlink"><span class="nx">coinFlipB</span></font> <font class="badlink"><span class="o">%</span></font> <span class="mi">2</span><span class="p">))</span> <font class="badlink"><span class="o">%</span></font> <span class="mi">2</span><span class="p">)</span> <font class="badlink"><span class="o">==</span></font> <span class="mi">0</span><span class="p">;</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>The game proceeds in two ongoing steps.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-2/index.rsh#L107-L127"><span class="stt">tic-tac-2/index.rsh</span></a><button class="btn" data-clipboard-text="      var state = tttInitial(XisFirst);
      invariant(balance() == (2 * wagerAmount));
      while ( ! game_over(state) ) {
        if ( state.xsTurn ) {
          commit();

          A.only(() =&gt; {
            const moveA = getValidMove(interact, state); });
          A.publish(moveA);

          state = applyMove(state, moveA);
          continue; }
        else {
          commit();

          B.only(() =&gt; {
            const moveB = getValidMove(interact, state); });
          B.publish(moveB);

          state = applyMove(state, moveB);
          continue; } }"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">107</span>    <font class="badlink"><span class="kd">var</span></font> <font class="badlink"><span class="nx">state</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">tttInitial</span></font><span class="p">(</span><font class="badlink"><span class="nx">XisFirst</span></font><span class="p">);</span>
<span class="mi">108</span>    <font class="badlink"><span class="k">invariant</span></font><span class="p">(</span><font class="badlink"><span class="nb">balance</span></font><span class="p">()</span> <font class="badlink"><span class="o">==</span></font> <span class="p">(</span><span class="mi">2</span> <font class="badlink"><span class="o">*</span></font> <font class="badlink"><span class="nx">wagerAmount</span></font><span class="p">));</span>
<span class="mi">109</span>    <font class="badlink"><span class="k">while</span></font> <span class="p">(</span> <font class="badlink"><span class="o">!</span></font> <font class="badlink"><span class="nx">game_over</span></font><span class="p">(</span><font class="badlink"><span class="nx">state</span></font><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
<span class="mi">110</span>      <font class="badlink"><span class="k">if</span></font> <span class="p">(</span> <font class="badlink"><span class="nx">state</span></font><span class="p">.</span><font class="badlink"><span class="nx">xsTurn</span></font> <span class="p">)</span> <span class="p">{</span>
<span class="mi">111</span>        <font class="badlink"><span class="k">commit</span></font><span class="p">();</span>
<span class="mi">112</span>    
<span class="mi">113</span>        <font class="badlink"><span class="nx">A</span></font><span class="p">.</span><font class="badlink"><span class="k">only</span></font><span class="p">(()</span> <font class="badlink"><span class="o">=&gt;</span></font> <span class="p">{</span>
<span class="mi">114</span>          <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">moveA</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">getValidMove</span></font><span class="p">(</span><font class="badlink"><span class="k">interact</span></font><span class="p">,</span> <font class="badlink"><span class="nx">state</span></font><span class="p">);</span> <span class="p">});</span>
<span class="mi">115</span>        <font class="badlink"><span class="nx">A</span></font><span class="p">.</span><font class="badlink"><span class="k">publish</span></font><span class="p">(</span><font class="badlink"><span class="nx">moveA</span></font><span class="p">);</span>
<span class="mi">116</span>    
<span class="mi">117</span>        <font class="badlink"><span class="nx">state</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">applyMove</span></font><span class="p">(</span><font class="badlink"><span class="nx">state</span></font><span class="p">,</span> <font class="badlink"><span class="nx">moveA</span></font><span class="p">);</span>
<span class="mi">118</span>        <font class="badlink"><span class="k">continue</span></font><span class="p">;</span> <span class="p">}</span>
<span class="mi">119</span>      <font class="badlink"><span class="k">else</span></font> <span class="p">{</span>
<span class="mi">120</span>        <font class="badlink"><span class="k">commit</span></font><span class="p">();</span>
<span class="mi">121</span>    
<span class="mi">122</span>        <font class="badlink"><span class="nx">B</span></font><span class="p">.</span><font class="badlink"><span class="k">only</span></font><span class="p">(()</span> <font class="badlink"><span class="o">=&gt;</span></font> <span class="p">{</span>
<span class="mi">123</span>          <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">moveB</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">getValidMove</span></font><span class="p">(</span><font class="badlink"><span class="k">interact</span></font><span class="p">,</span> <font class="badlink"><span class="nx">state</span></font><span class="p">);</span> <span class="p">});</span>
<span class="mi">124</span>        <font class="badlink"><span class="nx">B</span></font><span class="p">.</span><font class="badlink"><span class="k">publish</span></font><span class="p">(</span><font class="badlink"><span class="nx">moveB</span></font><span class="p">);</span>
<span class="mi">125</span>    
<span class="mi">126</span>        <font class="badlink"><span class="nx">state</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">applyMove</span></font><span class="p">(</span><font class="badlink"><span class="nx">state</span></font><span class="p">,</span> <font class="badlink"><span class="nx">moveB</span></font><span class="p">);</span>
<span class="mi">127</span>        <font class="badlink"><span class="k">continue</span></font><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p><div class="SIntrapara">While the game has not ended because the board is full or someone won: </div><div class="SIntrapara"><ul><li><p>If it is Alice&rsquo;s turn, Alice&rsquo;s backend interacts with her frontend, gets her hand, publishes it, and applies it to the board.</p></li><li><p>Otherwise, Bob&rsquo;s backend interacts with his frontend, gets his hand, publishes it, and applies it to the board.</p></li></ul></div></p></li></ul><p>Then, once the game is over, we compute the outcome of the game and pay each player.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-2/index.rsh#L129-L135"><span class="stt">tic-tac-2/index.rsh</span></a><button class="btn" data-clipboard-text="      const [ toA, toB ] =
            (ttt_winner_is_X( state ) ? [ 2, 0 ]
             : (ttt_winner_is_O( state ) ? [ 0, 2 ]
                : [ 1, 1 ]));
      transfer(toA * wagerAmount).to(A);
      transfer(toB * wagerAmount).to(B);
      commit();"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">129</span>    <font class="badlink"><span class="kd">const</span></font> <span class="p">[</span> <font class="badlink"><span class="nx">toA</span></font><span class="p">,</span> <font class="badlink"><span class="nx">toB</span></font> <span class="p">]</span> <font class="badlink"><span class="o">=</span></font>
<span class="mi">130</span>          <span class="p">(</span><font class="badlink"><span class="nx">ttt_winner_is_X</span></font><span class="p">(</span> <font class="badlink"><span class="nx">state</span></font> <span class="p">)</span> <font class="badlink"><span class="o">?</span></font> <span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span>
<span class="mi">131</span>           <font class="badlink"><span class="o">:</span></font> <span class="p">(</span><font class="badlink"><span class="nx">ttt_winner_is_O</span></font><span class="p">(</span> <font class="badlink"><span class="nx">state</span></font> <span class="p">)</span> <font class="badlink"><span class="o">?</span></font> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="p">]</span>
<span class="mi">132</span>              <font class="badlink"><span class="o">:</span></font> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">]));</span>
<span class="mi">133</span>    <font class="badlink"><span class="k">transfer</span></font><span class="p">(</span><font class="badlink"><span class="nx">toA</span></font> <font class="badlink"><span class="o">*</span></font> <font class="badlink"><span class="nx">wagerAmount</span></font><span class="p">).</span><font class="badlink"><span class="nx">to</span></font><span class="p">(</span><font class="badlink"><span class="nx">A</span></font><span class="p">);</span>
<span class="mi">134</span>    <font class="badlink"><span class="k">transfer</span></font><span class="p">(</span><font class="badlink"><span class="nx">toB</span></font> <font class="badlink"><span class="o">*</span></font> <font class="badlink"><span class="nx">wagerAmount</span></font><span class="p">).</span><font class="badlink"><span class="nx">to</span></font><span class="p">(</span><font class="badlink"><span class="nx">B</span></font><span class="p">);</span>
<span class="mi">135</span>    <font class="badlink"><span class="k">commit</span></font><span class="p">();</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Lines 129 through 132 compute the pot for each party.</p></li><li><p>Lines 133 through 134 pay each player.</p></li></ul><p>Finally, we use the <font class="badlink"><span class="techoutside"><span class="techinside">each</span></span></font> form to have each of the participants send the final outcome to their frontends.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tic-tac-2/index.rsh#L137-L138"><span class="stt">tic-tac-2/index.rsh</span></a><button class="btn" data-clipboard-text="      each([A, B], () =&gt; {
        interact.endsWith(state); }); });"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">137</span>    <font class="badlink"><span class="k">each</span></font><span class="p">([</span><font class="badlink"><span class="nx">A</span></font><span class="p">,</span> <font class="badlink"><span class="nx">B</span></font><span class="p">],</span> <span class="p">()</span> <font class="badlink"><span class="o">=&gt;</span></font> <span class="p">{</span>
<span class="mi">138</span>      <font class="badlink"><span class="k">interact</span></font><span class="p">.</span><font class="badlink"><span class="nx">endsWith</span></font><span class="p">(</span><font class="badlink"><span class="nx">state</span></font><span class="p">);</span> <span class="p">});</span> <span class="p">});</span>
</pre></div></div></p><ul><li><p>Line 137 states that this is a <font class="badlink"><span class="techoutside"><span class="techinside">local step</span></span></font> that <font class="badlink"><span class="techoutside"><span class="techinside">each</span></span></font> of the participants performs.</p></li></ul><p>At this point, we can run the program and see its output by running</p><p><span class="hspace">&nbsp;&nbsp;</span><span style="font-weight: bold"><span class="stt">$</span></span><span class="stt"> </span><span class="stt">./reach run</span></p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>If your version isn&rsquo;t working, look at the complete versions of the index.rsh and index.mjs files to make sure you copied everything down correctly!</p></blockquote></blockquote></blockquote><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>How come Alice and Bob&rsquo;s balance goes back to <span class="RktInBG"><span class="hspace"></span><span class="RktIn">100</span><span class="hspace"></span></span> each time?
It&rsquo;s because every time we run <span class="stt">./reach run</span>, it starts a completely fresh instance of the testing network and creates new accounts for each player.</p></blockquote></blockquote></blockquote><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>How come the balances aren&rsquo;t exactly <span class="RktInBG"><span class="hspace"></span><span class="RktIn">100</span><span class="hspace"></span></span>, <span class="RktInBG"><span class="hspace"></span><span class="RktIn">105</span><span class="hspace"></span></span>, and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">95</span><span class="hspace"></span></span>?
It&rsquo;s because Ethereum transactions cost "gas" to run.</p><p>If we had shown all the decimals, they&rsquo;d look like this:</p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">Alice went from 10 to 14.999999999999687163.</span></p></td></tr><tr><td><p><span class="stt">Bob went from 10 to 4.999999999999978229.</span></p></td></tr></table><p>Why does Alice win slightly less than Bob when she wins?
She has to pay to <font class="badlink"><span class="techoutside"><span class="techinside">deploy</span></span></font> the contract, because she calls acc.deploy in her <font class="badlink"><span class="techoutside"><span class="techinside">frontend</span></span></font>.</p><p>The <font class="badlink">guide section on deployment</font> discusses how to avoid this difference.</p></blockquote></blockquote></blockquote><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>If your version isn&rsquo;t working, look at the complete versions of index.rsh and index.mjs to make sure you copied everything down correctly!</p></blockquote></blockquote></blockquote><p>Since the players act randomly, the results will be different every time.
When I ran the program, this is the final output I got:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">Bob sees the final state:</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9556;&#9552;&#9552;&#9552;&#9574;&#9552;&#9552;&#9552;&#9574;&#9552;&#9552;&#9552;&#9559;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9553; O &#9553; X &#9553; X &#9553;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9568;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9571;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9553;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9553; X &#9553; O &#9553;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9568;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9571;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9553; O &#9553; X &#9553; O &#9553;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9562;&#9552;&#9552;&#9552;&#9577;&#9552;&#9552;&#9552;&#9577;&#9552;&#9552;&#9552;&#9565;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">Alice sees the final state:</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9556;&#9552;&#9552;&#9552;&#9574;&#9552;&#9552;&#9552;&#9574;&#9552;&#9552;&#9552;&#9559;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9553; O &#9553; X &#9553; X &#9553;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9568;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9571;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9553;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9553; X &#9553; O &#9553;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9568;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9580;&#9552;&#9552;&#9552;&#9571;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9553; O &#9553; X &#9553; O &#9553;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&#9562;&#9552;&#9552;&#9552;&#9577;&#9552;&#9552;&#9552;&#9577;&#9552;&#9552;&#9552;&#9565;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">Alice went from 100 to 104.9999</span></p></td></tr><tr><td><p><span class="stt">Bob went from 100 to 94.9999</span></p></td></tr><tr><td><p><span class="stt">Done!</span></p></td></tr></table></p><p>Alice is pretty good at Tic-Tac-Toe!</p><p><font class="badlink"><span class="techoutside"><span class="techinside">Consensus networks</span></span></font> in general, and Reach specifically, guarantee that all participants agree on the outcome of their decentralized computation.
Indeed, this is where the name <font class="badlink"><span class="techoutside"><span class="techinside">consensus network</span></span></font> comes from, as they enable these distributed, and untrusted, parties to come to a consensus, or agreement, about the intermediate states of a computation; and if they agree on the intermediate states, they will also agree on the output.
That&rsquo;s why every time you run <span class="stt">./reach run</span>, both Alice and Bob will see the same outcome!</p><p>In the <a href="tic-tac-3.html" data-pltdoc="x">next section</a>, we&rsquo;ll add Pay-To-Play to our Tic-Tac-Toe engine.</p><p><a href="index.html" data-pltdoc="x">Main menu</a></p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="tic-tac-1.html" title="backward to &quot;2 Scaffolding and Setup&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Pay-To-Play Tic-Tac-Toe Tutorial&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tic-tac-3.html" title="forward to &quot;4 Pay-to-Play&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>