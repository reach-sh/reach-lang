<p>This tutorial shows you how to build Rock Paper Scissors, a command-line and web-based decentralized application that enables two players, Alice and Bob, to compete against each other and wager on the outcome.</p>
<blockquote>
  <h1 id="install--setup">Install &amp; Setup<a aria-hidden="true" tabindex="-1" href="#install--setup"><span class="icon icon-link"></span></a></h1>
  <p>Be sure to complete <a href="/en/books/essentials/getting-started/install-and-run/">Install and Run</a> and <a href="/en/books/essentials/getting-started/set-up-an-ide/">Set up an IDE</a> before continuing.</p>
</blockquote>
<h2 id="file-structure">File Structure<a aria-hidden="true" tabindex="-1" href="#file-structure"><span class="icon icon-link"></span></a></h2>
<p>This module uses the following project directory structure:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1">~/reach/rock-paper-scissors/rps-1-setup</li><li value="2">~/reach/rock-paper-scissors/rps-2-rps</li><li value="3">~/reach/rock-paper-scissors/rps-3-bets</li><li value="4">~/reach/rock-paper-scissors/rps-4-attack</li><li value="5">~/reach/rock-paper-scissors/rps-5-trust</li><li value="6">~/reach/rock-paper-scissors/rps-6-timeouts</li><li value="7">~/reach/rock-paper-scissors/rps-7-loops</li><li value="8">~/reach/rock-paper-scissors/rps-8-interact</li><li value="9">~/reach/rock-paper-scissors/rps-9-web</li></ol></pre>
<p>Begin by creating and navigating to a subdirectory inside your ~/reach/ directory.</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #24292F">$ mkdir -p </span><span style="color: #CF222E">~</span><span style="color: #24292F">/reach/rock-paper-scissors </span><span style="color: #CF222E">&amp;&amp;</span><span style="color: #24292F"> </span><span style="color: #0550AE">cd</span><span style="color: #24292F"> </span><span style="color: #CF222E">~</span><span style="color: #24292F">/reach/rock-paper-scissors</span></li></ol></pre>
<h1 id="scaffolding-and-setup">Scaffolding and Setup<a aria-hidden="true" tabindex="-1" href="#scaffolding-and-setup"><span class="icon icon-link"></span></a></h1>
<p>To make the most of this tutorial, follow along by copying each part of the program and see how things work for yourself. If you’re like us, you may find it beneficial to type each line out, rather than copying &amp; pasting so you can start building your muscle memory and begin to gain a sense for each part of a Reach program.</p>
<p>Create a subdirectory inside the rock-paper-scissors folder for this section of the tutorial. We'll also create a file named <code>index.rsh</code>.</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #24292F">$ mkdir -p /rps-1-setup/index.rsh</span></li></ol></pre>
<blockquote>
  <p>We will be creating subdirectories for each section of this tutorial within the <code>/rock-paper-scissors/</code> directory.</p>
</blockquote>
<p>Type the following into <code>index.rsh</code>:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-1-setup/index.rsh">rps-1-setup/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #0A3069">'reach 0.1'</span><span style="color: #24292F">;</span></li><li value="2"></li><li value="3"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">main</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> Reach.</span><span style="color: #8250DF">App</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="4"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Alice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">Participant</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Alice'</span><span style="color: #24292F">, {</span></li><li value="5"><span style="color: #24292F">    </span><span style="color: #6E7781">// Specify Alice's interact interface here</span></li><li value="6"><span style="color: #24292F">  });</span></li><li value="7"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Bob</span><span style="color: #24292F">   </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">Participant</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Bob'</span><span style="color: #24292F">, {</span></li><li value="8"><span style="color: #24292F">   </span><span style="color: #6E7781">// Specify Bob's interact interface here</span></li><li value="9"><span style="color: #24292F">  });</span></li><li value="10"><span style="color: #24292F">  </span><span style="color: #8250DF">deploy</span><span style="color: #24292F">();</span></li><li value="11"><span style="color: #24292F">  </span><span style="color: #6E7781">// write your program here</span></li><li value="12"></li><li value="13"><span style="color: #24292F">});</span></li></ol></pre>
<blockquote>
  <h1 id="links-to-source">Links to Source<a aria-hidden="true" tabindex="-1" href="#links-to-source"><span class="icon icon-link"></span></a></h1>
  <p>You may have noticed that <code>rps-1-setup/index.rsh</code> is a link above the code snippet. Click these links to view the full source code.</p>
</blockquote>
<ul>
  <li>Line 1: Indicates that this is a Reach program. This will always be at the top of every index.rsh file.</li>
  <li>Line 3: Defines the main export from the program. The compiler looks at this during run time.</li>
  <li>Lines 4-9: Specify Alice and Bob and the two participants in this application.</li>
  <li>Line 10: Marks the deployment of the Reach program. This enables the program to do things.</li>
</ul>
<p>Next, we'll create a shell for the JavaScript <a href="https://docs.reach.sh/ref-model.html#%28tech._frontend%29">frontend</a> code. Create a new file <code>index.mjs</code> and add the following:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #24292F">$ touch index.mjs</span></li></ol></pre>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-1-setup/index.mjs">rps-1-setup/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">import</span><span style="color: #24292F"> { loadStdlib } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'@reach-sh/stdlib'</span><span style="color: #24292F">;</span></li><li value="2"><span style="color: #CF222E">import</span><span style="color: #24292F"> </span><span style="color: #0550AE">*</span><span style="color: #24292F"> </span><span style="color: #CF222E">as</span><span style="color: #24292F"> backend </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./build/index.main.mjs'</span><span style="color: #24292F">;</span></li><li value="3"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">stdlib</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">loadStdlib</span><span style="color: #24292F">(process.env);</span></li><li value="4"></li><li value="5"><span style="color: #24292F">(</span><span style="color: #CF222E">async</span><span style="color: #24292F"> () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="6"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">startingBalance</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">parseCurrency</span><span style="color: #24292F">(</span><span style="color: #0550AE">100</span><span style="color: #24292F">);</span></li><li value="7"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">accAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">newTestAccount</span><span style="color: #24292F">(startingBalance);</span></li><li value="8"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">accBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">newTestAccount</span><span style="color: #24292F">(startingBalance);</span></li><li value="9"></li><li value="10"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">ctcAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> accAlice.</span><span style="color: #8250DF">contract</span><span style="color: #24292F">(backend);</span></li><li value="11"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">ctcBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> accBob.</span><span style="color: #8250DF">contract</span><span style="color: #24292F">(backend, ctcAlice.</span><span style="color: #8250DF">getInfo</span><span style="color: #24292F">());</span></li><li value="12"></li><li value="13"><span style="color: #24292F">  </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #0550AE">Promise</span><span style="color: #24292F">.</span><span style="color: #8250DF">all</span><span style="color: #24292F">([</span></li><li value="14"><span style="color: #24292F">    ctcAlice.p.</span><span style="color: #8250DF">Alice</span><span style="color: #24292F">({</span></li><li value="15"><span style="color: #24292F">      </span><span style="color: #6E7781">// implement Alice's interact object here</span></li><li value="16"><span style="color: #24292F">    }),</span></li><li value="17"><span style="color: #24292F">    ctcBob.p.</span><span style="color: #8250DF">Bob</span><span style="color: #24292F">({</span></li><li value="18"><span style="color: #24292F">      </span><span style="color: #6E7781">// implement Bob's interact object here</span></li><li value="19"><span style="color: #24292F">    }),</span></li><li value="20"><span style="color: #24292F">  ]);</span></li><li value="21"><span style="color: #24292F">})(); </span><span style="color: #6E7781">// &lt;-- Don't forget these!</span></li></ol></pre>
<ul>
  <li>Line 1: Imports the Reach standard library loader.</li>
  <li>Line 2: Imports the backend, which will be produced by <code>$ reach compile</code>.</li>
  <li>Line 3: Loads the standard library dynamically based on the <a href="https://docs.reach.sh/ref-usage.html#%28env._.R.E.A.C.H_.C.O.N.N.E.C.T.O.R_.M.O.D.E%29_">REACH_CONNECTOR_MODE</a> environment variable.</li>
  <li>Line 5: Defines the asynchronous function that will contain the body of the frontend.</li>
  <li>Line 6: Defines a quantity of <a href="https://docs.reach.sh/ref-model.html#%28tech._network._token%29">network tokens</a> as the starting balance for each test account.</li>
  <li>Lines 7 &amp; 8: Create test accounts with endowments for Alice and Bob. This method only works on Reach-provided developer test networks.</li>
  <li>Line 10: Alice deploys the application. This activates the code in <code>index.rsh</code>.</li>
  <li>Line 11: Bob attaches to the application.</li>
  <li>Line 13: Awaits for the backend to complete before running the block of code.</li>
  <li>Lines 14 - 16: Initializes a backend for Alice</li>
  <li>Lines 17 - 19: Initializes a backend for Bob</li>
  <li>Line 21: Calls the asynchronous function defined in line 5.</li>
</ul>
<p>At this point, we can compile and run the program. Be sure Docker is running or the command will not work.</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #24292F">$ reach run</span></li></ol></pre>
<p>Assuming no errors, Reach will now build and launch a Docker container for the application. However, our application doesn't do anything yet. At this point in time, you'll only see diagnostic messages.</p>
<p>In the future, you can automate the entire process that we've walked through in this section by running <code>reach init</code>. We won't run this now, but in the future, you can use <code>reach init</code> to create a boilerplate for your dApps.</p>
<p>In the next step, we'll implement the logic of <em>Rock, Paper, Scissors!</em> so our application begins to do something!</p>
<blockquote>
  <h1 id="check-your-understanding">Check your Understanding<a aria-hidden="true" tabindex="-1" href="#check-your-understanding"><span class="icon icon-link"></span></a></h1>
  <p>
    When you write a dApp using Reach, do you:
    A) Write a smart contract in Solidity, a backend in JavaScript using the Ethereum SDK, and a frontend in JavaScript, then use Reach to test and deploy it.
    B) Write a program in Reach that generates a smart contract and a backend and a frontend in JavaScript, then use Reach to test and deploy it?
  </p>
</blockquote>
<h1 id="rock-paper-scissors-1">Rock, Paper, Scissors<a aria-hidden="true" tabindex="-1" href="#rock-paper-scissors-1"><span class="icon icon-link"></span></a></h1>
<p>In this section, we'll write enough code such that Alice and Bob will execute a game of <em>Rock, Paper, Scissors</em>!</p>
<p>We'll represent the hands of <code>Rock</code>, <code>Paper</code>, and <code>Scissors</code> as the numbers, 0, 1, and 2, respectively.</p>
<p>We'll also represent the three possible outcomes of the game as <code>B wins</code>, <code>A wins</code>, and <code>Draw</code>.</p>
<p>Let's change the Reach program to specify that Alice and Bob's frontends can be interacted with to get the move of each player, and later be informed of the game's outcome.</p>
<blockquote>
  <h1 id="unsigned-integers-in-reach">Unsigned integers in Reach<a aria-hidden="true" tabindex="-1" href="#unsigned-integers-in-reach"><span class="icon icon-link"></span></a></h1>
  <p>Reach does not support unsigned integers of exactly two bits. Rather than using the integers, 0, 1, and 2, we represent the equivalence class of integers modulo three.</p>
</blockquote>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-2-rps/index.rsh">rps-2-rps/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #0A3069">'reach 0.1'</span><span style="color: #24292F">;</span></li><li value="2"></li><li value="3"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Player</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span></li><li value="4"><span style="color: #24292F">  getHand: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([], UInt),</span></li><li value="5"><span style="color: #24292F">  seeOutcome: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([UInt], Null),</span></li><li value="6"><span style="color: #24292F">};</span></li><li value="7"></li><li value="8"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">main</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> Reach.</span><span style="color: #8250DF">App</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="9"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Alice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">Participant</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Alice'</span><span style="color: #24292F">, {</span></li><li value="10"><span style="color: #24292F">    </span><span style="color: #CF222E">...</span><span style="color: #24292F">Player,</span></li><li value="11"><span style="color: #24292F">  });</span></li><li value="12"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Bob</span><span style="color: #24292F">   </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">Participant</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Bob'</span><span style="color: #24292F">, {</span></li><li value="13"><span style="color: #24292F">    </span><span style="color: #CF222E">...</span><span style="color: #24292F">Player,</span></li><li value="14"><span style="color: #24292F">  });</span></li><li value="15"><span style="color: #24292F">  </span><span style="color: #8250DF">deploy</span><span style="color: #24292F">();</span></li><li value="16"></li><li value="17"><span style="color: #24292F">  Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li></ol></pre>
<ul>
  <li>Lines 3 - 6: Defines a <a href="https://docs.reach.sh/ref-programs-appinit.html#%28tech._participant._interact._interface%29">participant interact interface</a> that is shared between the two players. We've defined two methods: <code>getHand</code>, which returns a number, and <code>seeOutcome</code>, which receives a number.</li>
  <li>Lines 9-14: Establishes the use of the interface for both participants. Now, <code>interact</code> will be bound to an object with methods corresponding to the actions defined in the participant interact interface. This connects to the frontend of the corresponding participant.</li>
</ul>
<p>Let's leave the Reach application and move over to the JavaScript interface to implement these methods in the frontend.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-2-rps/index.mjs">rps-2-rps/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="13"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">HAND</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> [</span><span style="color: #0A3069">'Rock'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Paper'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Scissors'</span><span style="color: #24292F">];</span></li><li value="14"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">OUTCOME</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> [</span><span style="color: #0A3069">'Bob wins'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Draw'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Alice wins'</span><span style="color: #24292F">];</span></li><li value="15"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">Player</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (</span><span style="color: #953800">Who</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> ({</span></li><li value="16"><span style="color: #24292F">    </span><span style="color: #8250DF">getHand</span><span style="color: #24292F">: () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="17"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">hand</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">Math</span><span style="color: #24292F">.</span><span style="color: #0550AE">floor</span><span style="color: #24292F">(</span><span style="color: #0550AE">Math</span><span style="color: #24292F">.</span><span style="color: #0550AE">random</span><span style="color: #24292F">() </span><span style="color: #CF222E">*</span><span style="color: #24292F"> </span><span style="color: #0550AE">3</span><span style="color: #24292F">);</span></li><li value="18"><span style="color: #24292F">      console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`${</span><span style="color: #24292F">Who</span><span style="color: #0A3069">} played ${</span><span style="color: #0550AE">HAND</span><span style="color: #0A3069">[</span><span style="color: #24292F">hand</span><span style="color: #0A3069">]</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="19"><span style="color: #24292F">      </span><span style="color: #CF222E">return</span><span style="color: #24292F"> hand;</span></li><li value="20"><span style="color: #24292F">    },</span></li><li value="21"><span style="color: #24292F">    </span><span style="color: #8250DF">seeOutcome</span><span style="color: #24292F">: (</span><span style="color: #953800">outcome</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="22"><span style="color: #24292F">      console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`${</span><span style="color: #24292F">Who</span><span style="color: #0A3069">} saw outcome ${</span><span style="color: #0550AE">OUTCOME</span><span style="color: #0A3069">[</span><span style="color: #24292F">outcome</span><span style="color: #0A3069">]</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="23"><span style="color: #24292F">    },</span></li><li value="24"><span style="color: #24292F">  });</span></li><li value="25"></li><li value="26"><span style="color: #24292F">  </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #0550AE">Promise</span><span style="color: #24292F">.</span><span style="color: #8250DF">all</span><span style="color: #24292F">([</span></li><li value="27"><span style="color: #24292F">    ctcAlice.p.</span><span style="color: #8250DF">Alice</span><span style="color: #24292F">({</span></li><li value="28"><span style="color: #24292F">      </span><span style="color: #CF222E">...</span><span style="color: #8250DF">Player</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Alice'</span><span style="color: #24292F">),</span></li><li value="29"><span style="color: #24292F">    }),</span></li><li value="30"><span style="color: #24292F">    ctcBob.p.</span><span style="color: #8250DF">Bob</span><span style="color: #24292F">({</span></li><li value="31"><span style="color: #24292F">      </span><span style="color: #CF222E">...</span><span style="color: #8250DF">Player</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Bob'</span><span style="color: #24292F">),</span></li><li value="32"><span style="color: #24292F">    }),</span></li><li value="33"><span style="color: #24292F">  ]);</span></li></ol></pre>
<ul>
  <li>Lines 13 &amp; 14: Define arrays to hold the meaning of the hands and outcomes.</li>
  <li>Line 15: Defines a constructor for the Player implementation.</li>
  <li>Lines 16 - 20: Implement the <code>getHand</code> method.</li>
  <li>Lines 21 - 23: Implement the <code>seeOutcome</code> method.</li>
  <li>Lines 28 * 31: Instantiate the implementation once for Alice and once for Bob. These objects will be bound to <a href="https://docs.reach.sh/ref-programs-local.html#%28reach._%28%28interact%29%29%29"><code>interact</code></a> in the Reach program.</li>
</ul>
<h2 id="business-logic">Business Logic<a aria-hidden="true" tabindex="-1" href="#business-logic"><span class="icon icon-link"></span></a></h2>
<p>There should be nothing interesting or controversial about these implementations; that's the point of Reach. We write normal business logic without worrying about the details of the <a href="https://docs.reach.sh/ref-model.html#%28tech._consensus._network%29">consensus network</a> and decentralized application.</p>
<p>Now we'll return to the Reach program to look inside the body of the program to inspect what actions Alice and Bob are able to take.</p>
<p>In real life, <em>Rock, Paper, Scissors!</em>, Alice and Bob simultaneously decide what hand they will play and reveal it at the same time. In practice, "simultaneity" is a complex concept that is difficult to realize. For example, if you've played against a child, you may notice them trying to see what you're going to choose and delay until the last second to reveal their winning hand. Similarly, in a decentralized app, it is not possible to have simultaneity. Instead, one participant must "go first." In this case, we'll select Alice.</p>
<p>The game proceeds in three steps:</p>
<ol>
  <li>Alice's backend interacts with its frontend,</li>
  <li>Gets Alice's hand,</li>
  <li>And publishes it.</li>
</ol>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-2-rps/index.rsh">rps-2-rps/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="17"><span style="color: #24292F">  Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="18"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">handAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.</span><span style="color: #8250DF">getHand</span><span style="color: #24292F">());</span></li><li value="19"><span style="color: #24292F">  });</span></li><li value="20"><span style="color: #24292F">  Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(handAlice);</span></li><li value="21"><span style="color: #24292F">  </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li></ol></pre>
<ul>
  <li>Line 17: States that this block of code is something that <em>only</em> Alice performs.</li>
  <li>Line 18: The variable <code>handAlice</code> is known only to Alice. This binds its value to the result of interacting with Alice through the <code>getHand</code> method found in the JavaScript frontend. <code>interact</code> also <a href="https://docs.reach.sh/ref-programs-local.html#%28tech._declassify%29">declassifies</a> the value, because all information from <a href="https://docs.reach.sh/ref-model.html#%28tech._frontend%29">frontends</a> is <a href="https://docs.reach.sh/ref-programs-valid.html#%28tech._secret%29">secret</a> until explicitly publicized.</li>
  <li>Line 20: Alice <a href="https://docs.reach.sh/ref-model.html#%28tech._join%29">joins</a> the application by publishing the value to the <a href="https://docs.reach.sh/ref-model.html#%28tech._consensus._network%29">consensus network</a>, so it can be used to evaluate the outcome of the game. Once this happens, the code is in a "<a href="https://docs.reach.sh/ref-model.html#%28tech._consensus._step%29">consensus step</a>" where all participants act together.</li>
  <li>Line 21: Commits the state of the <a href="https://docs.reach.sh/ref-model.html#%28tech._consensus._network%29">consensus network</a> and returns to "<a href="https://docs.reach.sh/ref-model.html#%28tech._local._step%29">local step</a>" where individual participants can act alone.</li>
</ul>
<p>The next step is similar, in that Bob publishes his hand, however, we won't immediately commit the state, instead we compute the outcome of the game.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-2-rps/index.rsh">rps-2-rps/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="23"><span style="color: #24292F">  Bob.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="24"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">handBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.</span><span style="color: #8250DF">getHand</span><span style="color: #24292F">());</span></li><li value="25"><span style="color: #24292F">  });</span></li><li value="26"><span style="color: #24292F">  Bob.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(handBob);</span></li><li value="27"></li><li value="28"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">outcome</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (handAlice </span><span style="color: #CF222E">+</span><span style="color: #24292F"> (</span><span style="color: #0550AE">4</span><span style="color: #24292F"> </span><span style="color: #CF222E">-</span><span style="color: #24292F"> handBob)) </span><span style="color: #CF222E">%</span><span style="color: #24292F"> </span><span style="color: #0550AE">3</span><span style="color: #24292F">;</span></li><li value="29"><span style="color: #24292F">  </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li></ol></pre>
<ul>
  <li>Lines 23 - 26: Match Alice's similar <a href="https://docs.reach.sh/ref-model.html#%28tech._local._step%29">local step</a> and <a href="https://docs.reach.sh/ref-model.html#%28tech._join%29">join</a>ing of the application through a <a href="https://docs.reach.sh/ref-model.html#%28tech._consensus._transfer%29">consensus transfer</a> <a href="https://docs.reach.sh/ref-model.html#%28tech._publication%29">publication</a>.</li>
  <li>Line 28: Computes the outcome of the game before committing. The equation itself is not critical to understand for the purposes of our tutorial. However, we will say that <code>Outcome</code> stores a value of an integer modulo, which will correlate to the winning hand.</li>
</ul>
<p>In the next snippet we use the <a href="https://docs.reach.sh/ref-programs-step.html#%28tech._each%29">each</a> form to have each of the participants send the final outcome to their frontends.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-2-rps/index.rsh">rps-2-rps/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="30"></li><li value="31"><span style="color: #24292F">  </span><span style="color: #8250DF">each</span><span style="color: #24292F">([Alice, Bob], () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="32"><span style="color: #24292F">    interact.</span><span style="color: #8250DF">seeOutcome</span><span style="color: #24292F">(outcome);</span></li><li value="33"><span style="color: #24292F">  });</span></li></ol></pre>
<ul>
  <li>Line 31: States that this is a <a href="https://docs.reach.sh/ref-model.html#%28tech._local._step%29">local step</a> that <a href="https://docs.reach.sh/ref-programs-step.html#%28tech._each%29">each</a> of the participants performs.</li>
</ul>
<p>We can now run the program and see its output running</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #24292F">$ reach run</span></li></ol></pre>
<p>Players act randomly so your results may vary. When I ran the program three times, this is the output I received:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #24292F">$ reach run</span></li><li value="2"><span style="color: #24292F">Alice played Scissors</span></li><li value="3"><span style="color: #24292F">Bob played Paper</span></li><li value="4"><span style="color: #24292F">Alice saw outcome Alice wins</span></li><li value="5"><span style="color: #24292F">Bob saw outcome Alice wins</span></li><li value="6"></li><li value="7"><span style="color: #24292F">$ reach run</span></li><li value="8"><span style="color: #24292F">Alice played Scissors</span></li><li value="9"><span style="color: #24292F">Bob played Paper</span></li><li value="10"><span style="color: #24292F">Alice saw outcome Alice wins</span></li><li value="11"><span style="color: #24292F">Bob saw outcome Alice wins</span></li><li value="12"></li><li value="13"><span style="color: #24292F">$ reach run</span></li><li value="14"><span style="color: #24292F">Alice played Paper</span></li><li value="15"><span style="color: #24292F">Bob played Rock</span></li><li value="16"><span style="color: #24292F">Alice saw outcome Alice wins</span></li><li value="17"><span style="color: #24292F">Bob saw outcome Alice wins</span></li></ol></pre>
<p>Alice is good!</p>
<h2 id="consensus-networks">Consensus Networks<a aria-hidden="true" tabindex="-1" href="#consensus-networks"><span class="icon icon-link"></span></a></h2>
<p><a href="https://docs.reach.sh/ref-model.html#%28tech._consensus._network%29">Consensus networks</a> in general, and Reach specifically, guarantee that all participants agree on the outcome of their decentralized computation. Indeed, this is where the name <a href="https://docs.reach.sh/ref-model.html#%28tech._consensus._network%29">consensus network</a> comes from, as they enable these distributed, and untrusted, parties to come to a consensus, or agreement, about the intermediate states of a computation. If they agree on the intermediate states, they will also agree on the output. That's why every time you run <code>reach run</code>, both Alice and Bob will see the same outcome!</p>
<blockquote>
  <p>If your version isn't working, look at the complete versions of <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-2-rps/index.rsh">index.rsh</a> and <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-2-rps/index.mjs">index.mjs</a> to make sure you've copied everything correctly.</p>
</blockquote>
<blockquote>
  <h1 id="whos-on-first">Who’s on First<a aria-hidden="true" tabindex="-1" href="#whos-on-first"><span class="icon icon-link"></span></a></h1>
  <p>Does Alice go first, or do we call the player that goes first, "Alice"? It may seem like an unnecessary distinction, but this is a subtle point about the way Reach works. In this section, we explicitly ran <code>backend.Alice</code> and <code>backend.Bob</code> in the <a href="https://docs.reach.sh/ref-model.html#%28tech._frontend%29">frontend</a>. When we did that, we committed that particular JavaScript thread to be either Alice or Bob. In our game, whoever chose to run the Alice backend is the one that will go first. In other words: <strong>Alice goes first</strong>. This will be more obvious at <a href="https://docs.reach.sh/tut-8.html">the end of the tutorial</a> when we'll make the choice interactively about which role to play.</p>
</blockquote>
<p>In the next step, we'll add stakes to the game, because Alice needs to take her skills to the bank!</p>
<blockquote>
  <h1 id="check-your-understanding-1">Check Your Understanding<a aria-hidden="true" tabindex="-1" href="#check-your-understanding-1"><span class="icon icon-link"></span></a></h1>
  <p>Reach programs allow interaction with a user interface through which of the following methods?</p>
  <ol>
    <li>By forcing you to write a custom backend for the user interface that connects to the generated smart contract</li>
    <li>By allowing the frontends to provide values directly to the Reach application</li>
    <li>By allowing the Reach program to callback to the frontend via the interact object.</li>
  </ol>
</blockquote>
<blockquote>
  <p>How do participants in a Reach application share information with each other and find out what others have shared?</p>
  <ol>
    <li>Reach generates a smart contract, but you need to implement a process to scan the blockchain for events that correspond to sharing.</li>
    <li>The Reach primitive <code>publish</code> allows a participant to share information with all other participants, which happens automatically without the other parties needing to do anything special.</li>
    <li>The Reach primitive <code>publish</code> allows a participant to share information with all other participants, but they need to explicitly run the receive primitive to receive published information.</li>
  </ol>
</blockquote>
<h1 id="bets-and-wagers">Bets and Wagers<a aria-hidden="true" tabindex="-1" href="#bets-and-wagers"><span class="icon icon-link"></span></a></h1>
<p>It's fun to play <em>Rock, Paper, Scissors!</em> with friends for a laugh, but it's even better to play it with enemies and your entire lifesavings on the line! Let's change our program so Alice can offer a wager to Bob and whomever wins will take the pot.</p>
<p>This time, we'll start with changes to the JavaScript <a href="https://docs.reach.sh/ref-model.html#%28tech._frontend%29">frontend</a> and then we'll go back into the Reach code and connect the new methods.</p>
<p>Since we're going to have funds transferred, we'll record the balances of each participant before the game starts, so we can clearly show what they won at the end. Add this code between account creation and contract deployment.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.mjs">rps-3-bets/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="6"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">startingBalance</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">parseCurrency</span><span style="color: #24292F">(</span><span style="color: #0550AE">100</span><span style="color: #24292F">);</span></li><li value="7"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">accAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">newTestAccount</span><span style="color: #24292F">(startingBalance);</span></li><li value="8"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">accBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">newTestAccount</span><span style="color: #24292F">(startingBalance);</span></li><li value="9"></li><li value="10"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">fmt</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (</span><span style="color: #953800">x</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">formatCurrency</span><span style="color: #24292F">(x, </span><span style="color: #0550AE">4</span><span style="color: #24292F">);</span></li><li value="11"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">getBalance</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">async</span><span style="color: #24292F"> (</span><span style="color: #953800">who</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">fmt</span><span style="color: #24292F">(</span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">balanceOf</span><span style="color: #24292F">(who));</span></li><li value="12"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">beforeAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">getBalance</span><span style="color: #24292F">(accAlice);</span></li><li value="13"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">beforeBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">getBalance</span><span style="color: #24292F">(accBob);</span></li></ol></pre>
<ul>
  <li>Line 10: Shows a helpful function to display currency amounts with up to 4 decimal places.</li>
  <li>Line 11: A helpful function for getting the balance of a participant and displaying it with up to 4 decimal places.</li>
  <li>Line 12 &amp; 13: Get the balance before the game starts for Alice and Bob.</li>
</ul>
<h2 id="interface-object">Interface Object<a aria-hidden="true" tabindex="-1" href="#interface-object"><span class="icon icon-link"></span></a></h2>
<p>Now, let's update Alice's interface object to include her wager.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.mjs">rps-3-bets/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="32"><span style="color: #24292F">    ctcAlice.p.</span><span style="color: #8250DF">Alice</span><span style="color: #24292F">({</span></li><li value="33"><span style="color: #24292F">      </span><span style="color: #CF222E">...</span><span style="color: #8250DF">Player</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Alice'</span><span style="color: #24292F">),</span></li><li value="34"><span style="color: #24292F">      wager: stdlib.</span><span style="color: #8250DF">parseCurrency</span><span style="color: #24292F">(</span><span style="color: #0550AE">5</span><span style="color: #24292F">),</span></li><li value="35"><span style="color: #24292F">    }),</span></li></ol></pre>
<ul>
  <li>Line 33: Splices the common <code>Player</code> interface into Alice's interface.</li>
  <li>Line 34: Defines her wager as 5 units of the <a href="https://docs.reach.sh/ref-model.html#%28tech._network._token%29">network token</a>. This is an example of using a concrete value, rather than a function, in a <a href="https://docs.reach.sh/ref-programs-appinit.html#%28tech._participant._interact._interface%29">participant interact interface</a>.</li>
</ul>
<p>Bob's interface will now be modified to show Alice's wager and then immediately accept it.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.mjs">rps-3-bets/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="36"><span style="color: #24292F">    ctcBob.p.</span><span style="color: #8250DF">Bob</span><span style="color: #24292F">({</span></li><li value="37"><span style="color: #24292F">      </span><span style="color: #CF222E">...</span><span style="color: #8250DF">Player</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Bob'</span><span style="color: #24292F">),</span></li><li value="38"><span style="color: #24292F">      </span><span style="color: #8250DF">acceptWager</span><span style="color: #24292F">: (</span><span style="color: #953800">amt</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="39"><span style="color: #24292F">        console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Bob accepts the wager of ${</span><span style="color: #8250DF">fmt</span><span style="color: #0A3069">(</span><span style="color: #24292F">amt</span><span style="color: #0A3069">)</span><span style="color: #0A3069">}.`</span><span style="color: #24292F">);</span></li><li value="40"><span style="color: #24292F">      },</span></li><li value="41"><span style="color: #24292F">    }),</span></li></ol></pre>
<ul>
  <li>Lines 38 - 40: Define the <code>acceptWager</code> function and print a statement in the console.</li>
</ul>
<p>Now that the computation is over, we'll get the balance again and show a message that prints the change in funds.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.mjs">rps-3-bets/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="44"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">afterAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">getBalance</span><span style="color: #24292F">(accAlice);</span></li><li value="45"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">afterBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">getBalance</span><span style="color: #24292F">(accBob);</span></li><li value="46"></li><li value="47"><span style="color: #24292F">  console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Alice went from ${</span><span style="color: #24292F">beforeAlice</span><span style="color: #0A3069">} to ${</span><span style="color: #24292F">afterAlice</span><span style="color: #0A3069">}.`</span><span style="color: #24292F">);</span></li><li value="48"><span style="color: #24292F">  console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Bob went from ${</span><span style="color: #24292F">beforeBob</span><span style="color: #0A3069">} to ${</span><span style="color: #24292F">afterBob</span><span style="color: #0A3069">}.`</span><span style="color: #24292F">);</span></li></ol></pre>
<ul>
  <li>Lines 44 &amp; 45: Gets the balance after the transaction.</li>
  <li>Lines 47 &amp; 48: Prints the before and after balances.</li>
</ul>
<p>The changes that we've made only address the presentation and interfacing of the <a href="https://docs.reach.sh/ref-model.html#%28tech._frontend%29">frontend</a>. The business logic and actual wagers and transfers of funds happen in the Reach code.</p>
<p>Let's focus on the backend, now. To begin, we'll update the <a href="https://docs.reach.sh/ref-programs-appinit.html#%28tech._participant._interact._interface%29">participant interact interface</a>.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.rsh">rps-3-bets/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #0A3069">'reach 0.1'</span><span style="color: #24292F">;</span></li><li value="2"></li><li value="3"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Player</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span></li><li value="4"><span style="color: #24292F">  getHand: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([], UInt),</span></li><li value="5"><span style="color: #24292F">  seeOutcome: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([UInt], Null),</span></li><li value="6"><span style="color: #24292F">};</span></li><li value="7"></li><li value="8"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">main</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> Reach.</span><span style="color: #8250DF">App</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="9"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Alice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">Participant</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Alice'</span><span style="color: #24292F">, {</span></li><li value="10"><span style="color: #24292F">    </span><span style="color: #CF222E">...</span><span style="color: #24292F">Player,</span></li><li value="11"><span style="color: #24292F">    wager: UInt,</span></li><li value="12"><span style="color: #24292F">  });</span></li><li value="13"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Bob</span><span style="color: #24292F">   </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">Participant</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Bob'</span><span style="color: #24292F">, {</span></li><li value="14"><span style="color: #24292F">    </span><span style="color: #CF222E">...</span><span style="color: #24292F">Player,</span></li><li value="15"><span style="color: #24292F">    acceptWager: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([UInt], Null),</span></li><li value="16"><span style="color: #24292F">  });</span></li><li value="17"><span style="color: #24292F">  </span><span style="color: #8250DF">deploy</span><span style="color: #24292F">();</span></li><li value="18"></li><li value="19"><span style="color: #24292F">  Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li></ol></pre>
<ul>
  <li>Lines 9 - 12: Defines Alice's interface as the <code>Player</code> interface and an integer value, <code>wager</code>.</li>
  <li>Lines 13 - 16: Define Bob's interface along with a called <code>acceptWager</code>, which can look at the wager value.</li>
</ul>
<h2 id="updating-the-application">Updating the Application<a aria-hidden="true" tabindex="-1" href="#updating-the-application"><span class="icon icon-link"></span></a></h2>
<p>Next, we'll need to update each of the three parts of the application so it can work with the wager. We'll begin with Alice:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.rsh">rps-3-bets/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="19"><span style="color: #24292F">  Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="20"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">wager</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.wager);</span></li><li value="21"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">handAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.</span><span style="color: #8250DF">getHand</span><span style="color: #24292F">());</span></li><li value="22"><span style="color: #24292F">  });</span></li><li value="23"><span style="color: #24292F">  Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(wager, handAlice)</span></li><li value="24"><span style="color: #24292F">    .</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(wager);</span></li><li value="25"><span style="color: #24292F">  </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li></ol></pre>
<ul>
  <li>Line 20: <a href="https://docs.reach.sh/ref-programs-local.html#%28tech._declassify%29">Declassifies</a> the wager for transmission on the consensus network.</li>
  <li>Line 23: Adds the <code>wager</code> method so Alice can share her wager with Bob.</li>
  <li>Line 24: Alice transfers her wager as part of her <a href="https://docs.reach.sh/ref-model.html#%28tech._publication%29">publication</a>. If <code>wager</code> did not appear in line 23 but did in line 24, then the compiler would throw an exception. <em>Change the program and try for yourself.</em> The <a href="https://docs.reach.sh/ref-model.html#%28tech._consensus._network%29">consensus network</a> needs to verify that the amount of <a href="https://docs.reach.sh/ref-model.html#%28tech._network._token%29">network tokens</a> in Alice's publication match the computation available to the consensus network.</li>
</ul>
<h2 id="accept-and-transfer-funds">Accept and Transfer Funds<a aria-hidden="true" tabindex="-1" href="#accept-and-transfer-funds"><span class="icon icon-link"></span></a></h2>
<p>Next, Bob will be given the ability to be shown the wager, and have the opportunity to accept it, then transfer funds.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.rsh">rps-3-bets/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="27"><span style="color: #24292F">  Bob.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="28"><span style="color: #24292F">    interact.</span><span style="color: #8250DF">acceptWager</span><span style="color: #24292F">(wager);</span></li><li value="29"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">handBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.</span><span style="color: #8250DF">getHand</span><span style="color: #24292F">());</span></li><li value="30"><span style="color: #24292F">  });</span></li><li value="31"><span style="color: #24292F">  Bob.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(handBob)</span></li><li value="32"><span style="color: #24292F">    .</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(wager);</span></li></ol></pre>
<ul>
  <li>Line 28: Bob accepts the wager. At this point, if Bob doesn't like the terms, his frontend can simply not respond to this method and the <a href="https://docs.reach.sh/ref-model.html#%28tech._dapp%29">dApp</a> will stall.</li>
  <li>Line 32: Bob pays the wager</li>
</ul>
<p>At this point, the dApp is running in a <a href="https://docs.reach.sh/ref-model.html#%28tech._consensus._step%29">consensus step</a> and the contract itself will now hold twice the wager amount. Previously, it would compute the outcome and then commit the state. Now, it needs to look at the outcome and use it to balance the account.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.rsh">rps-3-bets/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="34"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">outcome</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (handAlice </span><span style="color: #CF222E">+</span><span style="color: #24292F"> (</span><span style="color: #0550AE">4</span><span style="color: #24292F"> </span><span style="color: #CF222E">-</span><span style="color: #24292F"> handBob)) </span><span style="color: #CF222E">%</span><span style="color: #24292F"> </span><span style="color: #0550AE">3</span><span style="color: #24292F">;</span></li><li value="35"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F">            [</span><span style="color: #0550AE">forAlice</span><span style="color: #24292F">, </span><span style="color: #0550AE">forBob</span><span style="color: #24292F">] </span><span style="color: #CF222E">=</span></li><li value="36"><span style="color: #24292F">    outcome </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">2</span><span style="color: #24292F"> </span><span style="color: #CF222E">?</span><span style="color: #24292F"> [       </span><span style="color: #0550AE">2</span><span style="color: #24292F">,      </span><span style="color: #0550AE">0</span><span style="color: #24292F">] </span><span style="color: #CF222E">:</span></li><li value="37"><span style="color: #24292F">    outcome </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">0</span><span style="color: #24292F"> </span><span style="color: #CF222E">?</span><span style="color: #24292F"> [       </span><span style="color: #0550AE">0</span><span style="color: #24292F">,      </span><span style="color: #0550AE">2</span><span style="color: #24292F">] </span><span style="color: #CF222E">:</span></li><li value="38"><span style="color: #24292F">    </span><span style="color: #6E7781">/* tie      */</span><span style="color: #24292F"> [       </span><span style="color: #0550AE">1</span><span style="color: #24292F">,      </span><span style="color: #0550AE">1</span><span style="color: #24292F">];</span></li><li value="39"><span style="color: #24292F">  </span><span style="color: #8250DF">transfer</span><span style="color: #24292F">(forAlice </span><span style="color: #CF222E">*</span><span style="color: #24292F"> wager).</span><span style="color: #8250DF">to</span><span style="color: #24292F">(Alice);</span></li><li value="40"><span style="color: #24292F">  </span><span style="color: #8250DF">transfer</span><span style="color: #24292F">(forBob   </span><span style="color: #CF222E">*</span><span style="color: #24292F"> wager).</span><span style="color: #8250DF">to</span><span style="color: #24292F">(Bob);</span></li><li value="41"><span style="color: #24292F">  </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li></ol></pre>
<ul>
  <li>Lines 35 - 38: Compute the amounts given to each participant depending on the outcome. If the outcome is 2 then Alice wins and she receives two portions of the wager amount. If the outcome is 0 then Bob wins and collects the portions. In a draw, both participants receive 1 portion, each.</li>
  <li>Lines 39 - 40: Transfer the wagers. Funds reside inside the contract, so the transfer always takes place from the contract to the participants. In this manner, participants do not need to trust one another in order to honestly play the game.</li>
  <li>Line 41: Commits the state of the application and allows the participants to see the outcome and completes the contract.</li>
</ul>
<p>We can now run the program and view its output.</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #24292F">$ reach run</span></li></ol></pre>
<p>Remember, players act randomly, so your results may vary. This is the output I received from three playthroughs:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #24292F">Alice played Paper</span></li><li value="2"><span style="color: #24292F">Bob accepts the wager of 5.</span></li><li value="3"><span style="color: #24292F">Bob played Rock</span></li><li value="4"><span style="color: #24292F">Alice saw outcome Alice wins</span></li><li value="5"><span style="color: #24292F">Bob saw outcome Alice wins</span></li><li value="6"><span style="color: #24292F">Alice went from 100 to 104.9999.</span></li><li value="7"><span style="color: #24292F">Bob went from 100 to 94.9999.</span></li><li value="8"></li><li value="9"><span style="color: #24292F">$ reach run</span></li><li value="10"><span style="color: #24292F">Alice played Paper</span></li><li value="11"><span style="color: #24292F">Bob accepts the wager of 5.</span></li><li value="12"><span style="color: #24292F">Bob played Scissors</span></li><li value="13"><span style="color: #24292F">Alice saw outcome Bob wins</span></li><li value="14"><span style="color: #24292F">Bob saw outcome Bob wins</span></li><li value="15"><span style="color: #24292F">Alice went from 100 to 94.9999.</span></li><li value="16"><span style="color: #24292F">Bob went from 100 to 104.9999.</span></li><li value="17"></li><li value="18"><span style="color: #24292F">$ reach run</span></li><li value="19"><span style="color: #24292F">Alice played Rock</span></li><li value="20"><span style="color: #24292F">Bob accepts the wager of 5.</span></li><li value="21"><span style="color: #24292F">Bob played Scissors</span></li><li value="22"><span style="color: #24292F">Alice saw outcome Alice wins</span></li><li value="23"><span style="color: #24292F">Bob saw outcome Alice wins</span></li><li value="24"><span style="color: #24292F">Alice went from 100 to 104.9999.</span></li><li value="25"><span style="color: #24292F">Bob went from 100 to 94.9999.</span></li></ol></pre>
<p>Alice is playing strong. Soon she'll have a fortune from playing <em>Rock, Paper, Scissors!</em></p>
<p>You may have noticed that Alice and Bob always return to a balance of 100. This is because <code>reach run</code> creates fresh accounts for both players. Remember, we've hard coded a balance of 100 network tokens for this tutorial.</p>
<p>Don't deploy this game on the mainnet! It turns out that now we have an incentive to play that there is a major security vulnerability. Let's fix this before Alice goes broke from a dishonest Bob!</p>
<blockquote>
  <h1 id="check-your-understanding-2">Check Your Understanding<a aria-hidden="true" tabindex="-1" href="#check-your-understanding-2"><span class="icon icon-link"></span></a></h1>
  <p>How do Reach programs manage token funds?</p>
  <ol>
    <li>They don't; you need to manage them explicitly in parallel to the Reach program</li>
    <li>The pay primitive can be added to a publish primitive to send funds to the Reach program, which can then use the transfer primitive to send funds back to participants, and other addresses.</li>
  </ol>
</blockquote>
<h1 id="trust-commitments-and-attacks">Trust, Commitments, and Attacks<a aria-hidden="true" tabindex="-1" href="#trust-commitments-and-attacks"><span class="icon icon-link"></span></a></h1>
<p>Alice and Bob are now able to exchange currency, but there is a fundamental flaw in our program: Bob is able to win every game!</p>
<p>How so, when we've seen Alice win so many games?</p>
<p>The problem is that we've only executed an <a href="https://docs.reach.sh/ref-model.html#%28tech._honest%29">honest</a> version of Bob. However, it's possible for a dishonest Bob to execute different code in his <a href="https://docs.reach.sh/ref-model.html#%28tech._backend%29">backend</a> so that he always wins by computing the winning hand based on information Alice shares in <code>handAlice</code>.</p>
<p>Let's give Bob a dishonest advantage:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-4-attack/index.rsh#L27-L32">rps-4-attack/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="27"><span style="color: #24292F">  Bob.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="28"><span style="color: #24292F">    interact.</span><span style="color: #8250DF">acceptWager</span><span style="color: #24292F">(wager);</span></li><li value="29"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">handBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (handAlice </span><span style="color: #CF222E">+</span><span style="color: #24292F"> </span><span style="color: #0550AE">1</span><span style="color: #24292F">) </span><span style="color: #CF222E">%</span><span style="color: #24292F"> </span><span style="color: #0550AE">3</span><span style="color: #24292F">;</span></li><li value="30"><span style="color: #24292F">  });</span></li><li value="31"><span style="color: #24292F">  Bob.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(handBob)</span></li><li value="32"><span style="color: #24292F">    .</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(wager);</span></li></ol></pre>
<p>Now Bob will ignore the frontend and compute the correct value.</p>
<p>Running the program will return an output similar to this:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"></li><li value="2"><span style="color: #24292F">$ reach run</span></li><li value="3"><span style="color: #24292F">Alice played Scissors</span></li><li value="4"><span style="color: #24292F">Bob accepts the wager of 5.</span></li><li value="5"><span style="color: #24292F">Alice saw outcome Bob wins</span></li><li value="6"><span style="color: #24292F">Bob saw outcome Bob wins</span></li><li value="7"><span style="color: #24292F">Alice went from 100 to 94.9999.</span></li><li value="8"><span style="color: #24292F">Bob went from 100 to 104.9999.</span></li></ol></pre>
<p>We can see from the output that Bob never consults the frontend. Bob will never print his hand and he will always win.</p>
<h2 id="automatic-verification-engine">Automatic Verification Engine<a aria-hidden="true" tabindex="-1" href="#automatic-verification-engine"><span class="icon icon-link"></span></a></h2>
<p>How do we know it's not just luck of the random number generator that observes Bob winning? Reach comes with an automatic verification engine that mathematically proves that this version always results in the <code>outcome</code> equaling 0, meaning Bob wins. We can prove this theorem with the <code>require</code> and <code>assert</code> statements after computing the <code>outcome</code>.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-4-attack/index.rsh#L34-L37">rps-4-attack/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="34"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">outcome</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (handAlice </span><span style="color: #CF222E">+</span><span style="color: #24292F"> (</span><span style="color: #0550AE">4</span><span style="color: #24292F"> </span><span style="color: #CF222E">-</span><span style="color: #24292F"> handBob)) </span><span style="color: #CF222E">%</span><span style="color: #24292F"> </span><span style="color: #0550AE">3</span><span style="color: #24292F">;</span></li><li value="35"><span style="color: #24292F">  </span><span style="color: #0550AE">require</span><span style="color: #24292F">(handBob </span><span style="color: #CF222E">==</span><span style="color: #24292F"> (handAlice </span><span style="color: #CF222E">+</span><span style="color: #24292F"> </span><span style="color: #0550AE">1</span><span style="color: #24292F">) </span><span style="color: #CF222E">%</span><span style="color: #24292F"> </span><span style="color: #0550AE">3</span><span style="color: #24292F">);</span></li><li value="36"><span style="color: #24292F">  </span><span style="color: #8250DF">assert</span><span style="color: #24292F">(outcome </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">0</span><span style="color: #24292F">);</span></li><li value="37"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F">            [</span><span style="color: #0550AE">forAlice</span><span style="color: #24292F">, </span><span style="color: #0550AE">forBob</span><span style="color: #24292F">] </span><span style="color: #CF222E">=</span></li></ol></pre>
<ul>
  <li>Line 35: Requires that the dishonest version of Bob be used for the proof.</li>
  <li>Line 36: Conducts the proof by including an <a href="https://docs.reach.sh/ref-model.html#%28tech._assert%29">assert</a> statement in the program.</li>
</ul>
<p>Now our verification engine checks an additional 5 theorems and prints this when compiled:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #24292F">..    // ...</span></li><li value="2"><span style="color: #24292F"> 2    Verifying </span><span style="color: #CF222E">for</span><span style="color: #24292F"> generic connector</span></li><li value="3"><span style="color: #24292F"> 3      Verifying when ALL participants are honest</span></li><li value="4"><span style="color: #24292F"> 4      Verifying when NO participants are honest</span></li><li value="5"><span style="color: #24292F"> 5      Verifying when ONLY </span><span style="color: #0A3069">"Alice"</span><span style="color: #24292F"> is honest</span></li><li value="6"><span style="color: #24292F"> 6      Verifying when ONLY </span><span style="color: #0A3069">"Bob"</span><span style="color: #24292F"> is honest</span></li><li value="7"><span style="color: #24292F"> 7    Checked 23 theorems</span><span style="color: #CF222E">;</span><span style="color: #24292F"> No failures</span><span style="color: #CF222E">!</span></li></ol></pre>
<p>At compile time, Reach conducts a mathematical proof that the expression always evaluates to <code>true</code>. We use the <a href="https://docs.reach.sh/guide-assert.html">verification engine</a> to prove that an attack would do what we expect. But it's better to use verification to show that <em>no flaws</em> exist and that <em>no attack</em> is possible.</p>
<p>Reach will check a certain number of theorems even without explicit <code>require</code> and <code>assert</code> statements. Let's see these theorems in action by inserting an error into the program.</p>
<p>First, undo the recent changes we made. So, we'll remove the <code>require</code> and <code>assert</code> statements and return <code>handBob</code> to its previous expression.</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #0550AE">29</span><span style="color: #24292F">        </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">handBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.</span><span style="color: #8250DF">getHand</span><span style="color: #24292F">());</span></li></ol></pre>
<p>Find the payout computation and alter it so that when Alice wins, she only gets her wager back, not Bob's, as well.</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #0550AE">34</span><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">outcome</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (handAlice </span><span style="color: #CF222E">+</span><span style="color: #24292F"> (</span><span style="color: #0550AE">4</span><span style="color: #24292F"> </span><span style="color: #CF222E">-</span><span style="color: #24292F"> handBob)) </span><span style="color: #CF222E">%</span><span style="color: #24292F"> </span><span style="color: #0550AE">3</span><span style="color: #24292F">;</span></li><li value="2"><span style="color: #0550AE">35</span><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F">            [</span><span style="color: #0550AE">forAlice</span><span style="color: #24292F">, </span><span style="color: #0550AE">forBob</span><span style="color: #24292F">] </span><span style="color: #CF222E">=</span></li><li value="3"><span style="color: #0550AE">36</span><span style="color: #24292F">        outcome </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">2</span><span style="color: #24292F"> </span><span style="color: #CF222E">?</span><span style="color: #24292F"> [       </span><span style="color: #0550AE">1</span><span style="color: #24292F">,      </span><span style="color: #0550AE">0</span><span style="color: #24292F">] </span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #6E7781">// &lt;- Oops. was: [2, 0]</span></li><li value="4"><span style="color: #0550AE">37</span><span style="color: #24292F">        outcome </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">0</span><span style="color: #24292F"> </span><span style="color: #CF222E">?</span><span style="color: #24292F"> [       </span><span style="color: #0550AE">0</span><span style="color: #24292F">,      </span><span style="color: #0550AE">2</span><span style="color: #24292F">] </span><span style="color: #CF222E">:</span></li><li value="5"><span style="color: #0550AE">38</span><span style="color: #24292F">        </span><span style="color: #6E7781">/* tie      */</span><span style="color: #24292F"> [       </span><span style="color: #0550AE">1</span><span style="color: #24292F">,      </span><span style="color: #0550AE">1</span><span style="color: #24292F">];</span></li><li value="6"><span style="color: #0550AE">39</span><span style="color: #24292F">      </span><span style="color: #8250DF">transfer</span><span style="color: #24292F">(forAlice </span><span style="color: #CF222E">*</span><span style="color: #24292F"> wager).</span><span style="color: #8250DF">to</span><span style="color: #24292F">(Alice);</span></li><li value="7"><span style="color: #0550AE">40</span><span style="color: #24292F">      </span><span style="color: #8250DF">transfer</span><span style="color: #24292F">(forBob </span><span style="color: #CF222E">*</span><span style="color: #24292F"> wager).</span><span style="color: #8250DF">to</span><span style="color: #24292F">(Bob);</span></li><li value="8"><span style="color: #0550AE">41</span><span style="color: #24292F">      </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li></ol></pre>
<ul>
  <li>Line 36 is now [1, 0].</li>
</ul>
<p>Running <code>$ reach compile</code> will share details about the error:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #24292F">..    </span></li><li value="2"><span style="color: #24292F"> 4    Verification failed:</span></li><li value="3"><span style="color: #24292F"> 5      when ALL participants are honest</span></li><li value="4"><span style="color: #24292F"> 6      of theorem: assert</span></li><li value="5"><span style="color: #24292F"> 7      msg: </span><span style="color: #0A3069">"balance zero at application exit"</span></li><li value="6"><span style="color: #24292F"> 8      at ./index-bad.rsh:8:30:compileDApp</span></li><li value="7"><span style="color: #24292F"> 9    </span></li><li value="8"><span style="color: #24292F">10      // Violation Witness</span></li><li value="9"><span style="color: #24292F">11    </span></li><li value="10"><span style="color: #24292F">12      const v71 = </span><span style="color: #0A3069">"Alice"</span><span style="color: #24292F">.interact.wager</span><span style="color: #CF222E">;</span></li><li value="11"><span style="color: #24292F">13      //    ^ could = 1</span></li><li value="12"><span style="color: #24292F">14      //      from: ./index-bad.rsh:11:10:property binding</span></li><li value="13"><span style="color: #24292F">15      const v74 = </span><span style="color: #8250DF">protect&lt;UInt&gt;("Alice".interact.getHand</span><span style="color: #24292F">());</span></li><li value="14"><span style="color: #24292F">16      //    ^ could = 0</span></li><li value="15"><span style="color: #24292F">17      //      from: ./index-bad.rsh:21:50:application</span></li><li value="16"><span style="color: #24292F">18      const v84 = </span><span style="color: #8250DF">protect&lt;UInt&gt;("Bob".interact.getHand</span><span style="color: #24292F">());</span></li><li value="17"><span style="color: #24292F">19      //    ^ could = 2</span></li><li value="18"><span style="color: #24292F">20      //      from: ./index-bad.rsh:29:48:application</span></li><li value="19"><span style="color: #24292F">21    </span></li><li value="20"><span style="color: #24292F">22      // Theorem Formalization</span></li><li value="21"><span style="color: #24292F">23    </span></li><li value="22"><span style="color: #24292F">24      const v93 = (v74 + (4 - v84)) % 3</span><span style="color: #CF222E">;</span></li><li value="23"><span style="color: #24292F">25      //    ^ would be 2</span></li><li value="24"><span style="color: #24292F">26      const v100 = (v93 == 2) </span><span style="color: #CF222E">?</span><span style="color: #24292F"> [1, 0 ] </span><span style="color: #0550AE">:</span><span style="color: #24292F"> (v93 == 0) </span><span style="color: #CF222E">?</span><span style="color: #24292F"> [0, 2 ] </span><span style="color: #0550AE">:</span><span style="color: #24292F"> [1, 1 ]</span><span style="color: #CF222E">;</span></li><li value="25"><span style="color: #24292F">27      //    ^ would be [1, 0 ]</span></li><li value="26"><span style="color: #24292F">28      const v114 = 0 == </span><span style="color: #0A3069">(((v</span><span style="color: #0550AE">71</span><span style="color: #0A3069"> </span><span style="color: #CF222E">+</span><span style="color: #0A3069"> v</span><span style="color: #0550AE">71</span><span style="color: #0A3069">) </span><span style="color: #CF222E">-</span><span style="color: #0A3069"> (v</span><span style="color: #0550AE">100</span><span style="color: #0A3069">[</span><span style="color: #0550AE">0</span><span style="color: #0A3069">] </span><span style="color: #CF222E">*</span><span style="color: #0A3069"> v</span><span style="color: #0550AE">71</span><span style="color: #0A3069">))</span><span style="color: #24292F"> - (v100[1] </span><span style="color: #CF222E">*</span><span style="color: #24292F"> v71))</span><span style="color: #CF222E">;</span></li><li value="27"><span style="color: #24292F">29      //    ^ would be </span><span style="color: #0550AE">false</span></li><li value="28"><span style="color: #24292F">30      assert(v114)</span><span style="color: #CF222E">;</span></li><li value="29"><span style="color: #24292F">31    </span></li><li value="30"><span style="color: #24292F">..</span></li></ol></pre>
<p>There's a lot of information here that you'll be able use with some experience. For now, we'll choose to focus on the most important parts:</p>
<ul>
  <li>Line 7 states an attempt to prove that the balance at the end of the program is zero. This is important because a balance left at the end of a program will result in tokens being sealed in the <a href="https://docs.reach.sh/ref-model.html#%28tech._contract%29">contract</a> forever.</li>
  <li>Lines 10 - 20: Describe values that will cause the theorem to fail.</li>
  <li>Lines 23 - 31: Detailed the theorem that failed.</li>
</ul>
<p>The <a href="https://docs.reach.sh/guide-assert.html">automatic verifications</a> help Reach programmers by protecting them from entire categories of errors.</p>
<h2 id="assertions">Assertions<a aria-hidden="true" tabindex="-1" href="#assertions"><span class="icon icon-link"></span></a></h2>
<p>Now, let's add an <a href="https://docs.reach.sh/ref-model.html#%28tech._assert%29">assert</a>ion that rejects a dishonest Bob. We'll rewind our code to the end of the Bets and Wagers section. In this version Bob is still honest. To help keep Bob honest, we'll add a single line after Alice publishes, but before Bob's <a href="https://docs.reach.sh/ref-model.html#%28tech._local._step%29">local step</a>:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #24292F">..    </span><span style="color: #6E7781">// ...</span></li><li value="2"><span style="color: #0550AE">23</span><span style="color: #24292F">    Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(wager, handAlice)</span></li><li value="3"><span style="color: #0550AE">24</span><span style="color: #24292F">      .</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(wager);</span></li><li value="4"><span style="color: #0550AE">25</span><span style="color: #24292F">    </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="5"><span style="color: #0550AE">26</span><span style="color: #24292F">    </span></li><li value="6"><span style="color: #0550AE">27</span><span style="color: #24292F">    </span><span style="color: #8250DF">unknowable</span><span style="color: #24292F">(Bob, </span><span style="color: #8250DF">Alice</span><span style="color: #24292F">(handAlice));</span></li><li value="7"><span style="color: #0550AE">28</span><span style="color: #24292F">    Bob.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="8"><span style="color: #0550AE">29</span><span style="color: #24292F">      interact.</span><span style="color: #8250DF">acceptWager</span><span style="color: #24292F">(wager);</span></li><li value="9"><span style="color: #0550AE">30</span><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">handBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.</span><span style="color: #8250DF">getHand</span><span style="color: #24292F">());</span></li><li value="10"><span style="color: #0550AE">31</span><span style="color: #24292F">    });</span></li><li value="11"><span style="color: #24292F">..    </span><span style="color: #6E7781">// ...</span></li></ol></pre>
<ul>
  <li>Line 27: Contains a knowledge assertion that Bob cannot know Alice's value in <code>handAlice</code>. Looking at line 23, we can see that this is not true. However, in most cases, it won't be so obvious.</li>
</ul>
<p>Running <code>$ reach run</code> will report that this assertion is false:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #24292F">..    </span></li><li value="2"><span style="color: #24292F"> 2    Verification failed:</span></li><li value="3"><span style="color: #24292F"> 3      of theorem unknowable(</span><span style="color: #0A3069">"Bob"</span><span style="color: #24292F">, handAlice/77)</span></li><li value="4"><span style="color: #24292F"> 4      at ./index-fails.rsh:27:13:application</span></li><li value="5"><span style="color: #24292F"> 5    </span></li><li value="6"><span style="color: #24292F"> 6      Bob knows of handAlice/77 because it is published.</span></li><li value="7"><span style="color: #24292F">..</span></li></ol></pre>
<p>It's not enough to correct failures and attacks as they are discovered. <strong>Always</strong> add asserts to your program where a failure or an attack would create an undesirable outcome. This will ensure that all similar attacks are not present or accidentally reintroduced.</p>
<h2 id="a-more-secure-version">A More Secure Version<a aria-hidden="true" tabindex="-1" href="#a-more-secure-version"><span class="icon icon-link"></span></a></h2>
<p>With this knowledge in mind, let's create a brand-new version of <em>Rock, Paper, Scissors!</em> so that it is more trustworthy and secure.</p>
<p>Let's begin by defining the rules of <em>Rock, Paper, Scissors!</em> with a greater amount of abstraction. This will allow us to separate the logic of the game from the details of the application.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-5-trust/index.rsh#L1-L7">rps-5-trust/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #0A3069">'reach 0.1'</span><span style="color: #24292F">;</span></li><li value="2"></li><li value="3"><span style="color: #CF222E">const</span><span style="color: #24292F"> [ </span><span style="color: #0550AE">isHand</span><span style="color: #24292F">, </span><span style="color: #0550AE">ROCK</span><span style="color: #24292F">, </span><span style="color: #0550AE">PAPER</span><span style="color: #24292F">, </span><span style="color: #0550AE">SCISSORS</span><span style="color: #24292F"> ] </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">makeEnum</span><span style="color: #24292F">(</span><span style="color: #0550AE">3</span><span style="color: #24292F">);</span></li><li value="4"><span style="color: #CF222E">const</span><span style="color: #24292F"> [ </span><span style="color: #0550AE">isOutcome</span><span style="color: #24292F">, </span><span style="color: #0550AE">B_WINS</span><span style="color: #24292F">, </span><span style="color: #0550AE">DRAW</span><span style="color: #24292F">, </span><span style="color: #0550AE">A_WINS</span><span style="color: #24292F"> ] </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">makeEnum</span><span style="color: #24292F">(</span><span style="color: #0550AE">3</span><span style="color: #24292F">);</span></li><li value="5"></li><li value="6"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">winner</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (</span><span style="color: #953800">handAlice</span><span style="color: #24292F">, </span><span style="color: #953800">handBob</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span></li><li value="7"><span style="color: #24292F">  ((handAlice </span><span style="color: #CF222E">+</span><span style="color: #24292F"> (</span><span style="color: #0550AE">4</span><span style="color: #24292F"> </span><span style="color: #CF222E">-</span><span style="color: #24292F"> handBob)) </span><span style="color: #CF222E">%</span><span style="color: #24292F"> </span><span style="color: #0550AE">3</span><span style="color: #24292F">);</span></li></ol></pre>
<ul>
  <li>Line 1: The Reach version header in all reach files</li>
  <li>Lines 3 - 4: Define <a href="https://docs.reach.sh/ref-programs-compute.html#%28tech._enumeration%29">enumeration</a>s for the hands that may be played, as well as the outcomes of the game.</li>
  <li>Lines 6 - 7: Defines the function that computes the winner of the game.</li>
</ul>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-5-trust/index.rsh#L9-L11">rps-5-trust/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="9"><span style="color: #8250DF">assert</span><span style="color: #24292F">(</span><span style="color: #8250DF">winner</span><span style="color: #24292F">(</span><span style="color: #0550AE">ROCK</span><span style="color: #24292F">, </span><span style="color: #0550AE">PAPER</span><span style="color: #24292F">) </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">B_WINS</span><span style="color: #24292F">);</span></li><li value="10"><span style="color: #8250DF">assert</span><span style="color: #24292F">(</span><span style="color: #8250DF">winner</span><span style="color: #24292F">(</span><span style="color: #0550AE">PAPER</span><span style="color: #24292F">, </span><span style="color: #0550AE">ROCK</span><span style="color: #24292F">) </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">A_WINS</span><span style="color: #24292F">);</span></li><li value="11"><span style="color: #8250DF">assert</span><span style="color: #24292F">(</span><span style="color: #8250DF">winner</span><span style="color: #24292F">(</span><span style="color: #0550AE">ROCK</span><span style="color: #24292F">, </span><span style="color: #0550AE">ROCK</span><span style="color: #24292F">) </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">DRAW</span><span style="color: #24292F">);</span></li></ol></pre>
<ul>
  <li>Lines 9 - 11: Test cases that assert a winner or a draw. This ensures that despite the values found in <code>handAlice</code> and <code>handBob</code>, <code>winner</code> will always be a valid outcome.</li>
</ul>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-5-trust/index.rsh#L13-L15">rps-5-trust/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="13"><span style="color: #8250DF">forall</span><span style="color: #24292F">(UInt, </span><span style="color: #953800">handAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=&gt;</span></li><li value="14"><span style="color: #24292F">  </span><span style="color: #8250DF">forall</span><span style="color: #24292F">(UInt, </span><span style="color: #953800">handBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=&gt;</span></li><li value="15"><span style="color: #24292F">    </span><span style="color: #8250DF">assert</span><span style="color: #24292F">(</span><span style="color: #8250DF">isOutcome</span><span style="color: #24292F">(</span><span style="color: #8250DF">winner</span><span style="color: #24292F">(handAlice, handBob)))));</span></li></ol></pre>
<p>Lines 13 - 15: Specifies that whenever the same value is provided for both hands that the <code>winner</code> value is <code>DRAW</code>.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-5-trust/index.rsh#L17-L18">rps-5-trust/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="17"><span style="color: #8250DF">forall</span><span style="color: #24292F">(UInt, (</span><span style="color: #953800">hand</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span></li><li value="18"><span style="color: #24292F">  </span><span style="color: #8250DF">assert</span><span style="color: #24292F">(</span><span style="color: #8250DF">winner</span><span style="color: #24292F">(hand, hand) </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">DRAW</span><span style="color: #24292F">));</span></li></ol></pre>
<ul>
  <li>Line 17: <code>forall</code> quantifies over all possible inputs for <code>hand</code>.</li>
  <li>Line 18: <code>assert</code> states that if the hand values are the same then the outcome is equal to <code>DRAW</code>.</li>
</ul>
<p>Next, we'll specify the participant interact interface for Alice and Bob.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-5-trust/index.rsh#L20-L24">rps-5-trust/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="20"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Player</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span></li><li value="21"><span style="color: #24292F">  </span><span style="color: #CF222E">...</span><span style="color: #24292F">hasRandom, </span><span style="color: #6E7781">// &lt;--- new!</span></li><li value="22"><span style="color: #24292F">  getHand: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([], UInt),</span></li><li value="23"><span style="color: #24292F">  seeOutcome: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([UInt], Null),</span></li><li value="24"><span style="color: #24292F">};</span></li></ol></pre>
<ul>
  <li>Line 21: Provides the frontend access to random numbers. This will be used to protect Alice's hand from a dishonest Bob.</li>
</ul>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-5-trust/index.mjs#L20-L30">rps-5-trust/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="20"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">Player</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (</span><span style="color: #953800">Who</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> ({</span></li><li value="21"><span style="color: #24292F">    </span><span style="color: #CF222E">...</span><span style="color: #24292F">stdlib.hasRandom, </span><span style="color: #6E7781">// &lt;--- new!</span></li><li value="22"><span style="color: #24292F">    </span><span style="color: #8250DF">getHand</span><span style="color: #24292F">: () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="23"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">hand</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">Math</span><span style="color: #24292F">.</span><span style="color: #0550AE">floor</span><span style="color: #24292F">(</span><span style="color: #0550AE">Math</span><span style="color: #24292F">.</span><span style="color: #0550AE">random</span><span style="color: #24292F">() </span><span style="color: #CF222E">*</span><span style="color: #24292F"> </span><span style="color: #0550AE">3</span><span style="color: #24292F">);</span></li><li value="24"><span style="color: #24292F">      console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`${</span><span style="color: #24292F">Who</span><span style="color: #0A3069">} played ${</span><span style="color: #0550AE">HAND</span><span style="color: #0A3069">[</span><span style="color: #24292F">hand</span><span style="color: #0A3069">]</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="25"><span style="color: #24292F">      </span><span style="color: #CF222E">return</span><span style="color: #24292F"> hand;</span></li><li value="26"><span style="color: #24292F">    },</span></li><li value="27"><span style="color: #24292F">    </span><span style="color: #8250DF">seeOutcome</span><span style="color: #24292F">: (</span><span style="color: #953800">outcome</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="28"><span style="color: #24292F">      console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`${</span><span style="color: #24292F">Who</span><span style="color: #0A3069">} saw outcome ${</span><span style="color: #0550AE">OUTCOME</span><span style="color: #0A3069">[</span><span style="color: #24292F">outcome</span><span style="color: #0A3069">]</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="29"><span style="color: #24292F">    },</span></li><li value="30"><span style="color: #24292F">  });</span></li></ol></pre>
<ul>
  <li>Line 21: Allows each participant to generate random numbers</li>
</ul>
<h2 id="randomness">Randomness<a aria-hidden="true" tabindex="-1" href="#randomness"><span class="icon icon-link"></span></a></h2>
<p>These two changes might look identical, but they mean very different things. The first, line 21 in the Reach program, adds <code>hasRandom</code> to the interface that the <a href="https://docs.reach.sh/ref-model.html#%28tech._backend%29">backend</a> expects the <a href="https://docs.reach.sh/ref-model.html#%28tech._frontend%29">frontend</a> to provide. The second, line 21 in the JavaScript, adds [hasRandom] to the implementation that the frontend provides to the backend.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-5-trust/index.rsh#L25-L36">rps-5-trust/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="25"></li><li value="26"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">main</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> Reach.</span><span style="color: #8250DF">App</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="27"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Alice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">Participant</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Alice'</span><span style="color: #24292F">, {</span></li><li value="28"><span style="color: #24292F">    </span><span style="color: #CF222E">...</span><span style="color: #24292F">Player,</span></li><li value="29"><span style="color: #24292F">    wager: UInt,</span></li><li value="30"><span style="color: #24292F">  });</span></li><li value="31"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Bob</span><span style="color: #24292F">   </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">Participant</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Bob'</span><span style="color: #24292F">, {</span></li><li value="32"><span style="color: #24292F">    </span><span style="color: #CF222E">...</span><span style="color: #24292F">Player,</span></li><li value="33"><span style="color: #24292F">    acceptWager: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([UInt], Null),</span></li><li value="34"><span style="color: #24292F">  });</span></li><li value="35"><span style="color: #24292F">  </span><span style="color: #8250DF">deploy</span><span style="color: #24292F">();</span></li><li value="36"></li></ol></pre>
<p>There is nothing new or exciting in this snippet. We're creating the Reach application and providing functionality to the participant interact interface.</p>
<p>In the next snippet, we'll implement the application while ensuring that Alice's hand is protected until Bob reveals his hand. We could just have Alice publish her wager, but then this would leave Bob vulnerable. Our challenge is that we need Alice to publish her hand, but also keep it secret. Our solution is to use a <a href="https://en.wikipedia.org/wiki/Commitment_scheme">cryptographic commitment scheme</a>. Reach’s standard library comes with <code>makeCommitment</code> to make this easier.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-5-trust/index.rsh#L37-L45">rps-5-trust/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="37"><span style="color: #24292F">  Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="38"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">wager</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.wager);</span></li><li value="39"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">_handAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> interact.</span><span style="color: #8250DF">getHand</span><span style="color: #24292F">();</span></li><li value="40"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> [</span><span style="color: #0550AE">_commitAlice</span><span style="color: #24292F">, </span><span style="color: #0550AE">_saltAlice</span><span style="color: #24292F">] </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">makeCommitment</span><span style="color: #24292F">(interact, _handAlice);</span></li><li value="41"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">commitAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(_commitAlice);</span></li><li value="42"><span style="color: #24292F">  });</span></li><li value="43"><span style="color: #24292F">  Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(wager, commitAlice)</span></li><li value="44"><span style="color: #24292F">    .</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(wager);</span></li><li value="45"><span style="color: #24292F">  </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li></ol></pre>
<ul>
  <li>Line 39: Alice computes her hand but does not declassify it.</li>
  <li>Line 40: Alice computes a commitment to her hand. We've added a secret "salt" value that was generated by the <code>random</code> function, which we'll reveal later.</li>
  <li>Line 41: Alice declassifies the commitment.</li>
  <li>Line 43: Alice publishes the commitment.</li>
  <li>Line 44: Includes Alice's wager funds in the publication.</li>
</ul>
<p>Next, we'll state the <a href="https://docs.reach.sh/ref-model.html#%28tech._knowledge._assertion%29">knowledge assertion</a> that Bob can't know either the hand or the "salt" and continue with his part of the program.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-5-trust/index.rsh#L47-L54">rps-5-trust/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="47"><span style="color: #24292F">  </span><span style="color: #8250DF">unknowable</span><span style="color: #24292F">(Bob, </span><span style="color: #8250DF">Alice</span><span style="color: #24292F">(_handAlice, _saltAlice));</span></li><li value="48"><span style="color: #24292F">  Bob.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="49"><span style="color: #24292F">    interact.</span><span style="color: #8250DF">acceptWager</span><span style="color: #24292F">(wager);</span></li><li value="50"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">handBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.</span><span style="color: #8250DF">getHand</span><span style="color: #24292F">());</span></li><li value="51"><span style="color: #24292F">  });</span></li><li value="52"><span style="color: #24292F">  Bob.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(handBob)</span></li><li value="53"><span style="color: #24292F">    .</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(wager);</span></li><li value="54"><span style="color: #24292F">  </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li></ol></pre>
<ul>
  <li>Line 47: States the <a href="https://docs.reach.sh/ref-model.html#%28tech._knowledge._assertion%29">knowledge assertion</a>.</li>
  <li>Lines 48 - 53: These lines are unchanged from the original version.</li>
  <li>Line 54: Transaction commit method. The payout isn't computed yet because Alice's hand is not currently public.</li>
</ul>
<p>Alice is ready to reveal her secrets so let's return our focus to her.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-5-trust/index.rsh#L56-L61">rps-5-trust/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="56"><span style="color: #24292F">  Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="57"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">saltAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(_saltAlice);</span></li><li value="58"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">handAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(_handAlice);</span></li><li value="59"><span style="color: #24292F">  });</span></li><li value="60"><span style="color: #24292F">  Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(saltAlice, handAlice);</span></li><li value="61"><span style="color: #24292F">  </span><span style="color: #8250DF">checkCommitment</span><span style="color: #24292F">(commitAlice, saltAlice, handAlice);</span></li></ol></pre>
<p>
  Lines 57 - 58: Alice declassifies the secret information.
  Line 60: Alice publishes the secret information.
  Line 61: Checks that the published values match the original values. This will always be true for honest participants, but dishonest participants may violate this assumption.
</p>
<p>The rest of the program is unchanged from the original version, except that it uses the new names for the outcomes.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-5-trust/index.rsh#L63-L74">rps-5-trust/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="63"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">outcome</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">winner</span><span style="color: #24292F">(handAlice, handBob);</span></li><li value="64"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F">                 [</span><span style="color: #0550AE">forAlice</span><span style="color: #24292F">, </span><span style="color: #0550AE">forBob</span><span style="color: #24292F">] </span><span style="color: #CF222E">=</span></li><li value="65"><span style="color: #24292F">    outcome </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">A_WINS</span><span style="color: #24292F"> </span><span style="color: #CF222E">?</span><span style="color: #24292F"> [       </span><span style="color: #0550AE">2</span><span style="color: #24292F">,      </span><span style="color: #0550AE">0</span><span style="color: #24292F">] </span><span style="color: #CF222E">:</span></li><li value="66"><span style="color: #24292F">    outcome </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">B_WINS</span><span style="color: #24292F"> </span><span style="color: #CF222E">?</span><span style="color: #24292F"> [       </span><span style="color: #0550AE">0</span><span style="color: #24292F">,      </span><span style="color: #0550AE">2</span><span style="color: #24292F">] </span><span style="color: #CF222E">:</span></li><li value="67"><span style="color: #24292F">    </span><span style="color: #6E7781">/* tie           */</span><span style="color: #24292F"> [       </span><span style="color: #0550AE">1</span><span style="color: #24292F">,      </span><span style="color: #0550AE">1</span><span style="color: #24292F">];</span></li><li value="68"><span style="color: #24292F">  </span><span style="color: #8250DF">transfer</span><span style="color: #24292F">(forAlice </span><span style="color: #CF222E">*</span><span style="color: #24292F"> wager).</span><span style="color: #8250DF">to</span><span style="color: #24292F">(Alice);</span></li><li value="69"><span style="color: #24292F">  </span><span style="color: #8250DF">transfer</span><span style="color: #24292F">(forBob   </span><span style="color: #CF222E">*</span><span style="color: #24292F"> wager).</span><span style="color: #8250DF">to</span><span style="color: #24292F">(Bob);</span></li><li value="70"><span style="color: #24292F">  </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="71"></li><li value="72"><span style="color: #24292F">  </span><span style="color: #8250DF">each</span><span style="color: #24292F">([Alice, Bob], () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="73"><span style="color: #24292F">    interact.</span><span style="color: #8250DF">seeOutcome</span><span style="color: #24292F">(outcome);</span></li><li value="74"><span style="color: #24292F">  });</span></li></ol></pre>
<p>We didn't change the frontend in a meaningful way so the output from <code>reach run</code> looks the same as before.</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #24292F">$ reach run</span></li><li value="2"><span style="color: #24292F">Alice played Scissors</span></li><li value="3"><span style="color: #24292F">Bob accepts the wager of 5.</span></li><li value="4"><span style="color: #24292F">Bob played Paper</span></li><li value="5"><span style="color: #24292F">Bob saw outcome Alice wins</span></li><li value="6"><span style="color: #24292F">Alice saw outcome Alice wins</span></li><li value="7"><span style="color: #24292F">Alice went from 100 to 104.9999.</span></li><li value="8"><span style="color: #24292F">Bob went from 100 to 94.9999.</span></li><li value="9"></li><li value="10"><span style="color: #24292F">$ reach run</span></li><li value="11"><span style="color: #24292F">Alice played Paper</span></li><li value="12"><span style="color: #24292F">Bob accepts the wager of 5.</span></li><li value="13"><span style="color: #24292F">Bob played Scissors</span></li><li value="14"><span style="color: #24292F">Bob saw outcome Bob wins</span></li><li value="15"><span style="color: #24292F">Alice saw outcome Bob wins</span></li><li value="16"><span style="color: #24292F">Alice went from 100 to 94.9999.</span></li><li value="17"><span style="color: #24292F">Bob went from 100 to 104.9999.</span></li><li value="18"></li><li value="19"><span style="color: #24292F">$ reach run</span></li><li value="20"><span style="color: #24292F">Alice played Scissors</span></li><li value="21"><span style="color: #24292F">Bob accepts the wager of 5.</span></li><li value="22"><span style="color: #24292F">Bob played Scissors</span></li><li value="23"><span style="color: #24292F">Bob saw outcome Draw</span></li><li value="24"><span style="color: #24292F">Alice saw outcome Draw</span></li><li value="25"><span style="color: #24292F">Alice went from 10 to 9.9999.</span></li><li value="26"><span style="color: #24292F">Bob went from 10 to 9.9999.</span></li></ol></pre>
<p>While the frontend looks the same, we know that behind the scenes, Alice now takes two steps in the Reach program and Bob only takes one. Alice is protected against Bob finding her hand and using it for his advantage.</p>
<p>You may have noticed that this version of the application proves more theorems which help protect Reach programs from a variety of human-errors. Non-Reach decentralized programmers are on their own when trying to ensure that these problems don't exist.</p>
<p>Our implementation of <em>Rock, Paper, Scissors!</em> is secure and free of exploits for Alice and Bob. However, there is a final category of mistakes that is common in dApps: non-participation.</p>
<p>As before, don't launch this version of <em>Rock, Paper, Scissors!</em> in the mainnet or Alice may ghost Bob when she knows she's going to lose!</p>
<blockquote>
  <h1 id="check-your-understanding-3">Check Your Understanding<a aria-hidden="true" tabindex="-1" href="#check-your-understanding-3"><span class="icon icon-link"></span></a></h1>
  <p>True or false: Since blockchain programs run on a single, global, publicly checked and certified consensus network, you don't need to test them as much as normal software, which run on a wide variety of different platforms and operating systems.</p>
</blockquote>
<blockquote>
  <p>True or false: It is easy to write correct programs that handle financial information, and even if you make a mistake, blockchains support an "Undo" operation that allows you to rollback to earlier versions of the leader to correct mistakes and recover lost funds.</p>
</blockquote>
<blockquote>
  <p>True or false: Reach provides automatic verifications to ensure that your program does not lose, lock away, or overspend funds and guarantees that your applications are free from entire categories of errors.</p>
</blockquote>
<blockquote>
  <p>True or false: Reach provides tools for you to add custom verifications to your program, like ensuring that information is known only to one party, or that your implementation of a sensitive algorithm is correct.</p>
</blockquote>
<h1 id="timeouts-and-participation">Timeouts and Participation<a aria-hidden="true" tabindex="-1" href="#timeouts-and-participation"><span class="icon icon-link"></span></a></h1>
<p>We've just removed a major security vulnerability. Way to avoid a scandal in the press! In this section, we'll focus on a subtle issue that is important and unique to decentralized applications: <a href="https://docs.reach.sh/guide-timeout.html">non-participation</a>.</p>
<p>Non-participation is the act of one party ceasing to continue playing their role in an application.</p>
<p>In traditional client-server programs this would be the equivalent of a client not sending additional requests to the server, or the server ceasing to send responses to the client. In centralized apps, non-participation is an exceptional circumstance that often leads to an error message for clients or a log entry for servers. Traditionally, developers have not needed to meticulously consider the consequences of non-participation.</p>
<p>However, in decentralized applications engineers must carefully consider the behavior of their dApp in the event of non-participation. Imagine if Alice pays her wager, but Bob never accepts. The application will not continue and Alice's <a href="https://docs.reach.sh/ref-model.html#%28tech._network._token%29">network tokens</a> will be locked away in the <a href="https://docs.reach.sh/ref-model.html#%28tech._contract%29">contract</a> forever. That wouldn't be too smart, right?</p>
<p>We can also imagine a scenario where Bob accepts and pays his wager, but Alice never submits her hand, locking away both of their funds forever. In either case, both parties would be hurt, and their fear of non-participation would increase the costs of each transaction and reduce the value of interacting with that contract.</p>
<p>Of course, for our tutorial, this is a trivial matter, but as a microcosm of decentralized application design, it is a consideration of extreme importance. Let's explore how Reach helps to address non-participation.</p>
<h2 id="mitigating-non-participation">Mitigating Non-Participation<a aria-hidden="true" tabindex="-1" href="#mitigating-non-participation"><span class="icon icon-link"></span></a></h2>
<p>In Reach, non-participation is mitigated through a "timeout" mechanism that pairs each <a href="https://docs.reach.sh/ref-model.html#%28tech._consensus._transfer%29">consensus transfer</a> with a <a href="https://docs.reach.sh/ref-model.html#%28tech._step%29">step</a> that occurs for all <a href="https://docs.reach.sh/ref-model.html#%28tech._participant%29">participants</a> if the <a href="https://docs.reach.sh/ref-model.html#%28tech._originator%29">originator</a> of the <a href="https://docs.reach.sh/ref-model.html#%28tech._consensus._transfer%29">consensus transfer</a> fails to make the required <a href="https://docs.reach.sh/ref-model.html#%28tech._publication%29">publication</a> before a particular network time.</p>
<p>Let's modify the <a href="https://docs.reach.sh/ref-programs-appinit.html#%28tech._participant._interact._interface%29">participant interact interface</a> to allow the <a href="https://docs.reach.sh/ref-model.html#%28tech._frontend%29">frontend</a> to be informed in the event of a timeout.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.rsh#L20-L25">rps-6-timeouts/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="20"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Player</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span></li><li value="21"><span style="color: #24292F">  </span><span style="color: #CF222E">...</span><span style="color: #24292F">hasRandom,</span></li><li value="22"><span style="color: #24292F">  getHand: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([], UInt),</span></li><li value="23"><span style="color: #24292F">  seeOutcome: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([UInt], Null),</span></li><li value="24"><span style="color: #24292F">  informTimeout: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([], Null),</span></li><li value="25"><span style="color: #24292F">};</span></li></ol></pre>
<ul>
  <li>Line 24: introduces a new method, <code>informTimeout</code>, which receives no arguments and returns no information. This function is called when a timeout occurs.</li>
</ul>
<p>Now let's update the JavaScript frontend so it can receive the message and display it in the console.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.mjs#L20-L33">rps-6-timeouts/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="20"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">Player</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (</span><span style="color: #953800">Who</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> ({</span></li><li value="21"><span style="color: #24292F">    </span><span style="color: #CF222E">...</span><span style="color: #24292F">stdlib.hasRandom,</span></li><li value="22"><span style="color: #24292F">    </span><span style="color: #8250DF">getHand</span><span style="color: #24292F">: () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="23"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">hand</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">Math</span><span style="color: #24292F">.</span><span style="color: #0550AE">floor</span><span style="color: #24292F">(</span><span style="color: #0550AE">Math</span><span style="color: #24292F">.</span><span style="color: #0550AE">random</span><span style="color: #24292F">() </span><span style="color: #CF222E">*</span><span style="color: #24292F"> </span><span style="color: #0550AE">3</span><span style="color: #24292F">);</span></li><li value="24"><span style="color: #24292F">      console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`${</span><span style="color: #24292F">Who</span><span style="color: #0A3069">} played ${</span><span style="color: #0550AE">HAND</span><span style="color: #0A3069">[</span><span style="color: #24292F">hand</span><span style="color: #0A3069">]</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="25"><span style="color: #24292F">      </span><span style="color: #CF222E">return</span><span style="color: #24292F"> hand;</span></li><li value="26"><span style="color: #24292F">    },</span></li><li value="27"><span style="color: #24292F">    </span><span style="color: #8250DF">seeOutcome</span><span style="color: #24292F">: (</span><span style="color: #953800">outcome</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="28"><span style="color: #24292F">      console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`${</span><span style="color: #24292F">Who</span><span style="color: #0A3069">} saw outcome ${</span><span style="color: #0550AE">OUTCOME</span><span style="color: #0A3069">[</span><span style="color: #24292F">outcome</span><span style="color: #0A3069">]</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="29"><span style="color: #24292F">    },</span></li><li value="30"><span style="color: #24292F">    </span><span style="color: #8250DF">informTimeout</span><span style="color: #24292F">: () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="31"><span style="color: #24292F">      console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`${</span><span style="color: #24292F">Who</span><span style="color: #0A3069">} observed a timeout`</span><span style="color: #24292F">);</span></li><li value="32"><span style="color: #24292F">    },</span></li><li value="33"><span style="color: #24292F">  });</span></li></ol></pre>
<ul>
  <li>Lines 30 - 32: The <code>informTimeout</code> object has been added with a message notifying the user that a timeout has occurred.</li>
</ul>
<p>We'll return to the Reach program and declare a deadline value. Alice will provide the deadline similar to how she provides the wager.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.rsh#L28-L32">rps-6-timeouts/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="28"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Alice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">Participant</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Alice'</span><span style="color: #24292F">, {</span></li><li value="29"><span style="color: #24292F">    </span><span style="color: #CF222E">...</span><span style="color: #24292F">Player,</span></li><li value="30"><span style="color: #24292F">    wager: UInt, </span><span style="color: #6E7781">// atomic units of currency</span></li><li value="31"><span style="color: #24292F">    deadline: UInt, </span><span style="color: #6E7781">// time delta (blocks/rounds)</span></li><li value="32"><span style="color: #24292F">  });</span></li></ol></pre>
<ul>
  <li>Line 31: <code>deadline</code> has been added to Alice's participant interact interface.</li>
</ul>
<p>Next, we'll define a helper function to inform each of the participants of the timeout.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.rsh#L39-L43">rps-6-timeouts/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="39"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">informTimeout</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="40"><span style="color: #24292F">    </span><span style="color: #8250DF">each</span><span style="color: #24292F">([Alice, Bob], () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="41"><span style="color: #24292F">      interact.</span><span style="color: #8250DF">informTimeout</span><span style="color: #24292F">();</span></li><li value="42"><span style="color: #24292F">    });</span></li><li value="43"><span style="color: #24292F">  };</span></li></ol></pre>
<ul>
  <li>Line 39: Defines an <a href="https://docs.reach.sh/ref-programs-compute.html#%28tech._arrow._expression%29">arrow expression</a> called <code>informTimeout</code></li>
  <li>Line 40: Has each of the participants perform a <a href="https://docs.reach.sh/ref-model.html#%28tech._local._step%29">local step</a>.</li>
  <li>Line 41: Has each participant call the <code>informTimeout</code> method.</li>
</ul>
<p>Our next step is to have Alice declassify and publish the <code>deadline</code> to use in future <a href="https://docs.reach.sh/ref-model.html#%28tech._timeout%29">timeout</a> clauses.</p>
<p>We won't add a timeout clause to Alice's first message because there's no consequence to her non-participation. She doesn't start the game, then no one is any worse off!</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.rsh#L45-L54">rps-6-timeouts/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="45"><span style="color: #24292F">  Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="46"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">wager</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.wager);</span></li><li value="47"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">_handAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> interact.</span><span style="color: #8250DF">getHand</span><span style="color: #24292F">();</span></li><li value="48"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> [</span><span style="color: #0550AE">_commitAlice</span><span style="color: #24292F">, </span><span style="color: #0550AE">_saltAlice</span><span style="color: #24292F">] </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">makeCommitment</span><span style="color: #24292F">(interact, _handAlice);</span></li><li value="49"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">commitAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(_commitAlice);</span></li><li value="50"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">deadline</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.deadline);</span></li><li value="51"><span style="color: #24292F">  });</span></li><li value="52"><span style="color: #24292F">  Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(wager, commitAlice, deadline)</span></li><li value="53"><span style="color: #24292F">    .</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(wager);</span></li><li value="54"><span style="color: #24292F">  </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li></ol></pre>
<ul>
  <li>Line 50: Alice declassifies the <code>deadline</code></li>
  <li>Line 51: Alice publishes the <code>deadline</code>.</li>
</ul>
<p>Bob's non-participation is different in nature than Alice's first opportunity for non-participation. If he fails to participate then Alice loses her initial wager. With this in mind, let's adjust Bob's first message.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.rsh#L61-L64">rps-6-timeouts/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="61"><span style="color: #24292F">  Bob.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(handBob)</span></li><li value="62"><span style="color: #24292F">    .</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(wager)</span></li><li value="63"><span style="color: #24292F">    .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #8250DF">relativeTime</span><span style="color: #24292F">(deadline), () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">closeTo</span><span style="color: #24292F">(Alice, informTimeout));</span></li><li value="64"><span style="color: #24292F">  </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li></ol></pre>
<ul>
  <li>Line 63 adds a timeout handler to Bob's <a href="https://docs.reach.sh/ref-model.html#%28tech._publication%29">publication</a>.</li>
</ul>
<h2 id="timeout-handler">Timeout Handler<a aria-hidden="true" tabindex="-1" href="#timeout-handler"><span class="icon icon-link"></span></a></h2>
<p>The timeout handler specifies that if the deadline is breached then the program will transition to the next step. In this case, the next step is to publish a message in the console and return the network tokens to Alice.</p>
<p>Next, we'll add a similar timeout handler to Alice's second message.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.rsh#L70-L71">rps-6-timeouts/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="70"><span style="color: #24292F">  Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(saltAlice, handAlice)</span></li><li value="71"><span style="color: #24292F">    .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #8250DF">relativeTime</span><span style="color: #24292F">(deadline), () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">closeTo</span><span style="color: #24292F">(Bob, informTimeout));</span></li></ol></pre>
<ul>
  <li>Lines 70 - 71: This is like our <code>timeout</code> handler in Bob's publication, but in this case, if Alice triggers the <code>timeout</code> event then Bob will collect all the funds.</li>
</ul>
<p>While it might be "fair" for Alice and Bob to each receive their own funds, this type of implementation would incentivize Alice to always timeout if she were going to lose, which she will know, because she'll know her hand and Bob's hand.</p>
<p>Our Reach program is now robust against non-participation attacks with a minimal addition of eleven lines!</p>
<p>For the purposes of our tutorial, we'll now modify the frontend to purposely cause a random timeout when Bob is supposed to accept the wager.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.rsh#L35-L54">rps-6-timeouts/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="35"><span style="color: #24292F">  </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #0550AE">Promise</span><span style="color: #24292F">.</span><span style="color: #8250DF">all</span><span style="color: #24292F">([</span></li><li value="36"><span style="color: #24292F">    ctcAlice.p.</span><span style="color: #8250DF">Alice</span><span style="color: #24292F">({</span></li><li value="37"><span style="color: #24292F">      </span><span style="color: #CF222E">...</span><span style="color: #8250DF">Player</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Alice'</span><span style="color: #24292F">),</span></li><li value="38"><span style="color: #24292F">      wager: stdlib.</span><span style="color: #8250DF">parseCurrency</span><span style="color: #24292F">(</span><span style="color: #0550AE">5</span><span style="color: #24292F">),</span></li><li value="39"><span style="color: #24292F">      deadline: </span><span style="color: #0550AE">10</span><span style="color: #24292F">,</span></li><li value="40"><span style="color: #24292F">    }),</span></li><li value="41"><span style="color: #24292F">    ctcBob.p.</span><span style="color: #8250DF">Bob</span><span style="color: #24292F">({</span></li><li value="42"><span style="color: #24292F">      </span><span style="color: #CF222E">...</span><span style="color: #8250DF">Player</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Bob'</span><span style="color: #24292F">),</span></li><li value="43"><span style="color: #24292F">      </span><span style="color: #8250DF">acceptWager</span><span style="color: #24292F">: </span><span style="color: #CF222E">async</span><span style="color: #24292F"> (</span><span style="color: #953800">amt</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> { </span><span style="color: #6E7781">// &lt;-- async now</span></li><li value="44"><span style="color: #24292F">        </span><span style="color: #CF222E">if</span><span style="color: #24292F"> ( </span><span style="color: #0550AE">Math</span><span style="color: #24292F">.</span><span style="color: #0550AE">random</span><span style="color: #24292F">() </span><span style="color: #CF222E">&lt;=</span><span style="color: #24292F"> </span><span style="color: #0550AE">0.5</span><span style="color: #24292F"> ) {</span></li><li value="45"><span style="color: #24292F">          </span><span style="color: #CF222E">for</span><span style="color: #24292F"> ( </span><span style="color: #CF222E">let</span><span style="color: #24292F"> i </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">0</span><span style="color: #24292F">; i </span><span style="color: #CF222E">&lt;</span><span style="color: #24292F"> </span><span style="color: #0550AE">10</span><span style="color: #24292F">; i</span><span style="color: #CF222E">++</span><span style="color: #24292F"> ) {</span></li><li value="46"><span style="color: #24292F">            console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`  Bob takes his sweet time...`</span><span style="color: #24292F">);</span></li><li value="47"><span style="color: #24292F">            </span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">wait</span><span style="color: #24292F">(</span><span style="color: #0550AE">1</span><span style="color: #24292F">);</span></li><li value="48"><span style="color: #24292F">          }</span></li><li value="49"><span style="color: #24292F">        } </span><span style="color: #CF222E">else</span><span style="color: #24292F"> {</span></li><li value="50"><span style="color: #24292F">          console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Bob accepts the wager of ${</span><span style="color: #8250DF">fmt</span><span style="color: #0A3069">(</span><span style="color: #24292F">amt</span><span style="color: #0A3069">)</span><span style="color: #0A3069">}.`</span><span style="color: #24292F">);</span></li><li value="51"><span style="color: #24292F">        }</span></li><li value="52"><span style="color: #24292F">      },</span></li><li value="53"><span style="color: #24292F">    }),</span></li><li value="54"><span style="color: #24292F">  ]);</span></li></ol></pre>
<ul>
  <li>Line 39: Alice specifies a <code>deadline</code> of ten blocks</li>
  <li>Lines 43 - 52: redefine Bob's <code>acceptWager</code> method as an asynchronous function.</li>
  <li>Lines 44 - 46: Now, half of the time Bob will trigger a timeout event.</li>
</ul>
<h2 id="run-with-timeouts">Run with Timeouts<a aria-hidden="true" tabindex="-1" href="#run-with-timeouts"><span class="icon icon-link"></span></a></h2>
<p>Let's observe two possible outcomes:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #24292F">$ reach run</span></li><li value="2"><span style="color: #24292F">Alice played Rock</span></li><li value="3"><span style="color: #24292F">Bob accepts the wager of 5.</span></li><li value="4"><span style="color: #24292F">Bob played Paper</span></li><li value="5"><span style="color: #24292F">Bob saw outcome Bob wins</span></li><li value="6"><span style="color: #24292F">Alice saw outcome Bob wins</span></li><li value="7"><span style="color: #24292F">Alice went from 100 to 94.9999.</span></li><li value="8"><span style="color: #24292F">Bob went from 100 to 104.9999.</span></li><li value="9"></li><li value="10"><span style="color: #24292F">$ reach run</span></li><li value="11"><span style="color: #24292F">Alice played Scissors</span></li><li value="12"><span style="color: #24292F">  Bob takes his sweet time...</span></li><li value="13"><span style="color: #24292F">  Bob takes his sweet time...</span></li><li value="14"><span style="color: #24292F">  Bob takes his sweet time...</span></li><li value="15"><span style="color: #24292F">  Bob takes his sweet time...</span></li><li value="16"><span style="color: #24292F">  Bob takes his sweet time...</span></li><li value="17"><span style="color: #24292F">  Bob takes his sweet time...</span></li><li value="18"><span style="color: #24292F">  Bob takes his sweet time...</span></li><li value="19"><span style="color: #24292F">  Bob takes his sweet time...</span></li><li value="20"><span style="color: #24292F">  Bob takes his sweet time...</span></li><li value="21"><span style="color: #24292F">  Bob takes his sweet time...</span></li><li value="22"><span style="color: #24292F">Bob played Scissors</span></li><li value="23"><span style="color: #24292F">Bob observed a timeout</span></li><li value="24"><span style="color: #24292F">Alice observed a timeout</span></li><li value="25"><span style="color: #24292F">Alice went from 10 to 9.9999.</span></li><li value="26"><span style="color: #24292F">Bob went from 10 to 9.9999.</span></li></ol></pre>
<p>We've now created a robust dApp that prevents either participant from dropping the game. If you'd like to dig into a deeper discussion on this subject, then visit our <a href="https://docs.reach.sh/guide-timeout.html">guide on non-participation</a>. In the next iteration, we'll extend the application to disallow draws.</p>
<blockquote>
  <h1 id="check-your-understanding-4">Check Your Understanding<a aria-hidden="true" tabindex="-1" href="#check-your-understanding-4"><span class="icon icon-link"></span></a></h1>
  <p>What happens in a decentralized application when one participant refuses to take the next step of the program?</p>
</blockquote>
<ol>
  <li>This is not possible, because the blockchain guarantees that each party performs a particular set of actions</li>
  <li>The program hangs forever waiting for a participant to provide a value</li>
  <li>The program punishes the non-participant and proceeds as if the active participant won.</li>
  <li>It depends on how the program was written; if the developer used Reach, the default is (2), but the developer could include a <code>timeout</code> block to implement the behavior in #3.</li>
</ol>
<h1 id="play-and-play-again">Play and Play Again<a aria-hidden="true" tabindex="-1" href="#play-and-play-again"><span class="icon icon-link"></span></a></h1>
<p>Our program is coming together, now, but it's not as fun to end on a draw. We can extend the application so Alice and Bob play until a winner is declared.</p>
<p>While this refactor will only require a change to the Reach program, we will also take the opportunity to modify the frontend so timeouts can happen to either party when they are asked to submit their hands. Let's do that now and then we'll focus on removing the ability to end on a draw.</p>
<p>We'll begin by modifying the <code>Player</code> interact object so that it will have a different <code>getHand</code> method.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.mjs#L20-L39">rps-7-loops/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="20"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">Player</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (</span><span style="color: #953800">Who</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> ({</span></li><li value="21"><span style="color: #24292F">    </span><span style="color: #CF222E">...</span><span style="color: #24292F">stdlib.hasRandom,</span></li><li value="22"><span style="color: #24292F">    </span><span style="color: #8250DF">getHand</span><span style="color: #24292F">: </span><span style="color: #CF222E">async</span><span style="color: #24292F"> () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> { </span><span style="color: #6E7781">// &lt;-- async now</span></li><li value="23"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">hand</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">Math</span><span style="color: #24292F">.</span><span style="color: #0550AE">floor</span><span style="color: #24292F">(</span><span style="color: #0550AE">Math</span><span style="color: #24292F">.</span><span style="color: #0550AE">random</span><span style="color: #24292F">() </span><span style="color: #CF222E">*</span><span style="color: #24292F"> </span><span style="color: #0550AE">3</span><span style="color: #24292F">);</span></li><li value="24"><span style="color: #24292F">      console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`${</span><span style="color: #24292F">Who</span><span style="color: #0A3069">} played ${</span><span style="color: #0550AE">HAND</span><span style="color: #0A3069">[</span><span style="color: #24292F">hand</span><span style="color: #0A3069">]</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="25"><span style="color: #24292F">      </span><span style="color: #CF222E">if</span><span style="color: #24292F"> ( </span><span style="color: #0550AE">Math</span><span style="color: #24292F">.</span><span style="color: #0550AE">random</span><span style="color: #24292F">() </span><span style="color: #CF222E">&lt;=</span><span style="color: #24292F"> </span><span style="color: #0550AE">0.01</span><span style="color: #24292F"> ) {</span></li><li value="26"><span style="color: #24292F">        </span><span style="color: #CF222E">for</span><span style="color: #24292F"> ( </span><span style="color: #CF222E">let</span><span style="color: #24292F"> i </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">0</span><span style="color: #24292F">; i </span><span style="color: #CF222E">&lt;</span><span style="color: #24292F"> </span><span style="color: #0550AE">10</span><span style="color: #24292F">; i</span><span style="color: #CF222E">++</span><span style="color: #24292F"> ) {</span></li><li value="27"><span style="color: #24292F">          console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`  ${</span><span style="color: #24292F">Who</span><span style="color: #0A3069">} takes their sweet time sending it back...`</span><span style="color: #24292F">);</span></li><li value="28"><span style="color: #24292F">          </span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">wait</span><span style="color: #24292F">(</span><span style="color: #0550AE">1</span><span style="color: #24292F">);</span></li><li value="29"><span style="color: #24292F">        }</span></li><li value="30"><span style="color: #24292F">      }</span></li><li value="31"><span style="color: #24292F">      </span><span style="color: #CF222E">return</span><span style="color: #24292F"> hand;</span></li><li value="32"><span style="color: #24292F">    },</span></li><li value="33"><span style="color: #24292F">    </span><span style="color: #8250DF">seeOutcome</span><span style="color: #24292F">: (</span><span style="color: #953800">outcome</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="34"><span style="color: #24292F">      console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`${</span><span style="color: #24292F">Who</span><span style="color: #0A3069">} saw outcome ${</span><span style="color: #0550AE">OUTCOME</span><span style="color: #0A3069">[</span><span style="color: #24292F">outcome</span><span style="color: #0A3069">]</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="35"><span style="color: #24292F">    },</span></li><li value="36"><span style="color: #24292F">    </span><span style="color: #8250DF">informTimeout</span><span style="color: #24292F">: () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="37"><span style="color: #24292F">      console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`${</span><span style="color: #24292F">Who</span><span style="color: #0A3069">} observed a timeout`</span><span style="color: #24292F">);</span></li><li value="38"><span style="color: #24292F">    },</span></li><li value="39"><span style="color: #24292F">  });</span></li></ol></pre>
<ul>
  <li>Lines 25 - 30: Moves the forced timeout code that we wrote for Bob's <code>acceptWager</code> function into the <code>getHand</code> method. We've also changed the threshold, so timeouts only happen 1% of the time.</li>
</ul>
<p>Next, we'll adjust Bob's <code>acceptWager</code> function to remove the timeout code.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.mjs#L41-L53">rps-7-loops/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="41"><span style="color: #24292F">  </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #0550AE">Promise</span><span style="color: #24292F">.</span><span style="color: #8250DF">all</span><span style="color: #24292F">([</span></li><li value="42"><span style="color: #24292F">    ctcAlice.p.</span><span style="color: #8250DF">Alice</span><span style="color: #24292F">({</span></li><li value="43"><span style="color: #24292F">      </span><span style="color: #CF222E">...</span><span style="color: #8250DF">Player</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Alice'</span><span style="color: #24292F">),</span></li><li value="44"><span style="color: #24292F">      wager: stdlib.</span><span style="color: #8250DF">parseCurrency</span><span style="color: #24292F">(</span><span style="color: #0550AE">5</span><span style="color: #24292F">),</span></li><li value="45"><span style="color: #24292F">      deadline: </span><span style="color: #0550AE">10</span><span style="color: #24292F">,</span></li><li value="46"><span style="color: #24292F">    }),</span></li><li value="47"><span style="color: #24292F">    ctcBob.p.</span><span style="color: #8250DF">Bob</span><span style="color: #24292F">({</span></li><li value="48"><span style="color: #24292F">      </span><span style="color: #CF222E">...</span><span style="color: #8250DF">Player</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Bob'</span><span style="color: #24292F">),</span></li><li value="49"><span style="color: #24292F">      </span><span style="color: #8250DF">acceptWager</span><span style="color: #24292F">: (</span><span style="color: #953800">amt</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="50"><span style="color: #24292F">        console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Bob accepts the wager of ${</span><span style="color: #8250DF">fmt</span><span style="color: #0A3069">(</span><span style="color: #24292F">amt</span><span style="color: #0A3069">)</span><span style="color: #0A3069">}.`</span><span style="color: #24292F">);</span></li><li value="51"><span style="color: #24292F">      },</span></li><li value="52"><span style="color: #24292F">    }),</span></li><li value="53"><span style="color: #24292F">  ]);</span></li></ol></pre>
<ul>
  <li>Lines 49 - 51: The <code>acceptWager</code> method has been simplified.</li>
</ul>
<h2 id="order-of-actions">Order of Actions<a aria-hidden="true" tabindex="-1" href="#order-of-actions"><span class="icon icon-link"></span></a></h2>
<p>Let's step back and look at our game's original steps and our new order of actions.</p>
<p>Previously, our steps were:</p>
<ol>
  <li>Alice sends her wager and commitment.</li>
  <li>Bob accepts the wager and sends his hand.</li>
  <li>Alice reveals her hand.</li>
  <li>The game ends.</li>
</ol>
<p>But now because players might submit many hands, but should only have a single wager, we'll break these steps up differently:</p>
<ol>
  <li>Alice sends her wager.</li>
  <li>Bob accepts the wager.</li>
  <li>Alice sends her commitment.</li>
  <li>Bob sends his hand.</li>
  <li>Alice reveals her hand.</li>
  <li>If the outcome is draw, return to step 3; otherwise, the game ends.</li>
</ol>
<p>Let's make these changes now.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.rsh#L45-L51">rps-7-loops/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="45"><span style="color: #24292F">      deadline: </span><span style="color: #0550AE">10</span><span style="color: #24292F">,</span></li><li value="46"><span style="color: #24292F">    }),</span></li><li value="47"><span style="color: #24292F">    ctcBob.p.</span><span style="color: #8250DF">Bob</span><span style="color: #24292F">({</span></li><li value="48"><span style="color: #24292F">      </span><span style="color: #CF222E">...</span><span style="color: #8250DF">Player</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Bob'</span><span style="color: #24292F">),</span></li><li value="49"><span style="color: #24292F">      </span><span style="color: #8250DF">acceptWager</span><span style="color: #24292F">: (</span><span style="color: #953800">amt</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="50"><span style="color: #24292F">        console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Bob accepts the wager of ${</span><span style="color: #8250DF">fmt</span><span style="color: #0A3069">(</span><span style="color: #24292F">amt</span><span style="color: #0A3069">)</span><span style="color: #0A3069">}.`</span><span style="color: #24292F">);</span></li><li value="51"><span style="color: #24292F">      },</span></li></ol></pre>
<ul>
  <li>Line 49: Alice publishes the wager and deadline.</li>
  <li>Line 50: Alice pays the wager.</li>
</ul>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.rsh#L53-L58">rps-7-loops/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="53"><span style="color: #24292F">  Bob.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="54"><span style="color: #24292F">    interact.</span><span style="color: #8250DF">acceptWager</span><span style="color: #24292F">(wager);</span></li><li value="55"><span style="color: #24292F">  });</span></li><li value="56"><span style="color: #24292F">  Bob.</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(wager)</span></li><li value="57"><span style="color: #24292F">    .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #8250DF">relativeTime</span><span style="color: #24292F">(deadline), () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">closeTo</span><span style="color: #24292F">(Alice, informTimeout));</span></li><li value="58"></li></ol></pre>
<ul>
  <li>Line 56: Bob pays the wager.</li>
  <li>Line 58: Does <strong>not</strong> have the previously implemented <a href="https://docs.reach.sh/ref-model.html#%28tech._consensus._step%29">consensus step</a> commit.</li>
</ul>
<h2 id="loop-invariants">Loop Invariants<a aria-hidden="true" tabindex="-1" href="#loop-invariants"><span class="icon icon-link"></span></a></h2>
<p>It's now time to begin the repeatable section of the application. Each party will repeatedly submit hands until the outcome is not a draw. In normal programming languages, such a circumstance would be implemented with a <code>while</code> loop, which is exactly what we'll do in Reach. However, <code>while</code> loops in Reach require extra care. We'll take our time working through loops in this tutorial. Upon your completion of the tutorial, you can learn more about loops in our <a href="https://docs.reach.sh/guide-loop-invs.html">guide</a>.</p>
<p>So far, our identifier bindings have been static and unchangeable. However, if this were the case with while loops, they would never start or terminate, because the loop condition would never change. So, we bind <code>while</code> loops using <code>var</code>.</p>
<p>Due to Reach's <a href="https://docs.reach.sh/guide-assert.html">automatic verification</a> engine, we need to make a statement about what properties of the program are invariant before and after a <code>while</code> loop body's execution. This is known as a "<a href="https://docs.reach.sh/guide-loop-invs.html">loop invariant</a>."</p>
<p>It's important to note that these loops <em>may only occur</em> inside <a href="https://docs.reach.sh/ref-model.html#%28tech._consensus._step%29">consensus steps</a>. This is why we didn't commit Bob's transaction, previously. We need to remain inside the consensus to start the <code>while</code> loop, because all <a href="https://docs.reach.sh/ref-model.html#%28tech._participant%29">participants</a> must agree on the direction of control flow in the dApp.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.rsh#L59-L61">rps-7-loops/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="59"><span style="color: #24292F">  </span><span style="color: #CF222E">var</span><span style="color: #24292F"> outcome </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">DRAW</span><span style="color: #24292F">;</span></li><li value="60"><span style="color: #24292F">  </span><span style="color: #8250DF">invariant</span><span style="color: #24292F">( </span><span style="color: #8250DF">balance</span><span style="color: #24292F">() </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">2</span><span style="color: #24292F"> </span><span style="color: #CF222E">*</span><span style="color: #24292F"> wager </span><span style="color: #CF222E">&amp;&amp;</span><span style="color: #24292F"> </span><span style="color: #8250DF">isOutcome</span><span style="color: #24292F">(outcome) );</span></li><li value="61"><span style="color: #24292F">  </span><span style="color: #CF222E">while</span><span style="color: #24292F"> ( outcome </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">DRAW</span><span style="color: #24292F"> ) {</span></li></ol></pre>
<ul>
  <li>Line 59: Defines the loop variable, <code>outcome</code></li>
  <li>Line 60: States the invariant as the body of the loop does not change the balance in the <a href="https://docs.reach.sh/ref-model.html#%28tech._contract%29">contract</a> account and that <code>outcome</code> is a valid outcome.</li>
  <li>Line 61: Begins the loop with the condition that it continues as long as the outcome is a draw.</li>
</ul>
<p>Now, we'll create the body of the loop, beginning with Alice's commitment to her hand.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.rsh#L61-L71">rps-7-loops/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="61"><span style="color: #24292F">  </span><span style="color: #CF222E">while</span><span style="color: #24292F"> ( outcome </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">DRAW</span><span style="color: #24292F"> ) {</span></li><li value="62"><span style="color: #24292F">    </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="63"></li><li value="64"><span style="color: #24292F">    Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="65"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">_handAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> interact.</span><span style="color: #8250DF">getHand</span><span style="color: #24292F">();</span></li><li value="66"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> [</span><span style="color: #0550AE">_commitAlice</span><span style="color: #24292F">, </span><span style="color: #0550AE">_saltAlice</span><span style="color: #24292F">] </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">makeCommitment</span><span style="color: #24292F">(interact, _handAlice);</span></li><li value="67"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">commitAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(_commitAlice);</span></li><li value="68"><span style="color: #24292F">    });</span></li><li value="69"><span style="color: #24292F">    Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(commitAlice)</span></li><li value="70"><span style="color: #24292F">      .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #8250DF">relativeTime</span><span style="color: #24292F">(deadline), () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">closeTo</span><span style="color: #24292F">(Bob, informTimeout));</span></li><li value="71"><span style="color: #24292F">    </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li></ol></pre>
<ul>
  <li>Line 62: Commits the last transaction. At the beginning of the loop, this commits Bob's acceptance of the wager, and in subsequent runs, publishes Alice's hand.</li>
  <li>Line 64 - 71: Similar to before, but now the wager is already known and paid.</li>
</ul>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.rsh#L73-L79">rps-7-loops/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="73"><span style="color: #24292F">    </span><span style="color: #8250DF">unknowable</span><span style="color: #24292F">(Bob, </span><span style="color: #8250DF">Alice</span><span style="color: #24292F">(_handAlice, _saltAlice));</span></li><li value="74"><span style="color: #24292F">    Bob.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="75"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">handBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.</span><span style="color: #8250DF">getHand</span><span style="color: #24292F">());</span></li><li value="76"><span style="color: #24292F">    });</span></li><li value="77"><span style="color: #24292F">    Bob.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(handBob)</span></li><li value="78"><span style="color: #24292F">      .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #8250DF">relativeTime</span><span style="color: #24292F">(deadline), () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">closeTo</span><span style="color: #24292F">(Alice, informTimeout));</span></li><li value="79"><span style="color: #24292F">    </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li></ol></pre>
<p>Bob's code is almost identical to the previous version, except that he's already accepted and paid the wager.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.rsh#L81-L87">rps-7-loops/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="81"><span style="color: #24292F">    Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="82"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">saltAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(_saltAlice);</span></li><li value="83"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">handAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(_handAlice);</span></li><li value="84"><span style="color: #24292F">    });</span></li><li value="85"><span style="color: #24292F">    Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(saltAlice, handAlice)</span></li><li value="86"><span style="color: #24292F">      .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #8250DF">relativeTime</span><span style="color: #24292F">(deadline), () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">closeTo</span><span style="color: #24292F">(Bob, informTimeout));</span></li><li value="87"><span style="color: #24292F">    </span><span style="color: #8250DF">checkCommitment</span><span style="color: #24292F">(commitAlice, saltAlice, handAlice);</span></li></ol></pre>
<p>Alice's next step is identical, because she is still revealing her hand in the same way.</p>
<p>Finally, we write the end of the loop:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.rsh#L89-L91">rps-7-loops/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="89"><span style="color: #24292F">    outcome </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">winner</span><span style="color: #24292F">(handAlice, handBob);</span></li><li value="90"><span style="color: #24292F">    </span><span style="color: #CF222E">continue</span><span style="color: #24292F">;</span></li><li value="91"><span style="color: #24292F">  }</span></li></ol></pre>
<ul>
  <li>Line 89: Updates the <code>outcome</code> loop variable with the new value.</li>
  <li>Line 90: Continues the loop. Unlike most programming languages, Reach <strong>requires</strong> that <code>continue</code> be <em>explicitly</em> written in the loop body.</li>
</ul>
<p>The rest of the program could be the same as before, except it now occurs outside of the loop. We'll make one additional simplification because we now know that the outcome can never be a draw.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.rsh#L93-L100">rps-7-loops/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="93"><span style="color: #24292F">  </span><span style="color: #8250DF">assert</span><span style="color: #24292F">(outcome </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">A_WINS</span><span style="color: #24292F"> </span><span style="color: #CF222E">||</span><span style="color: #24292F"> outcome </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">B_WINS</span><span style="color: #24292F">);</span></li><li value="94"><span style="color: #24292F">  </span><span style="color: #8250DF">transfer</span><span style="color: #24292F">(</span><span style="color: #0550AE">2</span><span style="color: #24292F"> </span><span style="color: #CF222E">*</span><span style="color: #24292F"> wager).</span><span style="color: #8250DF">to</span><span style="color: #24292F">(outcome </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">A_WINS</span><span style="color: #24292F"> </span><span style="color: #CF222E">?</span><span style="color: #24292F"> Alice </span><span style="color: #CF222E">:</span><span style="color: #24292F"> Bob);</span></li><li value="95"><span style="color: #24292F">  </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="96"></li><li value="97"><span style="color: #24292F">  </span><span style="color: #8250DF">each</span><span style="color: #24292F">([Alice, Bob], () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="98"><span style="color: #24292F">    interact.</span><span style="color: #8250DF">seeOutcome</span><span style="color: #24292F">(outcome);</span></li><li value="99"><span style="color: #24292F">  });</span></li><li value="100"><span style="color: #24292F">});</span></li></ol></pre>
<ul>
  <li>Line 93: Asserts the outcome is never "DRAW".</li>
  <li>Line 94: Transfers the funds to the winner.</li>
  <li>Line 95: Commits to the consensus network.</li>
  <li>Lines 97 - 99: Allows Alice and Bob to interact with the contract and see the outcome of the game.</li>
</ul>
<h2 id="run-without-draws">Run Without Draws<a aria-hidden="true" tabindex="-1" href="#run-without-draws"><span class="icon icon-link"></span></a></h2>
<p>Let's run the program to witness our loop in action:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #24292F">$ reach run</span></li><li value="2"><span style="color: #24292F">Bob accepts the wager of 5.</span></li><li value="3"><span style="color: #24292F">Alice played Paper</span></li><li value="4"><span style="color: #24292F">Bob played Rock</span></li><li value="5"><span style="color: #24292F">Bob saw outcome Alice wins</span></li><li value="6"><span style="color: #24292F">Alice saw outcome Alice wins</span></li><li value="7"><span style="color: #24292F">Alice went from 100 to 104.9999.</span></li><li value="8"><span style="color: #24292F">Bob went from 100 to 94.9999.</span></li><li value="9"></li><li value="10"><span style="color: #24292F">$ reach run</span></li><li value="11"><span style="color: #24292F">Bob accepts the wager of 5.</span></li><li value="12"><span style="color: #24292F">Alice played Rock</span></li><li value="13"><span style="color: #24292F">Bob played Rock</span></li><li value="14"><span style="color: #24292F">Alice played Paper</span></li><li value="15"><span style="color: #24292F">Bob played Scissors</span></li><li value="16"><span style="color: #24292F">Bob saw outcome Bob wins</span></li><li value="17"><span style="color: #24292F">Alice saw outcome Bob wins</span></li><li value="18"><span style="color: #24292F">Alice went from 100 to 94.9999.</span></li><li value="19"><span style="color: #24292F">Bob went from 100 to 104.9999.</span></li><li value="20"><span style="color: #24292F"> </span></li><li value="21"><span style="color: #24292F">$ reach run</span></li><li value="22"><span style="color: #24292F">Bob accepts the wager of 5.</span></li><li value="23"><span style="color: #24292F">Alice played Scissors</span></li><li value="24"><span style="color: #24292F">Bob played Rock</span></li><li value="25"><span style="color: #24292F">Bob saw outcome Bob wins</span></li><li value="26"><span style="color: #24292F">Alice saw outcome Bob wins</span></li><li value="27"><span style="color: #24292F">Alice went from 100 to 94.9999.</span></li><li value="28"><span style="color: #24292F">Bob went from 100 to 104.9999.</span></li></ol></pre>
<p>Your results will likely differ, but with enough runs, you should be able to see single round, and multi-round battles. Statistically, 1 out of every 100 games should result in a timeout, as well.</p>
<p>This implementation of <em>Rock, Paper, Scissors!</em> will always result in a pay-out, which is more exciting for every participant. In the next section, we'll learn how to exit "testing" mode with Reach and turn the JavaScript into an interactive <em>Rock, Paper, Scissors!</em> game with real users.</p>
<blockquote>
  <h1 id="check-your-understanding-5">Check Your Understanding<a aria-hidden="true" tabindex="-1" href="#check-your-understanding-5"><span class="icon icon-link"></span></a></h1>
  <p>How do you write an application in Reach that runs arbitrarily long, like a game of Rock, Paper, Scissors that is guaranteed to not end in a draw?</p>
</blockquote>
<ol>
  <li>This is not possible, because all Reach programs are finitely long</li>
  <li>You can use a <code>while</code> loop that runs until the outcome of the game is decided.</li>
</ol>
<blockquote>
  <p>When you check if a program with a <code>while</code> loop is correct, you need to have a property called a loop invariant. Which of the following statements must be true about the loop invariant?</p>
</blockquote>
<ol>
  <li>The part of the program before the <code>while</code> loop must establish the invariant.</li>
  <li>The condition and the body of the loop must establish the invariant.</li>
  <li>The negation of the condition and the invariant must establish any properties of the rest of the program.</li>
</ol>
<h1 id="interaction-and-independence">Interaction and Independence<a aria-hidden="true" tabindex="-1" href="#interaction-and-independence"><span class="icon icon-link"></span></a></h1>
<p>Previously, we eliminated the possibility of a DRAW in our Reach program and made very few changes in the JavaScript frontend. In this section, we won't make any changes to the backend. Instead, we'll customize the frontend to facilitate interactivity and provide the option to connect to a real consensus network.</p>
<h2 id="start-from-scratch">Start from Scratch<a aria-hidden="true" tabindex="-1" href="#start-from-scratch"><span class="icon icon-link"></span></a></h2>
<p>We'll start from scratch and show every line of the program, again. While much of the code will be like the previous version, for the sake of completeness, we'll show every line.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-8-interact/index.mjs#L1-L6">rps-8-interact/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">import</span><span style="color: #24292F"> { loadStdlib } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'@reach-sh/stdlib'</span><span style="color: #24292F">;</span></li><li value="2"><span style="color: #CF222E">import</span><span style="color: #24292F"> </span><span style="color: #0550AE">*</span><span style="color: #24292F"> </span><span style="color: #CF222E">as</span><span style="color: #24292F"> backend </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./build/index.main.mjs'</span><span style="color: #24292F">;</span></li><li value="3"><span style="color: #CF222E">import</span><span style="color: #24292F"> { ask, yesno, done } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'@reach-sh/stdlib/ask.mjs'</span><span style="color: #24292F">;</span></li><li value="4"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">stdlib</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">loadStdlib</span><span style="color: #24292F">(process.env);</span></li><li value="5"></li><li value="6"><span style="color: #24292F">(</span><span style="color: #CF222E">async</span><span style="color: #24292F"> () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li></ol></pre>
<ul>
  <li>Lines 1, 2, &amp; 4: Are the same as before; importing the standard library and backend.</li>
  <li>Line 3: Imports a helpful library for simple console applications called <code>ask.mjs</code> from the Reach standard library. We'll see how these three functions are used below.</li>
</ul>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-8-interact/index.mjs#L7-L12">rps-8-interact/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="7"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">isAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">ask</span><span style="color: #24292F">(</span></li><li value="8"><span style="color: #24292F">    </span><span style="color: #0A3069">`Are you Alice?`</span><span style="color: #24292F">,</span></li><li value="9"><span style="color: #24292F">    yesno</span></li><li value="10"><span style="color: #24292F">  );</span></li><li value="11"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">who</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> isAlice </span><span style="color: #CF222E">?</span><span style="color: #24292F"> </span><span style="color: #0A3069">'Alice'</span><span style="color: #24292F"> </span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0A3069">'Bob'</span><span style="color: #24292F">;</span></li><li value="12"></li></ol></pre>
<ul>
  <li>Lines 7 - 10: Asks whether the user is playing as Alice and expects a "Yes" or "No" answer. <code>ask</code> presents a prompt and collects a line of input until its argument does not error. <code>yesno</code> errors if it is not given "y" or "n".</li>
</ul>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-8-interact/index.mjs#L13-L29">rps-8-interact/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="13"><span style="color: #24292F">  console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Starting Rock, Paper, Scissors! as ${</span><span style="color: #24292F">who</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="14"></li><li value="15"><span style="color: #24292F">  </span><span style="color: #CF222E">let</span><span style="color: #24292F"> acc </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">null</span><span style="color: #24292F">;</span></li><li value="16"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">createAcc</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">ask</span><span style="color: #24292F">(</span></li><li value="17"><span style="color: #24292F">    </span><span style="color: #0A3069">`Would you like to create an account? (only possible on devnet)`</span><span style="color: #24292F">,</span></li><li value="18"><span style="color: #24292F">    yesno</span></li><li value="19"><span style="color: #24292F">  );</span></li><li value="20"><span style="color: #24292F">  </span><span style="color: #CF222E">if</span><span style="color: #24292F"> (createAcc) {</span></li><li value="21"><span style="color: #24292F">    acc </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">newTestAccount</span><span style="color: #24292F">(stdlib.</span><span style="color: #8250DF">parseCurrency</span><span style="color: #24292F">(</span><span style="color: #0550AE">1000</span><span style="color: #24292F">));</span></li><li value="22"><span style="color: #24292F">  } </span><span style="color: #CF222E">else</span><span style="color: #24292F"> {</span></li><li value="23"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">secret</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">ask</span><span style="color: #24292F">(</span></li><li value="24"><span style="color: #24292F">      </span><span style="color: #0A3069">`What is your account secret?`</span><span style="color: #24292F">,</span></li><li value="25"><span style="color: #24292F">      (</span><span style="color: #953800">x</span><span style="color: #24292F"> </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> x)</span></li><li value="26"><span style="color: #24292F">    );</span></li><li value="27"><span style="color: #24292F">    acc </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">newAccountFromSecret</span><span style="color: #24292F">(secret);</span></li><li value="28"><span style="color: #24292F">  }</span></li><li value="29"></li></ol></pre>
<ul>
  <li>Lines 16 - 19: Presents the user with the choice of creating a test account or inputting a secret to load an existing account.</li>
  <li>Line 21: Creates the test account.</li>
  <li>Line 27: Loads the existing account.</li>
</ul>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-8-interact/index.mjs#L30-L46">rps-8-interact/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="30"><span style="color: #24292F">  </span><span style="color: #CF222E">let</span><span style="color: #24292F"> ctc </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">null</span><span style="color: #24292F">;</span></li><li value="31"><span style="color: #24292F">  </span><span style="color: #CF222E">if</span><span style="color: #24292F"> (isAlice) {</span></li><li value="32"><span style="color: #24292F">    ctc </span><span style="color: #CF222E">=</span><span style="color: #24292F"> acc.</span><span style="color: #8250DF">contract</span><span style="color: #24292F">(backend);</span></li><li value="33"><span style="color: #24292F">    ctc.</span><span style="color: #8250DF">getInfo</span><span style="color: #24292F">().</span><span style="color: #8250DF">then</span><span style="color: #24292F">((</span><span style="color: #953800">info</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="34"><span style="color: #24292F">      console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`The contract is deployed as = ${</span><span style="color: #0550AE">JSON</span><span style="color: #0A3069">.</span><span style="color: #0550AE">stringify</span><span style="color: #0A3069">(</span><span style="color: #24292F">info</span><span style="color: #0A3069">)</span><span style="color: #0A3069">}`</span><span style="color: #24292F">); });</span></li><li value="35"><span style="color: #24292F">  } </span><span style="color: #CF222E">else</span><span style="color: #24292F"> {</span></li><li value="36"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">info</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">ask</span><span style="color: #24292F">(</span></li><li value="37"><span style="color: #24292F">      </span><span style="color: #0A3069">`Please paste the contract information:`</span><span style="color: #24292F">,</span></li><li value="38"><span style="color: #24292F">      </span><span style="color: #0550AE">JSON</span><span style="color: #24292F">.</span><span style="color: #0550AE">parse</span></li><li value="39"><span style="color: #24292F">    );</span></li><li value="40"><span style="color: #24292F">    ctc </span><span style="color: #CF222E">=</span><span style="color: #24292F"> acc.</span><span style="color: #8250DF">contract</span><span style="color: #24292F">(backend, info);</span></li><li value="41"><span style="color: #24292F">  }</span></li><li value="42"></li><li value="43"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">fmt</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (</span><span style="color: #953800">x</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">formatCurrency</span><span style="color: #24292F">(x, </span><span style="color: #0550AE">4</span><span style="color: #24292F">);</span></li><li value="44"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">getBalance</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">async</span><span style="color: #24292F"> () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">fmt</span><span style="color: #24292F">(</span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">balanceOf</span><span style="color: #24292F">(acc));</span></li><li value="45"></li><li value="46"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">before</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">getBalance</span><span style="color: #24292F">();</span></li></ol></pre>
<ul>
  <li>Lines 31 - 34: Ask if the participant will deploy the contract.</li>
  <li>Lines 36 - 38: deploy it and print out public information (<code>ctc.getInfo</code>) that can be given to the other player when it becomes available.</li>
  <li>Lines 40 - 44: Request, parse, and process the information.</li>
</ul>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-8-interact/index.mjs#L47-L54">rps-8-interact/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="47"><span style="color: #24292F">  console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Your balance is ${</span><span style="color: #24292F">before</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="48"></li><li value="49"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">interact</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> { </span><span style="color: #CF222E">...</span><span style="color: #24292F">stdlib.hasRandom };</span></li><li value="50"></li><li value="51"><span style="color: #24292F">  interact.</span><span style="color: #8250DF">informTimeout</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="52"><span style="color: #24292F">    console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`There was a timeout.`</span><span style="color: #24292F">);</span></li><li value="53"><span style="color: #24292F">    process.</span><span style="color: #8250DF">exit</span><span style="color: #24292F">(</span><span style="color: #0550AE">1</span><span style="color: #24292F">);</span></li><li value="54"><span style="color: #24292F">  };</span></li></ol></pre>
<p>Next, we define a few helper functions and start the participant interaction interface.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-8-interact/index.mjs#L55-L59">rps-8-interact/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="55"></li><li value="56"><span style="color: #24292F">  </span><span style="color: #CF222E">if</span><span style="color: #24292F"> (isAlice) {</span></li><li value="57"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">amt</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">ask</span><span style="color: #24292F">(</span></li><li value="58"><span style="color: #24292F">      </span><span style="color: #0A3069">`How much do you want to wager?`</span><span style="color: #24292F">,</span></li><li value="59"><span style="color: #24292F">      stdlib.parseCurrency</span></li></ol></pre>
<ul>
  <li>Lines 55 - 58: Define a timeout handler</li>
</ul>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-8-interact/index.mjs#L60-L78">rps-8-interact/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="60"><span style="color: #24292F">    );</span></li><li value="61"><span style="color: #24292F">    interact.wager </span><span style="color: #CF222E">=</span><span style="color: #24292F"> amt;</span></li><li value="62"><span style="color: #24292F">    interact.deadline </span><span style="color: #CF222E">=</span><span style="color: #24292F"> { ETH: </span><span style="color: #0550AE">100</span><span style="color: #24292F">, ALGO: </span><span style="color: #0550AE">100</span><span style="color: #24292F">, CFX: </span><span style="color: #0550AE">1000</span><span style="color: #24292F"> }[stdlib.connector];</span></li><li value="63"><span style="color: #24292F">  } </span><span style="color: #CF222E">else</span><span style="color: #24292F"> {</span></li><li value="64"><span style="color: #24292F">    interact.</span><span style="color: #8250DF">acceptWager</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">async</span><span style="color: #24292F"> (</span><span style="color: #953800">amt</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="65"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">accepted</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">ask</span><span style="color: #24292F">(</span></li><li value="66"><span style="color: #24292F">        </span><span style="color: #0A3069">`Do you accept the wager of ${</span><span style="color: #8250DF">fmt</span><span style="color: #0A3069">(</span><span style="color: #24292F">amt</span><span style="color: #0A3069">)</span><span style="color: #0A3069">}?`</span><span style="color: #24292F">,</span></li><li value="67"><span style="color: #24292F">        yesno</span></li><li value="68"><span style="color: #24292F">      );</span></li><li value="69"><span style="color: #24292F">      </span><span style="color: #CF222E">if</span><span style="color: #24292F"> (</span><span style="color: #CF222E">!</span><span style="color: #24292F">accepted) {</span></li><li value="70"><span style="color: #24292F">        process.</span><span style="color: #8250DF">exit</span><span style="color: #24292F">(</span><span style="color: #0550AE">0</span><span style="color: #24292F">);</span></li><li value="71"><span style="color: #24292F">      }</span></li><li value="72"><span style="color: #24292F">    };</span></li><li value="73"><span style="color: #24292F">  }</span></li><li value="74"></li><li value="75"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">HAND</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> [</span><span style="color: #0A3069">'Rock'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Paper'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Scissors'</span><span style="color: #24292F">];</span></li><li value="76"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">HANDS</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span></li><li value="77"><span style="color: #24292F">    </span><span style="color: #0A3069">'Rock'</span><span style="color: #24292F">: </span><span style="color: #0550AE">0</span><span style="color: #24292F">, </span><span style="color: #0A3069">'R'</span><span style="color: #24292F">: </span><span style="color: #0550AE">0</span><span style="color: #24292F">, </span><span style="color: #0A3069">'r'</span><span style="color: #24292F">: </span><span style="color: #0550AE">0</span><span style="color: #24292F">,</span></li><li value="78"><span style="color: #24292F">    </span><span style="color: #0A3069">'Paper'</span><span style="color: #24292F">: </span><span style="color: #0550AE">1</span><span style="color: #24292F">, </span><span style="color: #0A3069">'P'</span><span style="color: #24292F">: </span><span style="color: #0550AE">1</span><span style="color: #24292F">, </span><span style="color: #0A3069">'p'</span><span style="color: #24292F">: </span><span style="color: #0550AE">1</span><span style="color: #24292F">,</span></li></ol></pre>
<p>Next, we request the wager amount or define the <code>acceptWager</code> method, depending on if we are Alice or not.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-8-interact/index.mjs#L79-L97">rps-8-interact/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="79"><span style="color: #24292F">    </span><span style="color: #0A3069">'Scissors'</span><span style="color: #24292F">: </span><span style="color: #0550AE">2</span><span style="color: #24292F">, </span><span style="color: #0A3069">'S'</span><span style="color: #24292F">: </span><span style="color: #0550AE">2</span><span style="color: #24292F">, </span><span style="color: #0A3069">'s'</span><span style="color: #24292F">: </span><span style="color: #0550AE">2</span><span style="color: #24292F">,</span></li><li value="80"><span style="color: #24292F">  };</span></li><li value="81"></li><li value="82"><span style="color: #24292F">  interact.</span><span style="color: #8250DF">getHand</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">async</span><span style="color: #24292F"> () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="83"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">hand</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">ask</span><span style="color: #24292F">(</span><span style="color: #0A3069">`What hand will you play?`</span><span style="color: #24292F">, (</span><span style="color: #953800">x</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="84"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">hand</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">HANDS</span><span style="color: #24292F">[x];</span></li><li value="85"><span style="color: #24292F">      </span><span style="color: #CF222E">if</span><span style="color: #24292F"> ( hand </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">null</span><span style="color: #24292F"> ) {</span></li><li value="86"><span style="color: #24292F">        </span><span style="color: #CF222E">throw</span><span style="color: #24292F"> </span><span style="color: #0550AE">Error</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Not a valid hand ${</span><span style="color: #24292F">hand</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="87"><span style="color: #24292F">      }</span></li><li value="88"><span style="color: #24292F">      </span><span style="color: #CF222E">return</span><span style="color: #24292F"> hand;</span></li><li value="89"><span style="color: #24292F">    });</span></li><li value="90"><span style="color: #24292F">    console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`You played ${</span><span style="color: #0550AE">HAND</span><span style="color: #0A3069">[</span><span style="color: #24292F">hand</span><span style="color: #0A3069">]</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="91"><span style="color: #24292F">    </span><span style="color: #CF222E">return</span><span style="color: #24292F"> hand;</span></li><li value="92"><span style="color: #24292F">  };</span></li><li value="93"></li><li value="94"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">OUTCOME</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> [</span><span style="color: #0A3069">'Bob wins'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Draw'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Alice wins'</span><span style="color: #24292F">];</span></li><li value="95"><span style="color: #24292F">  interact.</span><span style="color: #8250DF">seeOutcome</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">async</span><span style="color: #24292F"> (</span><span style="color: #953800">outcome</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="96"><span style="color: #24292F">    console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`The outcome is: ${</span><span style="color: #0550AE">OUTCOME</span><span style="color: #0A3069">[</span><span style="color: #24292F">outcome</span><span style="color: #0A3069">]</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="97"><span style="color: #24292F">  };</span></li></ol></pre>
<p>Lines 86 - 96: Defines the shared <code>getHand</code> method.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-8-interact/index.mjs#L98-L102">rps-8-interact/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="98"></li><li value="99"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">part</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> isAlice </span><span style="color: #CF222E">?</span><span style="color: #24292F"> ctc.p.Alice </span><span style="color: #CF222E">:</span><span style="color: #24292F"> ctc.p.Bob;</span></li><li value="100"><span style="color: #24292F">  </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">part</span><span style="color: #24292F">(interact);</span></li><li value="101"></li><li value="102"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">after</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">getBalance</span><span style="color: #24292F">();</span></li></ol></pre>
<ul>
  <li>Lines 98 - 101: Creates the <code>seeOutcome</code> method.</li>
</ul>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-8-interact/index.mjs#L103-L110">rps-8-interact/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="103"><span style="color: #24292F">  console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Your balance is now ${</span><span style="color: #24292F">after</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="104"></li><li value="105"><span style="color: #24292F">  </span><span style="color: #8250DF">done</span><span style="color: #24292F">();</span></li><li value="106"><span style="color: #24292F">})();</span></li></ol></pre>
<p>Line 103: Chooses the appropriate backend function and awaits its completion.</p>
<h2 id="run-in-two-terminals">Run in Two Terminals<a aria-hidden="true" tabindex="-1" href="#run-in-two-terminals"><span class="icon icon-link"></span></a></h2>
<p>We can now open two terminals. Run the first as Alice and the second as Bob:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #24292F">$ reach run</span></li><li value="2"><span style="color: #24292F">Are you Alice</span><span style="color: #CF222E">?</span></li><li value="3"><span style="color: #24292F">y</span></li><li value="4"><span style="color: #24292F">Starting Rock, Paper, Scissors as Alice</span></li><li value="5"><span style="color: #24292F">Would you like to create an account</span><span style="color: #CF222E">?</span><span style="color: #24292F"> (only possible on devnet)</span></li><li value="6"><span style="color: #24292F">y</span></li><li value="7"><span style="color: #24292F">Do you want to deploy the contract</span><span style="color: #CF222E">?</span><span style="color: #24292F"> (y/n)</span></li><li value="8"><span style="color: #24292F">y</span></li><li value="9"><span style="color: #24292F">The contract is deployed as = </span><span style="color: #0A3069">"0x132b724e55AEb074C15A5CBb7b8EeE0dBEd45F7b"</span></li><li value="10"><span style="color: #24292F">Your balance is 999.9999</span></li><li value="11"><span style="color: #24292F">How much </span><span style="color: #CF222E">do</span><span style="color: #24292F"> you want to wager</span><span style="color: #CF222E">?</span></li><li value="12"><span style="color: #24292F">10</span></li><li value="13"><span style="color: #24292F">What hand will you play</span><span style="color: #CF222E">?</span></li><li value="14"><span style="color: #24292F">r</span></li><li value="15"><span style="color: #24292F">You played Rock</span></li><li value="16"><span style="color: #24292F">The outcome is: Bob wins</span></li><li value="17"><span style="color: #24292F">Your balance is now 989.9999</span></li></ol></pre>
<p>and for Bob:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #24292F">$ reach run</span></li><li value="2"><span style="color: #24292F">Are you Alice</span><span style="color: #CF222E">?</span></li><li value="3"><span style="color: #24292F">n</span></li><li value="4"><span style="color: #24292F">Starting Rock, Paper, Scissors as Bob</span></li><li value="5"><span style="color: #24292F">Would you like to create an account</span><span style="color: #CF222E">?</span><span style="color: #24292F"> (only possible on devnet)</span></li><li value="6"><span style="color: #24292F">y</span></li><li value="7"><span style="color: #24292F">Do you want to deploy the contract</span><span style="color: #CF222E">?</span><span style="color: #24292F"> (y/n)</span></li><li value="8"><span style="color: #24292F">n</span></li><li value="9"><span style="color: #24292F">Please paste the contract information:</span></li><li value="10"><span style="color: #0A3069">"0x132b724e55AEb074C15A5CBb7b8EeE0dBEd45F7b"</span></li><li value="11"><span style="color: #24292F">Your balance is 1000</span></li><li value="12"><span style="color: #24292F">Do you accept the wager of 10</span><span style="color: #CF222E">?</span></li><li value="13"><span style="color: #24292F">y</span></li><li value="14"><span style="color: #24292F">What hand will you play</span><span style="color: #CF222E">?</span></li><li value="15"><span style="color: #24292F">p</span></li><li value="16"><span style="color: #24292F">You played Paper</span></li><li value="17"><span style="color: #24292F">The outcome is: Bob wins</span></li><li value="18"><span style="color: #24292F">Your balance is now 1009.9999</span></li></ol></pre>
<p>When you run your versions of Alice and Bob your exact amounts and addresses may be different.</p>
<p>If we wanted to run our program on the Algorand devnet then we'd set the Reach connector mode with the following command in both terminals:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #24292F">$ REACH_CONNECTOR_MODE=ALGO-devnet reach run</span></li></ol></pre>
<p>Connecting to live <a href="https://docs.reach.sh/ref-model.html#%28tech._consensus._network%29">consensus networks</a> is similarly easy:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #24292F">$ REACH_CONNECTOR_MODE=ETH-live ETH_NODE_URI=</span><span style="color: #0A3069">"http://some.node.fqdn:8545"</span><span style="color: #24292F"> reach run</span></li></ol></pre>
<h2 id="completing-the-command-line-interface">Completing the Command-Line Interface<a aria-hidden="true" tabindex="-1" href="#completing-the-command-line-interface"><span class="icon icon-link"></span></a></h2>
<p>Our implementation of <em>Rock, Paper, Scissors!</em> is now finished! We are protected against attacks, timeouts, and draws and can run interactively on non-test networks.</p>
<p>In this step we made a command-line interface for each participant. In the next section, we'll create a web interface.</p>
<blockquote>
  <h1 id="check-your-understanding-6">Check Your Understanding<a aria-hidden="true" tabindex="-1" href="#check-your-understanding-6"><span class="icon icon-link"></span></a></h1>
  <p>Reach helps you build automated tests for your decentralized application, but it doesn't support building interactive user-interfaces.</p>
</blockquote>
<h1 id="web-interaction-with-react">Web Interaction with React<a aria-hidden="true" tabindex="-1" href="#web-interaction-with-react"><span class="icon icon-link"></span></a></h1>
<p>Just as before, we won't be making any changes to the backend Reach program. Instead, we're going to focus on replacing the command-line interface with a web interface.</p>
<p>We'll use <a href="https://reactjs.org/">React.js</a> for this tutorial, but the same principles apply to any web framework.</p>
<h2 id="reactjs-basics">React.js Basics<a aria-hidden="true" tabindex="-1" href="#reactjs-basics"><span class="icon icon-link"></span></a></h2>
<p>If you’ve never used React before, here are some basics about how it works:</p>
<ul>
  <li>React programs are JavaScript programs that use a special library that allows you to mix HTML inside of the body of your JavaScript.</li>
  <li>React has a special compiler that combines a bundle of JavaScript programs, and all their dependencies, into one large file that can be deployed on a static Web server. This is called "packing".</li>
  <li>When you’re developing and testing with React, you run a special development Web server that watches and updates this packed file every time you modify a source file, so you don’t have to constantly run the compiler.</li>
  <li>Reach automates the process of starting this development server for you when you run ./reach react and gives you access to it at <a href="http://localhost:3000/">http://localhost:3000/</a>.</li>
</ul>
<h2 id="deploying">Deploying<a aria-hidden="true" tabindex="-1" href="#deploying"><span class="icon icon-link"></span></a></h2>
<p>This tutorial assumes we're deploying and testing with Ethereum. Reach web applications rely on the web browser to provide access to a consensus network account and its associated wallet. Ethereum’s standard wallet is <a href="https://metamask.io/">MetaMask</a>. Install and set it up if you want to test this code.</p>
<blockquote>
  <p>Note that MetaMask does not support multiple active accounts, so testing locally will require the use of two separate browser instances with two MetaMask accounts: one to act as Alice and the other as Bob.</p>
</blockquote>
<p>To complete this section, we'll use the <code>index.rsh</code> file you've already written but create an <code>index.js</code> file from scratch. This will replace the <code>index.mjs</code> file we wrote for the command-line interface.</p>
<p>This code is supplemented with <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/index.css">index.css</a> and some <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/views">views</a>. These details are not specific to Reach, and are trivial, so we will not explain the specific of those files. If you run this locally, you'll want to download those file. Your directory should look like:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #0550AE">.</span></li><li value="2"><span style="color: #24292F">├── index.css</span></li><li value="3"><span style="color: #24292F">├── index.js</span></li><li value="4"><span style="color: #24292F">├── index.rsh</span></li><li value="5"><span style="color: #24292F">└── views</span></li><li value="6"><span style="color: #24292F">    ├── AppViews.js</span></li><li value="7"><span style="color: #24292F">    ├── AttacherViews.js</span></li><li value="8"><span style="color: #24292F">    ├── DeployerViews.js</span></li><li value="9"><span style="color: #24292F">    ├── PlayerViews.js</span></li><li value="10"><span style="color: #24292F">    └── render.js</span></li></ol></pre>
<h2 id="react-frontend">React Frontend<a aria-hidden="true" tabindex="-1" href="#react-frontend"><span class="icon icon-link"></span></a></h2>
<p>Let's begin writing the new JavaScript frontend.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/index.js#L1-L9">rps-9-web/index.js</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">import</span><span style="color: #24292F"> React </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'react'</span><span style="color: #24292F">;</span></li><li value="2"><span style="color: #CF222E">import</span><span style="color: #24292F"> AppViews </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./views/AppViews'</span><span style="color: #24292F">;</span></li><li value="3"><span style="color: #CF222E">import</span><span style="color: #24292F"> DeployerViews </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./views/DeployerViews'</span><span style="color: #24292F">;</span></li><li value="4"><span style="color: #CF222E">import</span><span style="color: #24292F"> AttacherViews </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./views/AttacherViews'</span><span style="color: #24292F">;</span></li><li value="5"><span style="color: #CF222E">import</span><span style="color: #24292F"> {renderDOM, renderView} </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./views/render'</span><span style="color: #24292F">;</span></li><li value="6"><span style="color: #CF222E">import</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./index.css'</span><span style="color: #24292F">;</span></li><li value="7"><span style="color: #CF222E">import</span><span style="color: #24292F"> </span><span style="color: #0550AE">*</span><span style="color: #24292F"> </span><span style="color: #CF222E">as</span><span style="color: #24292F"> backend </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./build/index.main.mjs'</span><span style="color: #24292F">;</span></li><li value="8"><span style="color: #CF222E">import</span><span style="color: #24292F"> {loadStdlib} </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'@reach-sh/stdlib'</span><span style="color: #24292F">;</span></li><li value="9"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">reach</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">loadStdlib</span><span style="color: #24292F">(process.env);</span></li></ol></pre>
<ul>
  <li>Lines 1 - 6: Import the views and CSS.</li>
  <li>Line 7: Import the compiled <code>backend</code></li>
  <li>Lines 8 &amp; 9: Load the <code>stdlib</code> as <code>reach</code>.</li>
</ul>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/index.js#L10-L14">rps-9-web/index.js</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="10"></li><li value="11"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">handToInt</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span><span style="color: #0A3069">'ROCK'</span><span style="color: #24292F">: </span><span style="color: #0550AE">0</span><span style="color: #24292F">, </span><span style="color: #0A3069">'PAPER'</span><span style="color: #24292F">: </span><span style="color: #0550AE">1</span><span style="color: #24292F">, </span><span style="color: #0A3069">'SCISSORS'</span><span style="color: #24292F">: </span><span style="color: #0550AE">2</span><span style="color: #24292F">};</span></li><li value="12"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">intToOutcome</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> [</span><span style="color: #0A3069">'Bob wins!'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Draw!'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Alice wins!'</span><span style="color: #24292F">];</span></li><li value="13"><span style="color: #CF222E">const</span><span style="color: #24292F"> {</span><span style="color: #0550AE">standardUnit</span><span style="color: #24292F">} </span><span style="color: #CF222E">=</span><span style="color: #24292F"> reach;</span></li><li value="14"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">defaults</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {defaultFundAmt: </span><span style="color: #0A3069">'10'</span><span style="color: #24292F">, defaultWager: </span><span style="color: #0A3069">'3'</span><span style="color: #24292F">, standardUnit};</span></li></ol></pre>
<p>Here we've defined helpful constants and defaults for later use.</p>
<h2 id="application-component">Application Component<a aria-hidden="true" tabindex="-1" href="#application-component"><span class="icon icon-link"></span></a></h2>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/index.js#L15-L31">rps-9-web/index.js</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="15"></li><li value="16"><span style="color: #CF222E">class</span><span style="color: #24292F"> </span><span style="color: #953800">App</span><span style="color: #24292F"> </span><span style="color: #CF222E">extends</span><span style="color: #24292F"> </span><span style="color: #953800">React</span><span style="color: #24292F">.</span><span style="color: #0550AE">Component</span><span style="color: #24292F"> {</span></li><li value="17"><span style="color: #24292F">  </span><span style="color: #CF222E">constructor</span><span style="color: #24292F">(</span><span style="color: #953800">props</span><span style="color: #24292F">) {</span></li><li value="18"><span style="color: #24292F">    </span><span style="color: #0550AE">super</span><span style="color: #24292F">(props);</span></li><li value="19"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.state </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {view: </span><span style="color: #0A3069">'ConnectAccount'</span><span style="color: #24292F">, </span><span style="color: #CF222E">...</span><span style="color: #24292F">defaults};</span></li><li value="20"><span style="color: #24292F">  }</span></li><li value="21"><span style="color: #24292F">  </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #8250DF">componentDidMount</span><span style="color: #24292F">() {</span></li><li value="22"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">acc</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> reach.</span><span style="color: #8250DF">getDefaultAccount</span><span style="color: #24292F">();</span></li><li value="23"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">balAtomic</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> reach.</span><span style="color: #8250DF">balanceOf</span><span style="color: #24292F">(acc);</span></li><li value="24"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">bal</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> reach.</span><span style="color: #8250DF">formatCurrency</span><span style="color: #24292F">(balAtomic, </span><span style="color: #0550AE">4</span><span style="color: #24292F">);</span></li><li value="25"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({acc, bal});</span></li><li value="26"><span style="color: #24292F">    </span><span style="color: #CF222E">if</span><span style="color: #24292F"> (</span><span style="color: #CF222E">await</span><span style="color: #24292F"> reach.</span><span style="color: #8250DF">canFundFromFaucet</span><span style="color: #24292F">()) {</span></li><li value="27"><span style="color: #24292F">      </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'FundAccount'</span><span style="color: #24292F">});</span></li><li value="28"><span style="color: #24292F">    } </span><span style="color: #CF222E">else</span><span style="color: #24292F"> {</span></li><li value="29"><span style="color: #24292F">      </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'DeployerOrAttacher'</span><span style="color: #24292F">});</span></li><li value="30"><span style="color: #24292F">    }</span></li><li value="31"><span style="color: #24292F">  }</span></li></ol></pre>
<p>Here, we've begun defining <code>App</code> as a React component and provide instructions for what to do once React mounts (i.e., when React starts).</p>
<ul>
  <li>Line 19: We initialize the component state to display the <code>ConnectAccount</code> view. (As pictured below).</li>
  <li>Lines 21 - 31: Hooks into React's <code>componentDidMount</code> lifecycle event, which is called when the component starts.</li>
  <li>Line 22: We use <code>getDefaultAccount</code>, which accesses the default browser account. (i.e., MetaMask)</li>
  <li>Line 26: We use <code>canFundFromFaucet</code> to check if we can access the Reach developer testing network faucet.</li>
  <li>Line 27: If <code>canFundFromFaucet</code> is <code>true</code>, we set the component state to display the <code>FundAccount</code> view.</li>
  <li>Line 29: If <code>canFundFromFaucet</code> is <code>false</code>, we set the component state to skip to the <code>DeployerOrAttacher</code> view.</li>
</ul>
<h2 id="connect-account-dialog">Connect Account Dialog<a aria-hidden="true" tabindex="-1" href="#connect-account-dialog"><span class="icon icon-link"></span></a></h2>
<p>
  <img src="/exp/essentials/getting-started/rock-paper-scissors/ConnectAccount.png" alt="The ConnectAccount view">
</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/index.js#L39-L41">rps-9-web/index.js</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="39"><span style="color: #24292F">  </span><span style="color: #8250DF">render</span><span style="color: #24292F">() { </span><span style="color: #CF222E">return</span><span style="color: #24292F"> </span><span style="color: #8250DF">renderView</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">, AppViews); }</span></li><li value="40"><span style="color: #24292F">}</span></li><li value="41"></li></ol></pre>
<ul>
  <li>Line 39: We render the appropriate view from <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/views/AppViews.js">rps-9-web/views/AppViews.js</a></li>
</ul>
<p>
  <img src="/exp/essentials/getting-started/rock-paper-scissors/FundAccount.png" alt="Figure 2: The FundAccount view">
</p>
<p>We'll return to the close of <code>componentDidMount</code> to define callbacks on <code>App</code> for what to do when the user clicks certain buttons.</p>
<h2 id="fund-account-dialog">Fund Account Dialog<a aria-hidden="true" tabindex="-1" href="#fund-account-dialog"><span class="icon icon-link"></span></a></h2>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/index.js#L32-L36">rps-9-web/index.js</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="32"><span style="color: #24292F">  </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #8250DF">fundAccount</span><span style="color: #24292F">(</span><span style="color: #953800">fundAmount</span><span style="color: #24292F">) {</span></li><li value="33"><span style="color: #24292F">    </span><span style="color: #CF222E">await</span><span style="color: #24292F"> reach.</span><span style="color: #8250DF">fundFromFaucet</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">.state.acc, reach.</span><span style="color: #8250DF">parseCurrency</span><span style="color: #24292F">(fundAmount));</span></li><li value="34"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'DeployerOrAttacher'</span><span style="color: #24292F">});</span></li><li value="35"><span style="color: #24292F">  }</span></li><li value="36"><span style="color: #24292F">  </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #8250DF">skipFundAccount</span><span style="color: #24292F">() { </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'DeployerOrAttacher'</span><span style="color: #24292F">}); }</span></li></ol></pre>
<ul>
  <li>Lines 32 - 35: Define what happens when the user clicks the <code>Fund Account</code> button.</li>
  <li>Line 33: Transfer funds from the faucet to the user's account.</li>
  <li>Line 34: Sets the component state to display the <code>DeployerOrAttacher</code> view. (figure 3).</li>
  <li>Line 36: Define what to do when the user clicks the <code>Skip</code> button, which is to set the component state to display the <code>DeployerOrAttacher</code> view.</li>
</ul>
<h2 id="choose-role">Choose Role<a aria-hidden="true" tabindex="-1" href="#choose-role"><span class="icon icon-link"></span></a></h2>
<p>
  <img src="/exp/essentials/getting-started/rock-paper-scissors/DeployerOrAttacher.png" alt="Figure 3: The DeployerOrAttacher view">
</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/index.js#L36-L38">rps-9-web/index.js</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="36"><span style="color: #24292F">  </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #8250DF">skipFundAccount</span><span style="color: #24292F">() { </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'DeployerOrAttacher'</span><span style="color: #24292F">}); }</span></li><li value="37"><span style="color: #24292F">  </span><span style="color: #8250DF">selectAttacher</span><span style="color: #24292F">() { </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'Wrapper'</span><span style="color: #24292F">, ContentView: Attacher}); }</span></li><li value="38"><span style="color: #24292F">  </span><span style="color: #8250DF">selectDeployer</span><span style="color: #24292F">() { </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'Wrapper'</span><span style="color: #24292F">, ContentView: Deployer}); }</span></li></ol></pre>
<ul>
  <li>Lines 37 &amp; 38: Sets a sub-component based on whether the user clicks <code>Deployer</code> or <code>Attacher</code>.</li>
</ul>
<h2 id="player-component">Player Component<a aria-hidden="true" tabindex="-1" href="#player-component"><span class="icon icon-link"></span></a></h2>
<p>Next, we define <code>Player</code> as a React component, which will be extended by the specialized components for Alice and Bob. The web frontend needs to implement the participant interact interface for players, which we previously defined as:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/index.rsh#L20-L25">rps-9-web/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="20"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Player</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span></li><li value="21"><span style="color: #24292F">  </span><span style="color: #CF222E">...</span><span style="color: #24292F">hasRandom,</span></li><li value="22"><span style="color: #24292F">  getHand: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([], UInt),</span></li><li value="23"><span style="color: #24292F">  seeOutcome: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([UInt], Null),</span></li><li value="24"><span style="color: #24292F">  informTimeout: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([], Null),</span></li><li value="25"><span style="color: #24292F">};</span></li></ol></pre>
<p>We will provide these callbacks via the React component directly:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/index.js#L42-L55">rps-9-web/index.js</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="42"><span style="color: #CF222E">class</span><span style="color: #24292F"> </span><span style="color: #953800">Player</span><span style="color: #24292F"> </span><span style="color: #CF222E">extends</span><span style="color: #24292F"> </span><span style="color: #953800">React</span><span style="color: #24292F">.</span><span style="color: #0550AE">Component</span><span style="color: #24292F"> {</span></li><li value="43"><span style="color: #24292F">  </span><span style="color: #8250DF">random</span><span style="color: #24292F">() { </span><span style="color: #CF222E">return</span><span style="color: #24292F"> reach.hasRandom.</span><span style="color: #8250DF">random</span><span style="color: #24292F">(); }</span></li><li value="44"><span style="color: #24292F">  </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #8250DF">getHand</span><span style="color: #24292F">() { </span><span style="color: #6E7781">// Fun([], UInt)</span></li><li value="45"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">hand</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #CF222E">new</span><span style="color: #24292F"> </span><span style="color: #0550AE">Promise</span><span style="color: #24292F">(</span><span style="color: #953800">resolveHandP</span><span style="color: #24292F"> </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="46"><span style="color: #24292F">      </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'GetHand'</span><span style="color: #24292F">, playable: </span><span style="color: #0550AE">true</span><span style="color: #24292F">, resolveHandP});</span></li><li value="47"><span style="color: #24292F">    });</span></li><li value="48"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'WaitingForResults'</span><span style="color: #24292F">, hand});</span></li><li value="49"><span style="color: #24292F">    </span><span style="color: #CF222E">return</span><span style="color: #24292F"> handToInt[hand];</span></li><li value="50"><span style="color: #24292F">  }</span></li><li value="51"><span style="color: #24292F">  </span><span style="color: #8250DF">seeOutcome</span><span style="color: #24292F">(</span><span style="color: #953800">i</span><span style="color: #24292F">) { </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'Done'</span><span style="color: #24292F">, outcome: intToOutcome[i]}); }</span></li><li value="52"><span style="color: #24292F">  </span><span style="color: #8250DF">informTimeout</span><span style="color: #24292F">() { </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'Timeout'</span><span style="color: #24292F">}); }</span></li><li value="53"><span style="color: #24292F">  </span><span style="color: #8250DF">playHand</span><span style="color: #24292F">(</span><span style="color: #953800">hand</span><span style="color: #24292F">) { </span><span style="color: #0550AE">this</span><span style="color: #24292F">.state.</span><span style="color: #8250DF">resolveHandP</span><span style="color: #24292F">(hand); }</span></li><li value="54"><span style="color: #24292F">}</span></li><li value="55"></li></ol></pre>
<ul>
  <li>Line 43: Provides the <code>random</code> callback.</li>
  <li>Lines 44 - 50: Provides the <code>getHand</code> callback.</li>
  <li>Lines 45 - 47: Sets the component state to display the <code>GetHand</code> view (figure 4) and wait for a <code>Promise</code> which can be resolved via user interaction.</li>
  <li>Line 48: Occurs after the <code>Promise</code> is resolved, we set the component state to display the <code>WaitingForResults</code> view (figure 5).</li>
  <li>Lines 51 &amp; 52: Provides the <code>seeOutcome</code> and <code>informTimeout</code> callbacks, which set the component state to display the <code>Done</code> view (figure 6) and the <code>Timeout</code> view (figure 7), respectively.</li>
  <li>Line 53: Defines what happens when the user clicks <code>Rock</code>, <code>Paper</code>, <code>Scissors</code>: The <code>Promise</code> from line 45 is resolved.</li>
</ul>
<h2 id="get-hand-dialog">Get Hand Dialog<a aria-hidden="true" tabindex="-1" href="#get-hand-dialog"><span class="icon icon-link"></span></a></h2>
<p>
  <img src="/exp/essentials/getting-started/rock-paper-scissors/GetHand.png" alt="Figure 4: The GetHand view">
</p>
<h2 id="waiting-for-results-display">Waiting for Results Display<a aria-hidden="true" tabindex="-1" href="#waiting-for-results-display"><span class="icon icon-link"></span></a></h2>
<p>
  <img src="/exp/essentials/getting-started/rock-paper-scissors/WaitingForResults.png" alt="Figure 5: The WaitingForResults view">
</p>
<h2 id="done-display">Done Display<a aria-hidden="true" tabindex="-1" href="#done-display"><span class="icon icon-link"></span></a></h2>
<p>
  <img src="/exp/essentials/getting-started/rock-paper-scissors/Done.png" alt="Figure 6: The Done view">
</p>
<h2 id="timeout-display">Timeout Display<a aria-hidden="true" tabindex="-1" href="#timeout-display"><span class="icon icon-link"></span></a></h2>
<p>
  <img src="/exp/essentials/getting-started/rock-paper-scissors/Timeout.png" alt="Figure 7: The Timeout view">
</p>
<h2 id="deployer-component">Deployer Component<a aria-hidden="true" tabindex="-1" href="#deployer-component"><span class="icon icon-link"></span></a></h2>
<p>Next, our web frontend needs to implement the participant interact interface for Alice, which we previously defined as:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/index.rsh#L28-L32">rps-9-web/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="28"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Alice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">Participant</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Alice'</span><span style="color: #24292F">, {</span></li><li value="29"><span style="color: #24292F">    </span><span style="color: #CF222E">...</span><span style="color: #24292F">Player,</span></li><li value="30"><span style="color: #24292F">    wager: UInt, </span><span style="color: #6E7781">// atomic units of currency</span></li><li value="31"><span style="color: #24292F">    deadline: UInt, </span><span style="color: #6E7781">// time delta (blocks/rounds)</span></li><li value="32"><span style="color: #24292F">  });</span></li></ol></pre>
<p>We provide the <code>wager</code> and <code>deadline</code> values and define some button handlers in order to trigger the deployment of the contract.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/index.js#L56-L72">rps-9-web/index.js</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="56"><span style="color: #CF222E">class</span><span style="color: #24292F"> </span><span style="color: #953800">Deployer</span><span style="color: #24292F"> </span><span style="color: #CF222E">extends</span><span style="color: #24292F"> </span><span style="color: #0550AE">Player</span><span style="color: #24292F"> {</span></li><li value="57"><span style="color: #24292F">  </span><span style="color: #CF222E">constructor</span><span style="color: #24292F">(</span><span style="color: #953800">props</span><span style="color: #24292F">) {</span></li><li value="58"><span style="color: #24292F">    </span><span style="color: #0550AE">super</span><span style="color: #24292F">(props);</span></li><li value="59"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.state </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {view: </span><span style="color: #0A3069">'SetWager'</span><span style="color: #24292F">};</span></li><li value="60"><span style="color: #24292F">  }</span></li><li value="61"><span style="color: #24292F">  </span><span style="color: #8250DF">setWager</span><span style="color: #24292F">(</span><span style="color: #953800">wager</span><span style="color: #24292F">) { </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'Deploy'</span><span style="color: #24292F">, wager}); }</span></li><li value="62"><span style="color: #24292F">  </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #8250DF">deploy</span><span style="color: #24292F">() {</span></li><li value="63"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">ctc</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">this</span><span style="color: #24292F">.props.acc.</span><span style="color: #8250DF">deploy</span><span style="color: #24292F">(backend);</span></li><li value="64"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'Deploying'</span><span style="color: #24292F">, ctc});</span></li><li value="65"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.wager </span><span style="color: #CF222E">=</span><span style="color: #24292F"> reach.</span><span style="color: #8250DF">parseCurrency</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">.state.wager); </span><span style="color: #6E7781">// UInt</span></li><li value="66"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.deadline </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {ETH: </span><span style="color: #0550AE">10</span><span style="color: #24292F">, ALGO: </span><span style="color: #0550AE">100</span><span style="color: #24292F">, CFX: </span><span style="color: #0550AE">1000</span><span style="color: #24292F">}[reach.connector]; </span><span style="color: #6E7781">// UInt</span></li><li value="67"><span style="color: #24292F">    backend.</span><span style="color: #8250DF">Alice</span><span style="color: #24292F">(ctc, </span><span style="color: #0550AE">this</span><span style="color: #24292F">);</span></li><li value="68"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">ctcInfoStr</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">JSON</span><span style="color: #24292F">.</span><span style="color: #0550AE">stringify</span><span style="color: #24292F">(</span><span style="color: #CF222E">await</span><span style="color: #24292F"> ctc.</span><span style="color: #8250DF">getInfo</span><span style="color: #24292F">(), </span><span style="color: #0550AE">null</span><span style="color: #24292F">, </span><span style="color: #0550AE">2</span><span style="color: #24292F">);</span></li><li value="69"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'WaitingForAttacher'</span><span style="color: #24292F">, ctcInfoStr});</span></li><li value="70"><span style="color: #24292F">  }</span></li><li value="71"><span style="color: #24292F">  </span><span style="color: #8250DF">render</span><span style="color: #24292F">() { </span><span style="color: #CF222E">return</span><span style="color: #24292F"> </span><span style="color: #8250DF">renderView</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">, DeployerViews); }</span></li><li value="72"><span style="color: #24292F">}</span></li></ol></pre>
<ul>
  <li>Line 59: Sets the component state to display the <code>SetWager</code> view (figure 8).</li>
  <li>Line 61: Defines what to do when the user clicks the <code>Set Wager</code> button, which is to set the component state to display the <code>Deploy</code> view (figure 9).</li>
  <li>Lines 62 - 69: Defines what to do when the user clicks the <code>Deploy</code> button.</li>
  <li>Line 63: Calls <code>acc.deploy</code>, which triggers a deploy of the contract.</li>
  <li>Line 64: Sets the component state to display the <code>Deploying</code> view (figure 10).</li>
  <li>Line 65: Sets the <code>wager</code> property.</li>
  <li>Line 66: Sets the <code>deadline</code> property based on which connector is being used.</li>
  <li>Line 67: Starts running the Reach program as Alice, using the <code>this</code> React component as the participant interact interface object.</li>
  <li>Lines 68 &amp; 69: Sets the component state to display the <code>WaitingForAttacher</code> view (figure 11), which displays the deployed contract info as JSON.</li>
  <li>Line 71: Renders the appropriate view from <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/views/DeployerViews.js">rps-9-web/views/DeployerViews.js</a>.</li>
</ul>
<h2 id="set-wager-dialog">Set Wager Dialog<a aria-hidden="true" tabindex="-1" href="#set-wager-dialog"><span class="icon icon-link"></span></a></h2>
<p>
  <img src="/exp/essentials/getting-started/rock-paper-scissors/SetWager.png" alt="Figure 8: The SetWager view">
</p>
<h2 id="deploy-dialog">Deploy Dialog<a aria-hidden="true" tabindex="-1" href="#deploy-dialog"><span class="icon icon-link"></span></a></h2>
<p>
  <img src="/exp/essentials/getting-started/rock-paper-scissors/Deploy.png" alt="Figure 9: The Deploy view">
</p>
<h2 id="deploying-display">Deploying Display<a aria-hidden="true" tabindex="-1" href="#deploying-display"><span class="icon icon-link"></span></a></h2>
<p>
  <img src="/exp/essentials/getting-started/rock-paper-scissors/Deploying.png" alt="Figure 10: The Deploying view">
</p>
<h2 id="waiting-for-attacher-display">Waiting for Attacher Display<a aria-hidden="true" tabindex="-1" href="#waiting-for-attacher-display"><span class="icon icon-link"></span></a></h2>
<p>
  <img src="/exp/essentials/getting-started/rock-paper-scissors/WaitingForAttacher.png" alt="Figure 11: The WaitingForAttacher view">
</p>
<h2 id="attacher-component">Attacher Component<a aria-hidden="true" tabindex="-1" href="#attacher-component"><span class="icon icon-link"></span></a></h2>
<p>The frontend needs to implement the participant interact interface for Bob, which we previously defined as:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/index.rsh#L33-L36">rps-9-web/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="33"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Bob</span><span style="color: #24292F">   </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">Participant</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Bob'</span><span style="color: #24292F">, {</span></li><li value="34"><span style="color: #24292F">    </span><span style="color: #CF222E">...</span><span style="color: #24292F">Player,</span></li><li value="35"><span style="color: #24292F">    acceptWager: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([UInt], Null),</span></li><li value="36"><span style="color: #24292F">  });</span></li></ol></pre>
<p>Next, we'll provide the <code>acceptWager</code> callback in the JavaScript. We'll also define some button handlers in order to attach to the deployed contract.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/index.js#L73-L95">rps-9-web/index.js</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="73"><span style="color: #CF222E">class</span><span style="color: #24292F"> </span><span style="color: #953800">Attacher</span><span style="color: #24292F"> </span><span style="color: #CF222E">extends</span><span style="color: #24292F"> </span><span style="color: #0550AE">Player</span><span style="color: #24292F"> {</span></li><li value="74"><span style="color: #24292F">  </span><span style="color: #CF222E">constructor</span><span style="color: #24292F">(</span><span style="color: #953800">props</span><span style="color: #24292F">) {</span></li><li value="75"><span style="color: #24292F">    </span><span style="color: #0550AE">super</span><span style="color: #24292F">(props);</span></li><li value="76"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.state </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {view: </span><span style="color: #0A3069">'Attach'</span><span style="color: #24292F">};</span></li><li value="77"><span style="color: #24292F">  }</span></li><li value="78"><span style="color: #24292F">  </span><span style="color: #8250DF">attach</span><span style="color: #24292F">(</span><span style="color: #953800">ctcInfoStr</span><span style="color: #24292F">) {</span></li><li value="79"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">ctc</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">this</span><span style="color: #24292F">.props.acc.</span><span style="color: #8250DF">attach</span><span style="color: #24292F">(backend, </span><span style="color: #0550AE">JSON</span><span style="color: #24292F">.</span><span style="color: #0550AE">parse</span><span style="color: #24292F">(ctcInfoStr));</span></li><li value="80"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'Attaching'</span><span style="color: #24292F">});</span></li><li value="81"><span style="color: #24292F">    backend.</span><span style="color: #8250DF">Bob</span><span style="color: #24292F">(ctc, </span><span style="color: #0550AE">this</span><span style="color: #24292F">);</span></li><li value="82"><span style="color: #24292F">  }</span></li><li value="83"><span style="color: #24292F">  </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #8250DF">acceptWager</span><span style="color: #24292F">(</span><span style="color: #953800">wagerAtomic</span><span style="color: #24292F">) { </span><span style="color: #6E7781">// Fun([UInt], Null)</span></li><li value="84"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">wager</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> reach.</span><span style="color: #8250DF">formatCurrency</span><span style="color: #24292F">(wagerAtomic, </span><span style="color: #0550AE">4</span><span style="color: #24292F">);</span></li><li value="85"><span style="color: #24292F">    </span><span style="color: #CF222E">return</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #CF222E">new</span><span style="color: #24292F"> </span><span style="color: #0550AE">Promise</span><span style="color: #24292F">(</span><span style="color: #953800">resolveAcceptedP</span><span style="color: #24292F"> </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="86"><span style="color: #24292F">      </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'AcceptTerms'</span><span style="color: #24292F">, wager, resolveAcceptedP});</span></li><li value="87"><span style="color: #24292F">    });</span></li><li value="88"><span style="color: #24292F">  }</span></li><li value="89"><span style="color: #24292F">  </span><span style="color: #8250DF">termsAccepted</span><span style="color: #24292F">() {</span></li><li value="90"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.state.</span><span style="color: #8250DF">resolveAcceptedP</span><span style="color: #24292F">();</span></li><li value="91"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'WaitingForTurn'</span><span style="color: #24292F">});</span></li><li value="92"><span style="color: #24292F">  }</span></li><li value="93"><span style="color: #24292F">  </span><span style="color: #8250DF">render</span><span style="color: #24292F">() { </span><span style="color: #CF222E">return</span><span style="color: #24292F"> </span><span style="color: #8250DF">renderView</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">, AttacherViews); }</span></li><li value="94"><span style="color: #24292F">}</span></li><li value="95"></li></ol></pre>
<ul>
  <li>Line 76: We initialize the component state to display the <code>Attach</code> view (figure 12).</li>
  <li>Lines 78 - 82: Defines what happens when the user clicks the <code>Attach</code> button.</li>
  <li>Line 79: We call <code>acc.attach</code>.</li>
  <li>Line 80: Sets the component state to display the <code>Attaching</code> view (figure 13).</li>
  <li>Line 81: Starts running the Reach program as Bob, using the <code>this</code> React component as the participant interact interface object.</li>
  <li>Lines 83 - 88: Defines the <code>acceptWager</code> callback.</li>
  <li>Lines 85 - 87: Sets the component state to display the <code>AcceptTerms</code> view (figure 14) and waits for a <code>Promise</code> which can be resolved via user interaction.</li>
  <li>Lines 89 - 92: Defines what happens when the user clicks the <code>Accept Terms and Pay Wager</code> button: the <code>Promise</code> from line 90 is resolved, and we set the component state to display the <code>WaitingForTurn</code> view (figure 15).</li>
  <li>Line 93: Renders the appropriate view from <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/views/AttacherViews.js">rps-9-web/views/AttacherViews.js</a>.</li>
</ul>
<h2 id="attach-dialog">Attach Dialog<a aria-hidden="true" tabindex="-1" href="#attach-dialog"><span class="icon icon-link"></span></a></h2>
<p>
  <img src="/exp/essentials/getting-started/rock-paper-scissors/Attach.png" alt="Figure 12: The Attach view">
</p>
<h2 id="attaching-display">Attaching Display<a aria-hidden="true" tabindex="-1" href="#attaching-display"><span class="icon icon-link"></span></a></h2>
<p>
  <img src="/exp/essentials/getting-started/rock-paper-scissors/Attaching.png" alt="Figure 13: The Attaching view">
</p>
<h2 id="accept-terms-dialog">Accept Terms Dialog<a aria-hidden="true" tabindex="-1" href="#accept-terms-dialog"><span class="icon icon-link"></span></a></h2>
<p>
  <img src="/exp/essentials/getting-started/rock-paper-scissors/AcceptTerms.png" alt="Figure 14: The AcceptTerms view">
</p>
<h2 id="waiting-for-turn-display">Waiting for Turn Display<a aria-hidden="true" tabindex="-1" href="#waiting-for-turn-display"><span class="icon icon-link"></span></a></h2>
<p>
  <img src="/exp/essentials/getting-started/rock-paper-scissors/WaitingForTurn.png" alt="Figure 15: The WaitingForTurn view">
</p>
<h2 id="putting-it-all-together">Putting it All Together<a aria-hidden="true" tabindex="-1" href="#putting-it-all-together"><span class="icon icon-link"></span></a></h2>
<p>Finally, we call a small helper function from <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/views/render.js">rps-9-web/views/render.js</a> to render our App component.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/index.js#L96">rps-9-web/index.js</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="96"><span style="color: #8250DF">renderDOM</span><span style="color: #24292F">(&lt;</span><span style="color: #116329">App</span><span style="color: #24292F"> /&gt;);</span></li></ol></pre>
<p>As a convenience for running the React development server, you can call:</p>
<p><code>$ reach react</code></p>
<p>To run the React development server with Algorand, call:</p>
<p><code>$ REACH_CONNECTOR_MODE=ALGO reach react</code></p>
<blockquote>
  <h1 id="accessing-algorand-browser-wallet">Accessing Algorand Browser Wallet<a aria-hidden="true" tabindex="-1" href="#accessing-algorand-browser-wallet"><span class="icon icon-link"></span></a></h1>
  <p>If you expect that your Algorand users do not have access to an ARC-0011 browser wallet, you want to provide a fallback.</p>
</blockquote>
<blockquote>
  <p>If you add the following to your program, then you can provide a simple wallet where the user copies and pastes their mnemonic for each interaction.</p>
</blockquote>
<blockquote>
  <p>
    <code>reach.setWalletFallback(reach.walletFallback({}));</code>
    Instead, if you would like to allow your users to use My Algo, then you can add the following:
  </p>
</blockquote>
<blockquote>
  <pre class="snippet unnumbered"><ol class="snippet"><li value="1"></li></ol></pre>
</blockquote>
<p>
  import MyAlgoConnect from '@reach-sh/stdlib/ALGO_MyAlgoConnect';
  stdlib.setWalletFallback(stdlib.walletFallback({
  providerEnv: 'TestNet', MyAlgoConnect }));
  ///
</p>
<blockquote>
  <p>
    Of course, you may want to replace
    <code>'TestNet'</code>
    with a different network name.
  </p>
</blockquote>
<p>Similarly, to run with Conflux:</p>
<p><code>$ REACH_CONNECTOR_MODE=CFX reach react</code></p>
<blockquote>
  <h1 id="adapting-for-conflux">Adapting for Conflux<a aria-hidden="true" tabindex="-1" href="#adapting-for-conflux"><span class="icon icon-link"></span></a></h1>
  <p>To adapt this example for Conflux TestNet or MainNet, you can add this after the imports:</p>
</blockquote>
<blockquote>
  <p>
    <code>reach.setProviderByName('TestNet'); // or 'MainNet'</code>
    For details, see the <a href="https://docs.reach.sh/ref-network-cfx.html#%28part._cfx-faq-mainnet%29">Conflux FAQ</a>.
  </p>
</blockquote>
<h2 id="use-reach-in-your-javascript-project">Use Reach in Your JavaScript Project<a aria-hidden="true" tabindex="-1" href="#use-reach-in-your-javascript-project"><span class="icon icon-link"></span></a></h2>
<p>If you'd like to use Reach in your own JavaScript project, you can call:</p>
<p><code>npm install @reach-sh/stdlib</code></p>
<blockquote>
  <p>The Reach standard library is undergoing continual improvement and is updated often. If you are experiencing issues with the Node.js package, try updating!</p>
</blockquote>
<p>As usual, you can compile your Reach program <code>index.rsh</code> to the backend build artifact <code>build/index.main.mjs</code> with:</p>
<p><code>$ reach compile</code></p>
<h2 id="live-in-the-browser">Live in the Browser<a aria-hidden="true" tabindex="-1" href="#live-in-the-browser"><span class="icon icon-link"></span></a></h2>
<p>Now our implementation of <em>Rock, Paper, Scissors!</em> is live in the browser! We can leverage callbacks in the participant interact interface to display to and gather information from the user, through any Web UI framework of our choice.</p>
<p>If we wanted to deploy this application to the world, then we would take the static files that React produces and host them on a web server. These files embed your compiled Reach program, so there's nothing more to do than provide them to the world.</p>
<p>Next, we'll summarize where we've gone and direct you to the next step of your journey to decentralized application mastery.</p>
<blockquote>
  <h1 id="check-your-understanding-7">Check Your Understanding<a aria-hidden="true" tabindex="-1" href="#check-your-understanding-7"><span class="icon icon-link"></span></a></h1>
  <p>True or false: Reach integrates with all web interface libraries, like React, Vue, and so on, because Reach frontends are just normal JavaScript programs.</p>
</blockquote>
<blockquote>
  <p>True or false: Reach accelerates your development with React by baking-in a React development server and the deployment process to test React programs locally.</p>
</blockquote>
<h1 id="onward-and-further">Onward and Further<a aria-hidden="true" tabindex="-1" href="#onward-and-further"><span class="icon icon-link"></span></a></h1>
<p>Let's review what we've completed in this tutorial:</p>
<ul>
  <li>In <a href="#scaffolding-and-setup">Scaffolding and Setup</a> we saw how easy it is to setup initial Reach files and choose a consensus network.</li>
  <li>In <a href="#rock-paper-scissors-1">Rock, Paper, and Scissors</a> we saw how Reach allows developers to focus on the business logic of their decentralized application and look past the nitty-gritty details of blockchain interaction and protocol design.</li>
  <li>In <a href="#bets-and-wagers">Bets and Wagers</a> we saw how simple it is for Reach to work with tokens, network transactions and data sharing.</li>
  <li>In <a href="#trust-commitments-and-attacks">Trust, Commitments, and Attacks</a>, we introduced the automatic formal verification engine and how it ensures Reach programs are free of entire categories of flaws and security vulnerabilities.</li>
  <li>In <a href="#timeouts-and-participation">Timeouts and Participation</a>, we learned how Reach protects funds when handling non-participation attacks.</li>
  <li>In <a href="#play-and-play-again">Play and Play Again</a>, we experienced loops in Reach and how flexible the frontend is to variations in the backend.</li>
  <li>In <a href="#interaction-and-independence">Interaction and Independence</a>, we saw how to launch an interactive version of a dApp on a real network.</li>
  <li>In <a href="#web-interaction-with-react">Web Interaction</a> we deployed our Reach program as a fully decentralized Web app using React.</li>
</ul>
<p>Despite having done so much, this is only a brief introduction to what is possible with Reach.</p>
<p>How difficult was it to write a complete dApp using Reach? Let's look at the final versions of our programs to assess.</p>
<h2 id="reach-backend">Reach Backend<a aria-hidden="true" tabindex="-1" href="#reach-backend"><span class="icon icon-link"></span></a></h2>
<p>Here's the Reach backend:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-8-interact/index.rsh">rps-8-interact/index.rsh</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #0A3069">'reach 0.1'</span><span style="color: #24292F">;</span></li><li value="2"></li><li value="3"><span style="color: #CF222E">const</span><span style="color: #24292F"> [ </span><span style="color: #0550AE">isHand</span><span style="color: #24292F">, </span><span style="color: #0550AE">ROCK</span><span style="color: #24292F">, </span><span style="color: #0550AE">PAPER</span><span style="color: #24292F">, </span><span style="color: #0550AE">SCISSORS</span><span style="color: #24292F"> ] </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">makeEnum</span><span style="color: #24292F">(</span><span style="color: #0550AE">3</span><span style="color: #24292F">);</span></li><li value="4"><span style="color: #CF222E">const</span><span style="color: #24292F"> [ </span><span style="color: #0550AE">isOutcome</span><span style="color: #24292F">, </span><span style="color: #0550AE">B_WINS</span><span style="color: #24292F">, </span><span style="color: #0550AE">DRAW</span><span style="color: #24292F">, </span><span style="color: #0550AE">A_WINS</span><span style="color: #24292F"> ] </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">makeEnum</span><span style="color: #24292F">(</span><span style="color: #0550AE">3</span><span style="color: #24292F">);</span></li><li value="5"></li><li value="6"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">winner</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (</span><span style="color: #953800">handAlice</span><span style="color: #24292F">, </span><span style="color: #953800">handBob</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span></li><li value="7"><span style="color: #24292F">  ((handAlice </span><span style="color: #CF222E">+</span><span style="color: #24292F"> (</span><span style="color: #0550AE">4</span><span style="color: #24292F"> </span><span style="color: #CF222E">-</span><span style="color: #24292F"> handBob)) </span><span style="color: #CF222E">%</span><span style="color: #24292F"> </span><span style="color: #0550AE">3</span><span style="color: #24292F">);</span></li><li value="8"></li><li value="9"><span style="color: #8250DF">assert</span><span style="color: #24292F">(</span><span style="color: #8250DF">winner</span><span style="color: #24292F">(</span><span style="color: #0550AE">ROCK</span><span style="color: #24292F">, </span><span style="color: #0550AE">PAPER</span><span style="color: #24292F">) </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">B_WINS</span><span style="color: #24292F">);</span></li><li value="10"><span style="color: #8250DF">assert</span><span style="color: #24292F">(</span><span style="color: #8250DF">winner</span><span style="color: #24292F">(</span><span style="color: #0550AE">PAPER</span><span style="color: #24292F">, </span><span style="color: #0550AE">ROCK</span><span style="color: #24292F">) </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">A_WINS</span><span style="color: #24292F">);</span></li><li value="11"><span style="color: #8250DF">assert</span><span style="color: #24292F">(</span><span style="color: #8250DF">winner</span><span style="color: #24292F">(</span><span style="color: #0550AE">ROCK</span><span style="color: #24292F">, </span><span style="color: #0550AE">ROCK</span><span style="color: #24292F">) </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">DRAW</span><span style="color: #24292F">);</span></li><li value="12"></li><li value="13"><span style="color: #8250DF">forall</span><span style="color: #24292F">(UInt, </span><span style="color: #953800">handAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=&gt;</span></li><li value="14"><span style="color: #24292F">  </span><span style="color: #8250DF">forall</span><span style="color: #24292F">(UInt, </span><span style="color: #953800">handBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=&gt;</span></li><li value="15"><span style="color: #24292F">    </span><span style="color: #8250DF">assert</span><span style="color: #24292F">(</span><span style="color: #8250DF">isOutcome</span><span style="color: #24292F">(</span><span style="color: #8250DF">winner</span><span style="color: #24292F">(handAlice, handBob)))));</span></li><li value="16"></li><li value="17"><span style="color: #8250DF">forall</span><span style="color: #24292F">(UInt, (</span><span style="color: #953800">hand</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span></li><li value="18"><span style="color: #24292F">  </span><span style="color: #8250DF">assert</span><span style="color: #24292F">(</span><span style="color: #8250DF">winner</span><span style="color: #24292F">(hand, hand) </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">DRAW</span><span style="color: #24292F">));</span></li><li value="19"></li><li value="20"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Player</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span></li><li value="21"><span style="color: #24292F">  </span><span style="color: #CF222E">...</span><span style="color: #24292F">hasRandom,</span></li><li value="22"><span style="color: #24292F">  getHand: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([], UInt),</span></li><li value="23"><span style="color: #24292F">  seeOutcome: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([UInt], Null),</span></li><li value="24"><span style="color: #24292F">  informTimeout: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([], Null),</span></li><li value="25"><span style="color: #24292F">};</span></li><li value="26"></li><li value="27"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">main</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> Reach.</span><span style="color: #8250DF">App</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="28"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Alice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">Participant</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Alice'</span><span style="color: #24292F">, {</span></li><li value="29"><span style="color: #24292F">    </span><span style="color: #CF222E">...</span><span style="color: #24292F">Player,</span></li><li value="30"><span style="color: #24292F">    wager: UInt, </span><span style="color: #6E7781">// atomic units of currency</span></li><li value="31"><span style="color: #24292F">    deadline: UInt, </span><span style="color: #6E7781">// time delta (blocks/rounds)</span></li><li value="32"><span style="color: #24292F">  });</span></li><li value="33"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">Bob</span><span style="color: #24292F">   </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">Participant</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Bob'</span><span style="color: #24292F">, {</span></li><li value="34"><span style="color: #24292F">    </span><span style="color: #CF222E">...</span><span style="color: #24292F">Player,</span></li><li value="35"><span style="color: #24292F">    acceptWager: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([UInt], Null),</span></li><li value="36"><span style="color: #24292F">  });</span></li><li value="37"><span style="color: #24292F">  </span><span style="color: #8250DF">deploy</span><span style="color: #24292F">();</span></li><li value="38"></li><li value="39"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">informTimeout</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="40"><span style="color: #24292F">    </span><span style="color: #8250DF">each</span><span style="color: #24292F">([Alice, Bob], () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="41"><span style="color: #24292F">      interact.</span><span style="color: #8250DF">informTimeout</span><span style="color: #24292F">();</span></li><li value="42"><span style="color: #24292F">    });</span></li><li value="43"><span style="color: #24292F">  };</span></li><li value="44"></li><li value="45"><span style="color: #24292F">  Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="46"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">wager</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.wager);</span></li><li value="47"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">deadline</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.deadline);</span></li><li value="48"><span style="color: #24292F">  });</span></li><li value="49"><span style="color: #24292F">  Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(wager, deadline)</span></li><li value="50"><span style="color: #24292F">    .</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(wager);</span></li><li value="51"><span style="color: #24292F">  </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="52"></li><li value="53"><span style="color: #24292F">  Bob.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="54"><span style="color: #24292F">    interact.</span><span style="color: #8250DF">acceptWager</span><span style="color: #24292F">(wager);</span></li><li value="55"><span style="color: #24292F">  });</span></li><li value="56"><span style="color: #24292F">  Bob.</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(wager)</span></li><li value="57"><span style="color: #24292F">    .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #8250DF">relativeTime</span><span style="color: #24292F">(deadline), () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">closeTo</span><span style="color: #24292F">(Alice, informTimeout));</span></li><li value="58"></li><li value="59"><span style="color: #24292F">  </span><span style="color: #CF222E">var</span><span style="color: #24292F"> outcome </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">DRAW</span><span style="color: #24292F">;</span></li><li value="60"><span style="color: #24292F">  </span><span style="color: #8250DF">invariant</span><span style="color: #24292F">( </span><span style="color: #8250DF">balance</span><span style="color: #24292F">() </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">2</span><span style="color: #24292F"> </span><span style="color: #CF222E">*</span><span style="color: #24292F"> wager </span><span style="color: #CF222E">&amp;&amp;</span><span style="color: #24292F"> </span><span style="color: #8250DF">isOutcome</span><span style="color: #24292F">(outcome) );</span></li><li value="61"><span style="color: #24292F">  </span><span style="color: #CF222E">while</span><span style="color: #24292F"> ( outcome </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">DRAW</span><span style="color: #24292F"> ) {</span></li><li value="62"><span style="color: #24292F">    </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="63"></li><li value="64"><span style="color: #24292F">    Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="65"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">_handAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> interact.</span><span style="color: #8250DF">getHand</span><span style="color: #24292F">();</span></li><li value="66"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> [</span><span style="color: #0550AE">_commitAlice</span><span style="color: #24292F">, </span><span style="color: #0550AE">_saltAlice</span><span style="color: #24292F">] </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">makeCommitment</span><span style="color: #24292F">(interact, _handAlice);</span></li><li value="67"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">commitAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(_commitAlice);</span></li><li value="68"><span style="color: #24292F">    });</span></li><li value="69"><span style="color: #24292F">    Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(commitAlice)</span></li><li value="70"><span style="color: #24292F">      .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #8250DF">relativeTime</span><span style="color: #24292F">(deadline), () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">closeTo</span><span style="color: #24292F">(Bob, informTimeout));</span></li><li value="71"><span style="color: #24292F">    </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="72"></li><li value="73"><span style="color: #24292F">    </span><span style="color: #8250DF">unknowable</span><span style="color: #24292F">(Bob, </span><span style="color: #8250DF">Alice</span><span style="color: #24292F">(_handAlice, _saltAlice));</span></li><li value="74"><span style="color: #24292F">    Bob.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="75"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">handBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.</span><span style="color: #8250DF">getHand</span><span style="color: #24292F">());</span></li><li value="76"><span style="color: #24292F">    });</span></li><li value="77"><span style="color: #24292F">    Bob.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(handBob)</span></li><li value="78"><span style="color: #24292F">      .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #8250DF">relativeTime</span><span style="color: #24292F">(deadline), () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">closeTo</span><span style="color: #24292F">(Alice, informTimeout));</span></li><li value="79"><span style="color: #24292F">    </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="80"></li><li value="81"><span style="color: #24292F">    Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="82"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">saltAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(_saltAlice);</span></li><li value="83"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">handAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(_handAlice);</span></li><li value="84"><span style="color: #24292F">    });</span></li><li value="85"><span style="color: #24292F">    Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(saltAlice, handAlice)</span></li><li value="86"><span style="color: #24292F">      .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #8250DF">relativeTime</span><span style="color: #24292F">(deadline), () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">closeTo</span><span style="color: #24292F">(Bob, informTimeout));</span></li><li value="87"><span style="color: #24292F">    </span><span style="color: #8250DF">checkCommitment</span><span style="color: #24292F">(commitAlice, saltAlice, handAlice);</span></li><li value="88"></li><li value="89"><span style="color: #24292F">    outcome </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">winner</span><span style="color: #24292F">(handAlice, handBob);</span></li><li value="90"><span style="color: #24292F">    </span><span style="color: #CF222E">continue</span><span style="color: #24292F">;</span></li><li value="91"><span style="color: #24292F">  }</span></li><li value="92"></li><li value="93"><span style="color: #24292F">  </span><span style="color: #8250DF">assert</span><span style="color: #24292F">(outcome </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">A_WINS</span><span style="color: #24292F"> </span><span style="color: #CF222E">||</span><span style="color: #24292F"> outcome </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">B_WINS</span><span style="color: #24292F">);</span></li><li value="94"><span style="color: #24292F">  </span><span style="color: #8250DF">transfer</span><span style="color: #24292F">(</span><span style="color: #0550AE">2</span><span style="color: #24292F"> </span><span style="color: #CF222E">*</span><span style="color: #24292F"> wager).</span><span style="color: #8250DF">to</span><span style="color: #24292F">(outcome </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">A_WINS</span><span style="color: #24292F"> </span><span style="color: #CF222E">?</span><span style="color: #24292F"> Alice </span><span style="color: #CF222E">:</span><span style="color: #24292F"> Bob);</span></li><li value="95"><span style="color: #24292F">  </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="96"></li><li value="97"><span style="color: #24292F">  </span><span style="color: #8250DF">each</span><span style="color: #24292F">([Alice, Bob], () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="98"><span style="color: #24292F">    interact.</span><span style="color: #8250DF">seeOutcome</span><span style="color: #24292F">(outcome);</span></li><li value="99"><span style="color: #24292F">  });</span></li><li value="100"><span style="color: #24292F">});</span></li></ol></pre>
<h2 id="command-line">Command-Line<a aria-hidden="true" tabindex="-1" href="#command-line"><span class="icon icon-link"></span></a></h2>
<p>This is the JavaScript command-line frontend:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-8-interact/index.mjs">rps-8-interact/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">import</span><span style="color: #24292F"> { loadStdlib } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'@reach-sh/stdlib'</span><span style="color: #24292F">;</span></li><li value="2"><span style="color: #CF222E">import</span><span style="color: #24292F"> </span><span style="color: #0550AE">*</span><span style="color: #24292F"> </span><span style="color: #CF222E">as</span><span style="color: #24292F"> backend </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./build/index.main.mjs'</span><span style="color: #24292F">;</span></li><li value="3"><span style="color: #CF222E">import</span><span style="color: #24292F"> { ask, yesno, done } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'@reach-sh/stdlib/ask.mjs'</span><span style="color: #24292F">;</span></li><li value="4"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">stdlib</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">loadStdlib</span><span style="color: #24292F">(process.env);</span></li><li value="5"></li><li value="6"><span style="color: #24292F">(</span><span style="color: #CF222E">async</span><span style="color: #24292F"> () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="7"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">isAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">ask</span><span style="color: #24292F">(</span></li><li value="8"><span style="color: #24292F">    </span><span style="color: #0A3069">`Are you Alice?`</span><span style="color: #24292F">,</span></li><li value="9"><span style="color: #24292F">    yesno</span></li><li value="10"><span style="color: #24292F">  );</span></li><li value="11"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">who</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> isAlice </span><span style="color: #CF222E">?</span><span style="color: #24292F"> </span><span style="color: #0A3069">'Alice'</span><span style="color: #24292F"> </span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0A3069">'Bob'</span><span style="color: #24292F">;</span></li><li value="12"></li><li value="13"><span style="color: #24292F">  console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Starting Rock, Paper, Scissors! as ${</span><span style="color: #24292F">who</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="14"></li><li value="15"><span style="color: #24292F">  </span><span style="color: #CF222E">let</span><span style="color: #24292F"> acc </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">null</span><span style="color: #24292F">;</span></li><li value="16"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">createAcc</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">ask</span><span style="color: #24292F">(</span></li><li value="17"><span style="color: #24292F">    </span><span style="color: #0A3069">`Would you like to create an account? (only possible on devnet)`</span><span style="color: #24292F">,</span></li><li value="18"><span style="color: #24292F">    yesno</span></li><li value="19"><span style="color: #24292F">  );</span></li><li value="20"><span style="color: #24292F">  </span><span style="color: #CF222E">if</span><span style="color: #24292F"> (createAcc) {</span></li><li value="21"><span style="color: #24292F">    acc </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">newTestAccount</span><span style="color: #24292F">(stdlib.</span><span style="color: #8250DF">parseCurrency</span><span style="color: #24292F">(</span><span style="color: #0550AE">1000</span><span style="color: #24292F">));</span></li><li value="22"><span style="color: #24292F">  } </span><span style="color: #CF222E">else</span><span style="color: #24292F"> {</span></li><li value="23"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">secret</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">ask</span><span style="color: #24292F">(</span></li><li value="24"><span style="color: #24292F">      </span><span style="color: #0A3069">`What is your account secret?`</span><span style="color: #24292F">,</span></li><li value="25"><span style="color: #24292F">      (</span><span style="color: #953800">x</span><span style="color: #24292F"> </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> x)</span></li><li value="26"><span style="color: #24292F">    );</span></li><li value="27"><span style="color: #24292F">    acc </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">newAccountFromSecret</span><span style="color: #24292F">(secret);</span></li><li value="28"><span style="color: #24292F">  }</span></li><li value="29"></li><li value="30"><span style="color: #24292F">  </span><span style="color: #CF222E">let</span><span style="color: #24292F"> ctc </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">null</span><span style="color: #24292F">;</span></li><li value="31"><span style="color: #24292F">  </span><span style="color: #CF222E">if</span><span style="color: #24292F"> (isAlice) {</span></li><li value="32"><span style="color: #24292F">    ctc </span><span style="color: #CF222E">=</span><span style="color: #24292F"> acc.</span><span style="color: #8250DF">contract</span><span style="color: #24292F">(backend);</span></li><li value="33"><span style="color: #24292F">    ctc.</span><span style="color: #8250DF">getInfo</span><span style="color: #24292F">().</span><span style="color: #8250DF">then</span><span style="color: #24292F">((</span><span style="color: #953800">info</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="34"><span style="color: #24292F">      console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`The contract is deployed as = ${</span><span style="color: #0550AE">JSON</span><span style="color: #0A3069">.</span><span style="color: #0550AE">stringify</span><span style="color: #0A3069">(</span><span style="color: #24292F">info</span><span style="color: #0A3069">)</span><span style="color: #0A3069">}`</span><span style="color: #24292F">); });</span></li><li value="35"><span style="color: #24292F">  } </span><span style="color: #CF222E">else</span><span style="color: #24292F"> {</span></li><li value="36"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">info</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">ask</span><span style="color: #24292F">(</span></li><li value="37"><span style="color: #24292F">      </span><span style="color: #0A3069">`Please paste the contract information:`</span><span style="color: #24292F">,</span></li><li value="38"><span style="color: #24292F">      </span><span style="color: #0550AE">JSON</span><span style="color: #24292F">.</span><span style="color: #0550AE">parse</span></li><li value="39"><span style="color: #24292F">    );</span></li><li value="40"><span style="color: #24292F">    ctc </span><span style="color: #CF222E">=</span><span style="color: #24292F"> acc.</span><span style="color: #8250DF">contract</span><span style="color: #24292F">(backend, info);</span></li><li value="41"><span style="color: #24292F">  }</span></li><li value="42"></li><li value="43"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">fmt</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (</span><span style="color: #953800">x</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">formatCurrency</span><span style="color: #24292F">(x, </span><span style="color: #0550AE">4</span><span style="color: #24292F">);</span></li><li value="44"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">getBalance</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">async</span><span style="color: #24292F"> () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">fmt</span><span style="color: #24292F">(</span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">balanceOf</span><span style="color: #24292F">(acc));</span></li><li value="45"></li><li value="46"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">before</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">getBalance</span><span style="color: #24292F">();</span></li><li value="47"><span style="color: #24292F">  console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Your balance is ${</span><span style="color: #24292F">before</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="48"></li><li value="49"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">interact</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> { </span><span style="color: #CF222E">...</span><span style="color: #24292F">stdlib.hasRandom };</span></li><li value="50"></li><li value="51"><span style="color: #24292F">  interact.</span><span style="color: #8250DF">informTimeout</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="52"><span style="color: #24292F">    console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`There was a timeout.`</span><span style="color: #24292F">);</span></li><li value="53"><span style="color: #24292F">    process.</span><span style="color: #8250DF">exit</span><span style="color: #24292F">(</span><span style="color: #0550AE">1</span><span style="color: #24292F">);</span></li><li value="54"><span style="color: #24292F">  };</span></li><li value="55"></li><li value="56"><span style="color: #24292F">  </span><span style="color: #CF222E">if</span><span style="color: #24292F"> (isAlice) {</span></li><li value="57"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">amt</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">ask</span><span style="color: #24292F">(</span></li><li value="58"><span style="color: #24292F">      </span><span style="color: #0A3069">`How much do you want to wager?`</span><span style="color: #24292F">,</span></li><li value="59"><span style="color: #24292F">      stdlib.parseCurrency</span></li><li value="60"><span style="color: #24292F">    );</span></li><li value="61"><span style="color: #24292F">    interact.wager </span><span style="color: #CF222E">=</span><span style="color: #24292F"> amt;</span></li><li value="62"><span style="color: #24292F">    interact.deadline </span><span style="color: #CF222E">=</span><span style="color: #24292F"> { ETH: </span><span style="color: #0550AE">100</span><span style="color: #24292F">, ALGO: </span><span style="color: #0550AE">100</span><span style="color: #24292F">, CFX: </span><span style="color: #0550AE">1000</span><span style="color: #24292F"> }[stdlib.connector];</span></li><li value="63"><span style="color: #24292F">  } </span><span style="color: #CF222E">else</span><span style="color: #24292F"> {</span></li><li value="64"><span style="color: #24292F">    interact.</span><span style="color: #8250DF">acceptWager</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">async</span><span style="color: #24292F"> (</span><span style="color: #953800">amt</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="65"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">accepted</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">ask</span><span style="color: #24292F">(</span></li><li value="66"><span style="color: #24292F">        </span><span style="color: #0A3069">`Do you accept the wager of ${</span><span style="color: #8250DF">fmt</span><span style="color: #0A3069">(</span><span style="color: #24292F">amt</span><span style="color: #0A3069">)</span><span style="color: #0A3069">}?`</span><span style="color: #24292F">,</span></li><li value="67"><span style="color: #24292F">        yesno</span></li><li value="68"><span style="color: #24292F">      );</span></li><li value="69"><span style="color: #24292F">      </span><span style="color: #CF222E">if</span><span style="color: #24292F"> (</span><span style="color: #CF222E">!</span><span style="color: #24292F">accepted) {</span></li><li value="70"><span style="color: #24292F">        process.</span><span style="color: #8250DF">exit</span><span style="color: #24292F">(</span><span style="color: #0550AE">0</span><span style="color: #24292F">);</span></li><li value="71"><span style="color: #24292F">      }</span></li><li value="72"><span style="color: #24292F">    };</span></li><li value="73"><span style="color: #24292F">  }</span></li><li value="74"></li><li value="75"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">HAND</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> [</span><span style="color: #0A3069">'Rock'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Paper'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Scissors'</span><span style="color: #24292F">];</span></li><li value="76"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">HANDS</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span></li><li value="77"><span style="color: #24292F">    </span><span style="color: #0A3069">'Rock'</span><span style="color: #24292F">: </span><span style="color: #0550AE">0</span><span style="color: #24292F">, </span><span style="color: #0A3069">'R'</span><span style="color: #24292F">: </span><span style="color: #0550AE">0</span><span style="color: #24292F">, </span><span style="color: #0A3069">'r'</span><span style="color: #24292F">: </span><span style="color: #0550AE">0</span><span style="color: #24292F">,</span></li><li value="78"><span style="color: #24292F">    </span><span style="color: #0A3069">'Paper'</span><span style="color: #24292F">: </span><span style="color: #0550AE">1</span><span style="color: #24292F">, </span><span style="color: #0A3069">'P'</span><span style="color: #24292F">: </span><span style="color: #0550AE">1</span><span style="color: #24292F">, </span><span style="color: #0A3069">'p'</span><span style="color: #24292F">: </span><span style="color: #0550AE">1</span><span style="color: #24292F">,</span></li><li value="79"><span style="color: #24292F">    </span><span style="color: #0A3069">'Scissors'</span><span style="color: #24292F">: </span><span style="color: #0550AE">2</span><span style="color: #24292F">, </span><span style="color: #0A3069">'S'</span><span style="color: #24292F">: </span><span style="color: #0550AE">2</span><span style="color: #24292F">, </span><span style="color: #0A3069">'s'</span><span style="color: #24292F">: </span><span style="color: #0550AE">2</span><span style="color: #24292F">,</span></li><li value="80"><span style="color: #24292F">  };</span></li><li value="81"></li><li value="82"><span style="color: #24292F">  interact.</span><span style="color: #8250DF">getHand</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">async</span><span style="color: #24292F"> () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="83"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">hand</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">ask</span><span style="color: #24292F">(</span><span style="color: #0A3069">`What hand will you play?`</span><span style="color: #24292F">, (</span><span style="color: #953800">x</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="84"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">hand</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">HANDS</span><span style="color: #24292F">[x];</span></li><li value="85"><span style="color: #24292F">      </span><span style="color: #CF222E">if</span><span style="color: #24292F"> ( hand </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">null</span><span style="color: #24292F"> ) {</span></li><li value="86"><span style="color: #24292F">        </span><span style="color: #CF222E">throw</span><span style="color: #24292F"> </span><span style="color: #0550AE">Error</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Not a valid hand ${</span><span style="color: #24292F">hand</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="87"><span style="color: #24292F">      }</span></li><li value="88"><span style="color: #24292F">      </span><span style="color: #CF222E">return</span><span style="color: #24292F"> hand;</span></li><li value="89"><span style="color: #24292F">    });</span></li><li value="90"><span style="color: #24292F">    console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`You played ${</span><span style="color: #0550AE">HAND</span><span style="color: #0A3069">[</span><span style="color: #24292F">hand</span><span style="color: #0A3069">]</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="91"><span style="color: #24292F">    </span><span style="color: #CF222E">return</span><span style="color: #24292F"> hand;</span></li><li value="92"><span style="color: #24292F">  };</span></li><li value="93"></li><li value="94"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">OUTCOME</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> [</span><span style="color: #0A3069">'Bob wins'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Draw'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Alice wins'</span><span style="color: #24292F">];</span></li><li value="95"><span style="color: #24292F">  interact.</span><span style="color: #8250DF">seeOutcome</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">async</span><span style="color: #24292F"> (</span><span style="color: #953800">outcome</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="96"><span style="color: #24292F">    console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`The outcome is: ${</span><span style="color: #0550AE">OUTCOME</span><span style="color: #0A3069">[</span><span style="color: #24292F">outcome</span><span style="color: #0A3069">]</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="97"><span style="color: #24292F">  };</span></li><li value="98"></li><li value="99"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">part</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> isAlice </span><span style="color: #CF222E">?</span><span style="color: #24292F"> ctc.p.Alice </span><span style="color: #CF222E">:</span><span style="color: #24292F"> ctc.p.Bob;</span></li><li value="100"><span style="color: #24292F">  </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">part</span><span style="color: #24292F">(interact);</span></li><li value="101"></li><li value="102"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">after</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">getBalance</span><span style="color: #24292F">();</span></li><li value="103"><span style="color: #24292F">  console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Your balance is now ${</span><span style="color: #24292F">after</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="104"></li><li value="105"><span style="color: #24292F">  </span><span style="color: #8250DF">done</span><span style="color: #24292F">();</span></li><li value="106"><span style="color: #24292F">})();</span></li></ol></pre>
<h2 id="web-frontend">Web Frontend<a aria-hidden="true" tabindex="-1" href="#web-frontend"><span class="icon icon-link"></span></a></h2>
<p>Finally, the code of our web frontend:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-9-web/index.js">rps-9-web/index.js</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">import</span><span style="color: #24292F"> React </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'react'</span><span style="color: #24292F">;</span></li><li value="2"><span style="color: #CF222E">import</span><span style="color: #24292F"> AppViews </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./views/AppViews'</span><span style="color: #24292F">;</span></li><li value="3"><span style="color: #CF222E">import</span><span style="color: #24292F"> DeployerViews </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./views/DeployerViews'</span><span style="color: #24292F">;</span></li><li value="4"><span style="color: #CF222E">import</span><span style="color: #24292F"> AttacherViews </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./views/AttacherViews'</span><span style="color: #24292F">;</span></li><li value="5"><span style="color: #CF222E">import</span><span style="color: #24292F"> {renderDOM, renderView} </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./views/render'</span><span style="color: #24292F">;</span></li><li value="6"><span style="color: #CF222E">import</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./index.css'</span><span style="color: #24292F">;</span></li><li value="7"><span style="color: #CF222E">import</span><span style="color: #24292F"> </span><span style="color: #0550AE">*</span><span style="color: #24292F"> </span><span style="color: #CF222E">as</span><span style="color: #24292F"> backend </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./build/index.main.mjs'</span><span style="color: #24292F">;</span></li><li value="8"><span style="color: #CF222E">import</span><span style="color: #24292F"> {loadStdlib} </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'@reach-sh/stdlib'</span><span style="color: #24292F">;</span></li><li value="9"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">reach</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">loadStdlib</span><span style="color: #24292F">(process.env);</span></li><li value="10"></li><li value="11"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">handToInt</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span><span style="color: #0A3069">'ROCK'</span><span style="color: #24292F">: </span><span style="color: #0550AE">0</span><span style="color: #24292F">, </span><span style="color: #0A3069">'PAPER'</span><span style="color: #24292F">: </span><span style="color: #0550AE">1</span><span style="color: #24292F">, </span><span style="color: #0A3069">'SCISSORS'</span><span style="color: #24292F">: </span><span style="color: #0550AE">2</span><span style="color: #24292F">};</span></li><li value="12"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">intToOutcome</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> [</span><span style="color: #0A3069">'Bob wins!'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Draw!'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Alice wins!'</span><span style="color: #24292F">];</span></li><li value="13"><span style="color: #CF222E">const</span><span style="color: #24292F"> {</span><span style="color: #0550AE">standardUnit</span><span style="color: #24292F">} </span><span style="color: #CF222E">=</span><span style="color: #24292F"> reach;</span></li><li value="14"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">defaults</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {defaultFundAmt: </span><span style="color: #0A3069">'10'</span><span style="color: #24292F">, defaultWager: </span><span style="color: #0A3069">'3'</span><span style="color: #24292F">, standardUnit};</span></li><li value="15"></li><li value="16"><span style="color: #CF222E">class</span><span style="color: #24292F"> </span><span style="color: #953800">App</span><span style="color: #24292F"> </span><span style="color: #CF222E">extends</span><span style="color: #24292F"> </span><span style="color: #953800">React</span><span style="color: #24292F">.</span><span style="color: #0550AE">Component</span><span style="color: #24292F"> {</span></li><li value="17"><span style="color: #24292F">  </span><span style="color: #CF222E">constructor</span><span style="color: #24292F">(</span><span style="color: #953800">props</span><span style="color: #24292F">) {</span></li><li value="18"><span style="color: #24292F">    </span><span style="color: #0550AE">super</span><span style="color: #24292F">(props);</span></li><li value="19"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.state </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {view: </span><span style="color: #0A3069">'ConnectAccount'</span><span style="color: #24292F">, </span><span style="color: #CF222E">...</span><span style="color: #24292F">defaults};</span></li><li value="20"><span style="color: #24292F">  }</span></li><li value="21"><span style="color: #24292F">  </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #8250DF">componentDidMount</span><span style="color: #24292F">() {</span></li><li value="22"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">acc</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> reach.</span><span style="color: #8250DF">getDefaultAccount</span><span style="color: #24292F">();</span></li><li value="23"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">balAtomic</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> reach.</span><span style="color: #8250DF">balanceOf</span><span style="color: #24292F">(acc);</span></li><li value="24"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">bal</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> reach.</span><span style="color: #8250DF">formatCurrency</span><span style="color: #24292F">(balAtomic, </span><span style="color: #0550AE">4</span><span style="color: #24292F">);</span></li><li value="25"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({acc, bal});</span></li><li value="26"><span style="color: #24292F">    </span><span style="color: #CF222E">if</span><span style="color: #24292F"> (</span><span style="color: #CF222E">await</span><span style="color: #24292F"> reach.</span><span style="color: #8250DF">canFundFromFaucet</span><span style="color: #24292F">()) {</span></li><li value="27"><span style="color: #24292F">      </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'FundAccount'</span><span style="color: #24292F">});</span></li><li value="28"><span style="color: #24292F">    } </span><span style="color: #CF222E">else</span><span style="color: #24292F"> {</span></li><li value="29"><span style="color: #24292F">      </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'DeployerOrAttacher'</span><span style="color: #24292F">});</span></li><li value="30"><span style="color: #24292F">    }</span></li><li value="31"><span style="color: #24292F">  }</span></li><li value="32"><span style="color: #24292F">  </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #8250DF">fundAccount</span><span style="color: #24292F">(</span><span style="color: #953800">fundAmount</span><span style="color: #24292F">) {</span></li><li value="33"><span style="color: #24292F">    </span><span style="color: #CF222E">await</span><span style="color: #24292F"> reach.</span><span style="color: #8250DF">fundFromFaucet</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">.state.acc, reach.</span><span style="color: #8250DF">parseCurrency</span><span style="color: #24292F">(fundAmount));</span></li><li value="34"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'DeployerOrAttacher'</span><span style="color: #24292F">});</span></li><li value="35"><span style="color: #24292F">  }</span></li><li value="36"><span style="color: #24292F">  </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #8250DF">skipFundAccount</span><span style="color: #24292F">() { </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'DeployerOrAttacher'</span><span style="color: #24292F">}); }</span></li><li value="37"><span style="color: #24292F">  </span><span style="color: #8250DF">selectAttacher</span><span style="color: #24292F">() { </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'Wrapper'</span><span style="color: #24292F">, ContentView: Attacher}); }</span></li><li value="38"><span style="color: #24292F">  </span><span style="color: #8250DF">selectDeployer</span><span style="color: #24292F">() { </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'Wrapper'</span><span style="color: #24292F">, ContentView: Deployer}); }</span></li><li value="39"><span style="color: #24292F">  </span><span style="color: #8250DF">render</span><span style="color: #24292F">() { </span><span style="color: #CF222E">return</span><span style="color: #24292F"> </span><span style="color: #8250DF">renderView</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">, AppViews); }</span></li><li value="40"><span style="color: #24292F">}</span></li><li value="41"></li><li value="42"><span style="color: #CF222E">class</span><span style="color: #24292F"> </span><span style="color: #953800">Player</span><span style="color: #24292F"> </span><span style="color: #CF222E">extends</span><span style="color: #24292F"> </span><span style="color: #953800">React</span><span style="color: #24292F">.</span><span style="color: #0550AE">Component</span><span style="color: #24292F"> {</span></li><li value="43"><span style="color: #24292F">  </span><span style="color: #8250DF">random</span><span style="color: #24292F">() { </span><span style="color: #CF222E">return</span><span style="color: #24292F"> reach.hasRandom.</span><span style="color: #8250DF">random</span><span style="color: #24292F">(); }</span></li><li value="44"><span style="color: #24292F">  </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #8250DF">getHand</span><span style="color: #24292F">() { </span><span style="color: #6E7781">// Fun([], UInt)</span></li><li value="45"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">hand</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #CF222E">new</span><span style="color: #24292F"> </span><span style="color: #0550AE">Promise</span><span style="color: #24292F">(</span><span style="color: #953800">resolveHandP</span><span style="color: #24292F"> </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="46"><span style="color: #24292F">      </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'GetHand'</span><span style="color: #24292F">, playable: </span><span style="color: #0550AE">true</span><span style="color: #24292F">, resolveHandP});</span></li><li value="47"><span style="color: #24292F">    });</span></li><li value="48"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'WaitingForResults'</span><span style="color: #24292F">, hand});</span></li><li value="49"><span style="color: #24292F">    </span><span style="color: #CF222E">return</span><span style="color: #24292F"> handToInt[hand];</span></li><li value="50"><span style="color: #24292F">  }</span></li><li value="51"><span style="color: #24292F">  </span><span style="color: #8250DF">seeOutcome</span><span style="color: #24292F">(</span><span style="color: #953800">i</span><span style="color: #24292F">) { </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'Done'</span><span style="color: #24292F">, outcome: intToOutcome[i]}); }</span></li><li value="52"><span style="color: #24292F">  </span><span style="color: #8250DF">informTimeout</span><span style="color: #24292F">() { </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'Timeout'</span><span style="color: #24292F">}); }</span></li><li value="53"><span style="color: #24292F">  </span><span style="color: #8250DF">playHand</span><span style="color: #24292F">(</span><span style="color: #953800">hand</span><span style="color: #24292F">) { </span><span style="color: #0550AE">this</span><span style="color: #24292F">.state.</span><span style="color: #8250DF">resolveHandP</span><span style="color: #24292F">(hand); }</span></li><li value="54"><span style="color: #24292F">}</span></li><li value="55"></li><li value="56"><span style="color: #CF222E">class</span><span style="color: #24292F"> </span><span style="color: #953800">Deployer</span><span style="color: #24292F"> </span><span style="color: #CF222E">extends</span><span style="color: #24292F"> </span><span style="color: #0550AE">Player</span><span style="color: #24292F"> {</span></li><li value="57"><span style="color: #24292F">  </span><span style="color: #CF222E">constructor</span><span style="color: #24292F">(</span><span style="color: #953800">props</span><span style="color: #24292F">) {</span></li><li value="58"><span style="color: #24292F">    </span><span style="color: #0550AE">super</span><span style="color: #24292F">(props);</span></li><li value="59"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.state </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {view: </span><span style="color: #0A3069">'SetWager'</span><span style="color: #24292F">};</span></li><li value="60"><span style="color: #24292F">  }</span></li><li value="61"><span style="color: #24292F">  </span><span style="color: #8250DF">setWager</span><span style="color: #24292F">(</span><span style="color: #953800">wager</span><span style="color: #24292F">) { </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'Deploy'</span><span style="color: #24292F">, wager}); }</span></li><li value="62"><span style="color: #24292F">  </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #8250DF">deploy</span><span style="color: #24292F">() {</span></li><li value="63"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">ctc</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">this</span><span style="color: #24292F">.props.acc.</span><span style="color: #8250DF">deploy</span><span style="color: #24292F">(backend);</span></li><li value="64"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'Deploying'</span><span style="color: #24292F">, ctc});</span></li><li value="65"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.wager </span><span style="color: #CF222E">=</span><span style="color: #24292F"> reach.</span><span style="color: #8250DF">parseCurrency</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">.state.wager); </span><span style="color: #6E7781">// UInt</span></li><li value="66"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.deadline </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {ETH: </span><span style="color: #0550AE">10</span><span style="color: #24292F">, ALGO: </span><span style="color: #0550AE">100</span><span style="color: #24292F">, CFX: </span><span style="color: #0550AE">1000</span><span style="color: #24292F">}[reach.connector]; </span><span style="color: #6E7781">// UInt</span></li><li value="67"><span style="color: #24292F">    backend.</span><span style="color: #8250DF">Alice</span><span style="color: #24292F">(ctc, </span><span style="color: #0550AE">this</span><span style="color: #24292F">);</span></li><li value="68"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">ctcInfoStr</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">JSON</span><span style="color: #24292F">.</span><span style="color: #0550AE">stringify</span><span style="color: #24292F">(</span><span style="color: #CF222E">await</span><span style="color: #24292F"> ctc.</span><span style="color: #8250DF">getInfo</span><span style="color: #24292F">(), </span><span style="color: #0550AE">null</span><span style="color: #24292F">, </span><span style="color: #0550AE">2</span><span style="color: #24292F">);</span></li><li value="69"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'WaitingForAttacher'</span><span style="color: #24292F">, ctcInfoStr});</span></li><li value="70"><span style="color: #24292F">  }</span></li><li value="71"><span style="color: #24292F">  </span><span style="color: #8250DF">render</span><span style="color: #24292F">() { </span><span style="color: #CF222E">return</span><span style="color: #24292F"> </span><span style="color: #8250DF">renderView</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">, DeployerViews); }</span></li><li value="72"><span style="color: #24292F">}</span></li><li value="73"><span style="color: #CF222E">class</span><span style="color: #24292F"> </span><span style="color: #953800">Attacher</span><span style="color: #24292F"> </span><span style="color: #CF222E">extends</span><span style="color: #24292F"> </span><span style="color: #0550AE">Player</span><span style="color: #24292F"> {</span></li><li value="74"><span style="color: #24292F">  </span><span style="color: #CF222E">constructor</span><span style="color: #24292F">(</span><span style="color: #953800">props</span><span style="color: #24292F">) {</span></li><li value="75"><span style="color: #24292F">    </span><span style="color: #0550AE">super</span><span style="color: #24292F">(props);</span></li><li value="76"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.state </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {view: </span><span style="color: #0A3069">'Attach'</span><span style="color: #24292F">};</span></li><li value="77"><span style="color: #24292F">  }</span></li><li value="78"><span style="color: #24292F">  </span><span style="color: #8250DF">attach</span><span style="color: #24292F">(</span><span style="color: #953800">ctcInfoStr</span><span style="color: #24292F">) {</span></li><li value="79"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">ctc</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">this</span><span style="color: #24292F">.props.acc.</span><span style="color: #8250DF">attach</span><span style="color: #24292F">(backend, </span><span style="color: #0550AE">JSON</span><span style="color: #24292F">.</span><span style="color: #0550AE">parse</span><span style="color: #24292F">(ctcInfoStr));</span></li><li value="80"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'Attaching'</span><span style="color: #24292F">});</span></li><li value="81"><span style="color: #24292F">    backend.</span><span style="color: #8250DF">Bob</span><span style="color: #24292F">(ctc, </span><span style="color: #0550AE">this</span><span style="color: #24292F">);</span></li><li value="82"><span style="color: #24292F">  }</span></li><li value="83"><span style="color: #24292F">  </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #8250DF">acceptWager</span><span style="color: #24292F">(</span><span style="color: #953800">wagerAtomic</span><span style="color: #24292F">) { </span><span style="color: #6E7781">// Fun([UInt], Null)</span></li><li value="84"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">wager</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> reach.</span><span style="color: #8250DF">formatCurrency</span><span style="color: #24292F">(wagerAtomic, </span><span style="color: #0550AE">4</span><span style="color: #24292F">);</span></li><li value="85"><span style="color: #24292F">    </span><span style="color: #CF222E">return</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #CF222E">new</span><span style="color: #24292F"> </span><span style="color: #0550AE">Promise</span><span style="color: #24292F">(</span><span style="color: #953800">resolveAcceptedP</span><span style="color: #24292F"> </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="86"><span style="color: #24292F">      </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'AcceptTerms'</span><span style="color: #24292F">, wager, resolveAcceptedP});</span></li><li value="87"><span style="color: #24292F">    });</span></li><li value="88"><span style="color: #24292F">  }</span></li><li value="89"><span style="color: #24292F">  </span><span style="color: #8250DF">termsAccepted</span><span style="color: #24292F">() {</span></li><li value="90"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.state.</span><span style="color: #8250DF">resolveAcceptedP</span><span style="color: #24292F">();</span></li><li value="91"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'WaitingForTurn'</span><span style="color: #24292F">});</span></li><li value="92"><span style="color: #24292F">  }</span></li><li value="93"><span style="color: #24292F">  </span><span style="color: #8250DF">render</span><span style="color: #24292F">() { </span><span style="color: #CF222E">return</span><span style="color: #24292F"> </span><span style="color: #8250DF">renderView</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">, AttacherViews); }</span></li><li value="94"><span style="color: #24292F">}</span></li><li value="95"></li><li value="96"><span style="color: #8250DF">renderDOM</span><span style="color: #24292F">(&lt;</span><span style="color: #116329">App</span><span style="color: #24292F"> /&gt;);</span></li></ol></pre>
<h2 id="reach-behind-the-scenes">Reach Behind the Scenes<a aria-hidden="true" tabindex="-1" href="#reach-behind-the-scenes"><span class="icon icon-link"></span></a></h2>
<p>As we've witnessed, we wrote about one-hundred lines of Reach and created two different frontends. Our command-line version is about a hundred lines of JavaScript, while our Web version is about the same length, but it has a lot of presentation code, as well.</p>
<p>Behind the scenes, Reach generated hundreds of lines of Solidity (which you can see here: <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-8-interact/build/index.main.sol">rps-8-interact/build/index.main.sol</a>), almost two-thousand lines of TEAL (which is here: <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-8-interact/build/index.main.appApproval.teal">rps-8-interact/build/index.main.appApproval.teal</a>), as well as over a thousand lines of JavaScript (as seen here: <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-8-interact/build/index.main.mjs">rps-8-interact/build/index.main.mjs</a>). If we weren't using Reach, we'd have to write all this code ourselves. Not only that, but we’d also need to ensure the frontend and backend were consistent and that they were completely bug and error free.</p>
<h2 id="build-your-own">Build Your Own!<a aria-hidden="true" tabindex="-1" href="#build-your-own"><span class="icon icon-link"></span></a></h2>
<p>Now that you've seen an entire Reach application, it's time for you to start working on your own applications!</p>
<p>The very next thing you should do right now is <strong>join us on the <a href="https://discord.gg/AZsgcXu">Discord Community</a></strong>! Once you've joined and verified (be sure to have DMs enabled), visit the #tutorial channel and message: "@team, I just completed the tutorial!" and we'll give you the <code>tutorial veteran</code> badge, so you can more easily help others work through the tutorials.</p>
<p>If you're interested in using Reach with frontends other than JavaScript, then take time to work through the next section. If you're primarily focused on using Reach with JavaScript, then we encourage you to get active in the Discord (we're excited to welcome you!) and begin building a project. You might also refer to our <a href="https://reach-sh.github.io/en/books/essentials/frontend-programming/javascript-frontends/">JavaScript Frontend</a> reference material as additional development support.</p>
<h1 id="rock-paper-scissors-in-python">Rock, Paper, Scissors in Python<a aria-hidden="true" tabindex="-1" href="#rock-paper-scissors-in-python"><span class="icon icon-link"></span></a></h1>
<blockquote>
  <p>By Matt Audesse <a href="mailto:matt@reach.sh">matt@reach.sh</a></p>
</blockquote>
<p>Reach supports using any programming language through the <a href="https://docs.reach.sh/ref-backends-rpc.html">Reach RPC Server</a>.</p>
<p>This tutorial walks through an implementation of <em>Rock, Paper, Scissors!</em> using Python in the frontend. This version of the program is based on the <a href="https://docs.reach.sh/tut-7.html">Play and Play Again</a> section of our <em>Rock, Paper, Scissors!</em> tutorial. While we don't include a text- or web-based interface, we will use the final version of the Reach backend code.</p>
<h2 id="comparing-javascript-frontend-to-python">Comparing JavaScript Frontend to Python<a aria-hidden="true" tabindex="-1" href="#comparing-javascript-frontend-to-python"><span class="icon icon-link"></span></a></h2>
<p>Below, we will compare the <em>Play and Play Again</em> JavaScript frontend with the equivalent Python code communicating via RPC. Follow along by typing the Python code into a file called <em>index.py</em>.</p>
<h3 id="imports">Imports<a aria-hidden="true" tabindex="-1" href="#imports"><span class="icon icon-link"></span></a></h3>
<p>Let's begin by comparing the necessary imports and program body:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.mjs#L1-L5">rps-7-loops/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">import</span><span style="color: #24292F"> { loadStdlib } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'@reach-sh/stdlib'</span><span style="color: #24292F">;</span></li><li value="2"><span style="color: #CF222E">import</span><span style="color: #24292F"> </span><span style="color: #0550AE">*</span><span style="color: #24292F"> </span><span style="color: #CF222E">as</span><span style="color: #24292F"> backend </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./build/index.main.mjs'</span><span style="color: #24292F">;</span></li><li value="3"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">stdlib</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">loadStdlib</span><span style="color: #24292F">(process.env);</span></li><li value="4"></li><li value="5"><span style="color: #24292F">(</span><span style="color: #CF222E">async</span><span style="color: #24292F"> () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li></ol></pre>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-rpc/client-py/index.py#L1-L10">rps-7-rpc/client-py/index.py</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #6E7781"># flake8: noqa</span></li><li value="2"></li><li value="3"><span style="color: #CF222E">import</span><span style="color: #24292F"> random</span></li><li value="4"><span style="color: #CF222E">from</span><span style="color: #24292F"> threading </span><span style="color: #CF222E">import</span><span style="color: #24292F"> Thread</span></li><li value="5"><span style="color: #CF222E">from</span><span style="color: #24292F"> reach_rpc </span><span style="color: #CF222E">import</span><span style="color: #24292F"> mk_rpc</span></li><li value="6"></li><li value="7"></li><li value="8"><span style="color: #CF222E">def</span><span style="color: #24292F"> </span><span style="color: #8250DF">main</span><span style="color: #24292F">():</span></li><li value="9"><span style="color: #24292F">    rpc, rpc_callbacks </span><span style="color: #CF222E">=</span><span style="color: #24292F"> mk_rpc()</span></li><li value="10"></li></ol></pre>
<p>In JavaScript, we import <code>loadStdlib</code> and <code>backend</code>, but the Python version plucks <code>mk_rpc</code> from the supporting <code>reach_rpc</code> library. It is unnecessary for an RPC frontend to import a backend because the <a href="https://docs.reach.sh/ref-backends-rpc.html">RPC server</a> handles this.</p>
<p>The Python version also borrows functionality from the <code>random</code> and <code>threading</code> libraries. These libraries are critical for the participant interact interface to communicate callable methods to the RPC server.</p>
<p>In line 9 the Python program binds <code>rpc</code> and <code>rpc_callbacks</code> out of <code>mk_rpc</code>. These are the only two functions we need to communicate with the <a href="https://docs.reach.sh/ref-frontends-rpc-py.html">Python RPC server</a>.</p>
<h3 id="funding-accounts">Funding Accounts<a aria-hidden="true" tabindex="-1" href="#funding-accounts"><span class="icon icon-link"></span></a></h3>
<p>Next, we'll define the Alice and Bob accounts and pre-fund them with a balance of 100 network tokens.</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.mjs#L6-L9">rps-7-loops/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="6"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">startingBalance</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">parseCurrency</span><span style="color: #24292F">(</span><span style="color: #0550AE">100</span><span style="color: #24292F">);</span></li><li value="7"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">accAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">newTestAccount</span><span style="color: #24292F">(startingBalance);</span></li><li value="8"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">accBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">newTestAccount</span><span style="color: #24292F">(startingBalance);</span></li><li value="9"></li></ol></pre>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-rpc/client-py/index.py#L11-L14">rps-7-rpc/client-py/index.py</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="11"><span style="color: #24292F">    starting_balance </span><span style="color: #CF222E">=</span><span style="color: #24292F"> rpc(</span><span style="color: #0A3069">'/stdlib/parseCurrency'</span><span style="color: #24292F">, </span><span style="color: #0550AE">100</span><span style="color: #24292F">)</span></li><li value="12"><span style="color: #24292F">    acc_alice        </span><span style="color: #CF222E">=</span><span style="color: #24292F"> rpc(</span><span style="color: #0A3069">'/stdlib/newTestAccount'</span><span style="color: #24292F">, starting_balance)</span></li><li value="13"><span style="color: #24292F">    acc_bob          </span><span style="color: #CF222E">=</span><span style="color: #24292F"> rpc(</span><span style="color: #0A3069">'/stdlib/newTestAccount'</span><span style="color: #24292F">, starting_balance)</span></li><li value="14"></li></ol></pre>
<p>Translating code with RPC only requires specifying the corresponding <a href="https://docs.reach.sh/ref-frontends-rpc-py.html">RPC</a> method and supplying the same arguments. In this snippet, we can see that the Python arguments match the <a href="https://docs.reach.sh/ref-frontends-js.html">JavaScript frontend support library</a> methods, followed by the parameter seen in the matching line of JavaScript.</p>
<h3 id="helper-functions">Helper Functions<a aria-hidden="true" tabindex="-1" href="#helper-functions"><span class="icon icon-link"></span></a></h3>
<p>Next, we'll define two helper functions and use them to query Alice and Bob's beginning balances:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.mjs#L10-L14">rps-7-loops/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="10"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">fmt</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (</span><span style="color: #953800">x</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">formatCurrency</span><span style="color: #24292F">(x, </span><span style="color: #0550AE">4</span><span style="color: #24292F">);</span></li><li value="11"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">getBalance</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">async</span><span style="color: #24292F"> (</span><span style="color: #953800">who</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">fmt</span><span style="color: #24292F">(</span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">balanceOf</span><span style="color: #24292F">(who));</span></li><li value="12"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">beforeAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">getBalance</span><span style="color: #24292F">(accAlice);</span></li><li value="13"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">beforeBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">getBalance</span><span style="color: #24292F">(accBob);</span></li><li value="14"></li></ol></pre>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-rpc/client-py/index.py#L15-L23">rps-7-rpc/client-py/index.py</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="15"><span style="color: #24292F">    </span><span style="color: #CF222E">def</span><span style="color: #24292F"> </span><span style="color: #8250DF">fmt</span><span style="color: #24292F">(x):</span></li><li value="16"><span style="color: #24292F">        </span><span style="color: #CF222E">return</span><span style="color: #24292F"> rpc(</span><span style="color: #0A3069">'/stdlib/formatCurrency'</span><span style="color: #24292F">, x, </span><span style="color: #0550AE">4</span><span style="color: #24292F">)</span></li><li value="17"></li><li value="18"><span style="color: #24292F">    </span><span style="color: #CF222E">def</span><span style="color: #24292F"> </span><span style="color: #8250DF">get_balance</span><span style="color: #24292F">(w):</span></li><li value="19"><span style="color: #24292F">        </span><span style="color: #CF222E">return</span><span style="color: #24292F"> fmt(rpc(</span><span style="color: #0A3069">'/stdlib/balanceOf'</span><span style="color: #24292F">, w))</span></li><li value="20"></li><li value="21"><span style="color: #24292F">    before_alice </span><span style="color: #CF222E">=</span><span style="color: #24292F"> get_balance(acc_alice)</span></li><li value="22"><span style="color: #24292F">    before_bob   </span><span style="color: #CF222E">=</span><span style="color: #24292F"> get_balance(acc_bob)</span></li><li value="23"></li></ol></pre>
<h3 id="deploying-contracts">Deploying Contracts<a aria-hidden="true" tabindex="-1" href="#deploying-contracts"><span class="icon icon-link"></span></a></h3>
<p>Deploying and attaching contracts works slightly differently over RPC:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.mjs#L15-L17">rps-7-loops/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="15"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">ctcAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> accAlice.</span><span style="color: #8250DF">contract</span><span style="color: #24292F">(backend);</span></li><li value="16"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">ctcBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> accBob.</span><span style="color: #8250DF">contract</span><span style="color: #24292F">(backend, ctcAlice.</span><span style="color: #8250DF">getInfo</span><span style="color: #24292F">());</span></li><li value="17"></li></ol></pre>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-rpc/client-py/index.py#L24-L25">rps-7-rpc/client-py/index.py</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="24"><span style="color: #24292F">    ctc_alice    </span><span style="color: #CF222E">=</span><span style="color: #24292F"> rpc(</span><span style="color: #0A3069">'/acc/deploy'</span><span style="color: #24292F">, acc_alice)</span></li><li value="25"></li></ol></pre>
<p>The RPC Server interfaces with the backend. As such, there is no need to call <code>backend</code> as a parameter. Alice's account RPC handle is sufficient for the contract deploy.</p>
<p>We will delay Bob's contract attach until later because Python lacks promises that are available in JavaScript. When Bob attaches to the account, we'll only need Bob's account RPC handle and Alice's contract <a href="https://docs.reach.sh/ref-backends-rpc-proto.html#%28tech._rpc._handle%29">RPC handle</a>.</p>
<h2 id="hand--outcome">HAND &amp; OUTCOME<a aria-hidden="true" tabindex="-1" href="#hand--outcome"><span class="icon icon-link"></span></a></h2>
<p><code>HAND</code> and <code>OUTCOME</code> only differ syntactically from their JavaScript equivalents:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.mjs#L18-L19">rps-7-loops/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="18"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">HAND</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> [</span><span style="color: #0A3069">'Rock'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Paper'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Scissors'</span><span style="color: #24292F">];</span></li><li value="19"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">OUTCOME</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> [</span><span style="color: #0A3069">'Bob wins'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Draw'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Alice wins'</span><span style="color: #24292F">];</span></li></ol></pre>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-rpc/client-py/index.py#L26-L28">rps-7-rpc/client-py/index.py</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="26"><span style="color: #24292F">    </span><span style="color: #0550AE">HAND</span><span style="color: #24292F">         </span><span style="color: #CF222E">=</span><span style="color: #24292F"> [</span><span style="color: #0A3069">'Rock'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Paper'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Scissors'</span><span style="color: #24292F">]</span></li><li value="27"><span style="color: #24292F">    </span><span style="color: #0550AE">OUTCOME</span><span style="color: #24292F">      </span><span style="color: #CF222E">=</span><span style="color: #24292F"> [</span><span style="color: #0A3069">'Bob wins'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Draw'</span><span style="color: #24292F">, </span><span style="color: #0A3069">'Alice wins'</span><span style="color: #24292F">]</span></li><li value="28"></li></ol></pre>
<h2 id="participant-interact-interface">Participant Interact Interface<a aria-hidden="true" tabindex="-1" href="#participant-interact-interface"><span class="icon icon-link"></span></a></h2>
<p>The participant interact interface definitions remain similar:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.mjs#L20-L32">rps-7-loops/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="20"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #8250DF">Player</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (</span><span style="color: #953800">Who</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> ({</span></li><li value="21"><span style="color: #24292F">    </span><span style="color: #CF222E">...</span><span style="color: #24292F">stdlib.hasRandom,</span></li><li value="22"><span style="color: #24292F">    </span><span style="color: #8250DF">getHand</span><span style="color: #24292F">: </span><span style="color: #CF222E">async</span><span style="color: #24292F"> () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> { </span><span style="color: #6E7781">// &lt;-- async now</span></li><li value="23"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">hand</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">Math</span><span style="color: #24292F">.</span><span style="color: #0550AE">floor</span><span style="color: #24292F">(</span><span style="color: #0550AE">Math</span><span style="color: #24292F">.</span><span style="color: #0550AE">random</span><span style="color: #24292F">() </span><span style="color: #CF222E">*</span><span style="color: #24292F"> </span><span style="color: #0550AE">3</span><span style="color: #24292F">);</span></li><li value="24"><span style="color: #24292F">      console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`${</span><span style="color: #24292F">Who</span><span style="color: #0A3069">} played ${</span><span style="color: #0550AE">HAND</span><span style="color: #0A3069">[</span><span style="color: #24292F">hand</span><span style="color: #0A3069">]</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="25"><span style="color: #24292F">      </span><span style="color: #CF222E">if</span><span style="color: #24292F"> ( </span><span style="color: #0550AE">Math</span><span style="color: #24292F">.</span><span style="color: #0550AE">random</span><span style="color: #24292F">() </span><span style="color: #CF222E">&lt;=</span><span style="color: #24292F"> </span><span style="color: #0550AE">0.01</span><span style="color: #24292F"> ) {</span></li><li value="26"><span style="color: #24292F">        </span><span style="color: #CF222E">for</span><span style="color: #24292F"> ( </span><span style="color: #CF222E">let</span><span style="color: #24292F"> i </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">0</span><span style="color: #24292F">; i </span><span style="color: #CF222E">&lt;</span><span style="color: #24292F"> </span><span style="color: #0550AE">10</span><span style="color: #24292F">; i</span><span style="color: #CF222E">++</span><span style="color: #24292F"> ) {</span></li><li value="27"><span style="color: #24292F">          console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`  ${</span><span style="color: #24292F">Who</span><span style="color: #0A3069">} takes their sweet time sending it back...`</span><span style="color: #24292F">);</span></li><li value="28"><span style="color: #24292F">          </span><span style="color: #CF222E">await</span><span style="color: #24292F"> stdlib.</span><span style="color: #8250DF">wait</span><span style="color: #24292F">(</span><span style="color: #0550AE">1</span><span style="color: #24292F">);</span></li><li value="29"><span style="color: #24292F">        }</span></li><li value="30"><span style="color: #24292F">      }</span></li><li value="31"><span style="color: #24292F">      </span><span style="color: #CF222E">return</span><span style="color: #24292F"> hand;</span></li><li value="32"><span style="color: #24292F">    },</span></li></ol></pre>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-rpc/client-py/index.py#L29-L34">rps-7-rpc/client-py/index.py</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="29"><span style="color: #24292F">    </span><span style="color: #CF222E">def</span><span style="color: #24292F"> </span><span style="color: #8250DF">player</span><span style="color: #24292F">(who):</span></li><li value="30"><span style="color: #24292F">        </span><span style="color: #CF222E">def</span><span style="color: #24292F"> </span><span style="color: #8250DF">getHand</span><span style="color: #24292F">():</span></li><li value="31"><span style="color: #24292F">            hand </span><span style="color: #CF222E">=</span><span style="color: #24292F"> random.randint(</span><span style="color: #0550AE">0</span><span style="color: #24292F">, </span><span style="color: #0550AE">2</span><span style="color: #24292F">)</span></li><li value="32"><span style="color: #24292F">            </span><span style="color: #0550AE">print</span><span style="color: #24292F">(</span><span style="color: #0A3069">'</span><span style="color: #0550AE">%s</span><span style="color: #0A3069"> played </span><span style="color: #0550AE">%s</span><span style="color: #0A3069">'</span><span style="color: #24292F"> </span><span style="color: #CF222E">%</span><span style="color: #24292F"> (who, </span><span style="color: #0550AE">HAND</span><span style="color: #24292F">[hand]))</span></li><li value="33"><span style="color: #24292F">            </span><span style="color: #CF222E">return</span><span style="color: #24292F"> hand</span></li><li value="34"></li></ol></pre>
<p>We see that the JavaScript and Python frontends begin by declaring a reusable Player constructor which provides methods available to the participants.</p>
<p>While the JavaScript includes an explicit call to the <code>hasRandom</code> method in the standard library, in Python, we direct the RPC server to append to the interface with <code>'stdlib.hasRandom' : True</code> as a field in the constructor's <a href="https://docs.reach.sh/tut-7-rpc.html#py-return">return value</a>. (Seen in line 42, below).</p>
<p>A <code>getHand</code> function is defined in line 22, and line 30, respectively. This randomly selects an element from the predefined <code>HAND</code> set and returns to the backend. The function will be passed as a callable method of the interface later.</p>
<h2 id="timeout">Timeout<a aria-hidden="true" tabindex="-1" href="#timeout"><span class="icon icon-link"></span></a></h2>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.mjs#L36-L38">rps-7-loops/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="36"><span style="color: #24292F">    </span><span style="color: #8250DF">informTimeout</span><span style="color: #24292F">: () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="37"><span style="color: #24292F">      console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`${</span><span style="color: #24292F">Who</span><span style="color: #0A3069">} observed a timeout`</span><span style="color: #24292F">);</span></li><li value="38"><span style="color: #24292F">    },</span></li></ol></pre>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-rpc/client-py/index.py#L35-L37">rps-7-rpc/client-py/index.py</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="35"><span style="color: #24292F">        </span><span style="color: #CF222E">def</span><span style="color: #24292F"> </span><span style="color: #8250DF">informTimeout</span><span style="color: #24292F">():</span></li><li value="36"><span style="color: #24292F">            </span><span style="color: #0550AE">print</span><span style="color: #24292F">(</span><span style="color: #0A3069">'</span><span style="color: #0550AE">%s</span><span style="color: #0A3069"> observed a timeout'</span><span style="color: #24292F"> </span><span style="color: #CF222E">%</span><span style="color: #24292F"> who)</span></li><li value="37"></li></ol></pre>
<p>Lines 36 and 35, respectively, show how a participant may be informed of a timeout.</p>
<h2 id="see-outcome">See Outcome<a aria-hidden="true" tabindex="-1" href="#see-outcome"><span class="icon icon-link"></span></a></h2>
<p>Similarly, we see the <code>seeOutcome</code> function in the following snippet:</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.mjs#L33-L35">rps-7-loops/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="33"><span style="color: #24292F">    </span><span style="color: #8250DF">seeOutcome</span><span style="color: #24292F">: (</span><span style="color: #953800">outcome</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="34"><span style="color: #24292F">      console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`${</span><span style="color: #24292F">Who</span><span style="color: #0A3069">} saw outcome ${</span><span style="color: #0550AE">OUTCOME</span><span style="color: #0A3069">[</span><span style="color: #24292F">outcome</span><span style="color: #0A3069">]</span><span style="color: #0A3069">}`</span><span style="color: #24292F">);</span></li><li value="35"><span style="color: #24292F">    },</span></li></ol></pre>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-rpc/client-py/index.py#L38-L47">rps-7-rpc/client-py/index.py</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="38"><span style="color: #24292F">        </span><span style="color: #CF222E">def</span><span style="color: #24292F"> </span><span style="color: #8250DF">seeOutcome</span><span style="color: #24292F">(n):</span></li><li value="39"><span style="color: #24292F">            </span><span style="color: #0550AE">print</span><span style="color: #24292F">(</span><span style="color: #0A3069">'</span><span style="color: #0550AE">%s</span><span style="color: #0A3069"> saw outcome </span><span style="color: #0550AE">%s</span><span style="color: #0A3069">'</span></li><li value="40"><span style="color: #24292F">                  </span><span style="color: #CF222E">%</span><span style="color: #24292F"> (who, </span><span style="color: #0550AE">OUTCOME</span><span style="color: #24292F">[rpc(</span><span style="color: #0A3069">'/stdlib/bigNumberToNumber'</span><span style="color: #24292F">, n)]))</span></li><li value="41"></li><li value="42"><span style="color: #24292F">        </span><span style="color: #CF222E">return</span><span style="color: #24292F"> {</span><span style="color: #0A3069">'stdlib.hasRandom'</span><span style="color: #24292F">: </span><span style="color: #0550AE">True</span><span style="color: #24292F">,</span></li><li value="43"><span style="color: #24292F">                </span><span style="color: #0A3069">'getHand'</span><span style="color: #24292F">:          getHand,</span></li><li value="44"><span style="color: #24292F">                </span><span style="color: #0A3069">'informTimeout'</span><span style="color: #24292F">:    informTimeout,</span></li><li value="45"><span style="color: #24292F">                </span><span style="color: #0A3069">'seeOutcome'</span><span style="color: #24292F">:       seeOutcome,</span></li><li value="46"><span style="color: #24292F">                }</span></li><li value="47"></li></ol></pre>
<p>In lines 42 - 46 of the Python code, we see a return of <code>dict</code>, which represents the most common fields for Alice and Bob's participant interact interface.</p>
<p>In line 42 we see <code>'stdlib.hasRandom' : True</code>. When communicating via RPC, this instructs the server to append the signature on the receiving end.</p>
<h2 id="build-the-game">Build the Game<a aria-hidden="true" tabindex="-1" href="#build-the-game"><span class="icon icon-link"></span></a></h2>
<p>Finally, we able to use our previous code to play the game!</p>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-loops/index.mjs#L41-L60">rps-7-loops/index.mjs</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="41"><span style="color: #24292F">  </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #0550AE">Promise</span><span style="color: #24292F">.</span><span style="color: #8250DF">all</span><span style="color: #24292F">([</span></li><li value="42"><span style="color: #24292F">    ctcAlice.p.</span><span style="color: #8250DF">Alice</span><span style="color: #24292F">({</span></li><li value="43"><span style="color: #24292F">      </span><span style="color: #CF222E">...</span><span style="color: #8250DF">Player</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Alice'</span><span style="color: #24292F">),</span></li><li value="44"><span style="color: #24292F">      wager: stdlib.</span><span style="color: #8250DF">parseCurrency</span><span style="color: #24292F">(</span><span style="color: #0550AE">5</span><span style="color: #24292F">),</span></li><li value="45"><span style="color: #24292F">      deadline: </span><span style="color: #0550AE">10</span><span style="color: #24292F">,</span></li><li value="46"><span style="color: #24292F">    }),</span></li><li value="47"><span style="color: #24292F">    ctcBob.p.</span><span style="color: #8250DF">Bob</span><span style="color: #24292F">({</span></li><li value="48"><span style="color: #24292F">      </span><span style="color: #CF222E">...</span><span style="color: #8250DF">Player</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Bob'</span><span style="color: #24292F">),</span></li><li value="49"><span style="color: #24292F">      </span><span style="color: #8250DF">acceptWager</span><span style="color: #24292F">: (</span><span style="color: #953800">amt</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="50"><span style="color: #24292F">        console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Bob accepts the wager of ${</span><span style="color: #8250DF">fmt</span><span style="color: #0A3069">(</span><span style="color: #24292F">amt</span><span style="color: #0A3069">)</span><span style="color: #0A3069">}.`</span><span style="color: #24292F">);</span></li><li value="51"><span style="color: #24292F">      },</span></li><li value="52"><span style="color: #24292F">    }),</span></li><li value="53"><span style="color: #24292F">  ]);</span></li><li value="54"></li><li value="55"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">afterAlice</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">getBalance</span><span style="color: #24292F">(accAlice);</span></li><li value="56"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">afterBob</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">getBalance</span><span style="color: #24292F">(accBob);</span></li><li value="57"></li><li value="58"><span style="color: #24292F">  console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Alice went from ${</span><span style="color: #24292F">beforeAlice</span><span style="color: #0A3069">} to ${</span><span style="color: #24292F">afterAlice</span><span style="color: #0A3069">}.`</span><span style="color: #24292F">);</span></li><li value="59"><span style="color: #24292F">  console.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(</span><span style="color: #0A3069">`Bob went from ${</span><span style="color: #24292F">beforeBob</span><span style="color: #0A3069">} to ${</span><span style="color: #24292F">afterBob</span><span style="color: #0A3069">}.`</span><span style="color: #24292F">);</span></li><li value="60"></li></ol></pre>
<p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-7-rpc/client-py/index.py#L48-L85">rps-7-rpc/client-py/index.py</a></p>
<pre class="snippet numbered"><ol class="snippet"><li value="48"><span style="color: #24292F">    </span><span style="color: #CF222E">def</span><span style="color: #24292F"> </span><span style="color: #8250DF">play_alice</span><span style="color: #24292F">():</span></li><li value="49"><span style="color: #24292F">        rpc_callbacks(</span></li><li value="50"><span style="color: #24292F">            </span><span style="color: #0A3069">'/backend/Alice'</span><span style="color: #24292F">,</span></li><li value="51"><span style="color: #24292F">            ctc_alice,</span></li><li value="52"><span style="color: #24292F">            </span><span style="color: #0550AE">dict</span><span style="color: #24292F">(</span><span style="color: #953800">wager</span><span style="color: #CF222E">=</span><span style="color: #24292F">rpc(</span><span style="color: #0A3069">'/stdlib/parseCurrency'</span><span style="color: #24292F">, </span><span style="color: #0550AE">5</span><span style="color: #24292F">), </span><span style="color: #953800">deadline</span><span style="color: #CF222E">=</span><span style="color: #0550AE">10</span><span style="color: #24292F">, </span><span style="color: #CF222E">**</span><span style="color: #24292F">player(</span><span style="color: #0A3069">'Alice'</span><span style="color: #24292F">)))</span></li><li value="53"></li><li value="54"><span style="color: #24292F">    alice </span><span style="color: #CF222E">=</span><span style="color: #24292F"> Thread(</span><span style="color: #953800">target</span><span style="color: #CF222E">=</span><span style="color: #24292F">play_alice)</span></li><li value="55"><span style="color: #24292F">    alice.start()</span></li><li value="56"></li><li value="57"><span style="color: #24292F">    </span><span style="color: #CF222E">def</span><span style="color: #24292F"> </span><span style="color: #8250DF">play_bob</span><span style="color: #24292F">():</span></li><li value="58"><span style="color: #24292F">        </span><span style="color: #CF222E">def</span><span style="color: #24292F"> </span><span style="color: #8250DF">acceptWager</span><span style="color: #24292F">(amt):</span></li><li value="59"><span style="color: #24292F">            </span><span style="color: #0550AE">print</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Bob accepts the wager of </span><span style="color: #0550AE">%s</span><span style="color: #0A3069">'</span><span style="color: #24292F"> </span><span style="color: #CF222E">%</span><span style="color: #24292F"> fmt(amt))</span></li><li value="60"></li><li value="61"><span style="color: #24292F">        ctc_bob </span><span style="color: #CF222E">=</span><span style="color: #24292F"> rpc(</span><span style="color: #0A3069">'/acc/attach'</span><span style="color: #24292F">, acc_bob, rpc(</span><span style="color: #0A3069">'/ctc/getInfo'</span><span style="color: #24292F">, ctc_alice))</span></li><li value="62"><span style="color: #24292F">        rpc_callbacks(</span></li><li value="63"><span style="color: #24292F">            </span><span style="color: #0A3069">'/backend/Bob'</span><span style="color: #24292F">,</span></li><li value="64"><span style="color: #24292F">            ctc_bob,</span></li><li value="65"><span style="color: #24292F">            </span><span style="color: #0550AE">dict</span><span style="color: #24292F">(</span><span style="color: #953800">acceptWager</span><span style="color: #CF222E">=</span><span style="color: #24292F">acceptWager, </span><span style="color: #CF222E">**</span><span style="color: #24292F">player(</span><span style="color: #0A3069">'Bob'</span><span style="color: #24292F">)))</span></li><li value="66"><span style="color: #24292F">        rpc(</span><span style="color: #0A3069">'/forget/ctc'</span><span style="color: #24292F">, ctc_bob)</span></li><li value="67"></li><li value="68"><span style="color: #24292F">    bob </span><span style="color: #CF222E">=</span><span style="color: #24292F"> Thread(</span><span style="color: #953800">target</span><span style="color: #CF222E">=</span><span style="color: #24292F">play_bob)</span></li><li value="69"><span style="color: #24292F">    bob.start()</span></li><li value="70"></li><li value="71"><span style="color: #24292F">    alice.join()</span></li><li value="72"><span style="color: #24292F">    bob.join()</span></li><li value="73"></li><li value="74"><span style="color: #24292F">    after_alice </span><span style="color: #CF222E">=</span><span style="color: #24292F"> get_balance(acc_alice)</span></li><li value="75"><span style="color: #24292F">    after_bob   </span><span style="color: #CF222E">=</span><span style="color: #24292F"> get_balance(acc_bob)</span></li><li value="76"></li><li value="77"><span style="color: #24292F">    </span><span style="color: #0550AE">print</span><span style="color: #24292F">(</span><span style="color: #0A3069">'Alice went from </span><span style="color: #0550AE">%s</span><span style="color: #0A3069"> to </span><span style="color: #0550AE">%s</span><span style="color: #0A3069">'</span><span style="color: #24292F"> </span><span style="color: #CF222E">%</span><span style="color: #24292F"> (before_alice, after_alice))</span></li><li value="78"><span style="color: #24292F">    </span><span style="color: #0550AE">print</span><span style="color: #24292F">(</span><span style="color: #0A3069">'  Bob went from </span><span style="color: #0550AE">%s</span><span style="color: #0A3069"> to </span><span style="color: #0550AE">%s</span><span style="color: #0A3069">'</span><span style="color: #24292F"> </span><span style="color: #CF222E">%</span><span style="color: #24292F"> (before_bob,   after_bob))</span></li><li value="79"></li><li value="80"><span style="color: #24292F">    rpc(</span><span style="color: #0A3069">'/forget/acc'</span><span style="color: #24292F">, acc_alice, acc_bob)</span></li><li value="81"><span style="color: #24292F">    rpc(</span><span style="color: #0A3069">'/forget/ctc'</span><span style="color: #24292F">, ctc_alice)</span></li><li value="82"></li><li value="83"></li><li value="84"><span style="color: #CF222E">if</span><span style="color: #24292F"> </span><span style="color: #0550AE">__name__</span><span style="color: #24292F"> </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0A3069">'__main__'</span><span style="color: #24292F">:</span></li><li value="85"><span style="color: #24292F">    main()</span></li></ol></pre>
<p>In the Python version, we create a function called <code>play_alice</code> and spawn it as a concurrent thread, which begins running in the background with <code>alice.start()</code> on line 55.</p>
<p><code>play_alice</code> sends Alice's RPC handle and her participant interact interface to the server with <code>rpc_callbacks</code>. The interface includes methods and values created by <code>player('Alice')</code> and adds an additional <code>wager</code> value which is set to the result of `rpc('/stdlib/parseCurrency', 5), as well as setting a deadline of 10.</p>
<p>Bob's interface is likewise defined and spawned as another thread, which also begins running concurrently on line 69. In Bob's case we add an <code>acceptWager</code> method to his participant interact interface. His function is more complex, because we delay creating his contract handle until this time, so that the main thread does not block waiting for Alice's contract information to resolve. This separation is not necessary in JavaScript thanks to JavaScript Promises.</p>
<p>Calling <code>.join()</code> in lines 71 &amp; 72 on <code>alice</code> and <code>bob</code> instructs the main thread to wait until both child threads have completed the game.</p>
<p>In lines 74 &amp; 75, we collect each player's remaining balance and print them to the console in lines 77 &amp; 78. Each player's child thread will have already printed their success/failure result to the screen prior to reaching this step, because that is how we encoded their <code>seeOutcome</code> methods.</p>
<p>Finally, in lines 80 &amp; 81, we release Alice and Bob's RPC handles from the server's memory with <code>/forget/acc</code> and <code>/forget/ctc</code>.</p>
<p>Lines 84 &amp; 85 invoke Python's process interpreter</p>
<h2 id="run-the-game">Run the Game<a aria-hidden="true" tabindex="-1" href="#run-the-game"><span class="icon icon-link"></span></a></h2>
<p>Now it's time to play our game!</p>
<p>Move a copy of the <code>index.rsh</code> file we used for the <a href="https://docs.reach.sh/tut-7.html">Play and Play Again</a> section and save it in the same directory as <code>index.py</code>.</p>
<p>Next, open a terminal in that directory and install the Reach Python RPC client:</p>
<p><code>$ ([ -d ./venv ] || python3 -m venv ./venv) &amp;&amp; source ./venv/bin/activate</code></p>
<p><code>$ pip install --upgrade reach-rpc-client</code></p>
<p>Then use <code>reach rpc-run</code> to play the game of <em>Rock, Paper, Scissors!</em></p>
<p><code>$ reach rpc-run python3 -u ./index.py</code></p>
<p>Its output will be the same as the final tutorial version of the frontend:</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #24292F">Bob accepts the wager of 5</span></li><li value="2"><span style="color: #24292F">Alice played Rock</span></li><li value="3"><span style="color: #24292F">Bob played Paper</span></li><li value="4"><span style="color: #24292F">Bob saw outcome Bob wins</span></li><li value="5"><span style="color: #24292F">Alice saw outcome Bob wins</span></li><li value="6"><span style="color: #24292F">Alice went from 10 to 4.9999</span></li><li value="7"><span style="color: #24292F">Bob went from 10 to 14.9999</span></li></ol></pre>
<p>This will launch an RPC server using the development <a href="https://docs.reach.sh/ref-backends-rpc-proto.html#%28tech._api._key%29">API key</a> "opensesame" and a TLS certificate designed for testing.</p>
<blockquote>
  <p>
    Deploying your <a href="https://docs.reach.sh/ref-model.html#%28tech._dapp%29">DApp</a> into production with the RPC server requires obtaining a certificate which is specific to your DNS domain and which has been signed by a certificate authority such as <a href="https://letsencrypt.org/getting-started/">Let’s Encrypt</a>.
    Users who are ready to go live should consult the <a href="https://docs.reach.sh/ref-usage.html#%28part._ref-usage-rpc-server%29">RPC Server command-line</a> reference section for configuration details.
  </p>
</blockquote>
<p>Once complete, type <code>deactivate</code> to exit the <code>venv</code> (virtual environment).</p>
<p>Great work! You've reimplemented the JavaScript tutorial as Python.</p>
<h2 id="summary">Summary<a aria-hidden="true" tabindex="-1" href="#summary"><span class="icon icon-link"></span></a></h2>
<p>This tutorial used Python to demonstrate how RPC frontends are built in Reach, but it is similarly easy to write RPC frontends in other languages, such as with the <a href="https://docs.reach.sh/ref-frontends-rpc-js.html">JavaScript (RPC)</a>, <a href="https://docs.reach.sh/ref-frontends-rpc-go.html">Go (RPC)</a>, and <a href="https://docs.reach.sh/ref-frontends-rpc-cs.html">C# RPC</a> libraries.</p>