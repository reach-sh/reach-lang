[{"bookPath":"tut","title":"Rock, Paper, Scissors in Python","titleId":"tut-7-rpc","hasOtp":true,"hasPageHeader":true},"<p>\n  <i id=\"p_0\" class=\"pid\"></i>The main sequence of the tutorial uses the\n  <a href=\"/frontend/#ref-frontends-js\">JavaScript frontend support library</a> to implement\n  a frontend for our Reach program using JavaScript.\n  But, Reach supports using any programming language through the\n  <a href=\"/rpc/#ref-backends-rpc\">Reach RPC Server</a>.<a href=\"#p_0\" class=\"pid\">0</a>\n</p>\n<p>\n  <i id=\"p_1\" class=\"pid\"></i>This tutorial walks through using this technique to implement a <em>Rock, Paper, Scissors!</em> frontend\n  in Python.\n  It is based on the frontend from <a href=\"/tut/rps/#tut-7\">Play and Play Again</a>, so it does not include a\n  text-based interface, or a Web interface, but uses the final version of the\n  Reach code.<a href=\"#p_1\" class=\"pid\">1</a>\n</p>\n<p>\n  <i id=\"p_2\" class=\"pid\"></i>Below we will compare the <a href=\"/tut/rps/#tut-7\">Play and Play Again</a> JavaScript frontend with the\n  equivalent Python code communicating via RPC, section by section.\n  Follow along by typing the Python code into a file called <code>index.py</code>.<a href=\"#p_2\" class=\"pid\">2</a>\n</p>\n<hr>\n<p><i id=\"p_3\" class=\"pid\"></i>We begin by comparing the necessary imports and program body:<a href=\"#p_3\" class=\"pid\">3</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-loops/index.mjs\">/examples/rps-7-loops/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"import { loadStdlib } from '@reach-sh/stdlib';\nimport * as backend from './build/index.main.mjs';\nconst stdlib = loadStdlib(process.env);\n\n(async () => {\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> { loadStdlib } </span><span style=\"color: #D73A49\">from</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">'@reach-sh/stdlib'</span><span style=\"color: #24292E\">;</span></li><li value=\"2\"><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">*</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">as</span><span style=\"color: #24292E\"> backend </span><span style=\"color: #D73A49\">from</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">'./build/index.main.mjs'</span><span style=\"color: #24292E\">;</span></li><li value=\"3\"><span style=\"color: #D73A49\">const</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">stdlib</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">loadStdlib</span><span style=\"color: #24292E\">(process.env);</span></li><li value=\"4\"></li><li value=\"5\"><span style=\"color: #24292E\">(</span><span style=\"color: #D73A49\">async</span><span style=\"color: #24292E\"> () </span><span style=\"color: #D73A49\">=&gt;</span><span style=\"color: #24292E\"> {</span></li></ol></pre>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-rpc/client-py/index.py\">/examples/rps-7-rpc/client-py/index.py</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"# flake8: noqa\n\nimport random\nfrom threading import Thread\nfrom reach_rpc import mk_rpc\n\n\ndef main():\n    rpc, rpc_callbacks = mk_rpc()\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: #6A737D\"># flake8: noqa</span></li><li value=\"2\"></li><li value=\"3\"><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> random</span></li><li value=\"4\"><span style=\"color: #D73A49\">from</span><span style=\"color: #24292E\"> threading </span><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> Thread</span></li><li value=\"5\"><span style=\"color: #D73A49\">from</span><span style=\"color: #24292E\"> reach_rpc </span><span style=\"color: #D73A49\">import</span><span style=\"color: #24292E\"> mk_rpc</span></li><li value=\"6\"></li><li value=\"7\"></li><li value=\"8\"><span style=\"color: #D73A49\">def</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">main</span><span style=\"color: #24292E\">():</span></li><li value=\"9\"><span style=\"color: #24292E\">    rpc, rpc_callbacks </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> mk_rpc()</span></li><li value=\"10\"></li></ol></pre>\n<p>\n  <i id=\"p_4\" class=\"pid\"></i>Rather than importing <span class=\"snip\"><span style=\"color: #24292E\">loadStdlib</span></span> and <span class=\"snip\"><span style=\"color: #24292E\">backend</span></span> as with the\n  JavaScript version, the Python frontend instead plucks <span class=\"snip\"><span style=\"color: #24292E\">mk_rpc</span></span> from its\n  supporting <span class=\"snip\"><span style=\"color: #24292E\">reach_rpc</span></span> library.\n  It is unnecessary for an RPC <em>frontend</em> to import a backend\n  because the <a href=\"/rpc/#ref-backends-rpc\">RPC Server</a> handles doing so instead.<a href=\"#p_4\" class=\"pid\">4</a>\n</p>\n<p>\n  <i id=\"p_5\" class=\"pid\"></i>The Python version also borrows functionality from the <span class=\"snip\"><span style=\"color: #24292E\">random</span></span> and\n  <span class=\"snip\"><span style=\"color: #24292E\">threading</span></span> libraries.\n  These will be necessary when providing callable methods in the\n  participant interact interface it offers the RPC server.<a href=\"#p_5\" class=\"pid\">5</a>\n</p>\n<p>\n  <i id=\"p_6\" class=\"pid\"></i>On line 9 the Python program binds <span class=\"snip\"><span style=\"color: #24292E\">rpc</span></span> and <span class=\"snip\"><span style=\"color: #24292E\">rpc_callbacks</span></span> out of\n  <span class=\"snip\"><span style=\"color: #24292E\">mk_rpc</span></span>.\n  These two functions are the only tools we will need to communicate with the\n  RPC server.\n  See <a href=\"/rpc/py/#ref-frontends-rpc-py\">Python</a> for more details on how they work.<a href=\"#p_6\" class=\"pid\">6</a>\n</p>\n<hr>\n<p>\n  <i id=\"p_7\" class=\"pid\"></i>Next, we define our Alice and Bob accounts and pre-fund them each with a\n  starting balance of <code>10</code>.<a href=\"#p_7\" class=\"pid\">7</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-loops/index.mjs\">/examples/rps-7-loops/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const startingBalance = stdlib.parseCurrency(100);\n  const accAlice = await stdlib.newTestAccount(startingBalance);\n  const accBob = await stdlib.newTestAccount(startingBalance);\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"6\"><span style=\"color: #24292E\">  </span><span style=\"color: #D73A49\">const</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">startingBalance</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> stdlib.</span><span style=\"color: #6F42C1\">parseCurrency</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">100</span><span style=\"color: #24292E\">);</span></li><li value=\"7\"><span style=\"color: #24292E\">  </span><span style=\"color: #D73A49\">const</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">accAlice</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">await</span><span style=\"color: #24292E\"> stdlib.</span><span style=\"color: #6F42C1\">newTestAccount</span><span style=\"color: #24292E\">(startingBalance);</span></li><li value=\"8\"><span style=\"color: #24292E\">  </span><span style=\"color: #D73A49\">const</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">accBob</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">await</span><span style=\"color: #24292E\"> stdlib.</span><span style=\"color: #6F42C1\">newTestAccount</span><span style=\"color: #24292E\">(startingBalance);</span></li><li value=\"9\"></li></ol></pre>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-rpc/client-py/index.py\">/examples/rps-7-rpc/client-py/index.py</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    starting_balance = rpc('/stdlib/parseCurrency', 100)\n    acc_alice        = rpc('/stdlib/newTestAccount', starting_balance)\n    acc_bob          = rpc('/stdlib/newTestAccount', starting_balance)\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"11\"><span style=\"color: #24292E\">    starting_balance </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> rpc(</span><span style=\"color: #032F62\">'/stdlib/parseCurrency'</span><span style=\"color: #24292E\">, </span><span style=\"color: #005CC5\">100</span><span style=\"color: #24292E\">)</span></li><li value=\"12\"><span style=\"color: #24292E\">    acc_alice        </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> rpc(</span><span style=\"color: #032F62\">'/stdlib/newTestAccount'</span><span style=\"color: #24292E\">, starting_balance)</span></li><li value=\"13\"><span style=\"color: #24292E\">    acc_bob          </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> rpc(</span><span style=\"color: #032F62\">'/stdlib/newTestAccount'</span><span style=\"color: #24292E\">, starting_balance)</span></li><li value=\"14\"></li></ol></pre>\n<p>\n  <i id=\"p_8\" class=\"pid\"></i>Translating code which uses the\n  <a href=\"/frontend/#ref-frontends-js\">JavaScript frontend support library</a> to its\n  <a href=\"/rpc/py/#ref-frontends-rpc-py\">Python RPC</a> equivalent is a simple matter of\n  specifying the corresponding RPC method (e.g.\n  <code>'/stdlib/newTestAccount'</code>), and supplying the same arguments thereafter.<a href=\"#p_8\" class=\"pid\">8</a>\n</p>\n<hr>\n<p>\n  <i id=\"p_9\" class=\"pid\"></i>Now we define two helper functions and use them to query Alice and Bob's\n  beginning balances:<a href=\"#p_9\" class=\"pid\">9</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-loops/index.mjs\">/examples/rps-7-loops/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const fmt = (x) => stdlib.formatCurrency(x, 4);\n  const getBalance = async (who) => fmt(await stdlib.balanceOf(who));\n  const beforeAlice = await getBalance(accAlice);\n  const beforeBob = await getBalance(accBob);\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"10\"><span style=\"color: #24292E\">  </span><span style=\"color: #D73A49\">const</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">fmt</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> (</span><span style=\"color: #E36209\">x</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">=&gt;</span><span style=\"color: #24292E\"> stdlib.</span><span style=\"color: #6F42C1\">formatCurrency</span><span style=\"color: #24292E\">(x, </span><span style=\"color: #005CC5\">4</span><span style=\"color: #24292E\">);</span></li><li value=\"11\"><span style=\"color: #24292E\">  </span><span style=\"color: #D73A49\">const</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getBalance</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">async</span><span style=\"color: #24292E\"> (</span><span style=\"color: #E36209\">who</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">=&gt;</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">fmt</span><span style=\"color: #24292E\">(</span><span style=\"color: #D73A49\">await</span><span style=\"color: #24292E\"> stdlib.</span><span style=\"color: #6F42C1\">balanceOf</span><span style=\"color: #24292E\">(who));</span></li><li value=\"12\"><span style=\"color: #24292E\">  </span><span style=\"color: #D73A49\">const</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">beforeAlice</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">await</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getBalance</span><span style=\"color: #24292E\">(accAlice);</span></li><li value=\"13\"><span style=\"color: #24292E\">  </span><span style=\"color: #D73A49\">const</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">beforeBob</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">await</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getBalance</span><span style=\"color: #24292E\">(accBob);</span></li><li value=\"14\"></li></ol></pre>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-rpc/client-py/index.py\">/examples/rps-7-rpc/client-py/index.py</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    def fmt(x):\n        return rpc('/stdlib/formatCurrency', x, 4)\n\n    def get_balance(w):\n        return fmt(rpc('/stdlib/balanceOf', w))\n\n    before_alice = get_balance(acc_alice)\n    before_bob   = get_balance(acc_bob)\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"15\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">def</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">fmt</span><span style=\"color: #24292E\">(x):</span></li><li value=\"16\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> rpc(</span><span style=\"color: #032F62\">'/stdlib/formatCurrency'</span><span style=\"color: #24292E\">, x, </span><span style=\"color: #005CC5\">4</span><span style=\"color: #24292E\">)</span></li><li value=\"17\"></li><li value=\"18\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">def</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">get_balance</span><span style=\"color: #24292E\">(w):</span></li><li value=\"19\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> fmt(rpc(</span><span style=\"color: #032F62\">'/stdlib/balanceOf'</span><span style=\"color: #24292E\">, w))</span></li><li value=\"20\"></li><li value=\"21\"><span style=\"color: #24292E\">    before_alice </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> get_balance(acc_alice)</span></li><li value=\"22\"><span style=\"color: #24292E\">    before_bob   </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> get_balance(acc_bob)</span></li><li value=\"23\"></li></ol></pre>\n<hr>\n<p><i id=\"p_10\" class=\"pid\"></i>Deploying and attaching to contracts works slightly differently over RPC:<a href=\"#p_10\" class=\"pid\">10</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-loops/index.mjs\">/examples/rps-7-loops/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const ctcAlice = accAlice.contract(backend);\n  const ctcBob = accBob.contract(backend, ctcAlice.getInfo());\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"15\"><span style=\"color: #24292E\">  </span><span style=\"color: #D73A49\">const</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">ctcAlice</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> accAlice.</span><span style=\"color: #6F42C1\">contract</span><span style=\"color: #24292E\">(backend);</span></li><li value=\"16\"><span style=\"color: #24292E\">  </span><span style=\"color: #D73A49\">const</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">ctcBob</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> accBob.</span><span style=\"color: #6F42C1\">contract</span><span style=\"color: #24292E\">(backend, ctcAlice.</span><span style=\"color: #6F42C1\">getInfo</span><span style=\"color: #24292E\">());</span></li><li value=\"17\"></li></ol></pre>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-rpc/client-py/index.py\">/examples/rps-7-rpc/client-py/index.py</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    ctc_alice    = rpc('/acc/contract', acc_alice)\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"24\"><span style=\"color: #24292E\">    ctc_alice    </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> rpc(</span><span style=\"color: #032F62\">'/acc/contract'</span><span style=\"color: #24292E\">, acc_alice)</span></li><li value=\"25\"></li></ol></pre>\n<p>\n  <i id=\"p_11\" class=\"pid\"></i>As previously mentioned, it is the responsibility of the\n  <a href=\"/rpc/#ref-backends-rpc\">RPC Server</a> (rather than that of the frontend\n  communicating over RPC) to interface with the DApp's backend, so that\n  argument is absent in the Python version shown above.\n  Instead, Alice's account RPC handle alone is sufficient for her to\n  deploy.\n  We also need to delay Bob's attach until later, because Python lacks Promises that work like JavaScript's.\n  When we do attach Bob, only Bob's account RPC handle and Alice's\n  contract RPC handle are necessary for him to attach.<a href=\"#p_11\" class=\"pid\">11</a>\n</p>\n<hr>\n<p>\n  <i id=\"p_12\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: #005CC5\">HAND</span></span> and <span class=\"snip\"><span style=\"color: #005CC5\">OUTCOME</span></span> only differ syntactically from their JavaScript\n  equivalents:<a href=\"#p_12\" class=\"pid\">12</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-loops/index.mjs\">/examples/rps-7-loops/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const HAND = ['Rock', 'Paper', 'Scissors'];\n  const OUTCOME = ['Bob wins', 'Draw', 'Alice wins'];\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"18\"><span style=\"color: #24292E\">  </span><span style=\"color: #D73A49\">const</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">HAND</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> [</span><span style=\"color: #032F62\">'Rock'</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">'Paper'</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">'Scissors'</span><span style=\"color: #24292E\">];</span></li><li value=\"19\"><span style=\"color: #24292E\">  </span><span style=\"color: #D73A49\">const</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">OUTCOME</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> [</span><span style=\"color: #032F62\">'Bob wins'</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">'Draw'</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">'Alice wins'</span><span style=\"color: #24292E\">];</span></li></ol></pre>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-rpc/client-py/index.py\">/examples/rps-7-rpc/client-py/index.py</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    HAND         = ['Rock', 'Paper', 'Scissors']\n    OUTCOME      = ['Bob wins', 'Draw', 'Alice wins']\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"26\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">HAND</span><span style=\"color: #24292E\">         </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> [</span><span style=\"color: #032F62\">'Rock'</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">'Paper'</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">'Scissors'</span><span style=\"color: #24292E\">]</span></li><li value=\"27\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">OUTCOME</span><span style=\"color: #24292E\">      </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> [</span><span style=\"color: #032F62\">'Bob wins'</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">'Draw'</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">'Alice wins'</span><span style=\"color: #24292E\">]</span></li><li value=\"28\"></li></ol></pre>\n<hr>\n<p><i id=\"p_13\" class=\"pid\"></i>Even participant interact interface definitions remain largely the same:<a href=\"#p_13\" class=\"pid\">13</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-loops/index.mjs\">/examples/rps-7-loops/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const Player = (Who) => ({\n    ...stdlib.hasRandom,\n    getHand: async () => { // <-- async now\n      const hand = Math.floor(Math.random() * 3);\n      console.log(`${Who} played ${HAND[hand]}`);\n      if ( Math.random() <= 0.01 ) {\n        for ( let i = 0; i < 10; i++ ) {\n          console.log(`  ${Who} takes their sweet time sending it back...`);\n          await stdlib.wait(1);\n        }\n      }\n      return hand;\n    },\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"20\"><span style=\"color: #24292E\">  </span><span style=\"color: #D73A49\">const</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">Player</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> (</span><span style=\"color: #E36209\">Who</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">=&gt;</span><span style=\"color: #24292E\"> ({</span></li><li value=\"21\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">...</span><span style=\"color: #24292E\">stdlib.hasRandom,</span></li><li value=\"22\"><span style=\"color: #24292E\">    </span><span style=\"color: #6F42C1\">getHand</span><span style=\"color: #24292E\">: </span><span style=\"color: #D73A49\">async</span><span style=\"color: #24292E\"> () </span><span style=\"color: #D73A49\">=&gt;</span><span style=\"color: #24292E\"> { </span><span style=\"color: #6A737D\">// &lt;-- async now</span></li><li value=\"23\"><span style=\"color: #24292E\">      </span><span style=\"color: #D73A49\">const</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">hand</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">Math</span><span style=\"color: #24292E\">.</span><span style=\"color: #005CC5\">floor</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">Math</span><span style=\"color: #24292E\">.</span><span style=\"color: #005CC5\">random</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">*</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">3</span><span style=\"color: #24292E\">);</span></li><li value=\"24\"><span style=\"color: #24292E\">      console.</span><span style=\"color: #6F42C1\">log</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">`${</span><span style=\"color: #24292E\">Who</span><span style=\"color: #032F62\">} played ${</span><span style=\"color: #005CC5\">HAND</span><span style=\"color: #032F62\">[</span><span style=\"color: #24292E\">hand</span><span style=\"color: #032F62\">]</span><span style=\"color: #032F62\">}`</span><span style=\"color: #24292E\">);</span></li><li value=\"25\"><span style=\"color: #24292E\">      </span><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> ( </span><span style=\"color: #005CC5\">Math</span><span style=\"color: #24292E\">.</span><span style=\"color: #005CC5\">random</span><span style=\"color: #24292E\">() </span><span style=\"color: #D73A49\">&lt;=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">0.01</span><span style=\"color: #24292E\"> ) {</span></li><li value=\"26\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">for</span><span style=\"color: #24292E\"> ( </span><span style=\"color: #D73A49\">let</span><span style=\"color: #24292E\"> i </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">; i </span><span style=\"color: #D73A49\">&lt;</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">10</span><span style=\"color: #24292E\">; i</span><span style=\"color: #D73A49\">++</span><span style=\"color: #24292E\"> ) {</span></li><li value=\"27\"><span style=\"color: #24292E\">          console.</span><span style=\"color: #6F42C1\">log</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">`  ${</span><span style=\"color: #24292E\">Who</span><span style=\"color: #032F62\">} takes their sweet time sending it back...`</span><span style=\"color: #24292E\">);</span></li><li value=\"28\"><span style=\"color: #24292E\">          </span><span style=\"color: #D73A49\">await</span><span style=\"color: #24292E\"> stdlib.</span><span style=\"color: #6F42C1\">wait</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">);</span></li><li value=\"29\"><span style=\"color: #24292E\">        }</span></li><li value=\"30\"><span style=\"color: #24292E\">      }</span></li><li value=\"31\"><span style=\"color: #24292E\">      </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> hand;</span></li><li value=\"32\"><span style=\"color: #24292E\">    },</span></li></ol></pre>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-rpc/client-py/index.py\">/examples/rps-7-rpc/client-py/index.py</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    def player(who):\n        def getHand():\n            hand = random.randint(0, 2)\n            print('%s played %s' % (who, HAND[hand]))\n            return hand\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"29\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">def</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">player</span><span style=\"color: #24292E\">(who):</span></li><li value=\"30\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">def</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getHand</span><span style=\"color: #24292E\">():</span></li><li value=\"31\"><span style=\"color: #24292E\">            hand </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> random.randint(</span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">, </span><span style=\"color: #005CC5\">2</span><span style=\"color: #24292E\">)</span></li><li value=\"32\"><span style=\"color: #24292E\">            </span><span style=\"color: #005CC5\">print</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">'</span><span style=\"color: #005CC5\">%s</span><span style=\"color: #032F62\"> played </span><span style=\"color: #005CC5\">%s</span><span style=\"color: #032F62\">'</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">%</span><span style=\"color: #24292E\"> (who, </span><span style=\"color: #005CC5\">HAND</span><span style=\"color: #24292E\">[hand]))</span></li><li value=\"33\"><span style=\"color: #24292E\">            </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> hand</span></li><li value=\"34\"></li></ol></pre>\n<p>\n  <i id=\"p_14\" class=\"pid\"></i>Here, both the JavaScript and Python frontends begin declaring a\n  reusable \"player constructor\".\n  This constructor represents those fields which are common to both Alice and\n  Bob's participant interact interfaces.<a href=\"#p_14\" class=\"pid\">14</a>\n</p>\n<p>\n  <i id=\"p_15\" class=\"pid\"></i>The JavaScript code explicitly includes <span class=\"snip\"><span style=\"color: #D73A49\">...</span><span style=\"color: #24292E\">stdlib.hasRandom</span></span> itself, but\n  the Python code can instead direct the RPC server to append it to the interface\n  by including <span class=\"snip\"><span style=\"color: #032F62\">'stdlib.hasRandom'</span><span style=\"color: #24292E\">: </span><span style=\"color: #005CC5\">True</span></span> as a field in the constructor's\n  <a href=\"#py-return\">return value</a>.<a href=\"#p_15\" class=\"pid\">15</a>\n</p>\n<p>\n  <i id=\"p_16\" class=\"pid\"></i>Next, they each define a <span class=\"snip\"><span style=\"color: #24292E\">getHand</span></span> function which randomly selects an\n  element from the previously defined <span class=\"snip\"><span style=\"color: #005CC5\">HAND</span></span> set and returns it to the\n  backend.\n  This function will be passed as a callable method of the interface later.<a href=\"#p_16\" class=\"pid\">16</a>\n</p>\n<p>\n  <i id=\"p_17\" class=\"pid\"></i>The Python version does not mimic the JavaScript's occasional \"pause behavior\",\n  although it easily could with a few extra lines of code.<a href=\"#p_17\" class=\"pid\">17</a>\n</p>\n<hr>\n<p>\n  <i id=\"p_18\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: #24292E\">informTimeout</span></span> requires no subsequent backend interaction and is\n  accordingly easily to implement in either language:<a href=\"#p_18\" class=\"pid\">18</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-loops/index.mjs\">/examples/rps-7-loops/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    informTimeout: () => {\n      console.log(`${Who} observed a timeout`);\n    },\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"36\"><span style=\"color: #24292E\">    </span><span style=\"color: #6F42C1\">informTimeout</span><span style=\"color: #24292E\">: () </span><span style=\"color: #D73A49\">=&gt;</span><span style=\"color: #24292E\"> {</span></li><li value=\"37\"><span style=\"color: #24292E\">      console.</span><span style=\"color: #6F42C1\">log</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">`${</span><span style=\"color: #24292E\">Who</span><span style=\"color: #032F62\">} observed a timeout`</span><span style=\"color: #24292E\">);</span></li><li value=\"38\"><span style=\"color: #24292E\">    },</span></li></ol></pre>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-rpc/client-py/index.py\">/examples/rps-7-rpc/client-py/index.py</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"        def informTimeout():\n            print('%s observed a timeout' % who)\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"35\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">def</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">informTimeout</span><span style=\"color: #24292E\">():</span></li><li value=\"36\"><span style=\"color: #24292E\">            </span><span style=\"color: #005CC5\">print</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">'</span><span style=\"color: #005CC5\">%s</span><span style=\"color: #032F62\"> observed a timeout'</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">%</span><span style=\"color: #24292E\"> who)</span></li><li value=\"37\"></li></ol></pre>\n<hr>\n<p><i id=\"p_19\" class=\"pid\"></i><a name=\"py-return\"></a>The same is true of <span class=\"snip\"><span style=\"color: #24292E\">seeOutcome</span></span>:<a href=\"#p_19\" class=\"pid\">19</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-loops/index.mjs\">/examples/rps-7-loops/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    seeOutcome: (outcome) => {\n      console.log(`${Who} saw outcome ${OUTCOME[outcome]}`);\n    },\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"33\"><span style=\"color: #24292E\">    </span><span style=\"color: #6F42C1\">seeOutcome</span><span style=\"color: #24292E\">: (</span><span style=\"color: #E36209\">outcome</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">=&gt;</span><span style=\"color: #24292E\"> {</span></li><li value=\"34\"><span style=\"color: #24292E\">      console.</span><span style=\"color: #6F42C1\">log</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">`${</span><span style=\"color: #24292E\">Who</span><span style=\"color: #032F62\">} saw outcome ${</span><span style=\"color: #005CC5\">OUTCOME</span><span style=\"color: #032F62\">[</span><span style=\"color: #24292E\">outcome</span><span style=\"color: #032F62\">]</span><span style=\"color: #032F62\">}`</span><span style=\"color: #24292E\">);</span></li><li value=\"35\"><span style=\"color: #24292E\">    },</span></li></ol></pre>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-rpc/client-py/index.py\">/examples/rps-7-rpc/client-py/index.py</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"        def seeOutcome(n):\n            print('%s saw outcome %s'\n                  % (who, OUTCOME[rpc('/stdlib/bigNumberToNumber', n)]))\n\n        return {'stdlib.hasRandom': True,\n                'getHand':          getHand,\n                'informTimeout':    informTimeout,\n                'seeOutcome':       seeOutcome,\n                }\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"38\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">def</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">seeOutcome</span><span style=\"color: #24292E\">(n):</span></li><li value=\"39\"><span style=\"color: #24292E\">            </span><span style=\"color: #005CC5\">print</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">'</span><span style=\"color: #005CC5\">%s</span><span style=\"color: #032F62\"> saw outcome </span><span style=\"color: #005CC5\">%s</span><span style=\"color: #032F62\">'</span></li><li value=\"40\"><span style=\"color: #24292E\">                  </span><span style=\"color: #D73A49\">%</span><span style=\"color: #24292E\"> (who, </span><span style=\"color: #005CC5\">OUTCOME</span><span style=\"color: #24292E\">[rpc(</span><span style=\"color: #032F62\">'/stdlib/bigNumberToNumber'</span><span style=\"color: #24292E\">, n)]))</span></li><li value=\"41\"></li><li value=\"42\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">return</span><span style=\"color: #24292E\"> {</span><span style=\"color: #032F62\">'stdlib.hasRandom'</span><span style=\"color: #24292E\">: </span><span style=\"color: #005CC5\">True</span><span style=\"color: #24292E\">,</span></li><li value=\"43\"><span style=\"color: #24292E\">                </span><span style=\"color: #032F62\">'getHand'</span><span style=\"color: #24292E\">:          getHand,</span></li><li value=\"44\"><span style=\"color: #24292E\">                </span><span style=\"color: #032F62\">'informTimeout'</span><span style=\"color: #24292E\">:    informTimeout,</span></li><li value=\"45\"><span style=\"color: #24292E\">                </span><span style=\"color: #032F62\">'seeOutcome'</span><span style=\"color: #24292E\">:       seeOutcome,</span></li><li value=\"46\"><span style=\"color: #24292E\">                }</span></li><li value=\"47\"></li></ol></pre>\n<p>\n  <i id=\"p_20\" class=\"pid\"></i>At the end of the Python code we return a <span class=\"snip\"><span style=\"color: #005CC5\">dict</span></span> that represents those\n  fields which are common to both Alice and Bob's\n  participant interact interfaces.<a href=\"#p_20\" class=\"pid\">20</a>\n</p>\n<p>\n  <i id=\"p_21\" class=\"pid\"></i>Again, <span class=\"snip\"><span style=\"color: #032F62\">'stdlib.hasRandom'</span><span style=\"color: #24292E\">: </span><span style=\"color: #005CC5\">True</span></span> has special significance when\n  communicating via RPC: it instructs the server to append this signature on the\n  receiving end.<a href=\"#p_21\" class=\"pid\">21</a>\n</p>\n<hr>\n<p>\n  <i id=\"p_22\" class=\"pid\"></i>Finally, we proceed to the most interesting part of the program and use the\n  code we have built up thus far to actually play a game of <em>Rock, Paper, Scissors!</em>:<a href=\"#p_22\" class=\"pid\">22</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-loops/index.mjs\">/examples/rps-7-loops/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  await Promise.all([\n    ctcAlice.p.Alice({\n      ...Player('Alice'),\n      wager: stdlib.parseCurrency(5),\n      deadline: 10,\n    }),\n    ctcBob.p.Bob({\n      ...Player('Bob'),\n      acceptWager: (amt) => {\n        console.log(`Bob accepts the wager of ${fmt(amt)}.`);\n      },\n    }),\n  ]);\n\n  const afterAlice = await getBalance(accAlice);\n  const afterBob = await getBalance(accBob);\n\n  console.log(`Alice went from ${beforeAlice} to ${afterAlice}.`);\n  console.log(`Bob went from ${beforeBob} to ${afterBob}.`);\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"41\"><span style=\"color: #24292E\">  </span><span style=\"color: #D73A49\">await</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">Promise</span><span style=\"color: #24292E\">.</span><span style=\"color: #6F42C1\">all</span><span style=\"color: #24292E\">([</span></li><li value=\"42\"><span style=\"color: #24292E\">    ctcAlice.p.</span><span style=\"color: #6F42C1\">Alice</span><span style=\"color: #24292E\">({</span></li><li value=\"43\"><span style=\"color: #24292E\">      </span><span style=\"color: #D73A49\">...</span><span style=\"color: #6F42C1\">Player</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">'Alice'</span><span style=\"color: #24292E\">),</span></li><li value=\"44\"><span style=\"color: #24292E\">      wager: stdlib.</span><span style=\"color: #6F42C1\">parseCurrency</span><span style=\"color: #24292E\">(</span><span style=\"color: #005CC5\">5</span><span style=\"color: #24292E\">),</span></li><li value=\"45\"><span style=\"color: #24292E\">      deadline: </span><span style=\"color: #005CC5\">10</span><span style=\"color: #24292E\">,</span></li><li value=\"46\"><span style=\"color: #24292E\">    }),</span></li><li value=\"47\"><span style=\"color: #24292E\">    ctcBob.p.</span><span style=\"color: #6F42C1\">Bob</span><span style=\"color: #24292E\">({</span></li><li value=\"48\"><span style=\"color: #24292E\">      </span><span style=\"color: #D73A49\">...</span><span style=\"color: #6F42C1\">Player</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">'Bob'</span><span style=\"color: #24292E\">),</span></li><li value=\"49\"><span style=\"color: #24292E\">      </span><span style=\"color: #6F42C1\">acceptWager</span><span style=\"color: #24292E\">: (</span><span style=\"color: #E36209\">amt</span><span style=\"color: #24292E\">) </span><span style=\"color: #D73A49\">=&gt;</span><span style=\"color: #24292E\"> {</span></li><li value=\"50\"><span style=\"color: #24292E\">        console.</span><span style=\"color: #6F42C1\">log</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">`Bob accepts the wager of ${</span><span style=\"color: #6F42C1\">fmt</span><span style=\"color: #032F62\">(</span><span style=\"color: #24292E\">amt</span><span style=\"color: #032F62\">)</span><span style=\"color: #032F62\">}.`</span><span style=\"color: #24292E\">);</span></li><li value=\"51\"><span style=\"color: #24292E\">      },</span></li><li value=\"52\"><span style=\"color: #24292E\">    }),</span></li><li value=\"53\"><span style=\"color: #24292E\">  ]);</span></li><li value=\"54\"></li><li value=\"55\"><span style=\"color: #24292E\">  </span><span style=\"color: #D73A49\">const</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">afterAlice</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">await</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getBalance</span><span style=\"color: #24292E\">(accAlice);</span></li><li value=\"56\"><span style=\"color: #24292E\">  </span><span style=\"color: #D73A49\">const</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">afterBob</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">await</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">getBalance</span><span style=\"color: #24292E\">(accBob);</span></li><li value=\"57\"></li><li value=\"58\"><span style=\"color: #24292E\">  console.</span><span style=\"color: #6F42C1\">log</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">`Alice went from ${</span><span style=\"color: #24292E\">beforeAlice</span><span style=\"color: #032F62\">} to ${</span><span style=\"color: #24292E\">afterAlice</span><span style=\"color: #032F62\">}.`</span><span style=\"color: #24292E\">);</span></li><li value=\"59\"><span style=\"color: #24292E\">  console.</span><span style=\"color: #6F42C1\">log</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">`Bob went from ${</span><span style=\"color: #24292E\">beforeBob</span><span style=\"color: #032F62\">} to ${</span><span style=\"color: #24292E\">afterBob</span><span style=\"color: #032F62\">}.`</span><span style=\"color: #24292E\">);</span></li><li value=\"60\"></li></ol></pre>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rps-7-rpc/client-py/index.py\">/examples/rps-7-rpc/client-py/index.py</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    def play_alice():\n        rpc_callbacks(\n            '/backend/Alice',\n            ctc_alice,\n            dict(wager=rpc('/stdlib/parseCurrency', 5), deadline=10, **player('Alice')))\n\n    alice = Thread(target=play_alice)\n    alice.start()\n\n    def play_bob():\n        def acceptWager(amt):\n            print('Bob accepts the wager of %s' % fmt(amt))\n\n        ctc_bob = rpc('/acc/contract', acc_bob, rpc('/ctc/getInfo', ctc_alice))\n        rpc_callbacks(\n            '/backend/Bob',\n            ctc_bob,\n            dict(acceptWager=acceptWager, **player('Bob')))\n        rpc('/forget/ctc', ctc_bob)\n\n    bob = Thread(target=play_bob)\n    bob.start()\n\n    alice.join()\n    bob.join()\n\n    after_alice = get_balance(acc_alice)\n    after_bob   = get_balance(acc_bob)\n\n    print('Alice went from %s to %s' % (before_alice, after_alice))\n    print('  Bob went from %s to %s' % (before_bob,   after_bob))\n\n    rpc('/forget/acc', acc_alice, acc_bob)\n    rpc('/forget/ctc', ctc_alice)\n\n\nif __name__ == '__main__':\n    main()\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"48\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">def</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">play_alice</span><span style=\"color: #24292E\">():</span></li><li value=\"49\"><span style=\"color: #24292E\">        rpc_callbacks(</span></li><li value=\"50\"><span style=\"color: #24292E\">            </span><span style=\"color: #032F62\">'/backend/Alice'</span><span style=\"color: #24292E\">,</span></li><li value=\"51\"><span style=\"color: #24292E\">            ctc_alice,</span></li><li value=\"52\"><span style=\"color: #24292E\">            </span><span style=\"color: #005CC5\">dict</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">wager</span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\">rpc(</span><span style=\"color: #032F62\">'/stdlib/parseCurrency'</span><span style=\"color: #24292E\">, </span><span style=\"color: #005CC5\">5</span><span style=\"color: #24292E\">), </span><span style=\"color: #E36209\">deadline</span><span style=\"color: #D73A49\">=</span><span style=\"color: #005CC5\">10</span><span style=\"color: #24292E\">, </span><span style=\"color: #D73A49\">**</span><span style=\"color: #24292E\">player(</span><span style=\"color: #032F62\">'Alice'</span><span style=\"color: #24292E\">)))</span></li><li value=\"53\"></li><li value=\"54\"><span style=\"color: #24292E\">    alice </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> Thread(</span><span style=\"color: #E36209\">target</span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\">play_alice)</span></li><li value=\"55\"><span style=\"color: #24292E\">    alice.start()</span></li><li value=\"56\"></li><li value=\"57\"><span style=\"color: #24292E\">    </span><span style=\"color: #D73A49\">def</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">play_bob</span><span style=\"color: #24292E\">():</span></li><li value=\"58\"><span style=\"color: #24292E\">        </span><span style=\"color: #D73A49\">def</span><span style=\"color: #24292E\"> </span><span style=\"color: #6F42C1\">acceptWager</span><span style=\"color: #24292E\">(amt):</span></li><li value=\"59\"><span style=\"color: #24292E\">            </span><span style=\"color: #005CC5\">print</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">'Bob accepts the wager of </span><span style=\"color: #005CC5\">%s</span><span style=\"color: #032F62\">'</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">%</span><span style=\"color: #24292E\"> fmt(amt))</span></li><li value=\"60\"></li><li value=\"61\"><span style=\"color: #24292E\">        ctc_bob </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> rpc(</span><span style=\"color: #032F62\">'/acc/contract'</span><span style=\"color: #24292E\">, acc_bob, rpc(</span><span style=\"color: #032F62\">'/ctc/getInfo'</span><span style=\"color: #24292E\">, ctc_alice))</span></li><li value=\"62\"><span style=\"color: #24292E\">        rpc_callbacks(</span></li><li value=\"63\"><span style=\"color: #24292E\">            </span><span style=\"color: #032F62\">'/backend/Bob'</span><span style=\"color: #24292E\">,</span></li><li value=\"64\"><span style=\"color: #24292E\">            ctc_bob,</span></li><li value=\"65\"><span style=\"color: #24292E\">            </span><span style=\"color: #005CC5\">dict</span><span style=\"color: #24292E\">(</span><span style=\"color: #E36209\">acceptWager</span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\">acceptWager, </span><span style=\"color: #D73A49\">**</span><span style=\"color: #24292E\">player(</span><span style=\"color: #032F62\">'Bob'</span><span style=\"color: #24292E\">)))</span></li><li value=\"66\"><span style=\"color: #24292E\">        rpc(</span><span style=\"color: #032F62\">'/forget/ctc'</span><span style=\"color: #24292E\">, ctc_bob)</span></li><li value=\"67\"></li><li value=\"68\"><span style=\"color: #24292E\">    bob </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> Thread(</span><span style=\"color: #E36209\">target</span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\">play_bob)</span></li><li value=\"69\"><span style=\"color: #24292E\">    bob.start()</span></li><li value=\"70\"></li><li value=\"71\"><span style=\"color: #24292E\">    alice.join()</span></li><li value=\"72\"><span style=\"color: #24292E\">    bob.join()</span></li><li value=\"73\"></li><li value=\"74\"><span style=\"color: #24292E\">    after_alice </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> get_balance(acc_alice)</span></li><li value=\"75\"><span style=\"color: #24292E\">    after_bob   </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> get_balance(acc_bob)</span></li><li value=\"76\"></li><li value=\"77\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">print</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">'Alice went from </span><span style=\"color: #005CC5\">%s</span><span style=\"color: #032F62\"> to </span><span style=\"color: #005CC5\">%s</span><span style=\"color: #032F62\">'</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">%</span><span style=\"color: #24292E\"> (before_alice, after_alice))</span></li><li value=\"78\"><span style=\"color: #24292E\">    </span><span style=\"color: #005CC5\">print</span><span style=\"color: #24292E\">(</span><span style=\"color: #032F62\">'  Bob went from </span><span style=\"color: #005CC5\">%s</span><span style=\"color: #032F62\"> to </span><span style=\"color: #005CC5\">%s</span><span style=\"color: #032F62\">'</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">%</span><span style=\"color: #24292E\"> (before_bob,   after_bob))</span></li><li value=\"79\"></li><li value=\"80\"><span style=\"color: #24292E\">    rpc(</span><span style=\"color: #032F62\">'/forget/acc'</span><span style=\"color: #24292E\">, acc_alice, acc_bob)</span></li><li value=\"81\"><span style=\"color: #24292E\">    rpc(</span><span style=\"color: #032F62\">'/forget/ctc'</span><span style=\"color: #24292E\">, ctc_alice)</span></li><li value=\"82\"></li><li value=\"83\"></li><li value=\"84\"><span style=\"color: #D73A49\">if</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">__name__</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">==</span><span style=\"color: #24292E\"> </span><span style=\"color: #032F62\">'__main__'</span><span style=\"color: #24292E\">:</span></li><li value=\"85\"><span style=\"color: #24292E\">    main()</span></li></ol></pre>\n<p>\n  <i id=\"p_23\" class=\"pid\"></i>In the Python version we create a function called <span class=\"snip\"><span style=\"color: #24292E\">play_alice</span></span> and spawn\n  it as a concurrent thread, which begins running in the background on line 56.<a href=\"#p_23\" class=\"pid\">23</a>\n</p>\n<p>\n  <i id=\"p_24\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: #24292E\">play_alice</span></span> sends Alice's contract RPC handle and her\n  participant interact interface to the server with <span class=\"snip\"><span style=\"color: #24292E\">rpc_callbacks</span></span>.\n  The interface includes methods and values created by <span class=\"snip\"><span style=\"color: #24292E\">player(</span><span style=\"color: #032F62\">'Alice'</span><span style=\"color: #24292E\">)</span></span>,\n  and adds an additional <span class=\"snip\"><span style=\"color: #24292E\">wager</span></span> value which is set to the result of\n  <span class=\"snip\"><span style=\"color: #24292E\">rpc(</span><span style=\"color: #032F62\">'/stdlib/parseCurrency'</span><span style=\"color: #24292E\">, </span><span style=\"color: #005CC5\">5</span><span style=\"color: #24292E\">)</span></span>,\n  as well as setting a <span class=\"snip\"><span style=\"color: #24292E\">deadline</span></span> of <span class=\"snip\"><span style=\"color: #005CC5\">10</span></span>.<a href=\"#p_24\" class=\"pid\">24</a>\n</p>\n<p>\n  <i id=\"p_25\" class=\"pid\"></i>Bob's interface is likewise defined and spawned as another thread, which also\n  begins running concurrently on line 69.\n  In Bob's case we add an <span class=\"snip\"><span style=\"color: #24292E\">acceptWager</span></span> method instead of another value to\n  his participant interact interface.\n  Furthermore, his function is more complex, because we delay creating his contract handle until this time, so that the main thread does not block waiting for Alice's contract information to resolve.\n  This separation is not necessary in JavaScript, because of how JavaScript Promises work.<a href=\"#p_25\" class=\"pid\">25</a>\n</p>\n<p>\n  <i id=\"p_26\" class=\"pid\"></i>Calling <span class=\"snip\"><span style=\"color: #24292E\">.join()</span></span> on <span class=\"snip\"><span style=\"color: #24292E\">alice</span></span> and <span class=\"snip\"><span style=\"color: #24292E\">bob</span></span> instructs the main thread\n  to wait until both child threads have run to completion, signifying the end of\n  the <em>Rock, Paper, Scissors!</em> game.\n  At this point we again collect each player's remaining balance and print them\n  to the console.\n  Each player's child thread will have already printed their success/failure\n  result to the screen prior to reaching this step, because that is how we encoded\n  their <span class=\"snip\"><span style=\"color: #24292E\">seeOutcome</span></span> methods.<a href=\"#p_26\" class=\"pid\">26</a>\n</p>\n<p>\n  <i id=\"p_27\" class=\"pid\"></i>All that remains is to release Alice and Bob's RPC handles from the\n  server's memory on lines 80 and 81 with the <code>/forget/acc</code> and\n  <code>/forget/ctc</code> methods, then instruct the Python process' interpreter to\n  invoke our <span class=\"snip\"><span style=\"color: #24292E\">main</span></span> function.<a href=\"#p_27\" class=\"pid\">27</a>\n</p>\n<hr>\n<p>\n  <i id=\"p_28\" class=\"pid\"></i>Now that we have written an entire <em>Rock, Paper, Scissors!</em> game in Python it is time to try\n  running it.<a href=\"#p_28\" class=\"pid\">28</a>\n</p>\n<p>\n  <i id=\"p_29\" class=\"pid\"></i>First you will need to copy the <code>index.rsh</code> file you used for <a href=\"/tut/rps/#tut-7\">the tutorial</a>\n  into the directory where you saved <code>index.py</code>.<a href=\"#p_29\" class=\"pid\">29</a>\n</p>\n<p>\n  <i id=\"p_30\" class=\"pid\"></i>Next, open a terminal in that directory and install the Reach Python RPC\n  client:<a href=\"#p_30\" class=\"pid\">30</a>\n</p>\n<pre class=\"snippet unnumbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"([ -d ./venv ] || python3 -m venv ./venv) &amp;&amp; source ./venv/bin/activate\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\"> ([ </span><span style=\"color: #D73A49\">-</span><span style=\"color: #24292E\">d ./venv ] </span><span style=\"color: #D73A49\">||</span><span style=\"color: #24292E\"> python3 </span><span style=\"color: #D73A49\">-</span><span style=\"color: #24292E\">m venv ./venv) </span><span style=\"color: #D73A49\">&amp;&amp;</span><span style=\"color: #24292E\"> source ./venv/bin/activate</span></li></ol></pre>\n<div class=\"note\">\n  <p><i id=\"p_31\" class=\"pid\"></i>What is this <code>\"venv\"</code> thing?<a href=\"#p_31\" class=\"pid\">31</a></p>\n  <p>\n    <i id=\"p_32\" class=\"pid\"></i>A Python\n    <a href=\"https://packaging.python.org/guides/installing-using-pip-and-virtual-environments/#creating-a-virtual-environment\">venv</a>\n    is a \"virtual environment\" that sandboxes dependencies to avoid cluttering your\n    system directories.<a href=\"#p_32\" class=\"pid\">32</a>\n  </p>\n</div>\n<pre class=\"snippet unnumbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"pip install --upgrade reach-rpc-client\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\"> pip install </span><span style=\"color: #D73A49\">--</span><span style=\"color: #24292E\">upgrade reach</span><span style=\"color: #D73A49\">-</span><span style=\"color: #24292E\">rpc</span><span style=\"color: #D73A49\">-</span><span style=\"color: #24292E\">client</span></li></ol></pre>\n<p><i id=\"p_33\" class=\"pid\"></i>Then use <code>./reach rpc-run</code> to play a game of <em>Rock, Paper, Scissors!</em>:<a href=\"#p_33\" class=\"pid\">33</a></p>\n<pre class=\"snippet unnumbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"./reach rpc-run python3 -u ./index.py\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: #D73A49\">$</span><span style=\"color: #24292E\"> ./reach rpc</span><span style=\"color: #D73A49\">-</span><span style=\"color: #24292E\">run python3 </span><span style=\"color: #D73A49\">-</span><span style=\"color: #24292E\">u ./index.py</span></li></ol></pre>\n<div class=\"note\">\n  <p>\n    <i id=\"p_34\" class=\"pid\"></i>Consult the <a href=\"/tool/usage/#ref-usage-rpc-run\">command-line</a> reference section for more details on\n    how this sub-command works.<a href=\"#p_34\" class=\"pid\">34</a>\n  </p>\n</div>\n<p><i id=\"p_35\" class=\"pid\"></i>Its output will be the same as the <a href=\"/tut/rps/#tut-7\">final tutorial</a> version of the frontend:<a href=\"#p_35\" class=\"pid\">35</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"Bob accepts the wager of 5\nAlice played Rock\nBob played Paper\nBob saw outcome Bob wins\nAlice saw outcome Bob wins\nAlice went from 10 to 4.9999\n  Bob went from 10 to 14.9999\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\">Bob accepts the wager of 5</li><li value=\"2\">Alice played Rock</li><li value=\"3\">Bob played Paper</li><li value=\"4\">Bob saw outcome Bob wins</li><li value=\"5\">Alice saw outcome Bob wins</li><li value=\"6\">Alice went from 10 to 4.9999</li><li value=\"7\">  Bob went from 10 to 14.9999</li></ol></pre>\n<p>\n  <i id=\"p_36\" class=\"pid\"></i>This will launch an RPC server using the development API key\n  <code>\"opensesame\"</code> and a TLS certificate designed for testing.<a href=\"#p_36\" class=\"pid\">36</a>\n</p>\n<div class=\"note\">\n  <p>\n    <i id=\"p_37\" class=\"pid\"></i>Deploying your DApp into production with the RPC server requires obtaining a\n    certificate which is specific to your DNS domain and which has been signed by a\n    certificate authority such as\n    <a href=\"https://letsencrypt.org/getting-started/\">Let's Encrypt</a>.<a href=\"#p_37\" class=\"pid\">37</a>\n  </p>\n  <p>\n    <i id=\"p_38\" class=\"pid\"></i>Users who are ready to go live should consult the <a href=\"/tool/usage/#ref-usage-rpc-server\">RPC Server command-line</a>\n    reference section for configuration details.<a href=\"#p_38\" class=\"pid\">38</a>\n  </p>\n</div>\n<p><i id=\"p_39\" class=\"pid\"></i>When you are done, type <code>deactivate</code> to exit your <code>venv</code>.<a href=\"#p_39\" class=\"pid\">39</a></p>\n<p><i id=\"p_40\" class=\"pid\"></i>Well done! You have just reimplemented <a href=\"/tut/rps/#tut-7\">the tutorial</a> in Python.<a href=\"#p_40\" class=\"pid\">40</a></p>\n<hr>\n<p>\n  <i id=\"p_41\" class=\"pid\"></i>This tutorial uses Python to demonstrate how RPC frontends are\n  built in Reach, but it is similarly easy to write RPC frontends in other\n  languages, such as with the <a href=\"/rpc/js/#ref-frontends-rpc-js\">JavaScript</a> and\n  <a href=\"/rpc/go/#ref-frontends-rpc-go\">Go</a> libraries.<a href=\"#p_41\" class=\"pid\">41</a>\n</p>","<ul><li class=\"dynamic\"><a href=\"#tut-7-rpc\">Rock, Paper, Scissors in Python</a></li></ul>"]