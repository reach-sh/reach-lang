[{"bookPath":"","title":"Répondez S'il Vous Plaît","titleId":"tut-rsvp","hasOtp":true,"hasPageHeader":true},"<h1 id=\"tut-rsvp\" class=\"refHeader\">Répondez S'il Vous Plaît<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#tut-rsvp\"><span class=\"icon icon-link\"></span></a></h1>\n<p>\n  <i id=\"p_0\" class=\"pid\"></i>This tutorial walks through the creation of a simple, but real, decentralized application.\n  It assumes a basic familiarity with Reach, as though you've gone <a href=\"/tut/rps/#tut\">Rock, Paper, Scissors!</a> tutorial, but does not dwell on intimate details of it.\n  Similarly, it assumes that you <a href=\"/quickstart/#quickstart\">have Reach installed</a> and are comfortable using it.<a href=\"#p_0\" class=\"pid\">0</a>\n</p>\n<h2 id=\"tut-rsvp1\" class=\"refHeader\">Respond, If You Please<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#tut-rsvp1\"><span class=\"icon icon-link\"></span></a></h2>\n<p>\n  <i id=\"p_1\" class=\"pid\"></i>In this tutorial, we'll be building a basic DApp for running events, which we'll refer to as \"RSVP\".\n  In this DApp, a <em>Host</em> will run an event, like a dinner party, which <em>Guests</em> will attend.\n  The Host wants the Guests to tell her if they are coming, so she accepts them to visit the DApp beforehand.\n  The Host does not want to charge the Guests for the privilege of their company, but she is nervous that she'll order too many macaroons.\n  Therefore, she requires that the Guests pay something when they agree to come.\n  We call this the \"reservation\".\n  But, when the Guests actually arrive and check-in, they will get their reservation back.<a href=\"#p_1\" class=\"pid\">1</a>\n</p>\n<p><i id=\"p_2\" class=\"pid\"></i>For example, this is a plausible run of the application:<a href=\"#p_2\" class=\"pid\">2</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"Buffy decides to host &quot;Buffy's Birthday Bash at the Bronze&quot;.\nXander, Willow, Cordelia, Giles, and Oz all agree to come.\nThe night of the party comes.\nAngel tries to say he'll come, but it's too late.\nXander and Willow show up early.\nGiles doesn't come because he's busy reshelving.\nOz is indisposed and can't make it.\nCordelia shows up late, but does come.\nJonathan tries to come in, but didn't let Buffy know, so he's turned away.\nBuffy closes the event and takes Giles &amp; Oz's reservations\" href=\"#\" id=\"copyBtn1\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"1\">Buffy decides to host \"Buffy's Birthday Bash at the Bronze\".</li><li value=\"2\">Xander, Willow, Cordelia, Giles, and Oz all agree to come.</li><li value=\"3\">The night of the party comes.</li><li value=\"4\">Angel tries to say he'll come, but it's too late.</li><li value=\"5\">Xander and Willow show up early.</li><li value=\"6\">Giles doesn't come because he's busy reshelving.</li><li value=\"7\">Oz is indisposed and can't make it.</li><li value=\"8\">Cordelia shows up late, but does come.</li><li value=\"9\">Jonathan tries to come in, but didn't let Buffy know, so he's turned away.</li><li value=\"10\">Buffy closes the event and takes Giles &amp; Oz's reservations</li></ol></pre>\n<p><i id=\"p_3\" class=\"pid\"></i>If everyone has $10 before the event, and the reservation is $1, then afterwards:<a href=\"#p_3\" class=\"pid\">3</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"Buffy has $12, because she took Giles &amp; Oz's reservations.\nAngel has $10, because his reservation failed.\nXander has $10, because he showed up.\nWillow has $10, because she showed up.\nCordelia has $10, because she showed up.\nGiles has $9, because he didn't.\nOz has $9, because he didn't.\nJonathan has $10, because he never made a reservation.\" href=\"#\" id=\"copyBtn2\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"1\">Buffy has $12, because she took Giles &amp; Oz's reservations.</li><li value=\"2\">Angel has $10, because his reservation failed.</li><li value=\"3\">Xander has $10, because he showed up.</li><li value=\"4\">Willow has $10, because she showed up.</li><li value=\"5\">Cordelia has $10, because she showed up.</li><li value=\"6\">Giles has $9, because he didn't.</li><li value=\"7\">Oz has $9, because he didn't.</li><li value=\"8\">Jonathan has $10, because he never made a reservation.</li></ol></pre>\n<div class=\"note\">\n  <p>\n    <i id=\"p_4\" class=\"pid\"></i>When you take this tutorial and launch your own product based on it, you should let Giles send his regrets if it is early enough!\n    Similarly, it would be cool if you made it so that the extra $2 was split between the Guests and the Host.\n    But, we won't implement these features today.<a href=\"#p_4\" class=\"pid\">4</a>\n  </p>\n</div>\n<p><i id=\"p_5\" class=\"pid\"></i>When you build DApps, it is essential that you think through these kinds of scenarios first, before you start writing code, because they will help you know where to start and know when you are done.<a href=\"#p_5\" class=\"pid\">5</a></p>\n<h2 id=\"tut-rsvp2\" class=\"refHeader\">Participate, Please<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#tut-rsvp2\"><span class=\"icon icon-link\"></span></a></h2>\n<p><i id=\"p_6\" class=\"pid\"></i>If you have done a prior Reach tutorial, like <a href=\"/tut/rps/#tut\">Rock, Paper, Scissors!</a>, then you are probably wondering what the participants in this program are.<a href=\"#p_6\" class=\"pid\">6</a></p>\n<ol>\n  <li><i id=\"p_7\" class=\"pid\"></i>Should we have a <code>Host</code> participant and a <code>Guest</code> participant?<a href=\"#p_7\" class=\"pid\">7</a></li>\n  <li><i id=\"p_8\" class=\"pid\"></i>Should we have a <code>Host</code> participant, as well as the participants <code>Guest1</code>, <code>Guest2</code>, up through <code>Guest5</code>?<a href=\"#p_8\" class=\"pid\">8</a></li>\n</ol>\n<p>\n  <i id=\"p_9\" class=\"pid\"></i>If we do the first, then how will we have five guests, like in Buffy's example?\n  If we do the second, then what if Jenny decides to come? Would we need a totally different program?<a href=\"#p_9\" class=\"pid\">9</a>\n</p>\n<p>\n  <i id=\"p_10\" class=\"pid\"></i>The second idea is really bad and we should absolutely not do anything like unto it.\n  The first idea is not always dumb, but it turns out we're going to do something else for this application.\n  However, since it is sometimes a good idea, let's elaborate on what it means and why it can be valuable.<a href=\"#p_10\" class=\"pid\">10</a>\n</p>\n<h2 id=\"tut-rsvp3\" class=\"refHeader\">Yo Dawg...<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#tut-rsvp3\"><span class=\"icon icon-link\"></span></a></h2>\n<p>\n  <i id=\"p_11\" class=\"pid\"></i>If we had a Reach application with just two participants, one for the Host and one for the Guest, then if we had many Guests, we would need to have many different instances of the application.\n  This is similar to the <a href=\"/tut/rps/#tut\">Rock, Paper, Scissors!</a> application, where each instance plays exactly one game, but you can run the application as many times as you want.<a href=\"#p_11\" class=\"pid\">11</a>\n</p>\n<p>\n  <i id=\"p_12\" class=\"pid\"></i>For our event reservation application, each instance of the application would handle the registration of one Guest and we would build a user interface that supports launching many instances and (for the Host) managing each instance.\n  This is a \"decentralized\" decentralized application (a \"De-DApp\"), because there are many instances of the same application with a common user interface.\n  Sometimes people refer to \"De-DApp\"s as \"protocols\", because they are trying to emphasize the idea that there are many instances which all speak a common language.<a href=\"#p_12\" class=\"pid\">12</a>\n</p>\n<p><i id=\"p_13\" class=\"pid\"></i>In contrast, there are \"centralized\" decentralized applications (\"Ce-DApps\") where there is one single instance that manages all interactions within the application.<a href=\"#p_13\" class=\"pid\">13</a></p>\n<p>\n  <i id=\"p_14\" class=\"pid\"></i>Some features are easier to build into De-DApps and others are more difficult, but are easier with Ce-DApps.\n  For example, we speculate that it is easier to add the feature that Guests who show up can split the abandoned reservations in a Ce-DApp than a De-DApp.<a href=\"#p_14\" class=\"pid\">14</a>\n</p>\n<p>\n  <i id=\"p_15\" class=\"pid\"></i>This concept of Ce-DApps and De-DApps is artistic and humanistic: there is no definitive technical definition.\n  In particular, there is a spectrum of centralization.\n  For example, just as we can imagine one application for a single Event but for all Guests, we can imagine one application for all Events and all Guests of that Event.\n  In that sense, we've just spoken about \"De-De-DApps\" (decentralized-decentralized-decentralized applications) and \"De-Ce-DApps\" as opposed to \"Ce-Ce-DApps\".<a href=\"#p_15\" class=\"pid\">15</a>\n</p>\n<p><i id=\"p_16\" class=\"pid\"></i>We are going to demonstrate the \"decentralized\" style, because it introduces fewer new Reach concepts, but we believe that the \"centralized\" design is more appropriate for this application.<a href=\"#p_16\" class=\"pid\">16</a></p>\n<h2 id=\"tut-rsvp4-tests\" class=\"refHeader\">Test First, but Verify<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#tut-rsvp4-tests\"><span class=\"icon icon-link\"></span></a></h2>\n<p>\n  <i id=\"p_17\" class=\"pid\"></i>But, rather than jumping into the Reach program, we're going to put our money where our mouth is and write a test scenario corresponding to Buffy's Birthday Bash.\n  We'll demonstrate how to use Reach's testing tools to write a convenient testing framework customized for your application.\n  We'll show the tests, then the framework, then the Reach code, and show how the Reach code connects to the framework.\n  This structure is overly complex for this simple application, but it is under complex for what it takes to build a \"real\" DApp.<a href=\"#p_17\" class=\"pid\">17</a>\n</p>\n<hr>\n<p><i id=\"p_18\" class=\"pid\"></i>We're going to use this exact same testing for each of the different versions of the application we build today, but each version will have a slightly different \"framework\" that connects totally different Reach code.<a href=\"#p_18\" class=\"pid\">18</a></p>\n<p><i id=\"p_19\" class=\"pid\"></i>Let's get started:<a href=\"#p_19\" class=\"pid\">19</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.mjs\">/examples/rsvp-4-tedede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"test.one('BBBB', async () => {\n  const Event = await makeRSVP({\n    hostLabel: 'Buffy',\n    name: `Buffy's Birthday Bash at the Bronze`,\n    reservation: stdlib.parseCurrency(1),\n    timeLimit: 250,\n  });\" href=\"#\" id=\"copyBtn3\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"83\"><a href=\"/frontend/#js_test\" title=\"js: test\"><span style=\"color: var(--shiki-token-constant)\">test</span></a><a href=\"/frontend/#js_test.one\" title=\"js: test.one\"><span style=\"color: var(--shiki-token-function)\">.one</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'BBBB'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> () </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"84\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_Event\" title=\"js: Event\"><span style=\"color: var(--shiki-token-constant)\">Event</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">makeRSVP</span><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"85\"><span style=\"color: var(--shiki-color-text)\">    hostLabel</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'Buffy'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"86\"><span style=\"color: var(--shiki-color-text)\">    name</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">`Buffy's Birthday Bash at the Bronze`</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"87\"><span style=\"color: var(--shiki-color-text)\">    reservation</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_parseCurrency\" title=\"js: parseCurrency\"><span style=\"color: var(--shiki-token-function)\">.parseCurrency</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"88\"><span style=\"color: var(--shiki-color-text)\">    timeLimit</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">250</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"89\"><span style=\"color: var(--shiki-color-text)\">  });</span></li></ol></pre>\n<p>\n  <i id=\"p_20\" class=\"pid\"></i>In this sample, we use <span class=\"snip\"><a href=\"/frontend/#js_test\" title=\"js: test\"><span style=\"color: var(--shiki-token-constant)\">test</span></a><a href=\"/frontend/#js_test.one\" title=\"js: test.one\"><span style=\"color: var(--shiki-color-text)\">.one</span></a></span> to define a single test scenario.\n  We use the function <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">makeRSVP</span></span>, which we will define later, to create a JavaScript object for the Event abstraction.\n  When it is created, it has the details of the event in it.<a href=\"#p_20\" class=\"pid\">20</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.mjs\">/examples/rsvp-4-tedede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const Buffy = Event.Host;\n  const People = await Event.makeGuests([\n    'Xander', 'Willow', 'Cordelia', 'Giles', 'Oz', 'Angel', 'Jonathan',\n  ]);\n  const [ Xander, Willow, Cordelia, Giles, Oz, Angel, Jonathan ] = People;\" href=\"#\" id=\"copyBtn4\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"90\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Buffy</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_Event\" title=\"js: Event\"><span style=\"color: var(--shiki-token-constant)\">Event</span></a><span style=\"color: var(--shiki-color-text)\">.Host;</span></li><li value=\"91\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">People</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_Event\" title=\"js: Event\"><span style=\"color: var(--shiki-token-constant)\">Event</span></a><span style=\"color: var(--shiki-token-function)\">.makeGuests</span><span style=\"color: var(--shiki-color-text)\">([</span></li><li value=\"92\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-string-expression)\">'Xander'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'Willow'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'Cordelia'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'Giles'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'Oz'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'Angel'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'Jonathan'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"93\"><span style=\"color: var(--shiki-color-text)\">  ]);</span></li><li value=\"94\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><span style=\"color: var(--shiki-token-constant)\">Xander</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Willow</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Cordelia</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Giles</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Oz</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Angel</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Jonathan</span><span style=\"color: var(--shiki-color-text)\"> ] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> People;</span></li></ol></pre>\n<p>\n  <i id=\"p_21\" class=\"pid\"></i>Next, we define objects for each of the people involved in the scenario.\n  This code uses <span class=\"snip\"><a href=\"/frontend/#js_Event\" title=\"js: Event\"><span style=\"color: var(--shiki-token-constant)\">Event</span></a><span style=\"color: var(--shiki-color-text)\">.makeGuests</span></span>, a function which we will define later, to turn a list of labels into Guest abstractions.<a href=\"#p_21\" class=\"pid\">21</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.mjs\">/examples/rsvp-4-tedede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const Scoobies = [ Xander, Willow, Cordelia, Giles, Oz ];\n  await Promise.all( Scoobies.map((G) => G.willGo()) );\" href=\"#\" id=\"copyBtn5\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"95\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Scoobies</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> [ Xander</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Willow</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Cordelia</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Giles</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Oz ];</span></li><li value=\"96\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Promise</span><span style=\"color: var(--shiki-token-function)\">.all</span><span style=\"color: var(--shiki-color-text)\">( </span><span style=\"color: var(--shiki-token-constant)\">Scoobies</span><span style=\"color: var(--shiki-token-function)\">.map</span><span style=\"color: var(--shiki-color-text)\">((G) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">G</span><span style=\"color: var(--shiki-token-function)\">.willGo</span><span style=\"color: var(--shiki-color-text)\">()) );</span></li></ol></pre>\n<p><i id=\"p_22\" class=\"pid\"></i>Next, we have each one of the Scoobies declare that they will go to the event, and therefore pay the reservation.<a href=\"#p_22\" class=\"pid\">22</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.mjs\">/examples/rsvp-4-tedede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  await Event.waitUntilDeadline();\n  await test.chkErr('Angel', err, async () => {\n    await Angel.willGo();\n  });\n  await Xander.showUp();\n  await Willow.showUp();\n  await Cordelia.showUp();\n  await test.chkErr('Jonathan', 'no reservation', async () => {\n    await Jonathan.showUp();\n  });\n  await Giles.noShow();\n  await Oz.noShow();\" href=\"#\" id=\"copyBtn6\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"97\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_Event\" title=\"js: Event\"><span style=\"color: var(--shiki-token-constant)\">Event</span></a><span style=\"color: var(--shiki-token-function)\">.waitUntilDeadline</span><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"98\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_test\" title=\"js: test\"><span style=\"color: var(--shiki-token-constant)\">test</span></a><a href=\"/frontend/#js_test.chkErr\" title=\"js: test.chkErr\"><span style=\"color: var(--shiki-token-function)\">.chkErr</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Angel'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> err</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> () </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"99\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Angel</span><span style=\"color: var(--shiki-token-function)\">.willGo</span><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"100\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"101\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Xander</span><span style=\"color: var(--shiki-token-function)\">.showUp</span><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"102\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Willow</span><span style=\"color: var(--shiki-token-function)\">.showUp</span><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"103\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Cordelia</span><span style=\"color: var(--shiki-token-function)\">.showUp</span><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"104\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_test\" title=\"js: test\"><span style=\"color: var(--shiki-token-constant)\">test</span></a><a href=\"/frontend/#js_test.chkErr\" title=\"js: test.chkErr\"><span style=\"color: var(--shiki-token-function)\">.chkErr</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Jonathan'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'no reservation'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> () </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"105\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Jonathan</span><span style=\"color: var(--shiki-token-function)\">.showUp</span><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"106\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"107\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Giles</span><span style=\"color: var(--shiki-token-function)\">.noShow</span><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"108\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Oz</span><span style=\"color: var(--shiki-token-function)\">.noShow</span><span style=\"color: var(--shiki-color-text)\">();</span></li></ol></pre>\n<p>\n  <i id=\"p_23\" class=\"pid\"></i>Next, we wait for the deadline and have people start showing up, or not.\n  In the case of Angel, when he says he'll go, there's an error, because he's late.\n  <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">err</span></span> is a constant we'll define later that is the text of the error message from the consensus network indicating that there was a problem submitting the transaction.\n  Similarly, in the case of Jonathan, when he tries to show up, there's an error.<a href=\"#p_23\" class=\"pid\">23</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.mjs\">/examples/rsvp-4-tedede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  for ( const p of [ Buffy, ...People ] ) {\n    const bal = await p.getBalance();\n    console.log(`${p.label} has ${bal}`);\n  }\n});\n\nawait test.run({ noVarOutput: true });\" href=\"#\" id=\"copyBtn7\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"110\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-keyword)\">for</span><span style=\"color: var(--shiki-color-text)\"> ( </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">p</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">of</span><span style=\"color: var(--shiki-color-text)\"> [ Buffy</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">...</span><span style=\"color: var(--shiki-color-text)\">People ] ) {</span></li><li value=\"111\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">bal</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">p</span><span style=\"color: var(--shiki-token-function)\">.getBalance</span><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"112\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-token-constant)\">p</span><span style=\"color: var(--shiki-color-text)\">.label</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> has </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">bal</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"113\"><span style=\"color: var(--shiki-color-text)\">  }</span></li><li value=\"114\"><span style=\"color: var(--shiki-color-text)\">});</span></li><li value=\"115\"></li><li value=\"116\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_test\" title=\"js: test\"><span style=\"color: var(--shiki-token-constant)\">test</span></a><a href=\"/frontend/#js_test.run\" title=\"js: test.run\"><span style=\"color: var(--shiki-token-function)\">.run</span></a><span style=\"color: var(--shiki-color-text)\">({ noVarOutput</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">true</span><span style=\"color: var(--shiki-color-text)\"> });</span></li></ol></pre>\n<p>\n  <i id=\"p_24\" class=\"pid\"></i>Finally, we print out the balances of everyone and see that they match our expectations.\n  The function <span class=\"snip\"><a href=\"/frontend/#js_test\" title=\"js: test\"><span style=\"color: var(--shiki-token-constant)\">test</span></a><a href=\"/frontend/#js_test.run\" title=\"js: test.run\"><span style=\"color: var(--shiki-color-text)\">.run</span></a></span> instructs Reach to run all of the tests and not print out extra debugging information.<a href=\"#p_24\" class=\"pid\">24</a>\n</p>\n<p><i id=\"p_25\" class=\"pid\"></i>Here's what an example run looks like on Algorand:<a href=\"#p_25\" class=\"pid\">25</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"[... a lot of boilerplate about building images and running them ...]\nCordelia made reservation: 4828\nXander made reservation: 4827\nGiles made reservation: 4830\nOz made reservation: 4829\nWillow made reservation: 4831\nWaiting until 4535\nChecking in Xander to 4827...\nXander did show.\nChecking in Willow to 4831...\nWillow did show.\nChecking in Cordelia to 4828...\nCordelia did show.\nChecking in Giles to 4830...\nGiles did not show.\nChecking in Oz to 4829...\nOz did not show.\nBuffy has 101.9853 ALGO\nXander has 99.9962 ALGO\nWillow has 99.9962 ALGO\nCordelia has 99.9962 ALGO\nGiles has 98.9962 ALGO\nOz has 98.9962 ALGO\nAngel has 99.9993 ALGO\nJonathan has 100.0003 ALGO\" href=\"#\" id=\"copyBtn8\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"1\">[... a lot of boilerplate about building images and running them ...]</li><li value=\"2\">Cordelia made reservation: 4828</li><li value=\"3\">Xander made reservation: 4827</li><li value=\"4\">Giles made reservation: 4830</li><li value=\"5\">Oz made reservation: 4829</li><li value=\"6\">Willow made reservation: 4831</li><li value=\"7\">Waiting until 4535</li><li value=\"8\">Checking in Xander to 4827...</li><li value=\"9\">Xander did show.</li><li value=\"10\">Checking in Willow to 4831...</li><li value=\"11\">Willow did show.</li><li value=\"12\">Checking in Cordelia to 4828...</li><li value=\"13\">Cordelia did show.</li><li value=\"14\">Checking in Giles to 4830...</li><li value=\"15\">Giles did not show.</li><li value=\"16\">Checking in Oz to 4829...</li><li value=\"17\">Oz did not show.</li><li value=\"18\">Buffy has 101.9853 ALGO</li><li value=\"19\">Xander has 99.9962 ALGO</li><li value=\"20\">Willow has 99.9962 ALGO</li><li value=\"21\">Cordelia has 99.9962 ALGO</li><li value=\"22\">Giles has 98.9962 ALGO</li><li value=\"23\">Oz has 98.9962 ALGO</li><li value=\"24\">Angel has 99.9993 ALGO</li><li value=\"25\">Jonathan has 100.0003 ALGO</li></ol></pre>\n<p><i id=\"p_26\" class=\"pid\"></i>This sample contains extra printouts we didn't show, because they are embedded in the \"framework\" (i.e. <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">makeRSVP</span></span>) that we'll show later.<a href=\"#p_26\" class=\"pid\">26</a></p>\n<p>\n  <i id=\"p_27\" class=\"pid\"></i>Ideally, we would make real tests that assert that these numbers are correct, but in practice it is very difficult to do so, because of protocol fees and (on networks like Algorand) rewards.\n  One work around for this is to use deliberately huge numbers (like a reservation of 50) and have tests that do \"epsilon comparison\" (i.e. rather than writing <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">x </span><span style=\"color: var(--shiki-token-keyword)\">==</span><span style=\"color: var(--shiki-color-text)\"> y</span></span>, you write <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">(x </span><span style=\"color: var(--shiki-token-keyword)\">-</span><span style=\"color: var(--shiki-color-text)\"> y) </span><span style=\"color: var(--shiki-token-keyword)\">&lt;=</span><span style=\"color: var(--shiki-color-text)\"> epsilon</span></span>, where <code>epsilon</code> is a small number).\n  We won't bother with that today, however.<a href=\"#p_27\" class=\"pid\">27</a>\n</p>\n<h2 id=\"tut-rsvp4-rsh\" class=\"refHeader\">A Decentralized DApp<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#tut-rsvp4-rsh\"><span class=\"icon icon-link\"></span></a></h2>\n<p><i id=\"p_28\" class=\"pid\"></i>Now that we've shown the test case that we'll use for every version, let's look at the \"decentralized\" version of this DApp.<a href=\"#p_28\" class=\"pid\">28</a></p>\n<p>\n  <i id=\"p_29\" class=\"pid\"></i>Recall, that in the \"decentralized\" version, there will be one instance of the application for every Guest that goes to the Event.\n  Since the Host can't know how many Guests there are going to be, she cannot create all of the instances.\n  So, in our design, the Guest will create the instance themselves.\n  When the Guest checks in, they have to tell the Host about the instance so the Host can interact with it and return the reservation.\n  The Host will have to check to make sure the instance is for the correct Event.\n  On the other hand, if the Guest doesn't check in, then the Host has to find out about the instance somehow and claim the reservation.\n  (This \"somehow\" is why this may not be the best design for this application.)<a href=\"#p_29\" class=\"pid\">29</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.rsh\">/examples/rsvp-4-tedede/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"'reach 0.1';\n'use strict';\n\nconst Details = Object({\n  name: Bytes(128),\n  reservation: UInt,\n  deadline: UInt,\n  host: Address,\n});\n\nexport const main = Reach.App(() => {\n  const Host = Participant('Host', {\n    details: Details,\n    showed: Bool,\n  });\n  const Guest = Participant('Guest', {\n    details: Details,\n    registered: Fun([Contract], Null),\n  });\n  init();\" href=\"#\" id=\"copyBtn9\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: var(--shiki-token-string-expression)\">'reach 0.1'</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"2\"><a href=\"/rsh/compute/#rsh_'use%20strict'\" title=\"rsh: 'use strict'\"><span style=\"color: var(--shiki-token-string-expression)\">'use strict'</span></a><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"3\"></li><li value=\"4\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Details</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Object\" title=\"rsh: Object\"><span style=\"color: var(--shiki-token-constant)\">Object</span></a><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"5\"><span style=\"color: var(--shiki-color-text)\">  name</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Bytes\" title=\"rsh: Bytes\"><span style=\"color: var(--shiki-token-function)\">Bytes</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">128</span><span style=\"color: var(--shiki-color-text)\">)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"6\"><span style=\"color: var(--shiki-color-text)\">  reservation</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> UInt</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"7\"><span style=\"color: var(--shiki-color-text)\">  deadline</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> UInt</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"8\"><span style=\"color: var(--shiki-color-text)\">  host</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"9\"><span style=\"color: var(--shiki-color-text)\">});</span></li><li value=\"10\"></li><li value=\"11\"><a href=\"/rsh/module/#rsh_export\" title=\"rsh: export\"><span style=\"color: var(--shiki-token-keyword)\">export</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">main</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/module/#rsh_Reach\" title=\"rsh: Reach\"><span style=\"color: var(--shiki-token-constant)\">Reach</span></a><a href=\"/rsh/module/#rsh_Reach.App\" title=\"rsh: Reach.App\"><span style=\"color: var(--shiki-token-function)\">.App</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"12\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Host</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_Participant\" title=\"rsh: Participant\"><span style=\"color: var(--shiki-token-function)\">Participant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Host'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"13\"><span style=\"color: var(--shiki-color-text)\">    details</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> Details</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"14\"><span style=\"color: var(--shiki-color-text)\">    showed</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> Bool</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"15\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"16\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Guest</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_Participant\" title=\"rsh: Participant\"><span style=\"color: var(--shiki-token-function)\">Participant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Guest'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"17\"><span style=\"color: var(--shiki-color-text)\">    details</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> Details</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"18\"><span style=\"color: var(--shiki-color-text)\">    registered</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Contract]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Null)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"19\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"20\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/appinit/#rsh_init\" title=\"rsh: init\"><span style=\"color: var(--shiki-token-function)\">init</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li></ol></pre>\n<p>\n  <i id=\"p_30\" class=\"pid\"></i>First, we define a type that represents the details of the event.\n  It contains the name of the event (\"Buffy's Birthday Bash...\"), as well as the reservation price, the deadline, and the host's address.<a href=\"#p_30\" class=\"pid\">30</a>\n</p>\n<p><i id=\"p_31\" class=\"pid\"></i>Second, we define the application and the two participants, the Host, and the Guest.<a href=\"#p_31\" class=\"pid\">31</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.rsh\">/examples/rsvp-4-tedede/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  Guest.only(() => {\n    const details = declassify(interact.details);\n  });\n  Guest.publish(details).pay(details.reservation);\n  const { reservation, deadline, host } = details;\n  enforce( thisConsensusTime() < deadline, &quot;too late&quot; );\n  Guest.interact.registered(getContract());\n  commit();\" href=\"#\" id=\"copyBtn10\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"22\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">Guest</span><a href=\"/rsh/step/#rsh_only\" title=\"rsh: only\"><span style=\"color: var(--shiki-token-function)\">.only</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"23\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">details</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: var(--shiki-token-function)\">declassify</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-color-text)\">.details);</span></li><li value=\"24\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"25\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">Guest</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">(details)</span><a href=\"/rsh/step/#rsh_pay\" title=\"rsh: pay\"><span style=\"color: var(--shiki-token-function)\">.pay</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">details</span><span style=\"color: var(--shiki-color-text)\">.reservation);</span></li><li value=\"26\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> { </span><span style=\"color: var(--shiki-token-constant)\">reservation</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">deadline</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">host</span><span style=\"color: var(--shiki-color-text)\"> } </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> details;</span></li><li value=\"27\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_enforce\" title=\"rsh: enforce\"><span style=\"color: var(--shiki-token-function)\">enforce</span></a><span style=\"color: var(--shiki-color-text)\">( </span><a href=\"/rsh/compute/#rsh_thisConsensusTime\" title=\"rsh: thisConsensusTime\"><span style=\"color: var(--shiki-token-function)\">thisConsensusTime</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_%3C\" title=\"rsh: <\"><span style=\"color: var(--shiki-token-keyword)\">&lt;</span></a><span style=\"color: var(--shiki-color-text)\"> deadline</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"too late\"</span><span style=\"color: var(--shiki-color-text)\"> );</span></li><li value=\"28\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">Guest</span><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.registered</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_getContract\" title=\"rsh: getContract\"><span style=\"color: var(--shiki-token-function)\">getContract</span></a><span style=\"color: var(--shiki-color-text)\">());</span></li><li value=\"29\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li></ol></pre>\n<p>\n  <i id=\"p_32\" class=\"pid\"></i>As mentioned above, the first thing that happens in the program is that the Guest launches the instance by doing the first publication.\n  They publish the details of the event, which they had to get from the Host somehow.\n  (Another \"somehow\"!)\n  And they have to pay the reservation fee.<a href=\"#p_32\" class=\"pid\">32</a>\n</p>\n<p>\n  <i id=\"p_33\" class=\"pid\"></i>We enforce that the current time on the network is before the deadline.\n  This is not strictly necessary, but it will be convenient and helpful for end users.<a href=\"#p_33\" class=\"pid\">33</a>\n</p>\n<div class=\"note\">\n  <p><i id=\"p_34\" class=\"pid\"></i>What is <span class=\"snip\"><a href=\"/rsh/compute/#rsh_enforce\" title=\"rsh: enforce\"><span style=\"color: var(--shiki-color-text)\">enforce</span></a></span>?<a href=\"#p_34\" class=\"pid\">34</a></p>\n  <p>\n    <i id=\"p_35\" class=\"pid\"></i>It is similar to <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_require\" title=\"rsh: require\"><span style=\"color: var(--shiki-color-text)\">require</span></a></span>, except that Reach does not guarantee that there is an <span class=\"snip\"><a href=\"/rsh/local/#rsh_assume\" title=\"rsh: assume\"><span style=\"color: var(--shiki-color-text)\">assume</span></a></span> that dominates it.\n    This means that honest actors may submit publications that will not be satisfied, because they violate the property.\n    You should use this sparingly and only for properties that cannot be checked locally, like things related to time (as in this case) or things related to external <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_remote\" title=\"rsh: remote\"><span style=\"color: var(--shiki-color-text)\">remote</span></a></span> objects.<a href=\"#p_35\" class=\"pid\">35</a>\n  </p>\n</div>\n<p><i id=\"p_36\" class=\"pid\"></i>Finally, the Guest is informed, via their <code>registered</code> <span class=\"snip\"><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-color-text)\">interact</span></a></span> function, about the contract's identity, so they can share it with the Host.<a href=\"#p_36\" class=\"pid\">36</a></p>\n<div class=\"note\">\n  <p><i id=\"p_37\" class=\"pid\"></i>Did you notice that the <span class=\"snip\"><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-color-text)\">interact</span></a></span> function was called outside of an <span class=\"snip\"><a href=\"/rsh/step/#rsh_only\" title=\"rsh: only\"><span style=\"color: var(--shiki-color-text)\">only</span></a></span> block and within a consensus step?<a href=\"#p_37\" class=\"pid\">37</a></p>\n  <p>\n    <i id=\"p_38\" class=\"pid\"></i>When an <span class=\"snip\"><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-color-text)\">interact</span></a></span> function returns <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Null\" title=\"rsh: Null\"><span style=\"color: var(--shiki-color-text)\">Null</span></a></span>, it can be called via the short-hand <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_Participant\" title=\"rsh: Participant\"><span style=\"color: var(--shiki-token-constant)\">Participant</span></a><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.f</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-keyword)\">...</span><span style=\"color: var(--shiki-color-text)\">.)</span></span>.\n    This a short-hand for writing <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_Participant\" title=\"rsh: Participant\"><span style=\"color: var(--shiki-token-constant)\">Participant</span></a><a href=\"/rsh/step/#rsh_only\" title=\"rsh: only\"><span style=\"color: var(--shiki-token-function)\">.only</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.f</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-keyword)\">...</span><span style=\"color: var(--shiki-color-text)\">.))</span></span>.<a href=\"#p_38\" class=\"pid\">38</a>\n  </p>\n  <p><i id=\"p_39\" class=\"pid\"></i>When a local step (such as the <span class=\"snip\"><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-color-text)\">interact</span></a></span> short-hand) appears in a consensus step, it will run after the consensus step is confirmed, whenever the participant learns about that confirmation.<a href=\"#p_39\" class=\"pid\">39</a></p>\n</div>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.rsh\">/examples/rsvp-4-tedede/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  Host.only(() => {\n    const hdetails = declassify(interact.details);\n    check( details == hdetails, &quot;wrong event&quot; );\n    const showed = declassify(interact.showed);\n  });\n  Host.publish(showed).check(() => {\n    check(this == host, &quot;not the host&quot;);\n  });\n  enforce( thisConsensusTime() >= deadline, &quot;too early&quot; );\n  transfer(reservation).to(showed ? Guest : Host);\n  commit();\n\n  exit();\n});\" href=\"#\" id=\"copyBtn11\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"31\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">Host</span><a href=\"/rsh/step/#rsh_only\" title=\"rsh: only\"><span style=\"color: var(--shiki-token-function)\">.only</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"32\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">hdetails</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: var(--shiki-token-function)\">declassify</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-color-text)\">.details);</span></li><li value=\"33\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">( details </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> hdetails</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"wrong event\"</span><span style=\"color: var(--shiki-color-text)\"> );</span></li><li value=\"34\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">showed</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: var(--shiki-token-function)\">declassify</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-color-text)\">.showed);</span></li><li value=\"35\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"36\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">Host</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">(showed)</span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">.check</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"37\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> host</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"not the host\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"38\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"39\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_enforce\" title=\"rsh: enforce\"><span style=\"color: var(--shiki-token-function)\">enforce</span></a><span style=\"color: var(--shiki-color-text)\">( </span><a href=\"/rsh/compute/#rsh_thisConsensusTime\" title=\"rsh: thisConsensusTime\"><span style=\"color: var(--shiki-token-function)\">thisConsensusTime</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_%3E=\" title=\"rsh: >=\"><span style=\"color: var(--shiki-token-keyword)\">&gt;=</span></a><span style=\"color: var(--shiki-color-text)\"> deadline</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"too early\"</span><span style=\"color: var(--shiki-color-text)\"> );</span></li><li value=\"40\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_transfer\" title=\"rsh: transfer\"><span style=\"color: var(--shiki-token-function)\">transfer</span></a><span style=\"color: var(--shiki-color-text)\">(reservation)</span><a href=\"/rsh/consensus/#rsh_transfer.to\" title=\"rsh: transfer.to\"><span style=\"color: var(--shiki-token-function)\">.to</span></a><span style=\"color: var(--shiki-color-text)\">(showed </span><a href=\"/rsh/compute/#rsh_?\" title=\"rsh: ?\"><span style=\"color: var(--shiki-token-keyword)\">?</span></a><span style=\"color: var(--shiki-color-text)\"> Guest </span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> Host);</span></li><li value=\"41\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"42\"></li><li value=\"43\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/step/#rsh_exit\" title=\"rsh: exit\"><span style=\"color: var(--shiki-token-function)\">exit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"44\"><span style=\"color: var(--shiki-color-text)\">});</span></li></ol></pre>\n<p>\n  <i id=\"p_40\" class=\"pid\"></i>It is now time for the Host to show up and declare what should happen to the reservation.\n  First, the Host checks to see if the details are correct.\n  If they are, then the Host publishes a boolean for whether the Guest really showed up or not.\n  When they publish, it is checked locally and consensually whether the sender is the specified Host.\n  We ensure that the time is after the deadline, and then send the reservation to the appropriate place.<a href=\"#p_40\" class=\"pid\">40</a>\n</p>\n<div class=\"note\">\n  <p><i id=\"p_41\" class=\"pid\"></i>What is <span class=\"snip\"><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-color-text)\">check</span></a></span>?<a href=\"#p_41\" class=\"pid\">41</a></p>\n  <p>\n    <i id=\"p_42\" class=\"pid\"></i>It is like <span class=\"snip\"><a href=\"/rsh/local/#rsh_assume\" title=\"rsh: assume\"><span style=\"color: var(--shiki-color-text)\">assume</span></a></span> and <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_require\" title=\"rsh: require\"><span style=\"color: var(--shiki-color-text)\">require</span></a></span>, except that it morphs into whichever is appropriate given the context of its use.\n    This is convenient for writing functions that validate input data that can be used locally (like <span class=\"snip\"><a href=\"/rsh/local/#rsh_assume\" title=\"rsh: assume\"><span style=\"color: var(--shiki-color-text)\">assume</span></a></span>) <em>and</em> in consensus (like <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_require\" title=\"rsh: require\"><span style=\"color: var(--shiki-color-text)\">require</span></a></span>).<a href=\"#p_42\" class=\"pid\">42</a>\n  </p>\n</div>\n<div class=\"note\">\n  <p><i id=\"p_43\" class=\"pid\"></i>How does the Guest know that the Host is going to be honest and report that they attended accurately?<a href=\"#p_43\" class=\"pid\">43</a></p>\n  <p>\n    <i id=\"p_44\" class=\"pid\"></i>There is no way for the Guest to enforce this.\n    They must trust the Host to do this correctly, just like they need to trust that the Host is not going to throw a lame party.\n    This is an example of the so-called \"oracle problem\" in consensus networks: when you want to represent on-chain information that is only available off-chain, you must have some trusted party that can bridge the information from the \"real\" world into the consensus network.\n    In this case, the Host is the Oracle.<a href=\"#p_44\" class=\"pid\">44</a>\n  </p>\n</div>\n<hr>\n<p>\n  <i id=\"p_45\" class=\"pid\"></i>This application works well and we'll be able to run our test scenario.\n  It is extremely simple, as a Reach program, but its main downside is that it requires complexity outside of the consensus network.<a href=\"#p_45\" class=\"pid\">45</a>\n</p>\n<p>\n  <i id=\"p_46\" class=\"pid\"></i>For example, how does the Host inform Guests what the proper event details are?\n  We assume that the Host is going to have a Web page that shows these events in a machine-readable format, like a QR code, which the RSVP application will consume and automatically use as the <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">details</span></span> variable.\n  One precise way this could work is that the Host goes to the RSVP application site, enters the information, and gets a custom link where this information is embedded in the URL, like <code>https://rsvp.app/event?d=SXQncyBhIHNlY3JldCB0byBldmVyeW9uZQo=</code>, and when they share the link, the application will be in \"Guest mode\".\n  The link could also contain things that are useful outside of the core consensus program, like a link to a banner image and other important details.\n  This would be a completely stateless way to implement the application.<a href=\"#p_46\" class=\"pid\">46</a>\n</p>\n<p>\n  <i id=\"p_47\" class=\"pid\"></i>Similarly, how do the Guests inform the Host about their instance of the program?\n  One strategy for this is that the RSVP application generates a QR code which is an encoded form of their <span class=\"snip\"><a href=\"/rsh/compute/#rsh_getContract\" title=\"rsh: getContract\"><span style=\"color: var(--shiki-color-text)\">getContract</span></a></span> value.\n  When the Guest arrives at the event, they show the QR code, which the Host scans with the RSVP application in \"Host mode\" and then it runs the next step of the program.<a href=\"#p_47\" class=\"pid\">47</a>\n</p>\n<p>\n  <i id=\"p_48\" class=\"pid\"></i>But, how does the Host find out about Guests that reserved, but never came?\n  In one way, it doesn't matter: the Host doesn't want the money, she just wants the Guest to have an incentive to come.\n  That answer is very unsatisfying though.\n  There are roughly two alternatives:<a href=\"#p_48\" class=\"pid\">48</a>\n</p>\n<ul>\n  <li><i id=\"p_49\" class=\"pid\"></i>First, the Guest could tell the Host up-front that they are coming, but they would have to do that off-chain, such as by the RSVP application tracking it in a centralized database or encouraging the Guest to send an automated email or SMS message.<a href=\"#p_49\" class=\"pid\">49</a></li>\n  <li>\n    <i id=\"p_50\" class=\"pid\"></i>Second, the Host could search the consensus network for all instances of the RSVP application with matching details and then deliberately interact with and claim the funds.\n    The first option is \"centralized\", while the second option is \"decentralized\".\n    (It appears, we now have a \"decentralized, decentralized, decentralized, decentralized application\" design, if we go with the second option.)<a href=\"#p_50\" class=\"pid\">50</a>\n  </li>\n</ul>\n<p>\n  <i id=\"p_51\" class=\"pid\"></i>Both of these options are tedious and annoying, so we will eventually use a different technique to engineer the RSVP application.\n  But before we do that, let's look at the JavaScript framework that makes our test scenario work.\n  It makes explicit these issues about who (Guest or Host) does what, when, and how.<a href=\"#p_51\" class=\"pid\">51</a>\n</p>\n<h2 id=\"tut-rsvp4-mjs\" class=\"refHeader\">My Kingdom for a Framework!<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#tut-rsvp4-mjs\"><span class=\"icon icon-link\"></span></a></h2>\n<p>\n  <i id=\"p_52\" class=\"pid\"></i>In <a href=\"/tut/rsvp/#tut-rsvp4-tests\">Test First, but Verify</a>, we showed a set of tests which we will use for each instance of the RSVP application code.\n  In <a href=\"/tut/rsvp/#tut-rsvp4-rsh\">A Decentralized DApp</a>, we showed the Reach program that implements an extremely decentralized version of this program.\n  In this section, we show the testing framework that connects these two things.<a href=\"#p_52\" class=\"pid\">52</a>\n</p>\n<p><i id=\"p_53\" class=\"pid\"></i>This framework needs to provide:<a href=\"#p_53\" class=\"pid\">53</a></p>\n<ul>\n  <li><i id=\"p_54\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">makeRSVP </span><span style=\"color: var(--shiki-token-comment)\">// :: Details -&gt; Event</span></span> --- A function which accepts the details of an event and returns an Event abstraction.<a href=\"#p_54\" class=\"pid\">54</a></li>\n  <li><i id=\"p_55\" class=\"pid\"></i><span class=\"snip\"><a href=\"/frontend/#js_Event\" title=\"js: Event\"><span style=\"color: var(--shiki-token-constant)\">Event</span></a><span style=\"color: var(--shiki-color-text)\">.Host </span><span style=\"color: var(--shiki-token-comment)\">// :: Person</span></span> --- An abstraction of the Host.<a href=\"#p_55\" class=\"pid\">55</a></li>\n  <li><i id=\"p_56\" class=\"pid\"></i><span class=\"snip\"><a href=\"/frontend/#js_Event\" title=\"js: Event\"><span style=\"color: var(--shiki-token-constant)\">Event</span></a><span style=\"color: var(--shiki-color-text)\">.makeGuests </span><span style=\"color: var(--shiki-token-comment)\">// :: [string] -&gt; Promise&lt;[Guest]&gt;</span></span> --- A function that produces an array of Guest abstractions, which are subclasses of People abstractions.<a href=\"#p_56\" class=\"pid\">56</a></li>\n  <li><i id=\"p_57\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">Guest</span><span style=\"color: var(--shiki-color-text)\">.willGo </span><span style=\"color: var(--shiki-token-comment)\">// :: -&gt; Promise&lt;void&gt;</span></span> --- A function for one guest to make a reservation.<a href=\"#p_57\" class=\"pid\">57</a></li>\n  <li><i id=\"p_58\" class=\"pid\"></i><span class=\"snip\"><a href=\"/frontend/#js_Event\" title=\"js: Event\"><span style=\"color: var(--shiki-token-constant)\">Event</span></a><span style=\"color: var(--shiki-color-text)\">.waitUntilDeadline </span><span style=\"color: var(--shiki-token-comment)\">// :: -&gt; Promise&lt;void&gt;</span></span> --- A function that waits until the deadline has passed.<a href=\"#p_58\" class=\"pid\">58</a></li>\n  <li><i id=\"p_59\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">Guest</span><span style=\"color: var(--shiki-color-text)\">.showUp </span><span style=\"color: var(--shiki-token-comment)\">// :: -&gt; Promise&lt;void&gt;</span></span> --- A function for one guest to be checked in.<a href=\"#p_59\" class=\"pid\">59</a></li>\n  <li><i id=\"p_60\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">Guest</span><span style=\"color: var(--shiki-color-text)\">.noShow </span><span style=\"color: var(--shiki-token-comment)\">// :: -&gt; Promise&lt;void&gt;</span></span> --- A function for one guest to be indicated as failing to check in.<a href=\"#p_60\" class=\"pid\">60</a></li>\n  <li><i id=\"p_61\" class=\"pid\"></i><span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">Person</span><span style=\"color: var(--shiki-color-text)\">.getBalance </span><span style=\"color: var(--shiki-token-comment)\">// :: -&gt; Promise&lt;UInt&gt;</span></span> --- A function to read one person's balance.<a href=\"#p_61\" class=\"pid\">61</a></li>\n</ul>\n<p><i id=\"p_62\" class=\"pid\"></i>We'll talk about each of these in turn.<a href=\"#p_62\" class=\"pid\">62</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.mjs\">/examples/rsvp-4-tedede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"import { loadStdlib, test } from '@reach-sh/stdlib';\nimport * as backend from './build/index.main.mjs';\n\n// Basics\nconst stdlib = loadStdlib();\nconst err = {\n  'ETH': 'transaction may fail',\n  'ALGO': 'assert failed',\n  'CFX': 'transaction is reverted',\n}[stdlib.connector];\" href=\"#\" id=\"copyBtn12\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import\" title=\"js: import\"><span style=\"color: var(--shiki-token-keyword)\">import</span></a><span style=\"color: var(--shiki-color-text)\"> { loadStdlib</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> test } </span><span style=\"color: var(--shiki-token-keyword)\">from</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'@reach-sh/stdlib'</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"2\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import\" title=\"js: import\"><span style=\"color: var(--shiki-token-keyword)\">import</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">*</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">as</span><span style=\"color: var(--shiki-color-text)\"> backend </span><span style=\"color: var(--shiki-token-keyword)\">from</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'./build/index.main.mjs'</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"3\"></li><li value=\"4\"><span style=\"color: var(--shiki-token-comment)\">// Basics</span></li><li value=\"5\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_loadStdlib\" title=\"js: loadStdlib\"><span style=\"color: var(--shiki-token-function)\">loadStdlib</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"6\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">err</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"7\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-string-expression)\">'ETH'</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'transaction may fail'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"8\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-string-expression)\">'ALGO'</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'assert failed'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"9\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-string-expression)\">'CFX'</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'transaction is reverted'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"10\"><span style=\"color: var(--shiki-color-text)\">}[</span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><span style=\"color: var(--shiki-color-text)\">.connector];</span></li></ol></pre>\n<p>\n  <i id=\"p_63\" class=\"pid\"></i>First, we have the basic header that imports and initializes the Reach standard library.\n  The only interesting thing here is the definition of the various error messages for each network connector.<a href=\"#p_63\" class=\"pid\">63</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.mjs\">/examples/rsvp-4-tedede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const makeRSVP = async ({ hostLabel, name, reservation, timeLimit }) => {\n  const sbal = stdlib.parseCurrency(100);\n  const accHost = await stdlib.newTestAccount(sbal);\n  accHost.setDebugLabel(hostLabel);\" href=\"#\" id=\"copyBtn13\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"13\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">makeRSVP</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> ({ hostLabel</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> name</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> reservation</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> timeLimit }) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"14\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">sbal</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_parseCurrency\" title=\"js: parseCurrency\"><span style=\"color: var(--shiki-token-function)\">.parseCurrency</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">100</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"15\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">accHost</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.newTestAccount\" title=\"js: stdlib.newTestAccount\"><span style=\"color: var(--shiki-token-function)\">.newTestAccount</span></a><span style=\"color: var(--shiki-color-text)\">(sbal);</span></li><li value=\"16\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">accHost</span><a href=\"/frontend/#js_setDebugLabel\" title=\"js: setDebugLabel\"><span style=\"color: var(--shiki-token-function)\">.setDebugLabel</span></a><span style=\"color: var(--shiki-color-text)\">(hostLabel);</span></li></ol></pre>\n<p><i id=\"p_64\" class=\"pid\"></i>We define the <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">makeRSVP</span></span> function and create an initial test account for the host and set its label for debugging.<a href=\"#p_64\" class=\"pid\">64</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.mjs\">/examples/rsvp-4-tedede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const stdPerson = (obj) => {\n    const { acc } = obj;\n    const getBalance = async () => {\n      const bal = await acc.balanceOf();\n      return `${stdlib.formatCurrency(bal, 4)} ${stdlib.standardUnit}`;\n    };\n    return {\n      ...obj,\n      getBalance,\n    };\n  };\n\n  const Host = stdPerson({\n    acc: accHost,\n    label: hostLabel,\n  });\" href=\"#\" id=\"copyBtn14\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"18\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">stdPerson</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> (obj) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"19\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> { </span><a href=\"/frontend/#js_acc\" title=\"js: acc\"><span style=\"color: var(--shiki-token-constant)\">acc</span></a><span style=\"color: var(--shiki-color-text)\"> } </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> obj;</span></li><li value=\"20\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">getBalance</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> () </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"21\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">bal</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_acc\" title=\"js: acc\"><span style=\"color: var(--shiki-token-constant)\">acc</span></a><a href=\"/frontend/#js_acc.balanceOf\" title=\"js: acc.balanceOf\"><span style=\"color: var(--shiki-token-function)\">.balanceOf</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"22\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-keyword)\">return</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_formatCurrency\" title=\"js: formatCurrency\"><span style=\"color: var(--shiki-token-function)\">.formatCurrency</span></a><span style=\"color: var(--shiki-color-text)\">(bal</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">4</span><span style=\"color: var(--shiki-color-text)\">)</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_standardUnit\" title=\"js: standardUnit\"><span style=\"color: var(--shiki-color-text)\">.standardUnit</span></a><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"23\"><span style=\"color: var(--shiki-color-text)\">    };</span></li><li value=\"24\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-keyword)\">return</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"25\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-keyword)\">...</span><span style=\"color: var(--shiki-color-text)\">obj</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"26\"><span style=\"color: var(--shiki-color-text)\">      getBalance</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"27\"><span style=\"color: var(--shiki-color-text)\">    };</span></li><li value=\"28\"><span style=\"color: var(--shiki-color-text)\">  };</span></li><li value=\"29\"></li><li value=\"30\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Host</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">stdPerson</span><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"31\"><span style=\"color: var(--shiki-color-text)\">    acc</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> accHost</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"32\"><span style=\"color: var(--shiki-color-text)\">    label</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> hostLabel</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"33\"><span style=\"color: var(--shiki-color-text)\">  });</span></li></ol></pre>\n<p>\n  <i id=\"p_65\" class=\"pid\"></i>Next, we define the function <code>stdPerson</code> which takes an <code>obj</code> with an <code>acc</code> field and adds a <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">Person</span><span style=\"color: var(--shiki-color-text)\">.getBalance</span></span> function that returns the account's current balance as a nice formatted string.\n  We use this function to define the <span class=\"snip\"><a href=\"/frontend/#js_Event\" title=\"js: Event\"><span style=\"color: var(--shiki-token-constant)\">Event</span></a><span style=\"color: var(--shiki-color-text)\">.Host</span></span> value.<a href=\"#p_65\" class=\"pid\">65</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.mjs\">/examples/rsvp-4-tedede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  });\n\n  const deadline = (await stdlib.getNetworkTime()).add(timeLimit);\n  const waitUntilDeadline = async () => {\n    console.log(`Waiting until ${deadline}`);\n    await stdlib.waitUntilTime(deadline);\n  };\" href=\"#\" id=\"copyBtn15\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"33\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"34\"></li><li value=\"35\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">deadline</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> (</span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.getNetworkTime\" title=\"js: stdlib.getNetworkTime\"><span style=\"color: var(--shiki-token-function)\">.getNetworkTime</span></a><span style=\"color: var(--shiki-color-text)\">())</span><a href=\"/frontend/#js_add\" title=\"js: add\"><span style=\"color: var(--shiki-token-function)\">.add</span></a><span style=\"color: var(--shiki-color-text)\">(timeLimit);</span></li><li value=\"36\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">waitUntilDeadline</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> () </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"37\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">`Waiting until </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">deadline</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"38\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.waitUntilTime\" title=\"js: stdlib.waitUntilTime\"><span style=\"color: var(--shiki-token-function)\">.waitUntilTime</span></a><span style=\"color: var(--shiki-color-text)\">(deadline);</span></li><li value=\"39\"><span style=\"color: var(--shiki-color-text)\">  };</span></li></ol></pre>\n<p><i id=\"p_66\" class=\"pid\"></i>Next, we define the deadline, based on the current time, and the <span class=\"snip\"><a href=\"/frontend/#js_Event\" title=\"js: Event\"><span style=\"color: var(--shiki-token-constant)\">Event</span></a><span style=\"color: var(--shiki-color-text)\">.waitUntilDeadline</span></span> function for waiting until that time has passed.<a href=\"#p_66\" class=\"pid\">66</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.mjs\">/examples/rsvp-4-tedede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const details = {\n    name, reservation, deadline, host: accHost,\n  };\" href=\"#\" id=\"copyBtn16\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"41\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">details</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"42\"><span style=\"color: var(--shiki-color-text)\">    name</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> reservation</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> deadline</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> host</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> accHost</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"43\"><span style=\"color: var(--shiki-color-text)\">  };</span></li></ol></pre>\n<p>\n  <i id=\"p_67\" class=\"pid\"></i>Now, we can define the <code>details</code> object that will be consumed by Reach.\n  This value will be in scope for each of the Guests, which represents the Event details being shared with all the Guests.\n  We use <code>accHost</code> for the <code>host</code> field, because Reach can convert account abstractions into <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Address\" title=\"rsh: Address\"><span style=\"color: var(--shiki-color-text)\">Address</span></a></span> values.<a href=\"#p_67\" class=\"pid\">67</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.mjs\">/examples/rsvp-4-tedede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const makeGuest = async (label) => {\n    const acc = await stdlib.newTestAccount(sbal);\n    acc.setDebugLabel(label);\" href=\"#\" id=\"copyBtn17\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"45\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">makeGuest</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> (label) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"46\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_acc\" title=\"js: acc\"><span style=\"color: var(--shiki-token-constant)\">acc</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.newTestAccount\" title=\"js: stdlib.newTestAccount\"><span style=\"color: var(--shiki-token-function)\">.newTestAccount</span></a><span style=\"color: var(--shiki-color-text)\">(sbal);</span></li><li value=\"47\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/frontend/#js_acc\" title=\"js: acc\"><span style=\"color: var(--shiki-token-constant)\">acc</span></a><a href=\"/frontend/#js_setDebugLabel\" title=\"js: setDebugLabel\"><span style=\"color: var(--shiki-token-function)\">.setDebugLabel</span></a><span style=\"color: var(--shiki-color-text)\">(label);</span></li></ol></pre>\n<p><i id=\"p_68\" class=\"pid\"></i>We define the <span class=\"snip\"><a href=\"/frontend/#js_Event\" title=\"js: Event\"><span style=\"color: var(--shiki-token-constant)\">Event</span></a><span style=\"color: var(--shiki-color-text)\">.makeGuest</span></span> function, which starts by creating a new test account and setting its label.<a href=\"#p_68\" class=\"pid\">68</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.mjs\">/examples/rsvp-4-tedede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    let ctcInfo = undefined;\n    const willGo = async () => {\n      const ctcGuest = acc.contract(backend);\n      ctcInfo = await stdlib.withDisconnect(() => ctcGuest.p.Guest({\n        details,\n        registered: stdlib.disconnect,\n      }));\n      console.log(`${label} made reservation: ${ctcInfo}`);\n    };\" href=\"#\" id=\"copyBtn18\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"49\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let\" title=\"js: let\"><span style=\"color: var(--shiki-token-keyword)\">let</span></a><span style=\"color: var(--shiki-color-text)\"> ctcInfo </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">undefined</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"50\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">willGo</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> () </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"51\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcGuest</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_acc\" title=\"js: acc\"><span style=\"color: var(--shiki-token-constant)\">acc</span></a><a href=\"/frontend/#js_contract\" title=\"js: contract\"><span style=\"color: var(--shiki-token-function)\">.contract</span></a><span style=\"color: var(--shiki-color-text)\">(backend);</span></li><li value=\"52\"><span style=\"color: var(--shiki-color-text)\">      ctcInfo </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.withDisconnect\" title=\"js: stdlib.withDisconnect\"><span style=\"color: var(--shiki-token-function)\">.withDisconnect</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcGuest</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">p</span><span style=\"color: var(--shiki-token-function)\">.Guest</span><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"53\"><span style=\"color: var(--shiki-color-text)\">        details</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"54\"><span style=\"color: var(--shiki-color-text)\">        registered</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.disconnect\" title=\"js: stdlib.disconnect\"><span style=\"color: var(--shiki-color-text)\">.disconnect</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"55\"><span style=\"color: var(--shiki-color-text)\">      }));</span></li><li value=\"56\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">label</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> made reservation: </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">ctcInfo</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"57\"><span style=\"color: var(--shiki-color-text)\">    };</span></li></ol></pre>\n<p>\n  <i id=\"p_69\" class=\"pid\"></i>We define the <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">Guest</span><span style=\"color: var(--shiki-color-text)\">.willGo</span></span> function, which spawns a new contract that runs as the <code>Guest</code> participant.\n  It uses <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.withDisconnect\" title=\"js: stdlib.withDisconnect\"><span style=\"color: var(--shiki-color-text)\">.withDisconnect</span></a></span> and <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.disconnect\" title=\"js: stdlib.disconnect\"><span style=\"color: var(--shiki-color-text)\">.disconnect</span></a></span> to stop running after the <code>registered</code> <span class=\"snip\"><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-color-text)\">interact</span></a></span> function has been called with the contract information.\n  This information is returned from <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.withDisconnect\" title=\"js: stdlib.withDisconnect\"><span style=\"color: var(--shiki-color-text)\">.withDisconnect</span></a></span>, so <code>ctcInfo</code> is set to the actual contract that was deployed.\n  In a real deployment, this contract information would be presented the user as something like a QR code for them to save and show to the Host later.<a href=\"#p_69\" class=\"pid\">69</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.mjs\">/examples/rsvp-4-tedede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    const doHost = async (showed) => {\n      if ( ctcInfo === undefined ) {\n        throw new Error('no reservation');\n      }\n      console.log(`Checking in ${label} to ${ctcInfo}...`);\n      const ctcHost = accHost.contract(backend, ctcInfo);\n      await ctcHost.p.Host({\n        details, showed\n      });\n      console.log(`${label} did${showed ? '' : ' not'} show.`);\n    };\n    const showUp = () => doHost(true);\n    const noShow = () => doHost(false);\" href=\"#\" id=\"copyBtn19\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"58\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">doHost</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> (showed) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"59\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-keyword)\">if</span><span style=\"color: var(--shiki-color-text)\"> ( ctcInfo </span><span style=\"color: var(--shiki-token-keyword)\">===</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">undefined</span><span style=\"color: var(--shiki-color-text)\"> ) {</span></li><li value=\"60\"><span style=\"color: var(--shiki-color-text)\">        </span><span style=\"color: var(--shiki-token-keyword)\">throw</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">new</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Error</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'no reservation'</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"61\"><span style=\"color: var(--shiki-color-text)\">      }</span></li><li value=\"62\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">`Checking in </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">label</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> to </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">ctcInfo</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\">...`</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"63\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcHost</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">accHost</span><a href=\"/frontend/#js_contract\" title=\"js: contract\"><span style=\"color: var(--shiki-token-function)\">.contract</span></a><span style=\"color: var(--shiki-color-text)\">(backend</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> ctcInfo);</span></li><li value=\"64\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcHost</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">p</span><span style=\"color: var(--shiki-token-function)\">.Host</span><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"65\"><span style=\"color: var(--shiki-color-text)\">        details</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> showed</span></li><li value=\"66\"><span style=\"color: var(--shiki-color-text)\">      });</span></li><li value=\"67\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">label</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> did</span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">showed </span><span style=\"color: var(--shiki-token-keyword)\">?</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">''</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">' not'</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> show.`</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"68\"><span style=\"color: var(--shiki-color-text)\">    };</span></li><li value=\"69\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">showUp</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> () </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">doHost</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">true</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"70\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">noShow</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> () </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">doHost</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">false</span><span style=\"color: var(--shiki-color-text)\">);</span></li></ol></pre>\n<p>\n  <i id=\"p_70\" class=\"pid\"></i>We define the two functions <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">Guest</span><span style=\"color: var(--shiki-color-text)\">.showUp</span></span> and <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">Guest</span><span style=\"color: var(--shiki-color-text)\">.noShow</span></span> by defining a common function <code>doHost</code> that accepts a boolean.\n  This function throws an error if there was never a reservation, which we know because the <code>ctcInfo</code> variable is undefined.\n  Although the function is inside of the Guest object, it uses the Host's account abstraction to attach to an instance of the program.\n  It has access to <code>details</code> object, so it can ensure that they match.<a href=\"#p_70\" class=\"pid\">70</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-4-tedede/index.mjs\">/examples/rsvp-4-tedede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    return stdPerson({\n      acc, label,\n      willGo, showUp, noShow,\n    });\n  };\n  const makeGuests = (labels) => Promise.all(labels.map(makeGuest));\n\n  return { Host, makeGuest, makeGuests, waitUntilDeadline };\n};\" href=\"#\" id=\"copyBtn20\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"72\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-keyword)\">return</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">stdPerson</span><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"73\"><span style=\"color: var(--shiki-color-text)\">      acc</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> label</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"74\"><span style=\"color: var(--shiki-color-text)\">      willGo</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> showUp</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> noShow</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"75\"><span style=\"color: var(--shiki-color-text)\">    });</span></li><li value=\"76\"><span style=\"color: var(--shiki-color-text)\">  };</span></li><li value=\"77\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">makeGuests</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> (labels) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Promise</span><span style=\"color: var(--shiki-token-function)\">.all</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">labels</span><span style=\"color: var(--shiki-token-function)\">.map</span><span style=\"color: var(--shiki-color-text)\">(makeGuest));</span></li><li value=\"78\"></li><li value=\"79\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-keyword)\">return</span><span style=\"color: var(--shiki-color-text)\"> { Host</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> makeGuest</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> makeGuests</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> waitUntilDeadline };</span></li><li value=\"80\"><span style=\"color: var(--shiki-color-text)\">};</span></li></ol></pre>\n<p>\n  <i id=\"p_71\" class=\"pid\"></i>We close the definition of the Guest abstraction by calling <code>stdPerson</code> to add the <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">Person</span><span style=\"color: var(--shiki-color-text)\">.getBalance</span></span> function.\n  Then, we define <span class=\"snip\"><a href=\"/frontend/#js_Event\" title=\"js: Event\"><span style=\"color: var(--shiki-token-constant)\">Event</span></a><span style=\"color: var(--shiki-color-text)\">.makeGuests</span></span>, which produces a single promise out of the array of promises of Guest abstractions.\n  These values are all wrapped together into a final object, which is the result of <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">makeRSVP</span></span>.<a href=\"#p_71\" class=\"pid\">71</a>\n</p>\n<hr>\n<p>\n  <i id=\"p_72\" class=\"pid\"></i>At this point, we have a completely working DApp and testing framework.\n  But, turning this into a viable product and usable experience is more difficult.<a href=\"#p_72\" class=\"pid\">72</a>\n</p>\n<p><i id=\"p_73\" class=\"pid\"></i>Rather than do that, we're going to switch gears and show a different way to write this application that is a <em>centralized</em> DApp.<a href=\"#p_73\" class=\"pid\">73</a></p>\n<h2 id=\"tut-rsvp5-api\" class=\"refHeader\">The API and The Map<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#tut-rsvp5-api\"><span class=\"icon icon-link\"></span></a></h2>\n<p><i id=\"p_74\" class=\"pid\"></i>Recall that our previous version uses one instance for every Guest that goes to an Event and that this is tedious for the Host to communicate to the Guests what the Event details are and difficult for the Guests to communicate to the Host that they are intending to come and for the Host to note whether the Guests actually came.<a href=\"#p_74\" class=\"pid\">74</a></p>\n<p>\n  <i id=\"p_75\" class=\"pid\"></i>The key source of this tediousness is its over decentralization: the information is spread throughout the system and duplicated many times.\n  In some ways, this kind of decentralization is very valuable, because it means that there is not a single-point-of-failure, like how your body has many many different immune cells rather than a single giant immune cell.\n  However, that benefit is unnecessary when we are already running on a consensus network, where decentralization at the base layer provides trustlessness at the application layer.\n  Indeed, the difficulty of the over decentralized model leads some designer to build an off-chain centralized database, like a database of the active events, because it is so difficult to query the consensus network for matching application instances.\n  Those centralized databases become a trusted point-of-failure that are worthy targets of attack and exploitation.<a href=\"#p_75\" class=\"pid\">75</a>\n</p>\n<p><i id=\"p_76\" class=\"pid\"></i>Instead, we're going to write a version of RSVP using a single instance.<a href=\"#p_76\" class=\"pid\">76</a></p>\n<p>\n  <i id=\"p_77\" class=\"pid\"></i>If you're only familiar with Reach from the <a href=\"/tut/rps/#tut\">Rock, Paper, Scissors!</a> tutorial, then you should be wondering, \"But how are you going to let any number of Guests join? And where will you store their information?\"\n  We're going to use two new concepts to implement this:<a href=\"#p_77\" class=\"pid\">77</a>\n</p>\n<ol>\n  <li><i id=\"p_78\" class=\"pid\"></i>APIs --- which are a source of publications that do not originate in a participant are a source of asynchronous input events to the consensus network.<a href=\"#p_78\" class=\"pid\">78</a></li>\n  <li><i id=\"p_79\" class=\"pid\"></i>Mappings --- which are a database of values that grow linearly over the lifetime of the program.<a href=\"#p_79\" class=\"pid\">79</a></li>\n</ol>\n<p><i id=\"p_80\" class=\"pid\"></i>We will define an API that Guests can call to register for an Event and we'll define another API that the Host can call whenever they want to report whether a Guest showed up.<a href=\"#p_80\" class=\"pid\">80</a></p>\n<p><i id=\"p_81\" class=\"pid\"></i>We will define a Mapping that records whether a Guest has registered and we will clear that record when the Host reports their attendance.<a href=\"#p_81\" class=\"pid\">81</a></p>\n<p><i id=\"p_82\" class=\"pid\"></i>Since API publications do not come from participants, but could come from any number of actors in the consensus network, including other contracts, AND because Mappings can grow linearly in the number of actors that interact with the program, there is no limit to the number of Guests!<a href=\"#p_82\" class=\"pid\">82</a></p>\n<p><i id=\"p_83\" class=\"pid\"></i>The overall structure of our application will be:<a href=\"#p_83\" class=\"pid\">83</a></p>\n<ol>\n  <li><i id=\"p_84\" class=\"pid\"></i>The Host creates an application instance.<a href=\"#p_84\" class=\"pid\">84</a></li>\n  <li><i id=\"p_85\" class=\"pid\"></i>Guests repeatedly make reservations, before the deadline.<a href=\"#p_85\" class=\"pid\">85</a></li>\n  <li><i id=\"p_86\" class=\"pid\"></i>The Host repeatedly reports whether Guests come.<a href=\"#p_86\" class=\"pid\">86</a></li>\n  <li><i id=\"p_87\" class=\"pid\"></i>The program ends when all reserved Guests are accounted for.<a href=\"#p_87\" class=\"pid\">87</a></li>\n</ol>\n<h2 id=\"tut-rsvp5-rsh\" class=\"refHeader\">Programming with APIs and Maps<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#tut-rsvp5-rsh\"><span class=\"icon icon-link\"></span></a></h2>\n<p><i id=\"p_88\" class=\"pid\"></i>Let's dig into the code!<a href=\"#p_88\" class=\"pid\">88</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-5-cede/index.rsh\">/examples/rsvp-5-cede/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"'reach 0.1';\n'use strict';\n\nconst Details = Object({\n  name: Bytes(128),\n  reservation: UInt,\n  deadline: UInt,\n  host: Address,\n});\" href=\"#\" id=\"copyBtn21\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: var(--shiki-token-string-expression)\">'reach 0.1'</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"2\"><a href=\"/rsh/compute/#rsh_'use%20strict'\" title=\"rsh: 'use strict'\"><span style=\"color: var(--shiki-token-string-expression)\">'use strict'</span></a><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"3\"></li><li value=\"4\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Details</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Object\" title=\"rsh: Object\"><span style=\"color: var(--shiki-token-constant)\">Object</span></a><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"5\"><span style=\"color: var(--shiki-color-text)\">  name</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Bytes\" title=\"rsh: Bytes\"><span style=\"color: var(--shiki-token-function)\">Bytes</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">128</span><span style=\"color: var(--shiki-color-text)\">)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"6\"><span style=\"color: var(--shiki-color-text)\">  reservation</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> UInt</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"7\"><span style=\"color: var(--shiki-color-text)\">  deadline</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> UInt</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"8\"><span style=\"color: var(--shiki-color-text)\">  host</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"9\"><span style=\"color: var(--shiki-color-text)\">});</span></li></ol></pre>\n<p><i id=\"p_89\" class=\"pid\"></i>We define an object for the details of the Event, which is the same as before.<a href=\"#p_89\" class=\"pid\">89</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-5-cede/index.rsh\">/examples/rsvp-5-cede/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"export const main = Reach.App(() => {\n  const Admin = Participant('Admin', {\n    details: Details,\n    launched: Fun([Contract], Null),\n  });\n  const Guest = API('Guest', {\n    register: Fun([], Null),\n  });\n  const Host = API('Host', {\n    checkin: Fun([Address, Bool], Null),\n  });\n  init();\" href=\"#\" id=\"copyBtn22\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"11\"><a href=\"/rsh/module/#rsh_export\" title=\"rsh: export\"><span style=\"color: var(--shiki-token-keyword)\">export</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">main</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/module/#rsh_Reach\" title=\"rsh: Reach\"><span style=\"color: var(--shiki-token-constant)\">Reach</span></a><a href=\"/rsh/module/#rsh_Reach.App\" title=\"rsh: Reach.App\"><span style=\"color: var(--shiki-token-function)\">.App</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"12\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Admin</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_Participant\" title=\"rsh: Participant\"><span style=\"color: var(--shiki-token-function)\">Participant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Admin'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"13\"><span style=\"color: var(--shiki-color-text)\">    details</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> Details</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"14\"><span style=\"color: var(--shiki-color-text)\">    launched</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Contract]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Null)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"15\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"16\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Guest</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_API\" title=\"rsh: API\"><span style=\"color: var(--shiki-token-function)\">API</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Guest'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"17\"><span style=\"color: var(--shiki-color-text)\">    register</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Null)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"18\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"19\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Host</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_API\" title=\"rsh: API\"><span style=\"color: var(--shiki-token-function)\">API</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Host'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"20\"><span style=\"color: var(--shiki-color-text)\">    checkin</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bool]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Null)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"21\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"22\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/appinit/#rsh_init\" title=\"rsh: init\"><span style=\"color: var(--shiki-token-function)\">init</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li></ol></pre>\n<p><i id=\"p_90\" class=\"pid\"></i>We define the participant and then the two APIs.<a href=\"#p_90\" class=\"pid\">90</a></p>\n<ul>\n  <li>\n    <i id=\"p_91\" class=\"pid\"></i>The participant, <code>Admin</code>, is the one that actually creates the instance.\n    In most cases, this will be the Host, but we don't restrict it so it has to be the same person.<a href=\"#p_91\" class=\"pid\">91</a>\n  </li>\n  <li>\n    <i id=\"p_92\" class=\"pid\"></i>The first API, <code>Guest</code>, is for Guests to call and it has just a single function.\n    On-chain, this function will be callable as <code>Guest_register</code>, according to whatever the ABI standard is for the chain.\n    Off-chain, Reach provides an interface in its standard library to call it as <span class=\"snip\"><a href=\"/frontend/#js_ctc\" title=\"js: ctc\"><span style=\"color: var(--shiki-token-constant)\">ctc</span></a><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/frontend/#js_ctc.apis\" title=\"js: ctc.apis\"><span style=\"color: var(--shiki-token-constant)\">apis</span></a><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">Guest</span><span style=\"color: var(--shiki-token-function)\">.register</span><span style=\"color: var(--shiki-color-text)\">()</span></span>.<a href=\"#p_92\" class=\"pid\">92</a>\n  </li>\n  <li>\n    <i id=\"p_93\" class=\"pid\"></i>The second API, <code>Host</code> is for the Host to call as they check-in (or note the failure to show) of Guests.\n    It takes two arguments: the first for who the Guest is and the second for whether they showed up, or not.\n    It can be called on-chain as <code>Host_checkin</code> and off-chain with <span class=\"snip\"><a href=\"/frontend/#js_ctc\" title=\"js: ctc\"><span style=\"color: var(--shiki-token-constant)\">ctc</span></a><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/frontend/#js_ctc.apis\" title=\"js: ctc.apis\"><span style=\"color: var(--shiki-token-constant)\">apis</span></a><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">Host</span><span style=\"color: var(--shiki-token-function)\">.checkin</span><span style=\"color: var(--shiki-color-text)\">(guest</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> showed)</span></span>.<a href=\"#p_93\" class=\"pid\">93</a>\n  </li>\n</ul>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-5-cede/index.rsh\">/examples/rsvp-5-cede/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  Admin.only(() => {\n    const details = declassify(interact.details);\n  });\n  Admin.publish(details);\n  const { reservation, deadline, host } = details;\n  enforce( thisConsensusTime() < deadline, &quot;too late&quot; );\n  Admin.interact.launched(getContract());\" href=\"#\" id=\"copyBtn23\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"24\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">Admin</span><a href=\"/rsh/step/#rsh_only\" title=\"rsh: only\"><span style=\"color: var(--shiki-token-function)\">.only</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"25\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">details</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: var(--shiki-token-function)\">declassify</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-color-text)\">.details);</span></li><li value=\"26\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"27\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">Admin</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">(details);</span></li><li value=\"28\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> { </span><span style=\"color: var(--shiki-token-constant)\">reservation</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">deadline</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">host</span><span style=\"color: var(--shiki-color-text)\"> } </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> details;</span></li><li value=\"29\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_enforce\" title=\"rsh: enforce\"><span style=\"color: var(--shiki-token-function)\">enforce</span></a><span style=\"color: var(--shiki-color-text)\">( </span><a href=\"/rsh/compute/#rsh_thisConsensusTime\" title=\"rsh: thisConsensusTime\"><span style=\"color: var(--shiki-token-function)\">thisConsensusTime</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_%3C\" title=\"rsh: <\"><span style=\"color: var(--shiki-token-keyword)\">&lt;</span></a><span style=\"color: var(--shiki-color-text)\"> deadline</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"too late\"</span><span style=\"color: var(--shiki-color-text)\"> );</span></li><li value=\"30\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">Admin</span><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.launched</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_getContract\" title=\"rsh: getContract\"><span style=\"color: var(--shiki-token-function)\">getContract</span></a><span style=\"color: var(--shiki-color-text)\">());</span></li></ol></pre>\n<p>\n  <i id=\"p_94\" class=\"pid\"></i>We publish the details, unpack them, and signal to the creator that the contract has been launched.\n  However, we do <em>not</em> <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">()</span></span>, because we are going to do something else in the consensus.<a href=\"#p_94\" class=\"pid\">94</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-5-cede/index.rsh\">/examples/rsvp-5-cede/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const Guests = new Map(Bool);\n  const [ done, howMany ] =\n    parallelReduce([ false, 0 ])\n    .invariant( Guests.size() == howMany, &quot;howMany accurate&quot; )\" href=\"#\" id=\"copyBtn24\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"32\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Guests</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_new\" title=\"rsh: new\"><span style=\"color: var(--shiki-token-keyword)\">new</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a><span style=\"color: var(--shiki-color-text)\">(Bool);</span></li><li value=\"33\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><span style=\"color: var(--shiki-token-constant)\">done</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">howMany</span><span style=\"color: var(--shiki-color-text)\"> ] </span><span style=\"color: var(--shiki-token-keyword)\">=</span></li><li value=\"34\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-token-function)\">parallelReduce</span></a><span style=\"color: var(--shiki-color-text)\">([ </span><a href=\"/rsh/compute/#rsh_false\" title=\"rsh: false\"><span style=\"color: var(--shiki-token-constant)\">false</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\"> ])</span></li><li value=\"35\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_parallelReduce.invariant\" title=\"rsh: parallelReduce.invariant\"><span style=\"color: var(--shiki-token-function)\">.invariant</span></a><span style=\"color: var(--shiki-color-text)\">( </span><span style=\"color: var(--shiki-token-constant)\">Guests</span><a href=\"/rsh/compute/#rsh_Map.size\" title=\"rsh: Map.size\"><span style=\"color: var(--shiki-token-function)\">.size</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> howMany</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"howMany accurate\"</span><span style=\"color: var(--shiki-color-text)\"> )</span></li></ol></pre>\n<p>\n  <i id=\"p_95\" class=\"pid\"></i>This is a very dense code sample with lots of new ideas if you're only familiar with basic Reach.\n  It is worth studying closely, because these ideas are used over and over in complex Reach programs.<a href=\"#p_95\" class=\"pid\">95</a>\n</p>\n<p>\n  <i id=\"p_96\" class=\"pid\"></i>First, we define a new <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a></span> that stores a boolean value for each address used as a key.\n  We're going to use this to store the set of Guest accounts.\n  (There is a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_Set\" title=\"rsh: Set\"><span style=\"color: var(--shiki-token-constant)\">Set</span></a></span> container available too that abstracts this pattern, but we're going to show the \"raw\" version to explain mappings in detail.)<a href=\"#p_96\" class=\"pid\">96</a>\n</p>\n<p>\n  <i id=\"p_97\" class=\"pid\"></i>We can set entries in the mapping by writing <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">Guests[addr] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> bool</span></span> (or <span class=\"snip\"><a href=\"/rsh/errors/#rsh_delete\" title=\"rsh: delete\"><span style=\"color: var(--shiki-token-keyword)\">delete</span></a><span style=\"color: var(--shiki-color-text)\"> Guests[addr]</span></span> to remove them).\n  We will be able to access entries of the mapping by writing <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">Guests[addr]</span></span>, which will evaluate to a <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Maybe\" title=\"rsh: Maybe\"><span style=\"color: var(--shiki-token-function)\">Maybe</span></a><span style=\"color: var(--shiki-color-text)\">(Bool)</span></span> value.\n  It will be <span class=\"snip\"><span style=\"color: var(--shiki-token-function)\">None</span><span style=\"color: var(--shiki-color-text)\">()</span></span> if the value is not set.\n  It will be <span class=\"snip\"><span style=\"color: var(--shiki-token-function)\">Some</span><span style=\"color: var(--shiki-color-text)\">(bool)</span></span> if the value is set.<a href=\"#p_97\" class=\"pid\">97</a>\n</p>\n<div class=\"note\">\n  <p><i id=\"p_98\" class=\"pid\"></i>Some people find <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Maybe\" title=\"rsh: Maybe\"><span style=\"color: var(--shiki-color-text)\">Maybe</span></a></span>s to be tedious, but they are an important protection against NULL pointer dereferences that you see in other systems.<a href=\"#p_98\" class=\"pid\">98</a></p>\n  <p>\n    <i id=\"p_99\" class=\"pid\"></i>You may enjoy reading Sir Tony Hoare's <a href=\"https://en.wikipedia.org/wiki/Null_pointer#History\">explanation</a> about how and why he created NULL pointers and why he has regretted it ever since.\n    We think his cost estimate of the damage of NULL pointers at one billion dollars is too low by an order of magnitude.<a href=\"#p_99\" class=\"pid\">99</a>\n  </p>\n</div>\n<p>\n  <i id=\"p_100\" class=\"pid\"></i>Second, we start a \"parallel reduce\" block.\n  In computer science, a <a href=\"https://en.wikipedia.org/wiki/Reduction_operator\">reduction</a> is when a set of data is turned into a single value; i.e. it is <em>reduced</em> to one value.\n  For example, if you have a set of numbers, and you add them together, to get the sum, that's a reduction.\n  In this case, we are reducing a set of input events (API calls) that occur in <em>parallel</em> to each other (meaning that they are independently chosen by their initiators) into two values, <code>done</code> and <code>howMany</code>.\n  <code>done</code> is going to be a boolean that tells us if the Event is over and we can clear it from memory; it starts as <span class=\"snip\"><a href=\"/rsh/compute/#rsh_false\" title=\"rsh: false\"><span style=\"color: var(--shiki-token-constant)\">false</span></a></span>.\n  <code>howMany</code> is a running counter of how many Guests have registered, but have not checked in; it starts as <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">0</span></span>.\n  Shortly, we'll review the code that actually reduces incoming events into updated versions of these values.<a href=\"#p_100\" class=\"pid\">100</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-5-cede/index.rsh\">/examples/rsvp-5-cede/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    parallelReduce([ false, 0 ])\n    .invariant( Guests.size() == howMany, &quot;howMany accurate&quot; )\n    .invariant( balance() == howMany * reservation, &quot;balance accurate&quot; )\n    .while( ! ( done &amp;&amp; howMany == 0 ) )\" href=\"#\" id=\"copyBtn25\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"34\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-token-function)\">parallelReduce</span></a><span style=\"color: var(--shiki-color-text)\">([ </span><a href=\"/rsh/compute/#rsh_false\" title=\"rsh: false\"><span style=\"color: var(--shiki-token-constant)\">false</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\"> ])</span></li><li value=\"35\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_parallelReduce.invariant\" title=\"rsh: parallelReduce.invariant\"><span style=\"color: var(--shiki-token-function)\">.invariant</span></a><span style=\"color: var(--shiki-color-text)\">( </span><span style=\"color: var(--shiki-token-constant)\">Guests</span><a href=\"/rsh/compute/#rsh_size\" title=\"rsh: size\"><span style=\"color: var(--shiki-token-function)\">.size</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> howMany</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"howMany accurate\"</span><span style=\"color: var(--shiki-color-text)\"> )</span></li><li value=\"36\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_parallelReduce.invariant\" title=\"rsh: parallelReduce.invariant\"><span style=\"color: var(--shiki-token-function)\">.invariant</span></a><span style=\"color: var(--shiki-color-text)\">( </span><a href=\"/rsh/compute/#rsh_balance\" title=\"rsh: balance\"><span style=\"color: var(--shiki-token-function)\">balance</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> howMany </span><a href=\"/rsh/compute/#rsh_*\" title=\"rsh: *\"><span style=\"color: var(--shiki-token-keyword)\">*</span></a><span style=\"color: var(--shiki-color-text)\"> reservation</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"balance accurate\"</span><span style=\"color: var(--shiki-color-text)\"> )</span></li><li value=\"37\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_parallelReduce.while\" title=\"rsh: parallelReduce.while\"><span style=\"color: var(--shiki-token-function)\">.while</span></a><span style=\"color: var(--shiki-color-text)\">( </span><a href=\"/rsh/compute/#rsh_!\" title=\"rsh: !\"><span style=\"color: var(--shiki-token-keyword)\">!</span></a><span style=\"color: var(--shiki-color-text)\"> ( done </span><a href=\"/rsh/compute/#rsh_&amp;&amp;\" title=\"rsh: &amp;&amp;\"><span style=\"color: var(--shiki-token-keyword)\">&amp;&amp;</span></a><span style=\"color: var(--shiki-color-text)\"> howMany </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\"> ) )</span></li></ol></pre>\n<p>\n  <i id=\"p_101\" class=\"pid\"></i>Every <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-color-text)\">parallelReduce</span></a></span> can be written as a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-keyword)\">while</span></a></span> loop, but it is often more convenient to think about it as a separate kind of construct.\n  Because it is a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-keyword)\">while</span></a></span> loop, it must have a condition for when it terminates (a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-color-text)\">.while</span></a></span> component) and loop invariants (a sequence of <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_invariant\" title=\"rsh: invariant\"><span style=\"color: var(--shiki-color-text)\">.invariant</span></a></span> components).\n  In our case, we have two invariants and one condition.<a href=\"#p_101\" class=\"pid\">101</a>\n</p>\n<ul>\n  <li><i id=\"p_102\" class=\"pid\"></i>The first invariant is that the variable <code>howMany</code> is the same as the size of the <code>Guests</code> mapping.<a href=\"#p_102\" class=\"pid\">102</a></li>\n  <li><i id=\"p_103\" class=\"pid\"></i>The second invariant is that the contract's balance is the same as <code>howMany</code> times the number of reservations; in other words, that we can perfectly predict how much funds are in the contract's account.<a href=\"#p_103\" class=\"pid\">103</a></li>\n  <li>\n    <i id=\"p_104\" class=\"pid\"></i>The condition is that we will continue accepting (and reducing!) input events until\n    we are done <em>and</em> <code>howMany</code> is zero; because only then is it safe to turn off the ability to check in Guests.<a href=\"#p_104\" class=\"pid\">104</a>\n  </li>\n</ul>\n<p><i id=\"p_105\" class=\"pid\"></i>We can now show the reduction blocks for each different kind of input event.<a href=\"#p_105\" class=\"pid\">105</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-5-cede/index.rsh\">/examples/rsvp-5-cede/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    .api_(Guest.register, () => {\n      check(! done, &quot;event started&quot;);\n      check(isNone(Guests[this]), &quot;already registered&quot;);\n      return [ reservation, (ret) => {\n        enforce( thisConsensusTime() < deadline, &quot;too late&quot; );\n        Guests[this] = true;\n        ret(null);\n        return [ false, howMany + 1 ];\n      } ];\n    })\" href=\"#\" id=\"copyBtn26\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"38\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-function)\">.api_</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">Guest</span><span style=\"color: var(--shiki-color-text)\">.register</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"39\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_!\" title=\"rsh: !\"><span style=\"color: var(--shiki-token-keyword)\">!</span></a><span style=\"color: var(--shiki-color-text)\"> done</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"event started\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"40\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_isNone\" title=\"rsh: isNone\"><span style=\"color: var(--shiki-token-function)\">isNone</span></a><span style=\"color: var(--shiki-color-text)\">(Guests[</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-color-text)\">])</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"already registered\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"41\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [ reservation</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (ret) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"42\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/compute/#rsh_enforce\" title=\"rsh: enforce\"><span style=\"color: var(--shiki-token-function)\">enforce</span></a><span style=\"color: var(--shiki-color-text)\">( </span><a href=\"/rsh/compute/#rsh_thisConsensusTime\" title=\"rsh: thisConsensusTime\"><span style=\"color: var(--shiki-token-function)\">thisConsensusTime</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_%3C\" title=\"rsh: <\"><span style=\"color: var(--shiki-token-keyword)\">&lt;</span></a><span style=\"color: var(--shiki-color-text)\"> deadline</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"too late\"</span><span style=\"color: var(--shiki-color-text)\"> );</span></li><li value=\"43\"><span style=\"color: var(--shiki-color-text)\">        Guests[</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-color-text)\">] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"44\"><span style=\"color: var(--shiki-color-text)\">        </span><span style=\"color: var(--shiki-token-function)\">ret</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_null\" title=\"rsh: null\"><span style=\"color: var(--shiki-token-constant)\">null</span></a><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"45\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><a href=\"/rsh/compute/#rsh_false\" title=\"rsh: false\"><span style=\"color: var(--shiki-token-constant)\">false</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> howMany </span><a href=\"/rsh/compute/#rsh_+\" title=\"rsh: +\"><span style=\"color: var(--shiki-token-keyword)\">+</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\"> ];</span></li><li value=\"46\"><span style=\"color: var(--shiki-color-text)\">      } ];</span></li><li value=\"47\"><span style=\"color: var(--shiki-color-text)\">    })</span></li></ol></pre>\n<p>\n  <i id=\"p_106\" class=\"pid\"></i>This uses a new form you've never seen before: the <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">.api_</span></span> component.\n  It has two arguments:<a href=\"#p_106\" class=\"pid\">106</a>\n</p>\n<ol>\n  <li><i id=\"p_107\" class=\"pid\"></i>First, there's the API call that is actually being handled; in this case, the <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">Guest</span><span style=\"color: var(--shiki-color-text)\">.register</span></span> call.<a href=\"#p_107\" class=\"pid\">107</a></li>\n  <li><i id=\"p_108\" class=\"pid\"></i>Second, there's a function that accepts the arguments to call (in this case there are none) and specifies the action.<a href=\"#p_108\" class=\"pid\">108</a></li>\n</ol>\n<p><i id=\"p_109\" class=\"pid\"></i>The action specification function is made of two parts:<a href=\"#p_109\" class=\"pid\">109</a></p>\n<ol>\n  <li>\n    <i id=\"p_110\" class=\"pid\"></i>First, there's a sequence of <span class=\"snip\"><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-color-text)\">check</span></a></span>s that validate whether the API can be validly called.\n    In this case, we check to ensure that the Event hasn't started and that the Guest has not registered (by using the function <span class=\"snip\"><a href=\"/rsh/compute/#rsh_isNone\" title=\"rsh: isNone\"><span style=\"color: var(--shiki-color-text)\">isNone</span></a></span> to test the contents of the mapping).\n    Although we don't in this example, you can define values here that are used later in the reduction handler.<a href=\"#p_110\" class=\"pid\">110</a>\n  </li>\n  <li>\n    <i id=\"p_111\" class=\"pid\"></i>Second, there's a <span class=\"snip\"><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a></span> that specifies (a) what should be paid when this call is made, and (b) what happens in the consensus when it is called, specified as a function.\n    In this case, we have to pay the reservation price.<a href=\"#p_111\" class=\"pid\">111</a>\n  </li>\n</ol>\n<p>\n  <i id=\"p_112\" class=\"pid\"></i>The consensus reduction specification function accepts an argument (traditionally labeled <code>ret</code> (for \"return\") or <code>k</code> (for \"continuation\")) that must be called with the API call result.\n  The function can then perform any additional checks or effects, before yielding the result (by invoking <code>ret</code>) and then returning updated values for the reduction.<a href=\"#p_112\" class=\"pid\">112</a>\n</p>\n<p><i id=\"p_113\" class=\"pid\"></i>In this case, the function<a href=\"#p_113\" class=\"pid\">113</a></p>\n<ol>\n  <li><i id=\"p_114\" class=\"pid\"></i>ensures that it is not too late;<a href=\"#p_114\" class=\"pid\">114</a></li>\n  <li><i id=\"p_115\" class=\"pid\"></i>stores that the Guest is coming in the mapping;<a href=\"#p_115\" class=\"pid\">115</a></li>\n  <li><i id=\"p_116\" class=\"pid\"></i>yield <span class=\"snip\"><a href=\"/rsh/compute/#rsh_null\" title=\"rsh: null\"><span style=\"color: var(--shiki-token-constant)\">null</span></a></span> to the API caller; and,<a href=\"#p_116\" class=\"pid\">116</a></li>\n  <li><i id=\"p_117\" class=\"pid\"></i>increments the count of the number of Guests, <code>howMany</code>.<a href=\"#p_117\" class=\"pid\">117</a></li>\n</ol>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-5-cede/index.rsh\">/examples/rsvp-5-cede/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    .api_(Host.checkin, (guest, showed) => {\n      check(this == host, &quot;not the host&quot;);\n      check(isSome(Guests[guest]), &quot;no reservation&quot;);\n      return [ 0, (ret) => {\n        enforce( thisConsensusTime() >= deadline, &quot;too early&quot; );\n        delete Guests[guest];\n        transfer(reservation).to(showed ? guest : host);\n        ret(null);\n        return [ true, howMany - 1 ];\n      } ];\n    });\" href=\"#\" id=\"copyBtn27\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"48\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-function)\">.api_</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">Host</span><span style=\"color: var(--shiki-color-text)\">.checkin</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (guest</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> showed) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"49\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> host</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"not the host\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"50\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_isSome\" title=\"rsh: isSome\"><span style=\"color: var(--shiki-token-function)\">isSome</span></a><span style=\"color: var(--shiki-color-text)\">(Guests[guest])</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"no reservation\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"51\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (ret) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"52\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/compute/#rsh_enforce\" title=\"rsh: enforce\"><span style=\"color: var(--shiki-token-function)\">enforce</span></a><span style=\"color: var(--shiki-color-text)\">( </span><a href=\"/rsh/compute/#rsh_thisConsensusTime\" title=\"rsh: thisConsensusTime\"><span style=\"color: var(--shiki-token-function)\">thisConsensusTime</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_%3E=\" title=\"rsh: >=\"><span style=\"color: var(--shiki-token-keyword)\">&gt;=</span></a><span style=\"color: var(--shiki-color-text)\"> deadline</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"too early\"</span><span style=\"color: var(--shiki-color-text)\"> );</span></li><li value=\"53\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/errors/#rsh_delete\" title=\"rsh: delete\"><span style=\"color: var(--shiki-token-keyword)\">delete</span></a><span style=\"color: var(--shiki-color-text)\"> Guests[guest];</span></li><li value=\"54\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/consensus/#rsh_transfer\" title=\"rsh: transfer\"><span style=\"color: var(--shiki-token-function)\">transfer</span></a><span style=\"color: var(--shiki-color-text)\">(reservation)</span><a href=\"/rsh/consensus/#rsh_transfer.to\" title=\"rsh: transfer.to\"><span style=\"color: var(--shiki-token-function)\">.to</span></a><span style=\"color: var(--shiki-color-text)\">(showed </span><a href=\"/rsh/compute/#rsh_?\" title=\"rsh: ?\"><span style=\"color: var(--shiki-token-keyword)\">?</span></a><span style=\"color: var(--shiki-color-text)\"> guest </span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> host);</span></li><li value=\"55\"><span style=\"color: var(--shiki-color-text)\">        </span><span style=\"color: var(--shiki-token-function)\">ret</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_null\" title=\"rsh: null\"><span style=\"color: var(--shiki-token-constant)\">null</span></a><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"56\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> howMany </span><a href=\"/rsh/compute/#rsh_-\" title=\"rsh: -\"><span style=\"color: var(--shiki-token-keyword)\">-</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\"> ];</span></li><li value=\"57\"><span style=\"color: var(--shiki-color-text)\">      } ];</span></li><li value=\"58\"><span style=\"color: var(--shiki-color-text)\">    });</span></li></ol></pre>\n<p>\n  <i id=\"p_118\" class=\"pid\"></i>The Host checkin function is similar.\n  It accepts the Guest's address and whether the Host is reporting that they showed up or not.\n  It ensures that the initiator of the API call is the Host.\n  It ensures that the named Guest actually made a reservation.\n  It does not make the Host pay anything.\n  It ensures that the Host is doing this after the deadline.\n  It removes the Guest's entry from the mapping.\n  It transfers the reservation fee to either the Guest or the Host, depending on the value of <code>showed</code>.\n  And, finally, it decrements the Guest counter and indicates that Event has started.<a href=\"#p_118\" class=\"pid\">118</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-5-cede/index.rsh\">/examples/rsvp-5-cede/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  commit();\n\n  exit();\n});\" href=\"#\" id=\"copyBtn28\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"59\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"60\"></li><li value=\"61\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/step/#rsh_exit\" title=\"rsh: exit\"><span style=\"color: var(--shiki-token-function)\">exit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"62\"><span style=\"color: var(--shiki-color-text)\">});</span></li></ol></pre>\n<p>\n  <i id=\"p_119\" class=\"pid\"></i>Finally we close the applications.\n  We don't need to do any final <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_transfer\" title=\"rsh: transfer\"><span style=\"color: var(--shiki-color-text)\">transfer</span></a></span>s or anything like that to satisfy the token linearity property (which enforces that the contract's account is empty when it ends), because we know that we only reach the end of the <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-color-text)\">parallelReduce</span></a></span> when <code>howMany</code> is zero, and we know that the contract balance is <code>howMany * reservation</code>, so it must be zero in that case too.<a href=\"#p_119\" class=\"pid\">119</a>\n</p>\n<hr>\n<p><i id=\"p_120\" class=\"pid\"></i>Although we did not dwell on the verification of this program, nearly every line in the program is essential in some way and many of them are essential for passing the verification engine.<a href=\"#p_120\" class=\"pid\">120</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-5-cede/index-fail.rsh\">/examples/rsvp-5-cede/index-fail.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    .api_(HostP.checkin, (guest, showed) => {\n      check(this == host, &quot;not the host&quot;);\n      check(isSome(Guests[guest]), &quot;no reservation&quot;);\n      return [ 0, (ret) => {\n        enforce( thisConsensusTime() >= deadline, &quot;too early&quot; );\n        //delete Guests[guest];\n        transfer(reservation).to(showed ? guest : Host);\n        ret(null);\n        return [ true, howMany - 1 ];\n      } ];\n    });\" href=\"#\" id=\"copyBtn29\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"48\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-function)\">.api_</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">HostP</span><span style=\"color: var(--shiki-color-text)\">.checkin</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (guest</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> showed) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"49\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> host</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"not the host\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"50\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_isSome\" title=\"rsh: isSome\"><span style=\"color: var(--shiki-token-function)\">isSome</span></a><span style=\"color: var(--shiki-color-text)\">(Guests[guest])</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"no reservation\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"51\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (ret) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"52\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/compute/#rsh_enforce\" title=\"rsh: enforce\"><span style=\"color: var(--shiki-token-function)\">enforce</span></a><span style=\"color: var(--shiki-color-text)\">( </span><a href=\"/rsh/compute/#rsh_thisConsensusTime\" title=\"rsh: thisConsensusTime\"><span style=\"color: var(--shiki-token-function)\">thisConsensusTime</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_%3E=\" title=\"rsh: >=\"><span style=\"color: var(--shiki-token-keyword)\">&gt;=</span></a><span style=\"color: var(--shiki-color-text)\"> deadline</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"too early\"</span><span style=\"color: var(--shiki-color-text)\"> );</span></li><li value=\"53\"><span style=\"color: var(--shiki-color-text)\">        </span><span style=\"color: var(--shiki-token-comment)\">//delete Guests[guest];</span></li><li value=\"54\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/consensus/#rsh_transfer\" title=\"rsh: transfer\"><span style=\"color: var(--shiki-token-function)\">transfer</span></a><span style=\"color: var(--shiki-color-text)\">(reservation)</span><a href=\"/rsh/consensus/#rsh_transfer.to\" title=\"rsh: transfer.to\"><span style=\"color: var(--shiki-token-function)\">.to</span></a><span style=\"color: var(--shiki-color-text)\">(showed </span><a href=\"/rsh/compute/#rsh_?\" title=\"rsh: ?\"><span style=\"color: var(--shiki-token-keyword)\">?</span></a><span style=\"color: var(--shiki-color-text)\"> guest </span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> Host);</span></li><li value=\"55\"><span style=\"color: var(--shiki-color-text)\">        </span><span style=\"color: var(--shiki-token-function)\">ret</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_null\" title=\"rsh: null\"><span style=\"color: var(--shiki-token-constant)\">null</span></a><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"56\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> howMany </span><a href=\"/rsh/compute/#rsh_-\" title=\"rsh: -\"><span style=\"color: var(--shiki-token-keyword)\">-</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\"> ];</span></li><li value=\"57\"><span style=\"color: var(--shiki-color-text)\">      } ];</span></li><li value=\"58\"><span style=\"color: var(--shiki-color-text)\">    });</span></li></ol></pre>\n<p>\n  <i id=\"p_121\" class=\"pid\"></i>For example, suppose that we neglected to delete the Guest's reservation entry.\n  This means that we will decrement <code>howMany</code> without changing the size of the mapping, so one of the loop invariants will be incorrect.\n  Reach will detect this error and show the following error during verification:<a href=\"#p_121\" class=\"pid\">121</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-5-cede/index-fail.txt\">/examples/rsvp-5-cede/index-fail.txt</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"Verification failed:\n  when ALL participants are honest\n  of theorem: while invariant after loop\n  msg: &quot;howMany accurate&quot;\n  at ./index-fail.rsh:35:17:invariant\n\n  // Violation Witness\n\n  const UInt.max = 2;\n\n  const howMany/737 = <loop variable>;\n  //    ^ could = 1\n  //      from: ./index-fail.rsh:34:19:while\n  const v1105 = <map reduction>;\n  //    ^ could = 1\n  //      from: reach standard library:170:21:application\n\n  // Theorem Formalization\n\n  const v1112 = v1105 == (howMany/737 - 1);\n  //    ^ would be false\n  assert(v1112);\" href=\"#\" id=\"copyBtn30\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"4\">Verification failed:</li><li value=\"5\">  when ALL participants are honest</li><li value=\"6\">  of theorem: while invariant after loop</li><li value=\"7\">  msg: \"howMany accurate\"</li><li value=\"8\">  at ./index-fail.rsh:35:17:invariant</li><li value=\"9\"></li><li value=\"10\">  // Violation Witness</li><li value=\"11\"></li><li value=\"12\">  const UInt.max = 2;</li><li value=\"13\"></li><li value=\"14\">  const howMany/737 = &lt;loop variable&gt;;</li><li value=\"15\">  //    ^ could = 1</li><li value=\"16\">  //      from: ./index-fail.rsh:34:19:while</li><li value=\"17\">  const v1105 = &lt;map reduction&gt;;</li><li value=\"18\">  //    ^ could = 1</li><li value=\"19\">  //      from: reach standard library:170:21:application</li><li value=\"20\"></li><li value=\"21\">  // Theorem Formalization</li><li value=\"22\"></li><li value=\"23\">  const v1112 = v1105 == (howMany/737 - 1);</li><li value=\"24\">  //    ^ would be false</li><li value=\"25\">  assert(v1112);</li></ol></pre>\n<p>\n  <i id=\"p_122\" class=\"pid\"></i>This program is interesting, because the invariants and assertions are set up in such a way that almost no other program could possibly satisfy them.\n  In general, this is a good property to seek when you're writing trust-worthy software: you want any change to be detected by your verification engine and test suite.<a href=\"#p_122\" class=\"pid\">122</a>\n</p>\n<h2 id=\"tut-rsvp5-mjs\" class=\"refHeader\">Testing our APIs and Maps<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#tut-rsvp5-mjs\"><span class=\"icon icon-link\"></span></a></h2>\n<p>\n  <i id=\"p_123\" class=\"pid\"></i>We've just walked through the Reach implementation of the RSVP application using APIs and Maps.\n  But, now we need to show the updates to our testing framework that work with the new implementation.<a href=\"#p_123\" class=\"pid\">123</a>\n</p>\n<p><i id=\"p_124\" class=\"pid\"></i>The program starts exactly the same as before:<a href=\"#p_124\" class=\"pid\">124</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-5-cede/index.mjs\">/examples/rsvp-5-cede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"import { loadStdlib, test } from '@reach-sh/stdlib';\nimport * as backend from './build/index.main.mjs';\n\n// Basics\nconst stdlib = loadStdlib({ REACH_NO_WARN: 'Y' });\nconst err = {\n  'ETH': 'transaction may fail',\n  'ALGO': 'assert failed',\n  'CFX': 'transaction is reverted',\n}[stdlib.connector];\n\n// Framework\nconst makeRSVP = async ({ hostLabel, name, reservation, timeLimit }) => {\n  const sbal = stdlib.parseCurrency(100);\n  const accHost = await stdlib.newTestAccount(sbal);\n  accHost.setDebugLabel(hostLabel);\n\n  const stdPerson = (obj) => {\n    const { acc } = obj;\n    const getBalance = async () => {\n      const bal = await acc.balanceOf();\n      return `${stdlib.formatCurrency(bal, 4)} ${stdlib.standardUnit}`;\n    };\n    return {\n      ...obj,\n      getBalance,\n    };\n  };\n\n  const Host = stdPerson({\n    acc: accHost,\n    label: hostLabel,\n  });\n\n  const deadline = (await stdlib.getNetworkTime()).add(timeLimit);\n  const waitUntilDeadline = async () => {\n    console.log(`Waiting until ${deadline}`);\n    await stdlib.waitUntilTime(deadline);\n  };\n\n  const details = {\n    name, reservation, deadline, host: accHost,\n  };\" href=\"#\" id=\"copyBtn31\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import\" title=\"js: import\"><span style=\"color: var(--shiki-token-keyword)\">import</span></a><span style=\"color: var(--shiki-color-text)\"> { loadStdlib</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> test } </span><span style=\"color: var(--shiki-token-keyword)\">from</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'@reach-sh/stdlib'</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"2\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import\" title=\"js: import\"><span style=\"color: var(--shiki-token-keyword)\">import</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">*</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">as</span><span style=\"color: var(--shiki-color-text)\"> backend </span><span style=\"color: var(--shiki-token-keyword)\">from</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'./build/index.main.mjs'</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"3\"></li><li value=\"4\"><span style=\"color: var(--shiki-token-comment)\">// Basics</span></li><li value=\"5\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_loadStdlib\" title=\"js: loadStdlib\"><span style=\"color: var(--shiki-token-function)\">loadStdlib</span></a><span style=\"color: var(--shiki-color-text)\">({ REACH_NO_WARN</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'Y'</span><span style=\"color: var(--shiki-color-text)\"> });</span></li><li value=\"6\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">err</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"7\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-string-expression)\">'ETH'</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'transaction may fail'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"8\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-string-expression)\">'ALGO'</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'assert failed'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"9\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-string-expression)\">'CFX'</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'transaction is reverted'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"10\"><span style=\"color: var(--shiki-color-text)\">}[</span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><span style=\"color: var(--shiki-color-text)\">.connector];</span></li><li value=\"11\"></li><li value=\"12\"><span style=\"color: var(--shiki-token-comment)\">// Framework</span></li><li value=\"13\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">makeRSVP</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> ({ hostLabel</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> name</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> reservation</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> timeLimit }) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"14\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">sbal</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_parseCurrency\" title=\"js: parseCurrency\"><span style=\"color: var(--shiki-token-function)\">.parseCurrency</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">100</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"15\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">accHost</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.newTestAccount\" title=\"js: stdlib.newTestAccount\"><span style=\"color: var(--shiki-token-function)\">.newTestAccount</span></a><span style=\"color: var(--shiki-color-text)\">(sbal);</span></li><li value=\"16\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">accHost</span><a href=\"/frontend/#js_setDebugLabel\" title=\"js: setDebugLabel\"><span style=\"color: var(--shiki-token-function)\">.setDebugLabel</span></a><span style=\"color: var(--shiki-color-text)\">(hostLabel);</span></li><li value=\"17\"></li><li value=\"18\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">stdPerson</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> (obj) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"19\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> { </span><a href=\"/frontend/#js_acc\" title=\"js: acc\"><span style=\"color: var(--shiki-token-constant)\">acc</span></a><span style=\"color: var(--shiki-color-text)\"> } </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> obj;</span></li><li value=\"20\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">getBalance</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> () </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"21\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">bal</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_acc\" title=\"js: acc\"><span style=\"color: var(--shiki-token-constant)\">acc</span></a><a href=\"/frontend/#js_stdlib.balanceOf\" title=\"js: stdlib.balanceOf\"><span style=\"color: var(--shiki-token-function)\">.balanceOf</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"22\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-keyword)\">return</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_formatCurrency\" title=\"js: formatCurrency\"><span style=\"color: var(--shiki-token-function)\">.formatCurrency</span></a><span style=\"color: var(--shiki-color-text)\">(bal</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">4</span><span style=\"color: var(--shiki-color-text)\">)</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_standardUnit\" title=\"js: standardUnit\"><span style=\"color: var(--shiki-color-text)\">.standardUnit</span></a><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"23\"><span style=\"color: var(--shiki-color-text)\">    };</span></li><li value=\"24\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-keyword)\">return</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"25\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-keyword)\">...</span><span style=\"color: var(--shiki-color-text)\">obj</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"26\"><span style=\"color: var(--shiki-color-text)\">      getBalance</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"27\"><span style=\"color: var(--shiki-color-text)\">    };</span></li><li value=\"28\"><span style=\"color: var(--shiki-color-text)\">  };</span></li><li value=\"29\"></li><li value=\"30\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Host</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">stdPerson</span><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"31\"><span style=\"color: var(--shiki-color-text)\">    acc</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> accHost</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"32\"><span style=\"color: var(--shiki-color-text)\">    label</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> hostLabel</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"33\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"34\"></li><li value=\"35\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">deadline</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> (</span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.getNetworkTime\" title=\"js: stdlib.getNetworkTime\"><span style=\"color: var(--shiki-token-function)\">.getNetworkTime</span></a><span style=\"color: var(--shiki-color-text)\">())</span><a href=\"/frontend/#js_add\" title=\"js: add\"><span style=\"color: var(--shiki-token-function)\">.add</span></a><span style=\"color: var(--shiki-color-text)\">(timeLimit);</span></li><li value=\"36\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">waitUntilDeadline</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> () </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"37\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">`Waiting until </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">deadline</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"38\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.waitUntilTime\" title=\"js: stdlib.waitUntilTime\"><span style=\"color: var(--shiki-token-function)\">.waitUntilTime</span></a><span style=\"color: var(--shiki-color-text)\">(deadline);</span></li><li value=\"39\"><span style=\"color: var(--shiki-color-text)\">  };</span></li><li value=\"40\"></li><li value=\"41\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">details</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"42\"><span style=\"color: var(--shiki-color-text)\">    name</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> reservation</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> deadline</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> host</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> accHost</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"43\"><span style=\"color: var(--shiki-color-text)\">  };</span></li></ol></pre>\n<p><i id=\"p_125\" class=\"pid\"></i>But after we define the details, there's a difference:<a href=\"#p_125\" class=\"pid\">125</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-5-cede/index.mjs\">/examples/rsvp-5-cede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const ctcHost = accHost.contract(backend);\n  const ctcInfo = await stdlib.withDisconnect(() => ctcHost.p.Admin({\n    details,\n    launched: stdlib.disconnect,\n  }));\n  console.log(`${hostLabel} launched contract`);\" href=\"#\" id=\"copyBtn32\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"45\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcHost</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">accHost</span><a href=\"/frontend/#js_contract\" title=\"js: contract\"><span style=\"color: var(--shiki-token-function)\">.contract</span></a><span style=\"color: var(--shiki-color-text)\">(backend);</span></li><li value=\"46\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcInfo</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.withDisconnect\" title=\"js: stdlib.withDisconnect\"><span style=\"color: var(--shiki-token-function)\">.withDisconnect</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcHost</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">p</span><span style=\"color: var(--shiki-token-function)\">.Admin</span><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"47\"><span style=\"color: var(--shiki-color-text)\">    details</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"48\"><span style=\"color: var(--shiki-color-text)\">    launched</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.disconnect\" title=\"js: stdlib.disconnect\"><span style=\"color: var(--shiki-color-text)\">.disconnect</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"49\"><span style=\"color: var(--shiki-color-text)\">  }));</span></li><li value=\"50\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">hostLabel</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> launched contract`</span><span style=\"color: var(--shiki-color-text)\">);</span></li></ol></pre>\n<p>\n  <i id=\"p_126\" class=\"pid\"></i>We define the Host's contract handle and have them run the Admin participant, which creates and launches the single contract instance for everyone.\n  As mentioned above, we could have a separate account do this, but we choose not to for simplicity.<a href=\"#p_126\" class=\"pid\">126</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-5-cede/index.mjs\">/examples/rsvp-5-cede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const makeGuest = async (label) => {\n    const acc = await stdlib.newTestAccount(sbal);\n    acc.setDebugLabel(label);\n\n    const willGo = async () => {\n      const ctcGuest = acc.contract(backend, ctcInfo);\n      await ctcGuest.a.Guest.register();\n      console.log(`${label} made reservation`);\n    };\n    const doHost = async (showed) => {\n      console.log(`Checking in ${label}...`);\n      await ctcHost.a.Host.checkin(acc, showed);\n      console.log(`${label} did${showed ? '' : ' not'} show.`);\n    };\n    const showUp = () => doHost(true);\n    const noShow = () => doHost(false);\" href=\"#\" id=\"copyBtn33\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"52\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">makeGuest</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> (label) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"53\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_acc\" title=\"js: acc\"><span style=\"color: var(--shiki-token-constant)\">acc</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.newTestAccount\" title=\"js: stdlib.newTestAccount\"><span style=\"color: var(--shiki-token-function)\">.newTestAccount</span></a><span style=\"color: var(--shiki-color-text)\">(sbal);</span></li><li value=\"54\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/frontend/#js_acc\" title=\"js: acc\"><span style=\"color: var(--shiki-token-constant)\">acc</span></a><a href=\"/frontend/#js_setDebugLabel\" title=\"js: setDebugLabel\"><span style=\"color: var(--shiki-token-function)\">.setDebugLabel</span></a><span style=\"color: var(--shiki-color-text)\">(label);</span></li><li value=\"55\"></li><li value=\"56\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">willGo</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> () </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"57\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcGuest</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_acc\" title=\"js: acc\"><span style=\"color: var(--shiki-token-constant)\">acc</span></a><a href=\"/frontend/#js_contract\" title=\"js: contract\"><span style=\"color: var(--shiki-token-function)\">.contract</span></a><span style=\"color: var(--shiki-color-text)\">(backend</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> ctcInfo);</span></li><li value=\"58\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcGuest</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">a</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">Guest</span><span style=\"color: var(--shiki-token-function)\">.register</span><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"59\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">label</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> made reservation`</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"60\"><span style=\"color: var(--shiki-color-text)\">    };</span></li><li value=\"61\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">doHost</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> (showed) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"62\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">`Checking in </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">label</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\">...`</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"63\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcHost</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">a</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">Host</span><span style=\"color: var(--shiki-token-function)\">.checkin</span><span style=\"color: var(--shiki-color-text)\">(acc</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> showed);</span></li><li value=\"64\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">label</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> did</span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">showed </span><span style=\"color: var(--shiki-token-keyword)\">?</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">''</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">' not'</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> show.`</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"65\"><span style=\"color: var(--shiki-color-text)\">    };</span></li><li value=\"66\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">showUp</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> () </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">doHost</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">true</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"67\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">noShow</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> () </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">doHost</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">false</span><span style=\"color: var(--shiki-color-text)\">);</span></li></ol></pre>\n<p><i id=\"p_127\" class=\"pid\"></i>The code for guests is much simpler, because in each case we just have either the Guest call the <code>register</code> function or the Host call the <code>checkin</code> function.<a href=\"#p_127\" class=\"pid\">127</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-5-cede/index.mjs\">/examples/rsvp-5-cede/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    return stdPerson({\n      acc, label,\n      willGo, showUp, noShow,\n    });\n  };\n  const makeGuests = (labels) => Promise.all(labels.map(makeGuest));\n\n  return { Host, makeGuest, makeGuests, waitUntilDeadline };\n};\" href=\"#\" id=\"copyBtn34\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"69\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-keyword)\">return</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">stdPerson</span><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"70\"><span style=\"color: var(--shiki-color-text)\">      acc</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> label</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"71\"><span style=\"color: var(--shiki-color-text)\">      willGo</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> showUp</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> noShow</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"72\"><span style=\"color: var(--shiki-color-text)\">    });</span></li><li value=\"73\"><span style=\"color: var(--shiki-color-text)\">  };</span></li><li value=\"74\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">makeGuests</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> (labels) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Promise</span><span style=\"color: var(--shiki-token-function)\">.all</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">labels</span><span style=\"color: var(--shiki-token-function)\">.map</span><span style=\"color: var(--shiki-color-text)\">(makeGuest));</span></li><li value=\"75\"></li><li value=\"76\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-keyword)\">return</span><span style=\"color: var(--shiki-color-text)\"> { Host</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> makeGuest</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> makeGuests</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> waitUntilDeadline };</span></li><li value=\"77\"><span style=\"color: var(--shiki-color-text)\">};</span></li></ol></pre>\n<p><i id=\"p_128\" class=\"pid\"></i>Everything else about the program is the same.<a href=\"#p_128\" class=\"pid\">128</a></p>\n<hr>\n<p><i id=\"p_129\" class=\"pid\"></i>When we run the program, we will see output like:<a href=\"#p_129\" class=\"pid\">129</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"[... a lot of boilerplate about building images and running them ...]\nBuffy launched contract\nGiles made reservation\nXander made reservation\nCordelia made reservation\nWillow made reservation\nOz made reservation\nWaiting until 5669\nChecking in Xander...\nXander did show.\nChecking in Willow...\nWillow did show.\nChecking in Cordelia...\nCordelia did show.\nChecking in Giles...\nGiles did not show.\nChecking in Oz...\nOz did not show.\nBuffy has 101.9853 ALGO\nXander has 99.9962 ALGO\nWillow has 99.9962 ALGO\nCordelia has 99.9962 ALGO\nGiles has 98.9962 ALGO\nOz has 98.9962 ALGO\nAngel has 99.9993 ALGO\nJonathan has 100.0003 ALGO\" href=\"#\" id=\"copyBtn35\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"1\">[... a lot of boilerplate about building images and running them ...]</li><li value=\"2\">Buffy launched contract</li><li value=\"3\">Giles made reservation</li><li value=\"4\">Xander made reservation</li><li value=\"5\">Cordelia made reservation</li><li value=\"6\">Willow made reservation</li><li value=\"7\">Oz made reservation</li><li value=\"8\">Waiting until 5669</li><li value=\"9\">Checking in Xander...</li><li value=\"10\">Xander did show.</li><li value=\"11\">Checking in Willow...</li><li value=\"12\">Willow did show.</li><li value=\"13\">Checking in Cordelia...</li><li value=\"14\">Cordelia did show.</li><li value=\"15\">Checking in Giles...</li><li value=\"16\">Giles did not show.</li><li value=\"17\">Checking in Oz...</li><li value=\"18\">Oz did not show.</li><li value=\"19\">Buffy has 101.9853 ALGO</li><li value=\"20\">Xander has 99.9962 ALGO</li><li value=\"21\">Willow has 99.9962 ALGO</li><li value=\"22\">Cordelia has 99.9962 ALGO</li><li value=\"23\">Giles has 98.9962 ALGO</li><li value=\"24\">Oz has 98.9962 ALGO</li><li value=\"25\">Angel has 99.9993 ALGO</li><li value=\"26\">Jonathan has 100.0003 ALGO</li></ol></pre>\n<p><i id=\"p_130\" class=\"pid\"></i>This is output is effectively identical to the previous version of the program.<a href=\"#p_130\" class=\"pid\">130</a></p>\n<hr>\n<p>\n  <i id=\"p_131\" class=\"pid\"></i>This program is excellent and we wouldn't need to make any fundamentally different decisions about its design if we were to really launch the <code>rsvp.app</code> service.\n  However, there are a few things that are difficult to do with the program as it is.<a href=\"#p_131\" class=\"pid\">131</a>\n</p>\n<p>\n  <i id=\"p_132\" class=\"pid\"></i>For example, ideally when you go to <code>rsvp.app/event?id=bbbb</code>, you should be able to see some information about the Event, like who the Host is, what's the reservation price, and so on.\n  This information is embedded in the consensus network's records and in the state of the contract instance, but it requires low-level knowledge to extract.\n  We're going to add a <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-color-text)\">View</span></a></span> to the program to make it easy to access.<a href=\"#p_132\" class=\"pid\">132</a>\n</p>\n<p>\n  <i id=\"p_133\" class=\"pid\"></i>Similarly, we'd like to display information about how many people have already made reservations and, maybe, even who they are and when it happened.\n  For the first of those things, we'll add another <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-color-text)\">View</span></a></span>; and for the second, we'll add an <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_Events\" title=\"rsh: Events\"><span style=\"color: var(--shiki-color-text)\">Events</span></a></span> that will make it easy to access the record of everything that happened.<a href=\"#p_133\" class=\"pid\">133</a>\n</p>\n<div class=\"note\">\n  <p><i id=\"p_134\" class=\"pid\"></i>Although we're going to make changes to the Reach program, we're not actually exposing any information that wasn't already available in the consensus network's records.<a href=\"#p_134\" class=\"pid\">134</a></p>\n  <p>\n    <i id=\"p_135\" class=\"pid\"></i>For example, the <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-color-text)\">View</span></a></span> is going to make it easy to read the <code>details</code> and <code>howMany</code> variables.\n    These variables are actually stored in the consensus network's memory.\n    It is possible, for example, to know that \"<code>howMany</code> is stored at memory offset 0x8008\" and that is encoded as 64 bytes in little-endian order.\n    However, those details are extremely low-level and subject to change as the consensus network's implementation improves and Reach discovers more efficient ways to compile your program.<a href=\"#p_135\" class=\"pid\">135</a>\n  </p>\n  <p><i id=\"p_136\" class=\"pid\"></i>By adding a <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-color-text)\">View</span></a></span>, we'll produce a usable API that abstracts these kinds of details for the benefit of our colleagues that create the User Interface, our future selves that need to understand the program, and our users that want to have easy access to data about themselves.<a href=\"#p_136\" class=\"pid\">136</a></p>\n</div>\n<h2 id=\"tut-rsvp6-rsh\" class=\"refHeader\">A View To An Event<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#tut-rsvp6-rsh\"><span class=\"icon icon-link\"></span></a></h2>\n<p><i id=\"p_137\" class=\"pid\"></i>First, we'll review the changes to the Reach application code.<a href=\"#p_137\" class=\"pid\">137</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-6-vevt/index.rsh\">/examples/rsvp-6-vevt/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"export const main = Reach.App(() => {\n  const Admin = Participant('Admin', {\n    details: Details,\n    launched: Fun([Contract], Null),\n  });\n  const Guest = API('Guest', {\n    register: Fun([], Null),\n  });\n  const Host = API('Host', {\n    checkin: Fun([Address, Bool], Null),\n  });\n  const Info = View('Info', {\n    details: Details,\n    howMany: UInt,\n    reserved: Fun([Address], Bool),\n  });\n  const Notify = Events({\n    register: [Address],\n    checkin: [Address, Bool],\n  });\n  init();\" href=\"#\" id=\"copyBtn36\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"11\"><a href=\"/rsh/module/#rsh_export\" title=\"rsh: export\"><span style=\"color: var(--shiki-token-keyword)\">export</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">main</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/module/#rsh_Reach\" title=\"rsh: Reach\"><span style=\"color: var(--shiki-token-constant)\">Reach</span></a><a href=\"/rsh/module/#rsh_Reach.App\" title=\"rsh: Reach.App\"><span style=\"color: var(--shiki-token-function)\">.App</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"12\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Admin</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_Participant\" title=\"rsh: Participant\"><span style=\"color: var(--shiki-token-function)\">Participant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Admin'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"13\"><span style=\"color: var(--shiki-color-text)\">    details</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> Details</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"14\"><span style=\"color: var(--shiki-color-text)\">    launched</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Contract]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Null)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"15\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"16\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Guest</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_API\" title=\"rsh: API\"><span style=\"color: var(--shiki-token-function)\">API</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Guest'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"17\"><span style=\"color: var(--shiki-color-text)\">    register</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Null)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"18\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"19\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Host</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_API\" title=\"rsh: API\"><span style=\"color: var(--shiki-token-function)\">API</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Host'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"20\"><span style=\"color: var(--shiki-color-text)\">    checkin</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bool]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Null)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"21\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"22\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Info</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-token-function)\">View</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Info'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"23\"><span style=\"color: var(--shiki-color-text)\">    details</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> Details</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"24\"><span style=\"color: var(--shiki-color-text)\">    howMany</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> UInt</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"25\"><span style=\"color: var(--shiki-color-text)\">    reserved</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Address]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bool)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"26\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"27\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Notify</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_Events\" title=\"rsh: Events\"><span style=\"color: var(--shiki-token-function)\">Events</span></a><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"28\"><span style=\"color: var(--shiki-color-text)\">    register</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> [Address]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"29\"><span style=\"color: var(--shiki-color-text)\">    checkin</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> [Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bool]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"30\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"31\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/appinit/#rsh_init\" title=\"rsh: init\"><span style=\"color: var(--shiki-token-function)\">init</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li></ol></pre>\n<p><i id=\"p_138\" class=\"pid\"></i>We add definitions for the <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-color-text)\">View</span></a></span> and <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">Event</span></span> objects.<a href=\"#p_138\" class=\"pid\">138</a></p>\n<p>\n  <i id=\"p_139\" class=\"pid\"></i>Let's look at the <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-color-text)\">View</span></a></span> first.\n  The first argument is a label for it, like how we give labels to APIs and participants.\n  Next, we provide an object where the keys are the names of the view components and the fields are their types.\n  This object is just like an <span class=\"snip\"><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-color-text)\">interact</span></a></span> object, except that the values are provided <em>from</em> Reach, rather than <em>to</em> Reach.\n  In this case, like APIs, these values can be accessed on- and off-chain.\n  On-chain, they can be accessed using the normal ABI of the consensus network, just like APIs.\n  For example, the details are provided via a function named <code>Info_details</code> that takes no arguments and returns a <code>Details</code> structure, and there's a function named <code>Info_reserved</code> that accepts an address and returns a boolean indicating if they've made a reservation.\n  Off-chain, they can be accessed via a frontend function like <span class=\"snip\"><a href=\"/frontend/#js_ctc\" title=\"js: ctc\"><span style=\"color: var(--shiki-token-constant)\">ctc</span></a><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/frontend/#js_ctc.views\" title=\"js: ctc.views\"><span style=\"color: var(--shiki-token-constant)\">views</span></a><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">Info</span><span style=\"color: var(--shiki-token-function)\">.details</span><span style=\"color: var(--shiki-color-text)\">()</span></span>.\n  The off-chain function returns the value or an indication that it was not available.<a href=\"#p_139\" class=\"pid\">139</a>\n</p>\n<p>\n  <i id=\"p_140\" class=\"pid\"></i>Next, let's look at the <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_Events\" title=\"rsh: Events\"><span style=\"color: var(--shiki-color-text)\">Events</span></a></span> definition.\n  It can also be provided with a label, but we've chosen not to include one.\n  We don't have to provide labels for <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_API\" title=\"rsh: API\"><span style=\"color: var(--shiki-token-constant)\">API</span></a></span>s or <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-color-text)\">View</span></a></span>s either, but we think it is a good idea in those cases.\n  The object provided to <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_Events\" title=\"rsh: Events\"><span style=\"color: var(--shiki-color-text)\">Events</span></a></span> is not an interface, where the keys are types, but instead has tuples of types as the values.\n  These are the values that will be emitted together.\n  For example, the <code>register</code> event will contain one address, while the <code>checkin</code> event will contain an address and a boolean.\n  Like APIs and Views, they are available on- and off-chain.\n  On-chain, they are available using the standard ABI for the platform.\n  (Although, note, that some chains, like Ethereum, don't provide any on-chain mechanism for consuming events.)\n  Off-chain, they are available via a frontend function like <span class=\"snip\"><a href=\"/frontend/#js_ctc\" title=\"js: ctc\"><span style=\"color: var(--shiki-token-constant)\">ctc</span></a><span style=\"color: var(--shiki-color-text)\">.</span><a href=\"/frontend/#js_ctc.events\" title=\"js: ctc.events\"><span style=\"color: var(--shiki-token-constant)\">events</span></a><span style=\"color: var(--shiki-color-text)\">.register</span></span>.\n  The off-chain function has sub-methods for reading the next instance of the event or monitoring every event, as well as other options.<a href=\"#p_140\" class=\"pid\">140</a>\n</p>\n<p>\n  <i id=\"p_141\" class=\"pid\"></i>In both cases, we have not actually defined the values or meaning of these Views and Events.\n  We've merely indicated that our application contains them.\n  This is similar to how we define a Participant and then later indicate what actions it performs.\n  Let's look at the view definitions next.<a href=\"#p_141\" class=\"pid\">141</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-6-vevt/index.rsh\">/examples/rsvp-6-vevt/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  Admin.only(() => {\n    const details = declassify(interact.details);\n  });\n  Admin.publish(details);\n  const { reservation, deadline, host } = details;\n  enforce( thisConsensusTime() < deadline, &quot;too late&quot; );\n  Admin.interact.launched(getContract());\n  Info.details.set(details);\" href=\"#\" id=\"copyBtn37\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"33\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">Admin</span><a href=\"/rsh/step/#rsh_only\" title=\"rsh: only\"><span style=\"color: var(--shiki-token-function)\">.only</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"34\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">details</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: var(--shiki-token-function)\">declassify</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-color-text)\">.details);</span></li><li value=\"35\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"36\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">Admin</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">(details);</span></li><li value=\"37\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> { </span><span style=\"color: var(--shiki-token-constant)\">reservation</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">deadline</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">host</span><span style=\"color: var(--shiki-color-text)\"> } </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> details;</span></li><li value=\"38\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_enforce\" title=\"rsh: enforce\"><span style=\"color: var(--shiki-token-function)\">enforce</span></a><span style=\"color: var(--shiki-color-text)\">( </span><a href=\"/rsh/compute/#rsh_thisConsensusTime\" title=\"rsh: thisConsensusTime\"><span style=\"color: var(--shiki-token-function)\">thisConsensusTime</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_%3C\" title=\"rsh: <\"><span style=\"color: var(--shiki-token-keyword)\">&lt;</span></a><span style=\"color: var(--shiki-color-text)\"> deadline</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"too late\"</span><span style=\"color: var(--shiki-color-text)\"> );</span></li><li value=\"39\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">Admin</span><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.launched</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_getContract\" title=\"rsh: getContract\"><span style=\"color: var(--shiki-token-function)\">getContract</span></a><span style=\"color: var(--shiki-color-text)\">());</span></li><li value=\"40\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">Info</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">details</span><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(details);</span></li></ol></pre>\n<p>\n  <i id=\"p_142\" class=\"pid\"></i>A View can have a different value at each point in the program, including not having any value at all.\n  You define the value by calling <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-token-constant)\">View</span></a><span style=\"color: var(--shiki-color-text)\">.</span><span style=\"color: var(--shiki-token-constant)\">field</span><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-color-text)\">.set</span></a></span> and providing a value that satisfies the type.\n  For example, here (on line 40) we indicate that the <code>details</code> field is always the same as the <code>details</code> variable.\n  This definition applies to all dominated occurrences of the <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">()</span></span> keyword.\n  Views are not mutable references: instead, they are ways of naming, for external consumption, portions of the consensus state.<a href=\"#p_142\" class=\"pid\">142</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-6-vevt/index.rsh\">/examples/rsvp-6-vevt/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const Guests = new Map(Bool);\n  Info.reserved.set((who) => isSome(Guests[who]));\n  const [ done, howMany ] =\n    parallelReduce([ false, 0 ])\n    .define(() => {\n      Info.howMany.set(howMany);\n    })\n    .invariant( Guests.size() == howMany, &quot;howMany accurate&quot; )\n    .invariant( balance() == howMany * reservation, &quot;balance accurate&quot; )\n    .while( ! ( done &amp;&amp; howMany == 0 ) )\" href=\"#\" id=\"copyBtn38\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"42\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">Guests</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_new\" title=\"rsh: new\"><span style=\"color: var(--shiki-token-keyword)\">new</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a><span style=\"color: var(--shiki-color-text)\">(Bool);</span></li><li value=\"43\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">Info</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">reserved</span><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">((who) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_isSome\" title=\"rsh: isSome\"><span style=\"color: var(--shiki-token-function)\">isSome</span></a><span style=\"color: var(--shiki-color-text)\">(Guests[who]));</span></li><li value=\"44\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><span style=\"color: var(--shiki-token-constant)\">done</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">howMany</span><span style=\"color: var(--shiki-color-text)\"> ] </span><span style=\"color: var(--shiki-token-keyword)\">=</span></li><li value=\"45\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-token-function)\">parallelReduce</span></a><span style=\"color: var(--shiki-color-text)\">([ </span><a href=\"/rsh/compute/#rsh_false\" title=\"rsh: false\"><span style=\"color: var(--shiki-token-constant)\">false</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\"> ])</span></li><li value=\"46\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_parallelReduce.define\" title=\"rsh: parallelReduce.define\"><span style=\"color: var(--shiki-token-function)\">.define</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"47\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-constant)\">Info</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">howMany</span><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(howMany);</span></li><li value=\"48\"><span style=\"color: var(--shiki-color-text)\">    })</span></li><li value=\"49\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_parallelReduce.invariant\" title=\"rsh: parallelReduce.invariant\"><span style=\"color: var(--shiki-token-function)\">.invariant</span></a><span style=\"color: var(--shiki-color-text)\">( </span><span style=\"color: var(--shiki-token-constant)\">Guests</span><a href=\"/rsh/compute/#rsh_Map.size\" title=\"rsh: Map.size\"><span style=\"color: var(--shiki-token-function)\">.size</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> howMany</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"howMany accurate\"</span><span style=\"color: var(--shiki-color-text)\"> )</span></li><li value=\"50\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_parallelReduce.invariant\" title=\"rsh: parallelReduce.invariant\"><span style=\"color: var(--shiki-token-function)\">.invariant</span></a><span style=\"color: var(--shiki-color-text)\">( </span><a href=\"/rsh/compute/#rsh_balance\" title=\"rsh: balance\"><span style=\"color: var(--shiki-token-function)\">balance</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> howMany </span><a href=\"/rsh/compute/#rsh_*\" title=\"rsh: *\"><span style=\"color: var(--shiki-token-keyword)\">*</span></a><span style=\"color: var(--shiki-color-text)\"> reservation</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"balance accurate\"</span><span style=\"color: var(--shiki-color-text)\"> )</span></li><li value=\"51\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/consensus/#rsh_parallelReduce.while\" title=\"rsh: parallelReduce.while\"><span style=\"color: var(--shiki-token-function)\">.while</span></a><span style=\"color: var(--shiki-color-text)\">( </span><a href=\"/rsh/compute/#rsh_!\" title=\"rsh: !\"><span style=\"color: var(--shiki-token-keyword)\">!</span></a><span style=\"color: var(--shiki-color-text)\"> ( done </span><a href=\"/rsh/compute/#rsh_&amp;&amp;\" title=\"rsh: &amp;&amp;\"><span style=\"color: var(--shiki-token-keyword)\">&amp;&amp;</span></a><span style=\"color: var(--shiki-color-text)\"> howMany </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\"> ) )</span></li></ol></pre>\n<p>\n  <i id=\"p_143\" class=\"pid\"></i>We similarly expose the contents of the <code>Guests</code> mapping, as well as the <code>howMany</code> variable.\n  We use the <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">.define</span></span> feature of <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">parllelReduce</span></span> to introduce a statement that dominates the <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">()</span></span>s implicit in the <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-color-text)\">parallelReduce</span></a></span>.\n  This context is the only context that has access to the <code>howMany</code> variable, which is why we must place it there.<a href=\"#p_143\" class=\"pid\">143</a>\n</p>\n<p><i id=\"p_144\" class=\"pid\"></i>Next, let's look at the code that emits instances of the <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_Events\" title=\"rsh: Events\"><span style=\"color: var(--shiki-color-text)\">Events</span></a></span> we defined.<a href=\"#p_144\" class=\"pid\">144</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-6-vevt/index.rsh\">/examples/rsvp-6-vevt/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    .api_(Guest.register, () => {\n      check(! done, &quot;event started&quot;);\n      check(isNone(Guests[this]), &quot;already registered&quot;);\n      return [ reservation, (ret) => {\n        enforce( thisConsensusTime() < deadline, &quot;too late&quot; );\n        Guests[this] = true;\n        Notify.register(this);\n        ret(null);\n        return [ false, howMany + 1 ];\n      } ];\n    })\" href=\"#\" id=\"copyBtn39\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"52\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-function)\">.api_</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">Guest</span><span style=\"color: var(--shiki-color-text)\">.register</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"53\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_!\" title=\"rsh: !\"><span style=\"color: var(--shiki-token-keyword)\">!</span></a><span style=\"color: var(--shiki-color-text)\"> done</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"event started\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"54\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_isNone\" title=\"rsh: isNone\"><span style=\"color: var(--shiki-token-function)\">isNone</span></a><span style=\"color: var(--shiki-color-text)\">(Guests[</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-color-text)\">])</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"already registered\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"55\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [ reservation</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (ret) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"56\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/compute/#rsh_enforce\" title=\"rsh: enforce\"><span style=\"color: var(--shiki-token-function)\">enforce</span></a><span style=\"color: var(--shiki-color-text)\">( </span><a href=\"/rsh/compute/#rsh_thisConsensusTime\" title=\"rsh: thisConsensusTime\"><span style=\"color: var(--shiki-token-function)\">thisConsensusTime</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_%3C\" title=\"rsh: <\"><span style=\"color: var(--shiki-token-keyword)\">&lt;</span></a><span style=\"color: var(--shiki-color-text)\"> deadline</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"too late\"</span><span style=\"color: var(--shiki-color-text)\"> );</span></li><li value=\"57\"><span style=\"color: var(--shiki-color-text)\">        Guests[</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-color-text)\">] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"58\"><span style=\"color: var(--shiki-color-text)\">        </span><span style=\"color: var(--shiki-token-constant)\">Notify</span><span style=\"color: var(--shiki-token-function)\">.register</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"59\"><span style=\"color: var(--shiki-color-text)\">        </span><span style=\"color: var(--shiki-token-function)\">ret</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_null\" title=\"rsh: null\"><span style=\"color: var(--shiki-token-constant)\">null</span></a><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"60\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><a href=\"/rsh/compute/#rsh_false\" title=\"rsh: false\"><span style=\"color: var(--shiki-token-constant)\">false</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> howMany </span><a href=\"/rsh/compute/#rsh_+\" title=\"rsh: +\"><span style=\"color: var(--shiki-token-keyword)\">+</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\"> ];</span></li><li value=\"61\"><span style=\"color: var(--shiki-color-text)\">      } ];</span></li><li value=\"62\"><span style=\"color: var(--shiki-color-text)\">    })</span></li></ol></pre>\n<p>\n  <i id=\"p_145\" class=\"pid\"></i>We can emit an event by calling <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_Events\" title=\"rsh: Events\"><span style=\"color: var(--shiki-token-constant)\">Events</span></a><span style=\"color: var(--shiki-token-function)\">.kind</span><span style=\"color: var(--shiki-color-text)\">(args)</span></span> in a consensus step.\n  We do so inside of the <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">.api_</span></span> for the <code>Guest.register</code> API call on line 58.<a href=\"#p_145\" class=\"pid\">145</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-6-vevt/index.rsh\">/examples/rsvp-6-vevt/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"    .api_(Host.checkin, (guest, showed) => {\n      check(this == host, &quot;not the host&quot;);\n      check(isSome(Guests[guest]), &quot;no reservation&quot;);\n      return [ 0, (ret) => {\n        enforce( thisConsensusTime() >= deadline, &quot;too early&quot; );\n        delete Guests[guest];\n        transfer(reservation).to(showed ? guest : host);\n        Notify.checkin(guest, showed);\n        ret(null);\n        return [ true, howMany - 1 ];\n      } ];\n    });\" href=\"#\" id=\"copyBtn40\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"63\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-function)\">.api_</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">Host</span><span style=\"color: var(--shiki-color-text)\">.checkin</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (guest</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> showed) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"64\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> host</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"not the host\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"65\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_isSome\" title=\"rsh: isSome\"><span style=\"color: var(--shiki-token-function)\">isSome</span></a><span style=\"color: var(--shiki-color-text)\">(Guests[guest])</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"no reservation\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"66\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (ret) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"67\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/compute/#rsh_enforce\" title=\"rsh: enforce\"><span style=\"color: var(--shiki-token-function)\">enforce</span></a><span style=\"color: var(--shiki-color-text)\">( </span><a href=\"/rsh/compute/#rsh_thisConsensusTime\" title=\"rsh: thisConsensusTime\"><span style=\"color: var(--shiki-token-function)\">thisConsensusTime</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_%3E=\" title=\"rsh: >=\"><span style=\"color: var(--shiki-token-keyword)\">&gt;=</span></a><span style=\"color: var(--shiki-color-text)\"> deadline</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"too early\"</span><span style=\"color: var(--shiki-color-text)\"> );</span></li><li value=\"68\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/errors/#rsh_delete\" title=\"rsh: delete\"><span style=\"color: var(--shiki-token-keyword)\">delete</span></a><span style=\"color: var(--shiki-color-text)\"> Guests[guest];</span></li><li value=\"69\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/consensus/#rsh_transfer\" title=\"rsh: transfer\"><span style=\"color: var(--shiki-token-function)\">transfer</span></a><span style=\"color: var(--shiki-color-text)\">(reservation)</span><a href=\"/rsh/consensus/#rsh_transfer.to\" title=\"rsh: transfer.to\"><span style=\"color: var(--shiki-token-function)\">.to</span></a><span style=\"color: var(--shiki-color-text)\">(showed </span><a href=\"/rsh/compute/#rsh_?\" title=\"rsh: ?\"><span style=\"color: var(--shiki-token-keyword)\">?</span></a><span style=\"color: var(--shiki-color-text)\"> guest </span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> host);</span></li><li value=\"70\"><span style=\"color: var(--shiki-color-text)\">        </span><span style=\"color: var(--shiki-token-constant)\">Notify</span><span style=\"color: var(--shiki-token-function)\">.checkin</span><span style=\"color: var(--shiki-color-text)\">(guest</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> showed);</span></li><li value=\"71\"><span style=\"color: var(--shiki-color-text)\">        </span><span style=\"color: var(--shiki-token-function)\">ret</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_null\" title=\"rsh: null\"><span style=\"color: var(--shiki-token-constant)\">null</span></a><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"72\"><span style=\"color: var(--shiki-color-text)\">        </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [ </span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> howMany </span><a href=\"/rsh/compute/#rsh_-\" title=\"rsh: -\"><span style=\"color: var(--shiki-token-keyword)\">-</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\"> ];</span></li><li value=\"73\"><span style=\"color: var(--shiki-color-text)\">      } ];</span></li><li value=\"74\"><span style=\"color: var(--shiki-color-text)\">    });</span></li></ol></pre>\n<p>\n  <i id=\"p_146\" class=\"pid\"></i>We do the same for the <code>Host.checkin</code> event on line 70.\n  It is typical to emit events just before or after yield a result to the API caller.<a href=\"#p_146\" class=\"pid\">146</a>\n</p>\n<h2 id=\"tut-rsvp6-mjs\" class=\"refHeader\">The Panopticon<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#tut-rsvp6-mjs\"><span class=\"icon icon-link\"></span></a></h2>\n<p>\n  <i id=\"p_147\" class=\"pid\"></i>We've now exposed information about the state and history of the RSVP application to callers.\n  If we were going to build a real version of this application, we'd include calls to the <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-color-text)\">View</span></a></span> functions in the user interface and provide an event logger that monitors the <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_Events\" title=\"rsh: Events\"><span style=\"color: var(--shiki-color-text)\">Events</span></a></span>.\n  However, we'll delay that for another time.\n  Instead, we'll just make a few simple changes to the test framework to demonstrate how to use these functions.<a href=\"#p_147\" class=\"pid\">147</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-6-vevt/index.mjs\">/examples/rsvp-6-vevt/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const ctcHost = accHost.contract(backend);\n  const ctcInfo = await stdlib.withDisconnect(() => ctcHost.p.Admin({\n    details,\n    launched: stdlib.disconnect,\n  }));\n  console.log(`${hostLabel} launched contract`);\n  ctcHost.e.register.monitor((evt) => {\n    const { when, what: [ who_ ] } = evt;\n    const who = stdlib.formatAddress(who_);\n    console.log(`${hostLabel} sees that ${who} registered at ${when}`);\n  });\" href=\"#\" id=\"copyBtn41\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"45\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcHost</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">accHost</span><a href=\"/frontend/#js_contract\" title=\"js: contract\"><span style=\"color: var(--shiki-token-function)\">.contract</span></a><span style=\"color: var(--shiki-color-text)\">(backend);</span></li><li value=\"46\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcInfo</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.withDisconnect\" title=\"js: stdlib.withDisconnect\"><span style=\"color: var(--shiki-token-function)\">.withDisconnect</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcHost</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">p</span><span style=\"color: var(--shiki-token-function)\">.Admin</span><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"47\"><span style=\"color: var(--shiki-color-text)\">    details</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"48\"><span style=\"color: var(--shiki-color-text)\">    launched</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.disconnect\" title=\"js: stdlib.disconnect\"><span style=\"color: var(--shiki-color-text)\">.disconnect</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"49\"><span style=\"color: var(--shiki-color-text)\">  }));</span></li><li value=\"50\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">hostLabel</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> launched contract`</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"51\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">ctcHost</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">e</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">register</span><span style=\"color: var(--shiki-token-function)\">.monitor</span><span style=\"color: var(--shiki-color-text)\">((evt) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"52\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> { </span><span style=\"color: var(--shiki-token-constant)\">when</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> what: [ </span><span style=\"color: var(--shiki-token-constant)\">who_</span><span style=\"color: var(--shiki-color-text)\"> ] } </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> evt;</span></li><li value=\"53\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">who</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.formatAddress\" title=\"js: stdlib.formatAddress\"><span style=\"color: var(--shiki-token-function)\">.formatAddress</span></a><span style=\"color: var(--shiki-color-text)\">(who_);</span></li><li value=\"54\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">hostLabel</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> sees that </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">who</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> registered at </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">when</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"55\"><span style=\"color: var(--shiki-color-text)\">  });</span></li></ol></pre>\n<p>\n  <i id=\"p_148\" class=\"pid\"></i>First, we'll have the Host monitor all registrations for this event.\n  <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">ctcHost</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">events</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">register</span><span style=\"color: var(--shiki-token-function)\">.monitor</span><span style=\"color: var(--shiki-color-text)\">(f)</span></span> is a function that calls <code>f</code> once for every event.\n  <code>f</code> is called with an object that has a <code>when</code> field and a <code>what</code> field.\n  <code>when</code> is the time when the event was emitted from the consensus network.\n  <code>what</code> is an array of the values that were included with the event.\n  In this code, we extract those fields and print out a message on every registration.\n  This is representative of a user interface that shows the Host each registration as it happens.<a href=\"#p_148\" class=\"pid\">148</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/rsvp-6-vevt/index.mjs\">/examples/rsvp-6-vevt/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const makeGuest = async (label) => {\n    const acc = await stdlib.newTestAccount(sbal);\n    acc.setDebugLabel(label);\n\n    const willGo = async () => {\n      const ctcGuest = acc.contract(backend, ctcInfo);\n      const { reservation } = await ctcGuest.unsafeViews.Info.details();\n      console.log(`${label} sees event reservation is ${stdlib.formatCurrency(reservation)} ${stdlib.standardUnit}`);\n      await ctcGuest.a.Guest.register();\n      console.log(`${label} made reservation`);\n    };\" href=\"#\" id=\"copyBtn42\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"57\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">makeGuest</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> (label) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"58\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_acc\" title=\"js: acc\"><span style=\"color: var(--shiki-token-constant)\">acc</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.newTestAccount\" title=\"js: stdlib.newTestAccount\"><span style=\"color: var(--shiki-token-function)\">.newTestAccount</span></a><span style=\"color: var(--shiki-color-text)\">(sbal);</span></li><li value=\"59\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/frontend/#js_acc\" title=\"js: acc\"><span style=\"color: var(--shiki-token-constant)\">acc</span></a><a href=\"/frontend/#js_setDebugLabel\" title=\"js: setDebugLabel\"><span style=\"color: var(--shiki-token-function)\">.setDebugLabel</span></a><span style=\"color: var(--shiki-color-text)\">(label);</span></li><li value=\"60\"></li><li value=\"61\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">willGo</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> () </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"62\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcGuest</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_acc\" title=\"js: acc\"><span style=\"color: var(--shiki-token-constant)\">acc</span></a><a href=\"/frontend/#js_contract\" title=\"js: contract\"><span style=\"color: var(--shiki-token-function)\">.contract</span></a><span style=\"color: var(--shiki-color-text)\">(backend</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> ctcInfo);</span></li><li value=\"63\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> { </span><span style=\"color: var(--shiki-token-constant)\">reservation</span><span style=\"color: var(--shiki-color-text)\"> } </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcGuest</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">unsafeViews</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">Info</span><span style=\"color: var(--shiki-token-function)\">.details</span><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"64\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">label</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> sees event reservation is </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_formatCurrency\" title=\"js: formatCurrency\"><span style=\"color: var(--shiki-token-function)\">.formatCurrency</span></a><span style=\"color: var(--shiki-color-text)\">(reservation)</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_standardUnit\" title=\"js: standardUnit\"><span style=\"color: var(--shiki-color-text)\">.standardUnit</span></a><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"65\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcGuest</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">a</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">Guest</span><span style=\"color: var(--shiki-token-function)\">.register</span><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"66\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">label</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> made reservation`</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"67\"><span style=\"color: var(--shiki-color-text)\">    };</span></li></ol></pre>\n<p>\n  <i id=\"p_149\" class=\"pid\"></i>Next, we modify the <code>willGo</code> function so that the Guest, before they register, inspects the event details and looks at the reservation price.\n  This is representative of a user interface that informs the Guest of how much they'll be expected to pay to make a reservation.\n  In this code, we call <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">ctcGuest</span><span style=\"color: var(--shiki-color-text)\">.unsafeViews</span></span>, because when the view is not defined, it throws an error, rather than returning a special wrapper object.\n  We know that it will always be defined, so it is more convenient to use this, than to worry about decoding the wrapper object.<a href=\"#p_149\" class=\"pid\">149</a>\n</p>\n<hr>\n<p><i id=\"p_150\" class=\"pid\"></i>When we run this version of the program, it behaves exactly the same as before in all important ways, but has a slightly different output:<a href=\"#p_150\" class=\"pid\">150</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"[... a lot of boilerplate about building images and running them ...]\nBuffy launched contract\nXander sees event reservation is 1 ALGO\nCordelia sees event reservation is 1 ALGO\nWillow sees event reservation is 1 ALGO\nOz sees event reservation is 1 ALGO\nGiles sees event reservation is 1 ALGO\nGiles made reservation\nXander made reservation\nCordelia made reservation\nWillow made reservation\nOz made reservation\nWaiting until 5669\nAngel sees event reservation is 1 ALGO\nBuffy sees that S5YGHPLCBNX3KWS7U2MPEXQOQJ6H3HTFTAPLAPNFSHXZGKKPMRLLUHJ2SU registered at 5661\nBuffy sees that 7CU32PBE3LFQOBV53BIZZ4BRRKUGJRCKZEKRP5IT3FNXAYIBB6GJSQHGL4 registered at 5662\nBuffy sees that 72MKLYQN56GKZOCGIZHTJ6SQCEDBSRAMCLDPQAGZTZTB6LX6RG4RBR5WGY registered at 5663\nBuffy sees that WEQZOPCRY7VMA5JEJMZPTHYJFFSQIAXO4FJX23RPY3QXV3I53KDGMVBIPQ registered at 5664\nBuffy sees that LMGM4ZA24RTJTV6BCDWHKBMGG533XBVOH4MSTLHMUHYGLCEYOINY6BO5NI registered at 5665\nChecking in Xander...\nXander did show.\nChecking in Willow...\nWillow did show.\nChecking in Cordelia...\nCordelia did show.\nChecking in Giles...\nGiles did not show.\nChecking in Oz...\nOz did not show.\nBuffy has 101.9853 ALGO\nXander has 99.9962 ALGO\nWillow has 99.9962 ALGO\nCordelia has 99.9962 ALGO\nGiles has 98.9962 ALGO\nOz has 98.9962 ALGO\nAngel has 99.9993 ALGO\nJonathan has 100.0003 ALGO\" href=\"#\" id=\"copyBtn43\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"1\">[... a lot of boilerplate about building images and running them ...]</li><li value=\"2\">Buffy launched contract</li><li value=\"3\">Xander sees event reservation is 1 ALGO</li><li value=\"4\">Cordelia sees event reservation is 1 ALGO</li><li value=\"5\">Willow sees event reservation is 1 ALGO</li><li value=\"6\">Oz sees event reservation is 1 ALGO</li><li value=\"7\">Giles sees event reservation is 1 ALGO</li><li value=\"8\">Giles made reservation</li><li value=\"9\">Xander made reservation</li><li value=\"10\">Cordelia made reservation</li><li value=\"11\">Willow made reservation</li><li value=\"12\">Oz made reservation</li><li value=\"13\">Waiting until 5669</li><li value=\"14\">Angel sees event reservation is 1 ALGO</li><li value=\"15\">Buffy sees that S5YGHPLCBNX3KWS7U2MPEXQOQJ6H3HTFTAPLAPNFSHXZGKKPMRLLUHJ2SU registered at 5661</li><li value=\"16\">Buffy sees that 7CU32PBE3LFQOBV53BIZZ4BRRKUGJRCKZEKRP5IT3FNXAYIBB6GJSQHGL4 registered at 5662</li><li value=\"17\">Buffy sees that 72MKLYQN56GKZOCGIZHTJ6SQCEDBSRAMCLDPQAGZTZTB6LX6RG4RBR5WGY registered at 5663</li><li value=\"18\">Buffy sees that WEQZOPCRY7VMA5JEJMZPTHYJFFSQIAXO4FJX23RPY3QXV3I53KDGMVBIPQ registered at 5664</li><li value=\"19\">Buffy sees that LMGM4ZA24RTJTV6BCDWHKBMGG533XBVOH4MSTLHMUHYGLCEYOINY6BO5NI registered at 5665</li><li value=\"20\">Checking in Xander...</li><li value=\"21\">Xander did show.</li><li value=\"22\">Checking in Willow...</li><li value=\"23\">Willow did show.</li><li value=\"24\">Checking in Cordelia...</li><li value=\"25\">Cordelia did show.</li><li value=\"26\">Checking in Giles...</li><li value=\"27\">Giles did not show.</li><li value=\"28\">Checking in Oz...</li><li value=\"29\">Oz did not show.</li><li value=\"30\">Buffy has 101.9853 ALGO</li><li value=\"31\">Xander has 99.9962 ALGO</li><li value=\"32\">Willow has 99.9962 ALGO</li><li value=\"33\">Cordelia has 99.9962 ALGO</li><li value=\"34\">Giles has 98.9962 ALGO</li><li value=\"35\">Oz has 98.9962 ALGO</li><li value=\"36\">Angel has 99.9993 ALGO</li><li value=\"37\">Jonathan has 100.0003 ALGO</li></ol></pre>\n<h2 id=\"tut-rsvp7\" class=\"refHeader\">Where Do We Go From Here?<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#tut-rsvp7\"><span class=\"icon icon-link\"></span></a></h2>\n<p>\n  <i id=\"p_151\" class=\"pid\"></i>We've implemented a full DApp for managing events RSVPs in less than 80 lines of Reach code.\n  In less than a hundred lines of JavaScript, we have a testing system where we can implement test scenarios to ensure it is correct.\n  This is a lot to do in an afternoon, but it is better than writing the 3,000 lines of Solidity, TEAL, and JavaScript support code that Reach generated for us!<a href=\"#p_151\" class=\"pid\">151</a>\n</p>\n<p>\n  <i id=\"p_152\" class=\"pid\"></i>You should now be asking, <a href=\"https://www.youtube.com/watch?v=7XdAQpq_1Xw\">Where Do We Go From Here?</a>\n  You now understand...<a href=\"#p_152\" class=\"pid\">152</a>\n</p>\n<ul>\n  <li><i id=\"p_153\" class=\"pid\"></i>How to design decentralized and centralized DApps;<a href=\"#p_153\" class=\"pid\">153</a></li>\n  <li><i id=\"p_154\" class=\"pid\"></i>How to use <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_API\" title=\"rsh: API\"><span style=\"color: var(--shiki-token-constant)\">API</span></a></span>s in Reach programs;<a href=\"#p_154\" class=\"pid\">154</a></li>\n  <li><i id=\"p_155\" class=\"pid\"></i>How to use <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a></span>s in Reach programs;<a href=\"#p_155\" class=\"pid\">155</a></li>\n  <li><i id=\"p_156\" class=\"pid\"></i>How to define <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-color-text)\">View</span></a></span>s, for observing Reach programs internal state;<a href=\"#p_156\" class=\"pid\">156</a></li>\n  <li><i id=\"p_157\" class=\"pid\"></i>How to define <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_Events\" title=\"rsh: Events\"><span style=\"color: var(--shiki-color-text)\">Events</span></a></span>, for monitoring Reach program actions; and,<a href=\"#p_157\" class=\"pid\">157</a></li>\n  <li><i id=\"p_158\" class=\"pid\"></i>How to do it all with a testing-first framework.<a href=\"#p_158\" class=\"pid\">158</a></li>\n</ul>\n<p><i id=\"p_159\" class=\"pid\"></i>We find that many many users want to write DApps that are more like <a href=\"/tut/rsvp/#tut-rsvp\">Répondez S'il Vous Plaît</a> than <a href=\"/tut/rps/#tut\">Rock, Paper, Scissors!</a>, so hopefully this tutorial will help you on your way!<a href=\"#p_159\" class=\"pid\">159</a></p>\n<p>\n  <i id=\"p_160\" class=\"pid\"></i>If you want to extend this program and make it even better and more interesting, you should create a Web interface to it.\n  The interface will work by...<a href=\"#p_160\" class=\"pid\">160</a>\n</p>\n<ul>\n  <li><i id=\"p_161\" class=\"pid\"></i>Initially showing an \"Admin\" interface, where an administrator can launch an Event contract instance.<a href=\"#p_161\" class=\"pid\">161</a></li>\n  <li><i id=\"p_162\" class=\"pid\"></i>Upon launch, it should turn the contract information into a special URL, or QR code, that can be shared with potential Guests and the Host.<a href=\"#p_162\" class=\"pid\">162</a></li>\n  <li>\n    <i id=\"p_163\" class=\"pid\"></i>The Guest view should allow Guests to see the Event details and the current number of reservations.\n    It should do this without requiring the user to attach a wallet, but if they want to make a reservation, they would have to.\n    It should check to make sure they haven't already registered first (by using the <code>Info.reserved</code> view).<a href=\"#p_163\" class=\"pid\">163</a>\n  </li>\n  <li><i id=\"p_164\" class=\"pid\"></i>The Host view should allow the Host to see who has registered and provide an interface for checking them in, either by clicking a button associated with each <code>Notify.register</code> event, or by scanning their address on their mobile wallet.<a href=\"#p_164\" class=\"pid\">164</a></li>\n</ul>\n<p>\n  <i id=\"p_165\" class=\"pid\"></i>There is nothing new you'd need to learn about Reach to write that Web interface, but you'd have to be good at designing and building Web applications.\n  If you were using Algorand and wanted to provide a wallet to users who don't have an ARC11 wallet, then you'd use <span class=\"snip\"><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.walletFallback\" title=\"js: stdlib.walletFallback\"><span style=\"color: var(--shiki-color-text)\">.walletFallback</span></a></span>, but other than that, your code would look almost identical to our test suite, except you'd have lots of Web interface manipulation code.<a href=\"#p_165\" class=\"pid\">165</a>\n</p>\n<p><i id=\"p_166\" class=\"pid\"></i>So, remember, there's only one thing on this earth more powerful than evil, and that's us!<a href=\"#p_166\" class=\"pid\">166</a></p>","<ul><li class=\"dynamic\">\n    <a href=\"#tut-rsvp\">Répondez S'il Vous Plaît</a>\n    <ul class=\"dynamic\">\n      <li class=\"dynamic\"><a href=\"#tut-rsvp1\">Respond, If You Please</a></li>\n      <li class=\"dynamic\"><a href=\"#tut-rsvp2\">Participate, Please</a></li>\n      <li class=\"dynamic\"><a href=\"#tut-rsvp3\">Yo Dawg...</a></li>\n      <li class=\"dynamic\"><a href=\"#tut-rsvp4-tests\">Test First, but Verify</a></li>\n      <li class=\"dynamic\"><a href=\"#tut-rsvp4-rsh\">A Decentralized DApp</a></li>\n      <li class=\"dynamic\"><a href=\"#tut-rsvp4-mjs\">My Kingdom for a Framework!</a></li>\n      <li class=\"dynamic\"><a href=\"#tut-rsvp5-api\">The API and The Map</a></li>\n      <li class=\"dynamic\"><a href=\"#tut-rsvp5-rsh\">Programming with APIs and Maps</a></li>\n      <li class=\"dynamic\"><a href=\"#tut-rsvp5-mjs\">Testing our APIs and Maps</a></li>\n      <li class=\"dynamic\"><a href=\"#tut-rsvp6-rsh\">A View To An Event</a></li>\n      <li class=\"dynamic\"><a href=\"#tut-rsvp6-mjs\">The Panopticon</a></li>\n      <li class=\"dynamic\"><a href=\"#tut-rsvp7\">Where Do We Go From Here?</a></li>\n    </ul>\n  </li></ul>"]