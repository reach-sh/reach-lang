<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-149147406-1"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-149147406-1');</script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script><script src="tooltips.js"></script><script src="reach-pre.js"></script><link rel="stylesheet" href="tooltips.css"><link rel="stylesheet" href="reach.css"><link rel="stylesheet" href="minted.css"><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>2.7&nbsp;Play and Play Again</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Reach:<span class="mywbr"> &nbsp;</span> The Safest and Easiest DApp Programming Language</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="overview.html" class="tocviewlink" data-pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="tut.html" class="tocviewselflink" data-pltdoc="x">Tutorial</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="guide.html" class="tocviewlink" data-pltdoc="x">Guide</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="workshop.html" class="tocviewlink" data-pltdoc="x">Workshop</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="ref.html" class="tocviewlink" data-pltdoc="x">Reference</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>2&nbsp;</td><td><a href="tut.html" class="tocviewlink" data-pltdoc="x">Tutorial</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="tut-0.html" class="tocviewlink" data-pltdoc="x">Install and Initialize</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="tut-1.html" class="tocviewlink" data-pltdoc="x">Scaffolding and Setup</a></td></tr><tr><td align="right">2.3&nbsp;</td><td><a href="tut-2.html" class="tocviewlink" data-pltdoc="x">Rock, Paper, and Scissors</a></td></tr><tr><td align="right">2.4&nbsp;</td><td><a href="tut-3.html" class="tocviewlink" data-pltdoc="x">Bets and Wagers</a></td></tr><tr><td align="right">2.5&nbsp;</td><td><a href="tut-4.html" class="tocviewlink" data-pltdoc="x">Trust and Commitments</a></td></tr><tr><td align="right">2.6&nbsp;</td><td><a href="tut-5.html" class="tocviewlink" data-pltdoc="x">Timeouts and Participation</a></td></tr><tr><td align="right">2.7&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Play and Play Again</a></td></tr><tr><td align="right">2.8&nbsp;</td><td><a href="tut-7.html" class="tocviewlink" data-pltdoc="x">Interaction and Independence</a></td></tr><tr><td align="right">2.9&nbsp;</td><td><a href="tut-8.html" class="tocviewlink" data-pltdoc="x">Onward and Further</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="tut-5.html" title="backward to &quot;2.6 Timeouts and Participation&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="tut.html" title="up to &quot;2 Tutorial&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tut-7.html" title="forward to &quot;2.8 Interaction and Independence&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>2.7<tt>&nbsp;</tt><a name="(part._tut-6)"></a>Play and Play Again</h4><p>In this section, we extend our application so that Alice and Bob will continue to play against each other until there is a clear winner, so if it is a draw they will continue playing.</p><p>This will only require a change to the Reach program, not the JavaScript <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a>, but we will take the opportunity to modify the <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a> so that timeouts can happen to both parties when they are asked to submit their hands.
Let&rsquo;s do that to get it out of the way and not distract from the main task of removing draws.</p><p>We&rsquo;ll modify the <code class="highlight"><font class="badlink"><span class="nx">Player</span></font></code> interact object so that it will have a different <code class="highlight"><font class="badlink"><span class="nx">getHand</span></font></code> method.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-6/index.mjs#L18-L31"><span class="stt">tut-6/index.mjs</span></a><button class="btn" data-clipboard-text="  const Player = (Who) =&gt; ({
    ...stdlib.hasRandom,
    getHand: async () =&gt; { // &lt;-- async now
      const hand = Math.floor(Math.random()*3);
      console.log(`${Who} played ${HAND[hand]}`);
      if ( Math.random() &lt;= 0.01 ) {
        for ( let i = 0; i &lt; 10; i++ ) {
          console.log(`  ${Who} takes their sweet time sending it back...`);
          await stdlib.wait(1); } }
      return hand; },
    seeOutcome: (outcome) =&gt;
    console.log(`${Who} saw outcome ${OUTCOME[outcome]}`),
    informTimeout: () =&gt;
    console.log(`${Who} observed a timeout`) });"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">18</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">Player</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">Who</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">({</span>
<span class="mi">19</span>      <span class="p">...</span><a href="ref-backend-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><font class="badlink"><span class="nx">hasRandom</span></font><span class="p">,</span>
<span class="mi">20</span>      <font class="badlink"><span class="nx">getHand</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">async</span></font> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="c1">// &lt;-- async now</span>
<span class="mi">21</span>        <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">hand</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nb">Math</span></font><span class="p">.</span><font class="badlink"><span class="nx">floor</span></font><span class="p">(</span><font class="badlink"><span class="nb">Math</span></font><span class="p">.</span><font class="badlink"><span class="nx">random</span></font><span class="p">()</span><font class="badlink"><span class="o">*</span></font><span class="mi">3</span><span class="p">);</span>
<span class="mi">22</span>        <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">Who</span></font><span class="si">}</span><span class="sb"> played </span><span class="si">${</span><font class="badlink"><span class="nx">HAND</span></font><span class="p">[</span><font class="badlink"><span class="nx">hand</span></font><span class="p">]</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mi">23</span>        <font class="badlink"><span class="k">if</span></font> <span class="p">(</span> <font class="badlink"><span class="nb">Math</span></font><span class="p">.</span><font class="badlink"><span class="nx">random</span></font><span class="p">()</span> <font class="badlink"><span class="o">&lt;=</span></font> <span class="mf">0.01</span> <span class="p">)</span> <span class="p">{</span>
<span class="mi">24</span>          <font class="badlink"><span class="k">for</span></font> <span class="p">(</span> <font class="badlink"><span class="kd">let</span></font> <font class="badlink"><span class="nx">i</span></font> <font class="badlink"><span class="o">=</span></font> <span class="mi">0</span><span class="p">;</span> <font class="badlink"><span class="nx">i</span></font> <font class="badlink"><span class="o">&lt;</span></font> <span class="mi">10</span><span class="p">;</span> <font class="badlink"><span class="nx">i</span></font><font class="badlink"><span class="o">++</span></font> <span class="p">)</span> <span class="p">{</span>
<span class="mi">25</span>            <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`  </span><span class="si">${</span><font class="badlink"><span class="nx">Who</span></font><span class="si">}</span><span class="sb"> takes their sweet time sending it back...`</span><span class="p">);</span>
<span class="mi">26</span>            <font class="badlink"><span class="nx">await</span></font> <a href="ref-backend-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-backend-js.html#%28javascript._%28%28wait%29%29%29" class="nx" data-pltdoc="x">wait</a><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="p">}</span> <span class="p">}</span>
<span class="mi">27</span>        <font class="badlink"><span class="k">return</span></font> <font class="badlink"><span class="nx">hand</span></font><span class="p">;</span> <span class="p">},</span>
<span class="mi">28</span>      <font class="badlink"><span class="nx">seeOutcome</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">(</span><font class="badlink"><span class="nx">outcome</span></font><span class="p">)</span> <span class="p">=&gt;</span>
<span class="mi">29</span>      <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">Who</span></font><span class="si">}</span><span class="sb"> saw outcome </span><span class="si">${</span><font class="badlink"><span class="nx">OUTCOME</span></font><span class="p">[</span><font class="badlink"><span class="nx">outcome</span></font><span class="p">]</span><span class="si">}</span><span class="sb">`</span><span class="p">),</span>
<span class="mi">30</span>      <font class="badlink"><span class="nx">informTimeout</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">()</span> <span class="p">=&gt;</span>
<span class="mi">31</span>      <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">Who</span></font><span class="si">}</span><span class="sb"> observed a timeout`</span><span class="p">)</span> <span class="p">});</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Lines 23 through 26 moves the forced timeout code that we wrote for Bob&rsquo;s <code class="highlight"><font class="badlink"><span class="nx">acceptWager</span></font></code> function into this method.
We also change the threshold so that timeouts only happen 1% of the time.
This isn&rsquo;t a very interesting behavior, so we&rsquo;ll make it much less frequent.</p></li></ul><p>We also adjust Bob&rsquo;s <code class="highlight"><font class="badlink"><span class="nx">acceptWager</span></font></code> function to remove the timeout code, since we&rsquo;re testing that differently now.
It&rsquo;s just a matter of reverting to the simpler version from before.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-6/index.mjs#L33-L44"><span class="stt">tut-6/index.mjs</span></a><button class="btn" data-clipboard-text="  await Promise.all([
    backend.Alice(
      stdlib, ctcAlice,
      { ...Player('Alice'),
        wager: toNetworkFormat('5')
      }),
    backend.Bob(
      stdlib, ctcBob,
      { ...Player('Bob'),
        acceptWager: (amt) =&gt;
        console.log(`Bob accepts the wager of ${stdlib.fromWei(amt)}.`)  } )
  ]);"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">33</span>    <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nb">Promise</span></font><span class="p">.</span><font class="badlink"><span class="nx">all</span></font><span class="p">([</span>
<span class="mi">34</span>      <a href="ref-backend-js.html#%28javascript._%28%28backend%29%29%29" class="nx" data-pltdoc="x">backend</a><span class="p">.</span><font class="badlink"><span class="nx">Alice</span></font><span class="p">(</span>
<span class="mi">35</span>        <a href="ref-backend-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">,</span> <font class="badlink"><span class="nx">ctcAlice</span></font><span class="p">,</span>
<span class="mi">36</span>        <span class="p">{</span> <span class="p">...</span><font class="badlink"><span class="nx">Player</span></font><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">),</span>
<span class="mi">37</span>          <font class="badlink"><span class="nx">wager</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">toNetworkFormat</span></font><span class="p">(</span><span class="s1">&#39;5&#39;</span><span class="p">)</span>
<span class="mi">38</span>        <span class="p">}),</span>
<span class="mi">39</span>      <a href="ref-backend-js.html#%28javascript._%28%28backend%29%29%29" class="nx" data-pltdoc="x">backend</a><span class="p">.</span><font class="badlink"><span class="nx">Bob</span></font><span class="p">(</span>
<span class="mi">40</span>        <a href="ref-backend-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">,</span> <font class="badlink"><span class="nx">ctcBob</span></font><span class="p">,</span>
<span class="mi">41</span>        <span class="p">{</span> <span class="p">...</span><font class="badlink"><span class="nx">Player</span></font><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">),</span>
<span class="mi">42</span>          <font class="badlink"><span class="nx">acceptWager</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">(</span><font class="badlink"><span class="nx">amt</span></font><span class="p">)</span> <span class="p">=&gt;</span>
<span class="mi">43</span>          <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`Bob accepts the wager of </span><span class="si">${</span><a href="ref-backend-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-backend-js.html#%28javascript._%28%28from.Wei%29%29%29" class="nx" data-pltdoc="x">fromWei</a><span class="p">(</span><font class="badlink"><span class="nx">amt</span></font><span class="p">)</span><span class="si">}</span><span class="sb">.`</span><span class="p">)</span>  <span class="p">}</span> <span class="p">)</span>
<span class="mi">44</span>    <span class="p">]);</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 42 and 43 has the simpler <code class="highlight"><font class="badlink"><span class="nx">acceptWager</span></font></code> method for Bob.</p></li></ul><p><span style="font-weight: bold">&#8212;<wbr></wbr></span></p><p>Now, let&rsquo;s look at the Reach application.
All of the details about the playing of the game and the interface to the players will remain the same.
The only thing that&rsquo;s going to be different is the order the actions take place.</p><p>It used to be that the steps were:</p><ol><li><p>Alice sends her wager and commitment.</p></li><li><p>Bob accepts the wager and sends his hand.</p></li><li><p>Alice reveals her hand.</p></li><li><p>The game ends.</p></li></ol><p>But, now because the players may submit many hands, but should only  have a single wager, we&rsquo;ll break these steps up differently, as follows:</p><ol><li><p>Alice sends her wager.</p></li><li><p>Bob accepts the wager.</p></li><li><p>Alice sends her commitment.</p></li><li><p>Bob sends his hand.</p></li><li><p>Alice reveals her hand.</p></li><li><p>If it&rsquo;s draw, return to step 3; otherwise, the game ends.</p></li></ol><p>Let&rsquo;s make these changes now.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-6/index.rsh#L42-L46"><span class="stt">tut-6/index.rsh</span></a><button class="btn" data-clipboard-text="      A.only(() =&gt; {
        const wager = declassify(interact.wager); });
      A.publish(wager)
        .pay(wager);
      commit();"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">42</span>    <font class="badlink"><span class="nx">A</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28only%29%29%29" class="k" data-pltdoc="x">only</a><span class="p">(()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">43</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">wager</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28declassify%29%29%29" class="k" data-pltdoc="x">declassify</a><span class="p">(</span><a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">wager</span></font><span class="p">);</span> <span class="p">});</span>
<span class="mi">44</span>    <font class="badlink"><span class="nx">A</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">(</span><font class="badlink"><span class="nx">wager</span></font><span class="p">)</span>
<span class="mi">45</span>      <span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28pay%29%29%29" class="k" data-pltdoc="x">pay</a><span class="p">(</span><font class="badlink"><span class="nx">wager</span></font><span class="p">);</span>
<span class="mi">46</span>    <a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 44 has Alice publish and pay the wager.</p></li></ul><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-6/index.rsh#L48-L52"><span class="stt">tut-6/index.rsh</span></a><button class="btn" data-clipboard-text="      B.only(() =&gt; {
        interact.acceptWager(wager); });
      B.pay(wager)
        .timeout(DEADLINE, () =&gt; closeTo(A, informTimeout));
"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">48</span>    <font class="badlink"><span class="nx">B</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28only%29%29%29" class="k" data-pltdoc="x">only</a><span class="p">(()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">49</span>      <a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">acceptWager</span></font><span class="p">(</span><font class="badlink"><span class="nx">wager</span></font><span class="p">);</span> <span class="p">});</span>
<span class="mi">50</span>    <font class="badlink"><span class="nx">B</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28pay%29%29%29" class="k" data-pltdoc="x">pay</a><span class="p">(</span><font class="badlink"><span class="nx">wager</span></font><span class="p">)</span>
<span class="mi">51</span>      <span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28timeout%29%29%29" class="k" data-pltdoc="x">timeout</a><span class="p">(</span><font class="badlink"><span class="nx">DEADLINE</span></font><span class="p">,</span> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <a href="ref-programs-step.html#%28reach._%28%28close.To%29%29%29" class="nb" data-pltdoc="x">closeTo</a><span class="p">(</span><font class="badlink"><span class="nx">A</span></font><span class="p">,</span> <font class="badlink"><span class="nx">informTimeout</span></font><span class="p">));</span>
<span class="mi">52</span>    
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 50 has Bob pay the wager.</p></li><li><p>Line 52 does <span style="font-weight: bold">not</span> have this <a href="ref-model.html#%28tech._consensus._step%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus step</span></a> commit.</p></li></ul><p><span style="font-weight: bold">&#8212;<wbr></wbr></span></p><p>It&rsquo;s now time to begin the repeatable section of the application, where each party will repeatedly submit hands until the the outcome is not a draw.
In normal programming languages, such a circumstance would be implemented with a <code class="highlight"><font class="badlink"><span class="k">while</span></font></code> loop, which is exactly what we&rsquo;ll do in Reach.
However, <code class="highlight"><a href="ref-programs-consensus.html#%28reach._%28%28while%29%29%29" class="k" data-pltdoc="x">while</a></code> loops in Reach require extra care, as discussed in <a href="guide-loop-invs.html" data-pltdoc="x">the guide on loops in Reach</a>, so we&rsquo;ll take it slow.</p><p>In the rest of a Reach program, all identifier bindings are static and unchangable, but if this were the case throughout all of Reach, then <code class="highlight"><a href="ref-programs-consensus.html#%28reach._%28%28while%29%29%29" class="k" data-pltdoc="x">while</a></code> loops would either never start or never terminate, because the loop condition would never change.
So, a <code class="highlight"><a href="ref-programs-consensus.html#%28reach._%28%28while%29%29%29" class="k" data-pltdoc="x">while</a></code> loop in Reach can introduce a variable binding.</p><p>Next, because of Reach&rsquo;s <a href="guide-assert.html" data-pltdoc="x">automatic verification</a> engine, we must be able to make a statement about what properties of the program are invariant before and after a <code class="highlight"><a href="ref-programs-consensus.html#%28reach._%28%28while%29%29%29" class="k" data-pltdoc="x">while</a></code> loop body&rsquo;s execution, a so-called <a href="guide-loop-invs.html" data-pltdoc="x">"loop invariant"</a>.</p><p>Finally, such loops <span class="emph">may only occur</span> inside of <a href="ref-model.html#%28tech._consensus._step%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus steps</span></a>.
That&rsquo;s why Bob&rsquo;s transaction was not committed, because we need to remain inside of the consensus to start the <code class="highlight"><a href="ref-programs-consensus.html#%28reach._%28%28while%29%29%29" class="k" data-pltdoc="x">while</a></code> loop.
This is because all of the <a href="ref-model.html#%28tech._participant%29" class="techoutside" data-pltdoc="x"><span class="techinside">participants</span></a> must agree on the direction of control flow in the application.</p><p>Here&rsquo;s what the structure looks like:</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-6/index.rsh#L53-L55"><span class="stt">tut-6/index.rsh</span></a><button class="btn" data-clipboard-text="      var outcome = DRAW;
      invariant(balance() == 2 * wager &amp;&amp; isOutcome(outcome) );
      while ( outcome == DRAW ) {"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">53</span>    <a href="ref-programs-consensus.html#%28reach._%28%28var%29%29%29" class="kd" data-pltdoc="x">var</a> <font class="badlink"><span class="nx">outcome</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">DRAW</span></font><span class="p">;</span>
<span class="mi">54</span>    <a href="ref-programs-consensus.html#%28reach._%28%28invariant%29%29%29" class="k" data-pltdoc="x">invariant</a><span class="p">(</span><a href="ref-programs-compute.html#%28reach._%28%28balance%29%29%29" class="nb" data-pltdoc="x">balance</a><span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d~3d%29%29%29" class="o" data-pltdoc="x">==</a> <span class="mi">2</span> <a href="ref-programs-compute.html#%28reach._%28%28%2A%29%29%29" class="o" data-pltdoc="x">*</a> <font class="badlink"><span class="nx">wager</span></font> <a href="ref-programs-compute.html#%28reach._%28%28~26._~26%29%29%29" class="o" data-pltdoc="x">&amp;&amp;</a> <font class="badlink"><span class="nx">isOutcome</span></font><span class="p">(</span><font class="badlink"><span class="nx">outcome</span></font><span class="p">)</span> <span class="p">);</span>
<span class="mi">55</span>    <a href="ref-programs-consensus.html#%28reach._%28%28while%29%29%29" class="k" data-pltdoc="x">while</a> <span class="p">(</span> <font class="badlink"><span class="nx">outcome</span></font> <a href="ref-programs-compute.html#%28reach._%28%28~3d~3d%29%29%29" class="o" data-pltdoc="x">==</a> <font class="badlink"><span class="nx">DRAW</span></font> <span class="p">)</span> <span class="p">{</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 53 defines the loop variable, <code class="highlight"><font class="badlink"><span class="nx">outcome</span></font></code>.</p></li><li><p>Line 54 states the invariant that body of the loop does not change the balance in the <a href="ref-model.html#%28tech._contract%29" class="techoutside" data-pltdoc="x"><span class="techinside">contract</span></a> account and that  <code class="highlight"><font class="badlink"><span class="nx">outcome</span></font></code> is a valid outcome.</p></li><li><p>Line 55 begins the loop with the condition that it continues as long as the outcome is a draw.</p></li></ul><p>Now, let&rsquo;s look at the body of the loop for the remaining steps, starting with Alice&rsquo;s commitment to her hand.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-6/index.rsh#L56-L64"><span class="stt">tut-6/index.rsh</span></a><button class="btn" data-clipboard-text="        commit();

        A.only(() =&gt; {
          const _handA = interact.getHand();
          const [_commitA, _saltA] = makeCommitment(interact, _handA);
          const commitA = declassify(_commitA); });
        A.publish(commitA)
          .timeout(DEADLINE, () =&gt; closeTo(B, informTimeout));
        commit();"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">56</span>    <a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>
<span class="mi">57</span>    
<span class="mi">58</span>    <font class="badlink"><span class="nx">A</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28only%29%29%29" class="k" data-pltdoc="x">only</a><span class="p">(()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">59</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">_handA</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">getHand</span></font><span class="p">();</span>
<span class="mi">60</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <span class="p">[</span><font class="badlink"><span class="nx">_commitA</span></font><span class="p">,</span> <font class="badlink"><span class="nx">_saltA</span></font><span class="p">]</span> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28make.Commitment%29%29%29" class="nb" data-pltdoc="x">makeCommitment</a><span class="p">(</span><a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">,</span> <font class="badlink"><span class="nx">_handA</span></font><span class="p">);</span>
<span class="mi">61</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">commitA</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28declassify%29%29%29" class="k" data-pltdoc="x">declassify</a><span class="p">(</span><font class="badlink"><span class="nx">_commitA</span></font><span class="p">);</span> <span class="p">});</span>
<span class="mi">62</span>    <font class="badlink"><span class="nx">A</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">(</span><font class="badlink"><span class="nx">commitA</span></font><span class="p">)</span>
<span class="mi">63</span>      <span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28timeout%29%29%29" class="k" data-pltdoc="x">timeout</a><span class="p">(</span><font class="badlink"><span class="nx">DEADLINE</span></font><span class="p">,</span> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <a href="ref-programs-step.html#%28reach._%28%28close.To%29%29%29" class="nb" data-pltdoc="x">closeTo</a><span class="p">(</span><font class="badlink"><span class="nx">B</span></font><span class="p">,</span> <font class="badlink"><span class="nx">informTimeout</span></font><span class="p">));</span>
<span class="mi">64</span>    <a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 56 commits the last transaction, which at the start of the loop is Bob&rsquo;s acceptance of the wager, and at subsequent runs of the loop is Alice&rsquo;s publication of her hand.</p></li><li><p>Lines 58 through 64 are almost identical to the older version, except the wager is already known and paid.</p></li></ul><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-6/index.rsh#L66-L71"><span class="stt">tut-6/index.rsh</span></a><button class="btn" data-clipboard-text="        unknowable(B, A(_handA, _saltA));
        B.only(() =&gt; {
          const handB = declassify(interact.getHand()); });
        B.publish(handB)
          .timeout(DEADLINE, () =&gt; closeTo(A, informTimeout));
        commit();"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">66</span>    <a href="ref-programs-step.html#%28reach._%28%28unknowable%29%29%29" class="k" data-pltdoc="x">unknowable</a><span class="p">(</span><font class="badlink"><span class="nx">B</span></font><span class="p">,</span> <font class="badlink"><span class="nx">A</span></font><span class="p">(</span><font class="badlink"><span class="nx">_handA</span></font><span class="p">,</span> <font class="badlink"><span class="nx">_saltA</span></font><span class="p">));</span>
<span class="mi">67</span>    <font class="badlink"><span class="nx">B</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28only%29%29%29" class="k" data-pltdoc="x">only</a><span class="p">(()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">68</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">handB</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28declassify%29%29%29" class="k" data-pltdoc="x">declassify</a><span class="p">(</span><a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">getHand</span></font><span class="p">());</span> <span class="p">});</span>
<span class="mi">69</span>    <font class="badlink"><span class="nx">B</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">(</span><font class="badlink"><span class="nx">handB</span></font><span class="p">)</span>
<span class="mi">70</span>      <span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28timeout%29%29%29" class="k" data-pltdoc="x">timeout</a><span class="p">(</span><font class="badlink"><span class="nx">DEADLINE</span></font><span class="p">,</span> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <a href="ref-programs-step.html#%28reach._%28%28close.To%29%29%29" class="nb" data-pltdoc="x">closeTo</a><span class="p">(</span><font class="badlink"><span class="nx">A</span></font><span class="p">,</span> <font class="badlink"><span class="nx">informTimeout</span></font><span class="p">));</span>
<span class="mi">71</span>    <a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>Similarly, Bob&rsquo;s code is almost identical to the prior version, except that he&rsquo;s already accepted and paid the wager.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-6/index.rsh#L73-L77"><span class="stt">tut-6/index.rsh</span></a><button class="btn" data-clipboard-text="        A.only(() =&gt; {
          const [saltA, handA] = declassify([_saltA, _handA]); });
        A.publish(saltA, handA)
          .timeout(DEADLINE, () =&gt; closeTo(B, informTimeout));
        checkCommitment(commitA, saltA, handA);"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">73</span>    <font class="badlink"><span class="nx">A</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28only%29%29%29" class="k" data-pltdoc="x">only</a><span class="p">(()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">74</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <span class="p">[</span><font class="badlink"><span class="nx">saltA</span></font><span class="p">,</span> <font class="badlink"><span class="nx">handA</span></font><span class="p">]</span> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28declassify%29%29%29" class="k" data-pltdoc="x">declassify</a><span class="p">([</span><font class="badlink"><span class="nx">_saltA</span></font><span class="p">,</span> <font class="badlink"><span class="nx">_handA</span></font><span class="p">]);</span> <span class="p">});</span>
<span class="mi">75</span>    <font class="badlink"><span class="nx">A</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">(</span><font class="badlink"><span class="nx">saltA</span></font><span class="p">,</span> <font class="badlink"><span class="nx">handA</span></font><span class="p">)</span>
<span class="mi">76</span>      <span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28timeout%29%29%29" class="k" data-pltdoc="x">timeout</a><span class="p">(</span><font class="badlink"><span class="nx">DEADLINE</span></font><span class="p">,</span> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <a href="ref-programs-step.html#%28reach._%28%28close.To%29%29%29" class="nb" data-pltdoc="x">closeTo</a><span class="p">(</span><font class="badlink"><span class="nx">B</span></font><span class="p">,</span> <font class="badlink"><span class="nx">informTimeout</span></font><span class="p">));</span>
<span class="mi">77</span>    <a href="ref-programs-consensus.html#%28reach._%28%28check.Commitment%29%29%29" class="nb" data-pltdoc="x">checkCommitment</a><span class="p">(</span><font class="badlink"><span class="nx">commitA</span></font><span class="p">,</span> <font class="badlink"><span class="nx">saltA</span></font><span class="p">,</span> <font class="badlink"><span class="nx">handA</span></font><span class="p">);</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>Alice&rsquo;s next step is actually identical, because she is still revealing her hand in exactly the same way.</p><p>Next is the end of the loop.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-6/index.rsh#L79-L80"><span class="stt">tut-6/index.rsh</span></a><button class="btn" data-clipboard-text="        outcome = winner(handA, handB);
        continue; }"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">79</span>    <font class="badlink"><span class="nx">outcome</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">winner</span></font><span class="p">(</span><font class="badlink"><span class="nx">handA</span></font><span class="p">,</span> <font class="badlink"><span class="nx">handB</span></font><span class="p">);</span>
<span class="mi">80</span>    <a href="ref-programs-consensus.html#%28reach._%28%28continue%29%29%29" class="k" data-pltdoc="x">continue</a><span class="p">;</span> <span class="p">}</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 79 updates the <code class="highlight"><font class="badlink"><span class="nx">outcome</span></font></code> loop variable with the new value.</p></li><li><p>Line 80 continues the loop.
Unlike most programming languages, Reach <span style="font-weight: bold">requires</span> that <code class="highlight"><a href="ref-programs-consensus.html#%28reach._%28%28continue%29%29%29" class="k" data-pltdoc="x">continue</a></code> be explicitly written in the loop body.</p></li></ul><p>The rest of the program could be exactly the same as it was before, except now it occurs outside of the loop, but we will simplify it, because we know that the outcome can never be a draw.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-6/index.rsh#L82-L88"><span class="stt">tut-6/index.rsh</span></a><button class="btn" data-clipboard-text="      assert(outcome == A_WINS || outcome == B_WINS);
      transfer(2 * wager).to(outcome == A_WINS ? A : B);
      commit();

      each([A, B], () =&gt; {
        interact.seeOutcome(outcome); });
      exit(); });"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">82</span>    <a href="ref-programs-compute.html#%28reach._%28%28assert%29%29%29" class="k" data-pltdoc="x">assert</a><span class="p">(</span><font class="badlink"><span class="nx">outcome</span></font> <a href="ref-programs-compute.html#%28reach._%28%28~3d~3d%29%29%29" class="o" data-pltdoc="x">==</a> <font class="badlink"><span class="nx">A_WINS</span></font> <a href="ref-programs-compute.html#%28reach._%28%28~7c~7c%29%29%29" class="o" data-pltdoc="x">||</a> <font class="badlink"><span class="nx">outcome</span></font> <a href="ref-programs-compute.html#%28reach._%28%28~3d~3d%29%29%29" class="o" data-pltdoc="x">==</a> <font class="badlink"><span class="nx">B_WINS</span></font><span class="p">);</span>
<span class="mi">83</span>    <a href="ref-programs-consensus.html#%28reach._%28%28transfer%29%29%29" class="k" data-pltdoc="x">transfer</a><span class="p">(</span><span class="mi">2</span> <a href="ref-programs-compute.html#%28reach._%28%28%2A%29%29%29" class="o" data-pltdoc="x">*</a> <font class="badlink"><span class="nx">wager</span></font><span class="p">).</span><font class="badlink"><span class="nx">to</span></font><span class="p">(</span><font class="badlink"><span class="nx">outcome</span></font> <a href="ref-programs-compute.html#%28reach._%28%28~3d~3d%29%29%29" class="o" data-pltdoc="x">==</a> <font class="badlink"><span class="nx">A_WINS</span></font> <a href="ref-programs-compute.html#%28reach._%28%28~3f%29%29%29" class="o" data-pltdoc="x">?</a> <font class="badlink"><span class="nx">A</span></font> <font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">B</span></font><span class="p">);</span>
<span class="mi">84</span>    <a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>
<span class="mi">85</span>    
<span class="mi">86</span>    <a href="ref-programs-step.html#%28reach._%28%28each%29%29%29" class="k" data-pltdoc="x">each</a><span class="p">([</span><font class="badlink"><span class="nx">A</span></font><span class="p">,</span> <font class="badlink"><span class="nx">B</span></font><span class="p">],</span> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">87</span>      <a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">seeOutcome</span></font><span class="p">(</span><font class="badlink"><span class="nx">outcome</span></font><span class="p">);</span> <span class="p">});</span>
<span class="mi">88</span>    <a href="ref-programs-step.html#%28reach._%28%28exit%29%29%29" class="k" data-pltdoc="x">exit</a><span class="p">();</span> <span class="p">});</span>
</pre></div></div></p><ul><li><p>Line 82 asserts that the outcome is never draw, which is trivially true because otherwise the <code class="highlight"><a href="ref-programs-consensus.html#%28reach._%28%28while%29%29%29" class="k" data-pltdoc="x">while</a></code> loop would not have exitted.</p></li><li><p>Line 83 transfers the funds to the winner.</p></li></ul><p><span style="font-weight: bold">&#8212;<wbr></wbr></span></p><p>Let&rsquo;s run the program and see what happens:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">$ ./reach run</span></p></td></tr><tr><td><p><span class="stt">Bob accepts the wager of 5.0.</span></p></td></tr><tr><td><p><span class="stt">Alice played Paper</span></p></td></tr><tr><td><p><span class="stt">Bob played Rock</span></p></td></tr><tr><td><p><span class="stt">Bob saw outcome Alice wins</span></p></td></tr><tr><td><p><span class="stt">Alice saw outcome Alice wins</span></p></td></tr><tr><td><p><span class="stt">Alice went from 10.0 to 14.999999999999040261.</span></p></td></tr><tr><td><p><span class="stt">Bob went from 10.0 to 4.999999999999938085.</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">$ ./reach run</span></p></td></tr><tr><td><p><span class="stt">Bob accepts the wager of 5.0.</span></p></td></tr><tr><td><p><span class="stt">Alice played Rock</span></p></td></tr><tr><td><p><span class="stt">Bob played Rock</span></p></td></tr><tr><td><p><span class="stt">Alice played Paper</span></p></td></tr><tr><td><p><span class="stt">Bob played Scissors</span></p></td></tr><tr><td><p><span class="stt">Bob saw outcome Bob wins</span></p></td></tr><tr><td><p><span class="stt">Alice saw outcome Bob wins</span></p></td></tr><tr><td><p><span class="stt">Alice went from 10.0 to 4.999999999998975474.</span></p></td></tr><tr><td><p><span class="stt">Bob went from 10.0 to 14.999999999999906275.</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">$ ./reach run</span></p></td></tr><tr><td><p><span class="stt">Bob accepts the wager of 5.0.</span></p></td></tr><tr><td><p><span class="stt">Alice played Scissors</span></p></td></tr><tr><td><p><span class="stt">Bob played Rock</span></p></td></tr><tr><td><p><span class="stt">Bob saw outcome Bob wins</span></p></td></tr><tr><td><p><span class="stt">Alice saw outcome Bob wins</span></p></td></tr><tr><td><p><span class="stt">Alice went from 10.0 to 4.999999999999040265.</span></p></td></tr><tr><td><p><span class="stt">Bob went from 10.0 to 14.999999999999938097.</span></p></td></tr></table></p><p>As usual, your results may differ, but you should be able to see single round victories like this, as well as multi-round fights and timeouts from either party.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>If your version isn&rsquo;t working, look at the complete versions of <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-6/index.rsh"><span class="stt">tut-6/index.rsh</span></a> and <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-6/index.mjs"><span class="stt">tut-6/index.mjs</span></a> to make sure you copied everything down correctly!</p></blockquote></blockquote></blockquote><p>Now our implementation of <span class="emph">Rock, Paper, Scissors</span> will always result in a pay-out, which is much more fun for everyone.
In <a href="tut-7.html" data-pltdoc="x">the final step</a>, we&rsquo;ll show how to exit "testing" mode with Reach and turn our JavaScript into an interactive <span class="emph">Rock, Paper, Scissors</span> game with real users.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="tut-5.html" title="backward to &quot;2.6 Timeouts and Participation&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="tut.html" title="up to &quot;2 Tutorial&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tut-7.html" title="forward to &quot;2.8 Interaction and Independence&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div><script src="reach-post.js"></script></body></html>